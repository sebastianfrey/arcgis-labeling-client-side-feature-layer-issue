const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-C_bK48d2.js","./index-DxLSJ8yk.css"])))=>i.map(i=>d[i]);
import{ly as V,oJ as N,lz as F,eF as O,ob as I,oK as R,oL as S,_ as w,hc as U,oM as M,oN as T,gi as B,ci as _,d3 as A,N as k,oO as q,ch as Q,oP as D,ej as L}from"./index-C_bK48d2.js";import{a as m}from"./utils-B2fTWpox.js";import{x as j}from"./utils-qlOu9s_F.js";function ge({level:e,class:t,...n},o){const a=$(e);return V(`h${a}`,{...n,"aria-level":String(a),class:N(F.heading,t),role:"heading"},o)}function $(e){return O(Math.ceil(e),1,6)}function he(e,t=1){return $(e+t)}const K=/^-?(\d+)(\.(\d+))?$/i;function P(e,t){return e-t}function W(e,t){let n,o;return n=Number(e.toFixed(t)),n<e?o=n+1/10**t:(o=n,n-=1/10**t),n=Number(n.toFixed(t)),o=Number(o.toFixed(t)),[n,o]}function Z(e,t,n,o,a){const l=G(e,t,n,o),i=l.previous==null||l.previous<=a,r=l.next==null||l.next<=a;return i&&r||l.previous+l.next<=2*a}function x(e){const t=String(e),n=t.match(K);if(n!=null&&n[1])return{integer:n[1].split("").length,fractional:n[3]?n[3].split("").length:0};if(t.toLowerCase().includes("e")){const o=t.split("e"),a=o[0],l=o[1];if(a&&l){const i=Number(a);let r=Number(l);const u=r>0;u||(r=Math.abs(r));const s=x(i);return u?(s.integer+=r,r>s.fractional?s.fractional=0:s.fractional-=r):(s.fractional+=r,r>s.integer?s.integer=1:s.integer-=r),s}}return{integer:0,fractional:0}}function G(e,t,n,o){const a={previous:null,next:null};if(n!=null){const l=e-n,i=t-n-l;a.previous=Math.floor(Math.abs(100*i/l))}if(o!=null){const l=o-e,i=o-t-l;a.next=Math.floor(Math.abs(100*i/l))}return a}function we(e,t={}){const n=e.slice(),{tolerance:o=2,strictBounds:a=!1,indexes:l=n.map((i,r)=>r)}=t;l.sort(P);for(let i=0;i<l.length;i++){const r=l[i],u=n[r],s=r===0?null:n[r-1],f=r===n.length-1?null:n[r+1],p=x(u).fractional;if(p){let d,g=0,h=!1;for(;g<=p&&!h;){const b=W(u,g);d=a&&i===0?b[1]:b[0],h=Z(u,d,s,f,o),g++}h&&(n[r]=d)}}return n}const z={maximumFractionDigits:20};function H(e){return I(e,z)}const X="<",Y=">";function J(e,t,n,o){let a="";t===0?a=`${X} `:t===n&&(a=`${Y} `);const l=te(e,o);return l==null?"":a+l}function ee(e){const{format:t,fieldFormat:n}=e||{};return(n==null?void 0:n.type)==="number"||!!t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)}function te(e,t){if(e==null)return e;const{fieldType:n,format:o,fieldFormat:a,timeZoneOptions:l}=t||{};if(y(n))return j(e,{fieldType:n,format:o==null?void 0:o.dateFormat,fieldFormat:(a==null?void 0:a.type)==="date-time"?a:void 0,timeZoneOptions:l});if(typeof e=="string"&&ee(t)){const r=Number(e);isNaN(r)||(e=r)}if(typeof e=="string")return e;const i=(a==null?void 0:a.type)==="number"?R(a):o?S(o):void 0;return i?I(e,i):H(e)}const ye=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function ne(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find(i=>i.type==="color");if(!t)return null;let n=null,o=null;if(t.stops){if(t.stops.length===1)return t.stops[0].color;n=t.stops[0].value,o=t.stops[t.stops.length-1].value}const a=n!=null&&o!=null?n+(o-n)/2:0,{getColor:l}=await w(async()=>{const{getColor:i}=await import("./index-C_bK48d2.js").then(r=>r.xg);return{getColor:i}},__vite__mapDeps([0,1]),import.meta.url);return l(t,a)??null}async function be(e,t){const n=e.trailCap,o=e.trailWidth||1,a=t||await ne(e)||e.color;return new U({cap:n,color:a,width:o})}function oe(e,t){var n,o;if(!t)return null;if("featureReduction"in e)switch((n=e.featureReduction)==null?void 0:n.type){case"cluster":case"binning":{const a=e.featureReduction.fields.find(({name:l})=>l.toLowerCase()===t.toLowerCase());return a&&"getField"in e?e.getField(a.onStatisticField):null}}return"getField"in e?(o=e.getField)==null?void 0:o.call(e,t):null}function ae(e,t){var o;const n="popupTemplate"in e?(o=e.popupTemplate)==null?void 0:o.fieldInfos:null;if(n!=null&&n.length&&t)return n.find(a=>{var l;return((l=a.fieldName)==null?void 0:l.toLowerCase())===t.toLowerCase()})}function v(e){var o,a,l,i;let t=0,n=0;return e.stops?(t=((a=(o=e.stops)==null?void 0:o.at(0))==null?void 0:a.value)??t,n=((i=(l=e.stops)==null?void 0:l.at(-1))==null?void 0:i.value)??n):"minDataValue"in e&&"maxDataValue"in e&&(t=e.minDataValue??t,n=e.maxDataValue??n),n-t>2*B.days?"short-date":"short-date-short-time"}function y(e){return["date","date-only","time-only","timestamp-offset"].includes(e||"")}function C(e){return _(e)&&!("featureReduction"in e&&e.featureReduction)}function ve(e,t,n){const o=le(e,t.field,n);return o?(y(o.fieldType)&&(C(e)?o.fieldFormat??(o.fieldFormat=new M({dateStyle:"short",timeStyle:v(t)==="short-date-short-time"?"short":null})):o.format??(o.format=new T({dateFormat:v(t)}))),o):null}function le(e,t,n){var r,u;const o=oe(e,t),a=o==null?void 0:o.name;if(!a)return null;const l=o==null?void 0:o.type,i=C(e);return{fieldType:l,format:i?null:(r=ae(e,a))==null?void 0:r.format,fieldFormat:i?(u=e.getFieldConfiguration(a))==null?void 0:u.fieldFormat:null,timeZoneOptions:y(l)?{layerTimeZone:"preferredTimeZone"in e?e.preferredTimeZone:null,viewTimeZone:n,datesInUnknownTimezone:"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone}:null}}function Ie(e,t){var n,o;if("authoringInfo"in e)return(o=(n=e.authoringInfo)==null?void 0:n.visualVariables)==null?void 0:o.find(({theme:a})=>a===t)}function $e(e,t){let n=e??"";return t!=null&&t&&(n=n?"("+n+") AND ("+t+")":t),n}const re=new A([64,64,64]);function E(e,t){const n=[],o=e.length-1;return e.length===5?n.push(0,2,4):n.push(0,o),e.map((a,l)=>n.includes(l)?J(a,l,o,t):null)}async function ie(e,t,n){let o=!1,a=[],l=[];if(e.stops){const s=e.stops;a=s.map(f=>f.value),o=s.some(f=>!!f.label),o&&(l=s.map(f=>f.label))}const i=a[0],r=a[a.length-1];if(i==null&&r==null)return null;const u=o?null:E(a,n);return(await Promise.all(a.map(async(s,f)=>{const p=e.type==="opacity"?await ue(s,e,t):(await w(async()=>{const{getColor:g}=await import("./index-C_bK48d2.js").then(h=>h.xg);return{getColor:g}},__vite__mapDeps([0,1]),import.meta.url)).getColor(e,s),d=o?l[f]:(u==null?void 0:u[f])??"";return p==null?null:{value:s,color:p,label:d}}))).filter(k).reverse()}async function ue(e,t,n){const o=new A(n??re),a=(await w(async()=>{const{getOpacity:l}=await import("./index-C_bK48d2.js").then(i=>i.xg);return{getOpacity:l}},__vite__mapDeps([0,1]),import.meta.url)).getOpacity(t,e);return a!=null&&(o.a=a),o}function xe(e){let t=!1,n=[],o=[];n=e.map(r=>r.value),t=e.some(r=>!!r.label),t&&(o=e.map(r=>r.label??""));const a=n[0],l=n[n.length-1];if(a==null&&l==null)return null;const i=t?null:E(n);return n.map((r,u)=>({value:r,color:se(r,e),label:t?o[u]:(i==null?void 0:i[u])??""})).reverse()}function se(e,t){const{startIndex:n,endIndex:o,weight:a}=ce(e,t);if(n===o)return t[n].color;const l=A.blendColors(t[n].color,t[o].color,a);return new A(l)}function ce(e,t){let n=0,o=t.length-1;return t.some((a,l)=>e<a.value?(o=l,!0):(n=l,!1)),{startIndex:n,endIndex:o,weight:(e-t[n].value)/(t[o].value-t[n].value)}}function Ce(e,t){let n=[];if((e==null?void 0:e.type)==="multipart")e.colorRamps.reverse().forEach((o,a)=>{a===0?n.push({value:t.max,color:new A(o.toColor),label:"high"}):n.push({value:null,color:new A(o.toColor),label:""}),a===e.colorRamps.length-1?n.push({value:t.min,color:new A(o.fromColor),label:"low"}):n.push({value:null,color:new A(o.fromColor),label:""})});else{let o,a;(e==null?void 0:e.type)==="algorithmic"?(o=e.fromColor,a=e.toColor):(o=[0,0,0,1],a=[255,255,255,1]),n=[{value:t.max,color:new A(a),label:"high"},{value:t.min,color:new A(o),label:"low"}]}return n}function fe(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(o=>{var a;return((a=o.color)==null?void 0:a.a)>0});let n=t.length-1;if(t&&t[0]){const o=t[n];o&&o.ratio!==1&&(t.push(new q({ratio:1,color:o.color})),n++)}return t.map((o,a)=>{var i,r;let l="";return a===0?l=((i=e.legendOptions)==null?void 0:i.minLabel)||"low":a===n&&(l=((r=e.legendOptions)==null?void 0:r.maxLabel)||"high"),{color:o.color,label:l,ratio:o.ratio}}).reverse()}Q("short-date");async function c(e,t,n){L(e,t,()=>[]).push(...n)}async function Ee(e){var n,o;const t=new Map;if(!e)return t;if("visualVariables"in e&&e.visualVariables){for(const a of e.visualVariables)if(Ae(a)){const l=(await ie(a)??[]).map(i=>i.color);await c(t,a.field||a.valueExpression,l)}}if(e.type==="heatmap"){const a=fe(e).map(l=>l.color);await c(t,e.field||e.valueExpression,a)}else if(e.type==="pie-chart"){for(const a of e.attributes)await c(t,a.field||a.valueExpression,[a.color]);await c(t,"default",[(n=e==null?void 0:e.othersCategory)==null?void 0:n.color,m(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const a of e.attributes)await c(t,a.field||a.valueExpression,[a.color]);await c(t,"default",[e.backgroundColor])}else if(e.type==="unique-value")if(((o=e.authoringInfo)==null?void 0:o.type)==="predominance")for(const a of e.uniqueValueInfos??[])await c(t,a.value.toString(),[m(a.symbol,null)]);else{const a=(e.uniqueValueInfos??[]).map(s=>m(s.symbol,null)),{field:l,field2:i,field3:r,valueExpression:u}=e;(l||u)&&await c(t,l||u,a),i&&await c(t,i,a),r&&await c(t,r,a)}else if(e.type==="class-breaks"){const a=e.classBreakInfos.map(r=>m(r.symbol,null)),{field:l,valueExpression:i}=e;await c(t,l??i,a)}else e.type==="simple"&&await c(t,"default",[m(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&await c(t,"default",[m(e.defaultSymbol,null)]),t.forEach((a,l)=>{const i=D(a.filter(Boolean),(r,u)=>JSON.stringify(r)===JSON.stringify(u));t.set(l,i)}),t}function Ae(e){return e.type==="color"}export{le as C,ve as V,X as a,xe as b,$e as c,te as d,Ce as e,Y as f,ne as g,ye as h,x as i,Ie as j,ge as k,G as l,J as m,he as n,fe as r,se as s,ie as t,we as u,be as w,Ee as x};
