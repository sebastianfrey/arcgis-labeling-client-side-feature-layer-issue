import{eT as d,eU as p,eV as h,aF as y,eW as g,cF as c,eX as b,eY as v,eZ as f,aO as m,e_ as I,e$ as x,f0 as _,f1 as T,aJ as s,aK as n,aL as w,f2 as S}from"./index-C_bK48d2.js";import{c as o}from"./layerViewUtils-B_qaHejE.js";let i=class extends d(p(S)){get spatialReferenceSupported(){return!0}constructor(t){super(t),this._updatingHandles=new h,this._attributionIndexTask=null,this.layer=null,this.parent=null}initialize(){this.when().catch(t=>{var e;if(t.name!=="layerview:create-error"){const r=this.layer&&this.layer.id||"no id",a=((e=this.layer)==null?void 0:e.title)||"no title";y.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${a}', id: '${r}')`,t)}})}destroy(){this._updatingHandles=g(this._updatingHandles),this._attributionIndexTask=c(this._attributionIndexTask),this._set("parent",null)}get attributionItems(){var r;const t=this._get("attributionItems")??[];if(this.suspended||!((r=this.layer)!=null&&r.attributionVisible))return t.length===0?t:[];if(!this.view.stationary)return t;const e=this.getAttributionItems();return(t==null?void 0:t.length)!==e.length||t!=null&&t.some((a,l)=>a.text!==e[l].text)?e:t}get attributionUpdating(){return!!this._attributionIndexTask&&!this._attributionIndexTask.finished}get fullOpacity(){var t,e;return(((t=this.layer)==null?void 0:t.opacity)??1)*(((e=this.parent)==null?void 0:e.fullOpacity)??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var t;return!this.suspended&&((t=this.layer)==null?void 0:t.legendEnabled)===!0}get updating(){var t;return!(!((t=this._updatingHandles)!=null&&t.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var t;return((t=this.layer)==null?void 0:t.visible)===!0}set visible(t){this._overrideIfSome("visible",t)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var r;const t=this.view.timeExtent,e=(r=this.layer)==null?void 0:r.visibilityTimeExtent;return!t||!e||!t.intersection(e).isEmpty}canResume(){var e,r;const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&((e=this.layer)==null?void 0:e.loaded)&&this.parent&&!this.parent.suspended&&((r=this.view)==null?void 0:r.ready)&&o(t)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var a,l;const t=(a=this.parent)!=null&&a.suspended?this.parent.suspendInfo:{};(l=this.view)!=null&&l.ready||(t.viewNotReady=!0),this.layer&&this.layer.loaded||(t.layerNotLoaded=!0);const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return o(r)&&this.visibleAtCurrentScale||(t.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(t.outsideVisibilityTimeExtent=!0),this.visible||(t.layerInvisible=!0),t}isUpdating(){return!1}getAttributionItems(){var a;const t=b(this.layer);if(t)return[t];if(v(this.layer)&&(this._attributionIndexTask||(this._attributionIndexTask=f(async l=>{const u=await this.layer.fetchAttributionData();return m(l),I(u)}),this._updatingHandles.addPromise(this._attributionIndexTask.promise)),((a=this._attributionIndexTask)==null?void 0:a.finished)&&this._attributionIndexTask.value))return x(this._attributionIndexTask.value,this.layer.tileInfo,this.view.scale,this.view.extent);const e=_(this.layer);if(e)return[e];const r=T(this.layer);return r?[r]:[]}};s([n({readOnly:!0})],i.prototype,"spatialReferenceSupported",null),s([n()],i.prototype,"view",void 0),s([n({readOnly:!0})],i.prototype,"attributionItems",null),s([n({readOnly:!0})],i.prototype,"attributionUpdating",null),s([n()],i.prototype,"fullOpacity",null),s([n()],i.prototype,"layer",void 0),s([n()],i.prototype,"parent",void 0),s([n({readOnly:!0})],i.prototype,"suspended",null),s([n({readOnly:!0})],i.prototype,"suspendInfo",null),s([n({readOnly:!0})],i.prototype,"legendEnabled",null),s([n({type:Boolean,readOnly:!0})],i.prototype,"updating",null),s([n({readOnly:!0})],i.prototype,"updatingProgress",null),s([n()],i.prototype,"updateSuspended",null),s([n()],i.prototype,"visible",null),s([n({readOnly:!0})],i.prototype,"visibleAtCurrentScale",null),s([n({readOnly:!0})],i.prototype,"visibleAtCurrentTimeExtent",null),i=s([w("esri.views.layers.LayerView")],i);const k=i;export{k as I};
