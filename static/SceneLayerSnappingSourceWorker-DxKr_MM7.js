import{gn as C,l0 as E,gq as l,go as h,aJ as x,aL as L,b3 as m,aO as v,b6 as p,jo as y}from"./index-C_bK48d2.js";import{E as u,v as S,h as P,M as $}from"./sphere-Dx28BAGo.js";import{l as _}from"./Octree-Dmg0kHEk.js";import{a as j}from"./edgeProcessing-CFw-a8Be.js";import"./ray-DFDOQn-4.js";import"./vectorStacks-CpRnv_41.js";import"./quatf64-aQ5IuZRd.js";import"./plane-CYaN818s.js";import"./frustum-BtvbAxAw.js";import"./BufferView-CruTDoyp.js";import"./deduplicate-Z43o2PF3.js";import"./Indices-BnCWM-r-.js";import"./InterleavedLayout-DFvKIHDS.js";import"./types-BKo2foNY.js";import"./VertexElementDescriptor-2_ON7b9t.js";import"./VertexAttributeLocations-BSIMTgtd.js";import"./TextureBackedBufferLayout-Bu_3CpJU.js";import"./Normals-4KUYifO5.js";const V=1e3;function I(s,t,e){const n=new u;return C(n.center,s,.5),E(n.center,n.center,t,.5),n.radius=l(n.center,s),h(n.center,n.center,e),n}class b{constructor(t,e,n){this.objectId=t,this.target=e,this.distance=n}}class T extends b{constructor(t,e,n){super(t,e,n),this.type="vertex"}}class N extends b{constructor(t,e,n,i,o){super(t,e,n),this.start=i,this.end=o,this.type="edge"}}let g=class{constructor(){this._idToComponent=new Map,this._components=new _(s=>s.bounds),this._edges=new _(s=>s.bounds),this._tmpLineSegment=S(),this._tmpP1=m(),this._tmpP2=m(),this._tmpP3=m(),this.remoteClient=null}async fetchCandidates(s,t){await Promise.resolve(),v(t);const e=s;e.mbs=new u(s.mbsJSON),await this._ensureEdgeLocations(e,t);const n=[];return this._edges.forEachNeighbor(i=>(this._addCandidates(e,i,n),n.length<V),e.mbs),{result:{candidates:n}}}async _ensureEdgeLocations(s,t){const e=[];if(this._components.forEachNeighbor(o=>{if(o.info==null){const{id:d,uid:r}=o;e.push({id:d,uid:r})}return!0},s.mbs),!e.length)return;const n={components:e},i=await this.remoteClient.invoke("fetchAllEdgeLocations",n,t??{});for(const o of i.components)this._setFetchEdgeLocations(o)}async add(s){const t=new k(s.id,new u(s.bounds));return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(s){const t=this._idToComponent.get(s.id);if(t){const e=[];this._edges.forEachNeighbor(n=>(n.component===t&&e.push(n),!0),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(s){const t=this._idToComponent.get(s.id);if(t==null||s.uid!==t.uid)return;const e=j.createView(s.locations),n=new Array(e.count),i=m(),o=m();for(let c=0;c<e.count;c++){e.position0.getVec(c,i),e.position1.getVec(c,o);const a=I(i,o,s.origin),w=new q(t,c,a);n[c]=w}this._edges.add(n);const{objectIds:d,origin:r}=s;t.info={locations:e,objectIds:d,origin:r}}_addCandidates(s,t,e){const{info:n}=t.component,{origin:i,objectIds:o}=n,d=n.locations,r=d.position0.getVec(t.index,this._tmpP1),c=d.position1.getVec(t.index,this._tmpP2);h(r,r,i),h(c,c,i);const a=o[d.componentIndex.get(t.index)];this._addEdgeCandidate(s,a,r,c,e),f(s,a,r,e),f(s,a,c,e)}_addEdgeCandidate(s,t,e,n,i){if(!s.returnEdge)return;const o=s.mbs.center,d=P(e,n,this._tmpLineSegment),r=$(d,o,this._tmpP3);s.mbs.contains(r)&&i.push(new N(t,p(r),l(o,r),p(e),p(n)))}};g=x([L("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],g);const tt=g;function f(s,t,e,n){s.returnVertex&&s.mbs.contains(e)&&n.push(new T(t,p(e),l(s.mbs.center,e)))}class k{constructor(t,e){this.id=t,this.bounds=e,this.info=null,this.uid=y()}}class q{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}}export{tt as default};
