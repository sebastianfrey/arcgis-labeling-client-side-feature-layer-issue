import{e as k}from"./earcut-Lltz9D9k.js";import{bI as F,f9 as J,jI as K,gp as R,jJ as S,jK as Z,jL as $,jM as w}from"./index-C_bK48d2.js";import{t as L}from"./Indices-BnCWM-r-.js";import{j as q,k as v,S as z}from"./plane-CYaN818s.js";import{e as x}from"./deduplicate-Z43o2PF3.js";function B(n,t,a){const o=C(M,n,t,a)?v(M):[0,0,1];return Math.abs(o[2])>Math.cos(F(80))?2:Math.abs(o[1])>Math.abs(o[0])?1:0}function C(n,t,a,o){const r=(i=>!Array.isArray(i[0]))(t)?(i,e)=>t[3*i+e]:(i,e)=>t[i][e],s=o?J(o)/K(o):1;return z(n,(i,e)=>R(i,r(e,0)*s,r(e,1)*s,r(e,2)),a)}const M=q();function T(n){const t=E(n.rings,n.hasZ,1,n.spatialReference),a=new Array;let o=0,r=0;for(const e of t.polygons){const f=e.count,l=e.index,y=S(t.position,3*l,3*f),m=e.holeIndices.map(h=>h-l),p=L(k(y,m,3));a.push({position:y,faces:p}),o+=y.length,r+=p.length}const s=D(a,o,r),i=Array.isArray(s.position)?x(s.position,3,{originalIndices:s.faces}):x(s.position.buffer,6,{originalIndices:s.faces});return s.position=Z(new Float64Array(i.buffer)),s.faces=i.indices,s}function D(n,t,a){if(n.length===1)return n[0];const o=$(t),r=new Array(a);let s=0,i=0,e=0;for(const f of n){for(let l=0;l<f.position.length;l++)o[s++]=f.position[l];for(const l of f.faces)r[i++]=l+e;e=s/3}return{position:o,faces:L(r)}}function E(n,t,a,o){const r=n.length,s=new Array(r),i=new Array(r),e=new Array(r),f=n.reduce((g,c)=>g+c.length,0);let l=0,y=0,m=0;const p=$(3*f);let h=0;for(let g=r-1;g>=0;g--){const c=n[g],b=a===1&&G(c,t,o);if(b&&r!==1)s[l++]=c;else{let j=c.length;for(let u=0;u<l;++u)j+=s[u].length;const d={index:h,pathLengths:new Array(l+1),count:j,holeIndices:new Array(l)};d.pathLengths[0]=c.length,c.length>0&&(e[m++]={index:h,count:c.length}),h=b?I(c,c.length-1,-1,p,h,c.length,t):I(c,0,1,p,h,c.length,t);for(let u=0;u<l;++u){const A=s[u];d.holeIndices[u]=h,d.pathLengths[u+1]=A.length,A.length>0&&(e[m++]={index:h,count:A.length}),h=I(A,0,1,p,h,A.length,t)}l=0,d.count>0&&(i[y++]=d)}}for(let g=0;g<l;++g){const c=s[g];c.length>0&&(e[m++]={index:h,count:c.length}),h=I(c,0,1,p,h,c.length,t)}return i.length=y,e.length=m,{position:p,polygons:i,outlines:e}}function I(n,t,a,o,r,s,i){r*=3;for(let e=0;e<s;++e){const f=n[t];o[r++]=f[0],o[r++]=f[1],o[r++]=i&&f[2]?f[2]:0,t+=a}return r/3}function G(n,t,a){if(!t)return!w(n);const o=n.length-1;switch(B(n,o,a)){case 0:return!w(n,1,2);case 1:return!w(n,0,2);case 2:return!w(n,0,1)}}export{T as c,E as f,B as i};
