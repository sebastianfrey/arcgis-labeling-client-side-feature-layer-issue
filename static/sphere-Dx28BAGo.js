import{b6 as C,b3 as l,bH as A,fN as d,bB as P,gn as b,gw as L,eF as x,go as M,gO as B,gx as z,gy as D,fO as y,no as G,gp as T,b5 as K,b4 as Q,ie as W,d6 as X,bp as Y,bC as F,gv as Z,gu as tt,gs as nt,gq as V,gN as rt,l0 as it,bE as et}from"./index-C_bK48d2.js";import{s as st,S as ot,y as ct}from"./ray-DFDOQn-4.js";import{c as h,f as at}from"./vectorStacks-CpRnv_41.js";import{a as ut}from"./plane-CYaN818s.js";function O(r){return r?{origin:C(r.origin),vector:C(r.vector)}:{origin:l(),vector:l()}}function ht(r,t){const n=dt.get();return n.origin=r,n.vector=t,n}function Pt(r,t=O()){return gt(r.origin,r.vector,t)}function gt(r,t,n=O()){return A(n.origin,r),A(n.vector,t),n}function xt(r,t,n=O()){return A(n.origin,r),d(n.vector,t,r),n}function Bt(r,t){const n=d(h.get(),t,r.origin),i=P(r.vector,n),e=P(r.vector,r.vector),s=x(i/e,0,1),o=d(h.get(),b(h.get(),r.vector,s),n);return P(o,o)}function qt(r,t,n){return ft(r,t,0,1,n)}function Ot(r,t,n){return M(n,r.origin,b(n,r.vector,t))}function ft(r,t,n,i,e){const{vector:s,origin:o}=r,a=d(h.get(),t,o),g=P(s,a)/L(s);return b(e,s,x(g,n,i)),M(e,e,r.origin)}function jt(r,t){if(H(r,ht(t.origin,t.direction),!1,q)){const{tA:n,pB:i,distance2:e}=q;if(n>=0&&n<=1)return e;if(n<0)return B(r.origin,i);if(n>1)return B(M(h.get(),r.origin,r.vector),i)}return null}function wt(r,t,n){return!!H(r,t,!0,q)&&(A(n,q.pA),!0)}function H(r,t,n,i){const s=r.origin,o=M(h.get(),s,r.vector),a=t.origin,g=M(h.get(),a,t.vector),f=h.get(),c=h.get();if(f[0]=s[0]-a[0],f[1]=s[1]-a[1],f[2]=s[2]-a[2],c[0]=g[0]-a[0],c[1]=g[1]-a[1],c[2]=g[2]-a[2],Math.abs(c[0])<1e-6&&Math.abs(c[1])<1e-6&&Math.abs(c[2])<1e-6)return!1;const u=h.get();if(u[0]=o[0]-s[0],u[1]=o[1]-s[1],u[2]=o[2]-s[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const k=f[0]*c[0]+f[1]*c[1]+f[2]*c[2],_=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],U=f[0]*u[0]+f[1]*u[1]+f[2]*u[2],w=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],N=(u[0]*u[0]+u[1]*u[1]+u[2]*u[2])*w-_*_;if(Math.abs(N)<1e-6)return!1;let p=(k*_-U*w)/N,v=(k+_*p)/w;n&&(p=x(p,0,1),v=x(v,0,1));const $=h.get(),m=h.get();return $[0]=s[0]+p*u[0],$[1]=s[1]+p*u[1],$[2]=s[2]+p*u[2],m[0]=a[0]+v*c[0],m[1]=a[1]+v*c[1],m[2]=a[2]+v*c[2],i.tA=p,i.tB=v,i.pA=$,i.pB=m,i.distance2=B($,m),!0}const q={tA:0,tB:0,pA:l(),pB:l(),distance2:0},dt=new st(()=>O());function lt(r){return z(r)&&r.length>=3}function Mt(r){return(D(r)||Array.isArray(r))&&r.length>=3}function pt(r){return lt(r)||Mt(r)}function bt(r){return r instanceof Float32Array&&r.length>=4}function vt(r){return Array.isArray(r)&&r.length>=4}function yt(r){return bt(r)||vt(r)}function I(r,t){const n=y(r),i=G(r[2]/n),e=Math.atan2(r[1]/n,r[0]/n);return T(t,n,i,e),t}class j{constructor(t=0,n=0,i=0,e=0){this.radius=e,typeof t=="number"?this._center=K(t,n,i):pt(t)||yt(t)?(this._center=Q(t),this.radius=t.length===4?t[3]:n):(this._center=C(t.center),this.radius=t.radius)}get center(){return this._center}set center(t){A(this.center,t)}exactEquals(t){return W(this._center,t.center)&&this.radius===t.radius}copy(t){return t!==this&&(A(this._center,t.center),this.radius=t.radius),this}clone(){return new j(this.center,this.radius)}toVec4(){return X(this.center[0],this.center[1],this.center[2],this.radius)}contains(t){return B(this.center,t)<=this.radius**2}intersectRay(t,n){if(t==null||!this._intersect(t,S))return!1;let{t0:i,t1:e}=S;if((i<0||e<i&&e>0)&&(i=e),i<0)return!1;if(n){const{origin:s,direction:o}=t;n[0]=s[0]+o[0]*i,n[1]=s[1]+o[1]*i,n[2]=s[2]+o[2]*i}return!0}intersectLine(t,n){const i=ot(t,n);if(!this._intersect(i,S))return[];const{origin:e,direction:s}=i,{t0:o,t1:a}=S,g=f=>{const c=l();return it(c,e,s,f),this.projectPoint(c,c)};return Math.abs(o-a)<Y()?[g(o)]:[g(o),g(a)]}_intersect(t,n){const{origin:i,direction:e}=t,s=At;s[0]=i[0]-this.center[0],s[1]=i[1]-this.center[1],s[2]=i[2]-this.center[2];const o=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(o===0)return!1;const a=2*(e[0]*s[0]+e[1]*s[1]+e[2]*s[2]),g=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-this.radius**2);if(g<0)return!1;const f=Math.sqrt(g);return n.t0=(-a-f)/(2*o),n.t1=(-a+f)/(2*o),!0}projectPoint(t,n){const i=d(h.get(),t,this.center),e=b(h.get(),i,this.radius/y(i));return M(n,e,this.center)}closestPointOnSilhouette(t,n){const i=h.get(),e=at.get();F(i,t.origin,t.direction),F(n,i,t.origin),b(n,n,1/y(n)*this.radius);const s=this._angleToSilhouette(t.origin),o=ut(t.origin,n);return Z(e,o+s,i),tt(n,n,e),n}frustumCoverage(t,n,i){const e=this.radius,s=e*e,o=t+.5*Math.PI,a=n*n+s-2*Math.cos(o)*n*e,g=Math.sqrt(a),f=a-s;if(f<=0)return .5;const c=Math.sqrt(f),u=Math.acos(c/g)-Math.asin(e/(g/Math.sin(o)));return Math.min(1,(u+.5*i)/i)}_angleToSilhouette(t){const n=d(h.get(),t,this.center),i=y(n),e=this.radius,s=e+Math.abs(e-i);return nt(e/s)}union(t){const n=V(this._center,t.center),i=this.radius,e=t.radius;return n+e<i?this:n+i<e?(this.copy(t),this):(rt(this._center,this._center,t.center,(n+e-i)/(2*n)),this.radius=(n+i+e)/2,this)}toJSON(){return{center:this.center,radius:this.radius}}}const J={create:r=>new j(r),copy:(r,t)=>t.copy(r),setExtent:(r,t,n)=>n.copy(r),getExtent:(r,t)=>t,elevate:(r,t,n)=>(n.copy(r),n.radius+=t,n),axisAt(r,t,n,i){const e=d(R,t,r.center);switch(n){case 0:{const s=I(e,R)[2];return T(i,-Math.sin(s),Math.cos(s),0)}case 1:{const s=I(e,R),o=s[1],a=s[2],g=Math.sin(o);return T(i,-g*Math.cos(a),-g*Math.sin(a),Math.cos(o))}case 2:return et(i,e);default:return}},altitudeAt(r,t){const n=d(E,t,r.center);return y(n)-r.radius},setAltitudeAt(r,t,n,i){const e=J.altitudeAt(r,t),s=J.axisAt(r,t,2,E),o=b(E,s,n-e);return M(i,t,o)},intersectRay:(r,t,n)=>r.intersectRay(t,n),closestPoint:(r,t,n)=>r.intersectRay(t,n)?n:(ct(t,r.center,n),r.projectPoint(n,n)),intersectRayClosestSilhouette(r,t,n){if(r.intersectRay(t,n))return n;const i=r.closestPointOnSilhouette(t,h.get());return M(n,t.origin,b(h.get(),t.direction,V(t.origin,i)/y(t.direction))),n},closestPointOnSilhouette:(r,t,n)=>r.closestPointOnSilhouette(t,n),distanceToSilhouette(r,t){const n=d(h.get(),t,r.center),i=L(n),e=r.radius**2;return Math.sqrt(Math.abs(i-e))}},Rt=new j,S={t0:0,t1:0},At=l(),R=l(),E=l();export{ft as A,wt as B,J as C,j as E,qt as M,Rt as T,gt as b,jt as d,xt as h,pt as i,Bt as j,Ot as l,ht as m,Pt as p,O as v};
