import{iN as rt,am as bt}from"./index-C_bK48d2.js";import{c as C}from"./PixelBlock-CE63rTmP.js";import{u as ut}from"./pixelRangeUtils-BjN-b_zG.js";const st=9,Ut="PixelID";function D(t){var n;return t!=null&&((n=t.pixels)==null?void 0:n.length)>0}function Jt(t){var d;if(!(t!=null&&t.length)||t.some(p=>!D(p)))return null;if(t.length===1)return((d=t[0])==null?void 0:d.clone())??null;const n=t,{width:e,height:l,pixelType:o}=n[0];if(n.some(p=>p.width!==e||p.height!==l))return null;const i=n.map(({mask:p})=>p).filter(p=>p!=null);let r=null;i.length&&(r=new Uint8Array(e*l),r.set(i[0]),i.length>1&&dt(i.slice(1),r));const u=[];n.forEach(({pixels:p})=>u.push(...p));const h=r!=null&&u.length===n.length?n.map(({width:p,height:f,mask:a})=>a??new Uint8Array(p*f).fill(255)):null,s=n.map(({statistics:p})=>p).filter(p=>p==null?void 0:p.length),c=[];return s.forEach(p=>c.push(...p)),new C({pixelType:o,width:e,height:l,mask:r,bandMasks:h,pixels:u,statistics:c.length?c:null})}function Vt(t){if(!t)return;const n=t.colormap;if(!n||n.length===0)return;const e=n.sort((h,s)=>h[0]-s[0]),l=e[0][0]<0?e[0][0]:0,o=Math.max(256,e[e.length-1][0]-l+1),i=new Uint8Array(4*o),r=[],u=e[0].length===5;if(o>65536)return e.forEach(h=>{r[h[0]-l]=u?h.slice(1):h.slice(1).concat([255])}),{indexed2DColormap:r,offset:l,alphaSpecified:u};if(t.fillUnspecified){let h=e[0];for(let s=h[0]-l,c=0;s<o;s++)i[4*s]=h[1],i[4*s+1]=h[2],i[4*s+2]=h[3],i[4*s+3]=u?h[4]:255,s===h[0]-l&&(h=c===e.length-1?h:e[++c])}else for(let h=0;h<e.length;h++){const s=e[h],c=4*(s[0]-l);i[c]=s[1],i[c+1]=s[2],i[c+2]=s[3],i[c+3]=u?s[4]:255}return{indexedColormap:i,offset:l,alphaSpecified:u}}function jt(t,n){if(!D(t)||!n||!n.indexedColormap&&!n.indexed2DColormap)return t;const e=t.clone(),l=e.pixels;let o=e.mask;const i=e.width*e.height;if(l.length!==1)return t;const{indexedColormap:r,indexed2DColormap:u,offset:h,alphaSpecified:s}=n,c=l[0],d=new Uint8Array(c.length),p=new Uint8Array(c.length),f=new Uint8Array(c.length);let a,m=0;if(r){const x=r.length-1;if(o!=null)for(let g=0;g<i;g++)o[g]&&(m=4*(c[g]-h),m<h||m>x?o[g]=0:(d[g]=r[m],p[g]=r[m+1],f[g]=r[m+2],o[g]=r[m+3]));else{o=new Uint8Array(i);for(let g=0;g<i;g++)m=4*(c[g]-h),m<h||m>x?o[g]=0:(d[g]=r[m],p[g]=r[m+1],f[g]=r[m+2],o[g]=r[m+3]);e.mask=o}}else if(u)if(o!=null)for(let x=0;x<i;x++)o[x]&&(a=u[c[x]],d[x]=a[0],p[x]=a[1],f[x]=a[2],o[x]=a[3]);else{o=new Uint8Array(i);for(let x=0;x<i;x++)a=u[c[x]],d[x]=a[0],p[x]=a[1],f[x]=a[2],o[x]=a[3];e.mask=o}return e.pixels=[d,p,f],e.statistics=null,e.pixelType="u8",e.maskIsAlpha=s,e}function Lt(t,n){if(!D(t))return null;const{pixels:e,mask:l}=t,o=e.length;let i=n.lut;const{offset:r}=n;i&&i[0].length===1&&(i=e.map(()=>i));const u=[],h=n.outputPixelType||"u8";for(let c=0;c<o;c++){const d=pt(e[c],l,i[c],r||0,h);u.push(d)}const s=new C({width:t.width,height:t.height,pixels:u,mask:l,pixelType:h});return s.updateStatistics(),s}function pt(t,n,e,l,o){const i=t.length,r=C.createEmptyBand(o,i);if(n)for(let u=0;u<i;u++)n[u]&&(r[u]=e[t[u]-l]);else for(let u=0;u<i;u++)r[u]=e[t[u]-l];return r}function Pt(t,n,e,l){const{width:o,height:i,pixels:r,mask:u}=t,h=o*i,{bandId:s,ranges:c}=e,d=r[s];if(!d)return;const p=c.length===1,[f,a]=c[0];for(let m=0;m<h;m++)if(!u||u[m]){const x=d[m];if(p)x>=f&&x<=a&&(n[m]=l);else for(let g=0;g<c.length;g++){const[y,k]=c[g];if(x>=y&&x<=k){n[m]=l;break}}}}function vt(t,n,e,l){const{width:o,height:i,xyMask:r,xBandId:u,yBandId:h,xBandRange:s,yBandRange:c}=e,{pixels:d,mask:p}=t,f=d[u],a=d[h],[m,x]=s,[g,y]=c,k=(x-m)/o,A=(y-g)/i;for(let w=0;w<f.length;w++)if(!p||p[w]){let M=f[w],b=a[w];if(M<m||M>x||b<g||b>y)continue;r?(M=(M-m)*k,M=M>o-1?o-1:M<0?0:255&M,b=(y-b)*A,b=b>i-1?i-1:b<0?0:255&b,r[b*o+M]&&(n[w]=l)):n[w]=l}}function Xt(t){const{pixelBlock:n,renderedPixelBlock:e,highlightOptions:l}=t;if(!D(n))return;const{width:o,height:i}=n,r=o*i,u=new Uint8Array(r);for(let f=1;f<=l.length;f++){const a=l[f-1];"bandId"in a?Pt(n,u,a,f):vt(n,u,a,f)}const{pixels:h}=e;h.length===1&&(h[1]=h[0].slice(),h[2]=h[0].slice());const s=l.map(f=>f.color),[c,d,p]=h;if(e.mask){const f=e.mask;for(let a=0;a<r;a++)if(f[a]){f[a]=255;const m=u[a];if(m){const x=s[m-1];c[a]=x[0],d[a]=x[1],p[a]=x[2],f[a]=x[3]}}}else{const f=new Uint8Array(r).fill(255);for(let a=0;a<r;a++){const m=u[a];if(m){const x=s[m-1];c[a]=x[0],d[a]=x[1],p[a]=x[2],f[a]=x[3]}}e.mask=f}e.maskIsAlpha=!0}function Ht(t,n){if(!D(t))return null;const e=t.clone(),{pixels:l}=e,o=e.width*e.height,i=n.length,r=Math.floor(i/2),u=n[Math.floor(r)],h=l[0],s=new Uint8Array(o),c=new Uint8Array(o),d=new Uint8Array(o);let p=e.mask;const f=n[0].mappedColor.length===4;p||(p=new Uint8Array(o),p.fill(f?255:1),e.mask=p);for(let a=0;a<o;a++)if(p[a]){const m=h[a];let x=!1,g=r,y=u,k=0,A=i-1;for(;A-k>1;){if(m===y.value){x=!0;break}m>y.value?k=g:A=g,g=Math.floor((k+A)/2),y=n[Math.floor(g)]}x||(m===n[k].value?(y=n[k],x=!0):m===n[A].value?(y=n[A],x=!0):m<n[k].value?x=!1:m>n[k].value&&(m<n[A].value?(y=n[k],x=!0):A===i-1?x=!1:(y=n[A],x=!0))),x?(s[a]=y.mappedColor[0],c[a]=y.mappedColor[1],d[a]=y.mappedColor[2],p[a]=y.mappedColor[3]):s[a]=c[a]=d[a]=p[a]=0}return e.pixels=[s,c,d],e.mask=p,e.pixelType="u8",e.maskIsAlpha=f,e}function Kt(t,n,e=!1){const o=new Float32Array(3*st),i=n.length;for(let r=0;r<st;r++)o[3*r]=t[2*r]??rt-1,o[3*r+1]=t[2*r+1]??rt,o[3*r+2]=n[r]??0,r<i&&(r>0&&(o[3*r]-=1e-5),t[2*r+1]!==t[2*r]&&(r<i-1||!e)&&(o[3*r+1]-=1e-5));return o}function Gt(t,n){if(!D(t))return null;const{width:e,height:l}=t,{inputRanges:o,outputValues:i,outputPixelType:r,noDataRanges:u,allowUnmatched:h,replacementValue:s,isLastInputRangeInclusive:c}=n,d=t.pixels[0],p=C.createEmptyBand(r,d.length),f=t.mask,a=new Uint8Array(e*l);f?a.set(f):a.fill(255);const m=t.pixelType.startsWith("f")?1e-6:0,x=o.map(w=>w-m);x[0]=o[0],x[x.length-1]=o[o.length-1]+(c?1e-6:0);const g=o.length/2,[y,k]=ut(r);for(let w=0;w<l;w++)for(let M=0;M<e;M++){const b=w*e+M;if(a[b]){const P=d[b];let T=!1;for(let v=g-1;v>=0;v--)if(P===o[2*v]||P>x[2*v]&&P<x[2*v+1]){p[b]=i[v],T=!0;break}T||(h?p[b]=P>k?k:P<y?y:s??P:a[b]=0)}}const A=u==null?void 0:u.length;if(A)for(let w=0;w<l;w++)for(let M=0;M<e;M++){const b=w*e+M;if(!f||f[b]){const P=d[b];for(let T=0;T<A;T+=2)if(P>=u[T]&&P<=u[T+1]){p[b]=0,a[b]=0;break}}}return new C({width:e,height:l,pixelType:r,pixels:[p],mask:a})}function at(t,n,e,l){const o=e!=null&&e.length>=2?new Set(e):null,i=(e==null?void 0:e.length)===1?e[0]:null,r=!!(n!=null&&n.length);for(let u=0;u<t.length;u++)if(l[u]){const h=t[u];if(r){let s=!1;for(let c=0;c<n.length;c+=2)if(h>=n[c]&&h<=n[c+1]){s=!0;break}s||(l[u]=0)}l[u]&&(h===i||o!=null&&o.has(h))&&(l[u]=0)}}function ht(t,n){const e=t[0].length;n??(n=new Uint8Array(e).fill(255));for(let l=0;l<e;l++)if(n[l]){let o=!1;for(let i=0;i<t.length;i++)if(t[i][l]){o=!0;break}o||(n[l]=0)}return n}function dt(t,n){const e=t[0].length;n??(n=new Uint8Array(e).fill(255));for(let l=0;l<e;l++)if(n[l]){let o=!1;for(let i=0;i<t.length;i++)if(t[i][l]===0){o=!0;break}o&&(n[l]=0)}return n}function Qt(t,n){if(!D(t))return null;const{width:e,height:l,pixels:o}=t,i=e*l,r=new Uint8Array(i);t.mask?r.set(t.mask):r.fill(255);const u=o.length,{includedRanges:h,noDataValues:s,outputPixelType:c,matchAll:d,lookups:p}=n;if(p){const f=[];for(let a=0;a<u;a++){const m=p[a],x=pt(o[a],r,m.lut,m.offset||0,"u8");f.push(x)}f.length===1?r.set(f[0]):d?ht(f,r):dt(f,r)}else if(d){const f=[];for(let a=0;a<u;a++){const m=new Uint8Array(i);m.set(r),at(o[a],h==null?void 0:h.slice(2*a,2*a+2),s==null?void 0:s[a],m),f.push(m)}f.length===1?r.set(f[0]):ht(f,r)}else for(let f=0;f<u;f++)at(o[f],h==null?void 0:h.slice(2*f,2*f+2),s==null?void 0:s[f],r);return new C({width:e,height:l,pixelType:c,pixels:o,mask:r})}function Yt(t){const{srcPixelType:n,inputRanges:e,outputValues:l,allowUnmatched:o,noDataRanges:i,isLastInputRangeInclusive:r,outputPixelType:u}=t;if(n!=="u8"&&n!=="s8"&&n!=="u16"&&n!=="s16")return null;const h=n.includes("16")?65536:256,s=n.includes("s")?-h/2:0,c=C.createEmptyBand(u,h),d=new Uint8Array(h);o&&d.fill(255);const[p,f]=ut(u);if(e!=null&&e.length&&(l!=null&&l.length)){const m=e.map(x=>x-1e-6);m[0]=e[0],r&&(m[m.length-1]=e[e.length-1]);for(let x=0;x<m.length;x++){const g=l[x]>f?f:l[x]<p?p:l[x],y=Math.ceil(m[2*x]-s),k=e[2*x+1]===e[2*x]?y:Math.floor(m[2*x+1]-s);for(let A=y;A<=k;A++)c[A]=g,d[A]=255}}if(i!=null&&i.length)for(let a=0;a<i.length;a++){const m=Math.ceil(i[2*a]-s),x=Math.floor(i[2*a+1]-s);for(let g=m;g<=x;g++)d[g]=0}return{lut:c,offset:s,mask:d}}function Zt(t,n,e){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;const l=t.includes("16")?65536:256,o=t.includes("s")?-l/2:0,i=new Uint8Array(l);if(n)for(let r=0;r<n.length;r++){const u=Math.ceil(n[2*r]-o),h=Math.floor(n[2*r+1]-o);for(let s=u;s<=h;s++)i[s]=255}else i.fill(255);if(e)for(let r=0;r<e.length;r++)i[e[r]-o]=0;return{lut:i,offset:o}}function St(t,n,e,l,o,i,r,u){return{xmin:o<=e*t?0:o<e*t+t?o-e*t:t,ymin:i<=l*n?0:i<l*n+n?i-l*n:n,xmax:o+r<=e*t?0:o+r<e*t+t?o+r-e*t:t,ymax:i+u<=l*n?0:i+u<l*n+n?i+u-l*n:n}}function te(t,n){if(!t||t.length===0)return null;const e=t.find(a=>a.pixelBlock);if((e==null?void 0:e.pixelBlock)==null)return null;const l=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width,o=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,i=.01*Math.min(l,o),r=t.sort((a,m)=>Math.abs(a.extent.ymax-m.extent.ymax)>i?m.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-m.extent.xmin)>i?a.extent.xmin-m.extent.xmin:0),u=Math.min.apply(null,r.map(a=>a.extent.xmin)),h=Math.min.apply(null,r.map(a=>a.extent.ymin)),s=Math.max.apply(null,r.map(a=>a.extent.xmax)),c=Math.max.apply(null,r.map(a=>a.extent.ymax)),d={x:Math.round((n.xmin-u)/l),y:Math.round((c-n.ymax)/o)},p={width:Math.round((s-u)/l),height:Math.round((c-h)/o)},f={width:Math.round((n.xmax-n.xmin)/l),height:Math.round((n.ymax-n.ymin)/o)};return Math.round(p.width/e.pixelBlock.width)*Math.round(p.height/e.pixelBlock.height)!==r.length||d.x<0||d.y<0||p.width<f.width||p.height<f.height?null:{extent:n,pixelBlock:Tt(r.map(a=>a.pixelBlock),p,{clipOffset:d,clipSize:f})}}function et(t,n,e,l,o,i){const{width:r,height:u}=e.block,{x:h,y:s}=e.offset,{width:c,height:d}=e.mosaic,p=St(r,u,l,o,h,s,c,d);let f=0,a=0;if(i){const m=i.hasGCSSShiftTransform?360:i.halfWorldWidth??0,x=r*i.resolutionX,g=i.startX+l*x;g<m&&g+x>m?a=i.rightPadding:g>=m&&(f=i.leftMargin-i.rightPadding,a=0)}if(p.xmax-=a,typeof n!="number")for(let m=p.ymin;m<p.ymax;m++){const x=(o*u+m-s)*c+(l*r-h)+f,g=m*r;for(let y=p.xmin;y<p.xmax;y++)t[x+y]=n[g+y]}else for(let m=p.ymin;m<p.ymax;m++){const x=(o*u+m-s)*c+(l*r-h)+f;for(let g=p.xmin;g<p.xmax;g++)t[x+g]=n}}function Tt(t,n,e={}){var v;const{clipOffset:l,clipSize:o,alignmentInfo:i,blockWidths:r}=e;if(r)return It(t,n,{blockWidths:r});const u=t.find(S=>D(S));if(u==null)return null;const h=o?o.width:n.width,s=o?o.height:n.height,c=u.width,d=u.height,p=n.width/c,f=n.height/d,a={offset:l||{x:0,y:0},mosaic:o||n,block:{width:c,height:d}},m=u.pixelType,x=C.getPixelArrayConstructor(m),g=u.pixels.length,y=[];let k,A;for(let S=0;S<g;S++){A=new x(h*s);for(let U=0;U<f;U++)for(let I=0;I<p;I++){const B=t[U*p+I];D(B)&&(k=B.pixels[S],et(A,k,a,I,U,i))}y.push(A)}const w=t.some(S=>S==null||S.mask!=null&&S.mask.length>0),M=t.some(S=>(S==null?void 0:S.bandMasks)&&S.bandMasks.length>1),b=w?new Uint8Array(h*s):void 0,P=M?[]:void 0;if(b){for(let S=0;S<f;S++)for(let U=0;U<p;U++){const I=t[S*p+U],B=I!=null?I.mask:null;et(b,B??(I?255:0),a,U,S,i)}if(P)for(let S=0;S<g;S++){const U=new Uint8Array(h*s);for(let I=0;I<f;I++)for(let B=0;B<p;B++){const _=t[I*p+B],$=((v=_==null?void 0:_.bandMasks)==null?void 0:v[S])??(_==null?void 0:_.mask);et(U,$??(_?255:0),a,B,I,i)}P.push(U)}}const T=new C({width:h,height:s,pixels:y,pixelType:m,bandMasks:P,mask:b});return T.updateStatistics(),T}function It(t,n,e){var x;const l=t.find(g=>g!=null);if(l==null)return null;const o=t.some(g=>g==null||!!g.mask),{width:i,height:r}=n,u=o?new Uint8Array(i*r):null,{blockWidths:h}=e,s=[],c=l.getPlaneCount(),d=C.getPixelArrayConstructor(l.pixelType);if(o)for(let g=0,y=0;g<t.length;y+=h[g],g++){const k=t[g];if(!D(k))continue;const A=k.mask;for(let w=0;w<r;w++)for(let M=0;M<h[g];M++)u[w*i+M+y]=A==null?255:A[w*k.width+M]}const p=t.some(g=>(g==null?void 0:g.bandMasks)&&g.bandMasks.length>1),f=p?[]:void 0,a=i*r;for(let g=0;g<c;g++){const y=new d(a),k=p?new Uint8Array(a):void 0;for(let A=0,w=0;A<t.length;w+=h[A],A++){const M=t[A];if(!D(M))continue;const b=M.pixels[g];if(b!=null){for(let P=0;P<r;P++)for(let T=0;T<h[A];T++)y[P*i+T+w]=b[P*M.width+T];if(k){const P=((x=M.bandMasks)==null?void 0:x[g])??M.mask;for(let T=0;T<r;T++)for(let v=0;v<h[A];v++)k[T*i+v+w]=P?P[T*M.width+v]:255}}}s.push(y),f&&k&&f.push(k)}const m=new C({width:i,height:r,mask:u,bandMasks:f,pixels:s,pixelType:l.pixelType});return m.updateStatistics(),m}function ee(t,n,e){if(!D(t))return null;const{width:l,height:o}=t,i=n.x,r=n.y,u=e.width+i,h=e.height+r;if(i<0||r<0||u>l||h>o||i===0&&r===0&&u===l&&h===o)return t;t.mask||(t.mask=new Uint8Array(l*o));const s=t.mask;for(let c=0;c<o;c++){const d=c*l;for(let p=0;p<l;p++)s[d+p]=c<r||c>=h||p<i||p>=u?0:1}return t.updateStatistics(),t}function $t(t){if(!D(t))return null;const n=t.clone(),{width:e,height:l,pixels:o}=t,i=o[0],r=n.pixels[0],u=t.mask;for(let h=2;h<l-1;h++){const s=new Map;for(let d=h-2;d<h+2;d++)for(let p=0;p<4;p++){const f=d*e+p;X(s,i[f],u?u[f]:1)}r[h*e]=ft(s),r[h*e+1]=r[h*e+2]=r[h*e];let c=3;for(;c<e-1;c++){let d=(h-2)*e+c+1;X(s,i[d],u?u[d]:1),d=(h-1)*e+c+1,X(s,i[d],u?u[d]:1),d=h*e+c+1,X(s,i[d],u?u[d]:1),d=(h+1)*e+c+1,X(s,i[d],u?u[d]:1),d=(h-2)*e+c-3,K(s,i[d],u?u[d]:1),d=(h-1)*e+c-3,K(s,i[d],u?u[d]:1),d=h*e+c-3,K(s,i[d],u?u[d]:1),d=(h+1)*e+c-3,K(s,i[d],u?u[d]:1),r[h*e+c]=ft(s)}r[h*e+c+1]=r[h*e+c]}for(let h=0;h<e;h++)r[h]=r[e+h]=r[2*e+h],r[(l-1)*e+h]=r[(l-2)*e+h];return n.updateStatistics(),n}function ft(t){if(t.size===0)return 0;let n=0,e=-1,l=0;const o=t.keys();let i=o.next();for(;!i.done;)l=t.get(i.value),l>n&&(e=i.value,n=l),i=o.next();return e}function K(t,n,e){if(e===0)return;const l=t.get(n);l===1?t.delete(n):t.set(n,l-1)}function X(t,n,e){e!==0&&t.set(n,t.has(n)?t.get(n)+1:1)}function xt(t,n,e){let{x:l,y:o}=n;const{width:i,height:r}=e;if(l===0&&o===0&&r===t.height&&i===t.width)return t;const{width:u,height:h}=t,s=Math.max(0,o),c=Math.max(0,l),d=Math.min(l+i,u),p=Math.min(o+r,h);if(d<0||p<0||!D(t))return null;l=Math.max(0,-l),o=Math.max(0,-o);const{pixels:f}=t,a=i*r,m=f.length,x=[];for(let A=0;A<m;A++){const w=f[A],M=C.createEmptyBand(t.pixelType,a);for(let b=s;b<p;b++){const P=b*u;let T=(b+o-s)*i+l;for(let v=c;v<d;v++)M[T++]=w[P+v]}x.push(M)}const g=new Uint8Array(a),y=t.mask;for(let A=s;A<p;A++){const w=A*u;let M=(A+o-s)*i+l;for(let b=c;b<d;b++)g[M++]=y?y[w+b]:1}const k=new C({width:e.width,height:e.height,pixelType:t.pixelType,pixels:x,mask:g});return k.updateStatistics(),k}function mt(t,n=!0){if(!D(t))return null;const{pixels:e,width:l,height:o,mask:i,pixelType:r}=t,u=[],h=Math.round(l/2),s=Math.round(o/2),c=o-1,d=l-1;for(let f=0;f<e.length;f++){const a=e[f],m=C.createEmptyBand(r,h*s);let x=0;for(let g=0;g<o;g+=2)for(let y=0;y<l;y+=2){const k=a[g*l+y];if(n){const A=y===d?k:a[g*l+y+1],w=g===c?k:a[g*l+y+l],M=y===d?w:g===c?A:a[g*l+y+l+1];m[x++]=(k+A+w+M)/4}else m[x++]=k}u.push(m)}let p=null;if(i!=null){p=new Uint8Array(h*s);let f=0;for(let a=0;a<o;a+=2)for(let m=0;m<l;m+=2){const x=i[a*l+m];if(n){const g=m===d?x:i[a*l+m+1],y=a===c?x:i[a*l+m+l],k=m===d?y:a===c?g:i[a*l+m+l+1];p[f++]=x*g*y*k?1:0}else p[f++]=x}}return new C({width:h,height:s,pixelType:r,pixels:u,mask:p})}function ne(t,n,e=0,l=!0){if(!D(t))return null;const{width:o,height:i}=n;let{width:r,height:u}=t;const h=new Map,s={x:0,y:0},c=1+e;let d=t;for(let p=0;p<c;p++){const f=Math.ceil(r/o),a=Math.ceil(u/i);for(let m=0;m<a;m++){s.y=m*i;for(let x=0;x<f;x++){s.x=x*o;const g=xt(d,s,n);h.set(`${p}/${m}/${x}`,g)}}p<c-1&&(d=mt(d,l)),r=Math.round(r/2),u=Math.round(u/2)}return h}function ie(t){const{pixelBlock:n,tileSize:e,level:l,row:o,col:i,useBilinear:r}=t;if(!D(n))return null;const{width:u,height:h}=e,s=2**l,c=s*u,d=s*h;let p=xt(n,{y:o*d,x:i*c},{width:c,height:d});if(!p)return null;for(let f=l;f>0;f--)p=mt(p,r);return p}function gt(t,n,e,l,o=0){const{width:i,height:r}=t,{width:u,height:h}=n,s=l.cols,c=l.rows,d=Math.ceil(u/s-.1/s),p=Math.ceil(h/c-.1/c);let f,a,m,x,g,y,k;const A=d*s,w=A*p*c,M=new Float32Array(w),b=new Float32Array(w),P=new Uint32Array(w),T=new Uint32Array(w);let v,S,U=0;for(let I=0;I<p;I++)for(let B=0;B<d;B++){f=12*(I*d+B),a=e[f],m=e[f+1],x=e[f+2],g=e[f+3],y=e[f+4],k=e[f+5];for(let _=0;_<c;_++){U=(I*c+_)*A+B*s,S=(_+.5)/c;for(let $=0;$<_;$++)v=($+.5)/s,M[U+$]=(a*v+m*S+x)*i+o,b[U+$]=(g*v+y*S+k)*r+o,P[U+$]=Math.floor(M[U+$]),T[U+$]=Math.floor(b[U+$])}f+=6,a=e[f],m=e[f+1],x=e[f+2],g=e[f+3],y=e[f+4],k=e[f+5];for(let _=0;_<c;_++){U=(I*c+_)*A+B*s,S=(_+.5)/c;for(let $=_;$<s;$++)v=($+.5)/s,M[U+$]=(a*v+m*S+x)*i+o,b[U+$]=(g*v+y*S+k)*r+o,P[U+$]=Math.floor(M[U+$]),T[U+$]=Math.floor(b[U+$])}}return{offsets_x:M,offsets_y:b,offsets_xi:P,offsets_yi:T,gridWidth:A}}function le(t,n){const{coefficients:e,spacing:l}=n,{offsets_x:o,offsets_y:i,gridWidth:r}=gt(t,t,e,{rows:l[0],cols:l[1]}),{width:u,height:h}=t,s=new Float32Array(u*h),c=180/Math.PI;for(let d=0;d<h;d++)for(let p=0;p<u;p++){const f=d*r+p,a=d===0?f:f-r,m=d===h-1?f:f+r,x=o[a]-o[m],g=i[m]-i[a];if(isNaN(x)||isNaN(g))s[d*u+p]=90;else{let y=Math.atan2(g,x)*c;y=(360+y)%360,s[d*u+p]=y}}return s}function oe(t,n,e,l,o="nearest"){if(!D(t))return null;o==="majority"&&(t=$t(t));const{pixels:i,mask:r,bandMasks:u,pixelType:h}=t,s=t.width,c=t.height,d=C.getPixelArrayConstructor(h),p=i.length,{width:f,height:a}=n;let m=!1;for(let U=0;U<e.length;U+=3)e[U]===-1&&e[U+1]===-1&&e[U+2]===-1&&(m=!0);const{offsets_x:x,offsets_y:g,offsets_xi:y,offsets_yi:k,gridWidth:A}=gt({width:s,height:c},n,e,l,o==="majority"?.5:0);let w;const M=(U,I,B,_)=>{const $=U instanceof Float32Array||U instanceof Float64Array?0:.5;for(let F=0;F<a;F++){w=F*A;for(let N=0;N<f;N++){if(x[w]<0||g[w]<0)U[F*f+N]=0;else if(_)U[F*f+N]=I[y[w]+k[w]*s];else{const O=Math.floor(x[w]),W=Math.floor(g[w]),J=Math.ceil(x[w]),V=Math.ceil(g[w]),E=x[w]-O,j=g[w]-W;if(!B||B[O+W*s]&&B[J+W*s]&&B[O+V*s]&&B[J+V*s]){const H=(1-E)*I[O+W*s]+E*I[J+W*s],L=(1-E)*I[O+V*s]+E*I[J+V*s];U[F*f+N]=(1-j)*H+j*L+$}else U[F*f+N]=I[y[w]+k[w]*s]}w++}}},b=[];let P;const T=(u==null?void 0:u.length)===p,v=[];for(let U=0;U<p;U++){if(T){const I=new Uint8Array(f*a);M(I,u[U],u[U],!0),v.push(I)}P=new d(f*a),M(P,i[U],T?u[U]:r,o==="nearest"||o==="majority"),b.push(P)}const S=new C({width:f,height:a,pixelType:h,pixels:b,bandMasks:T?v:void 0});if(r!=null)S.mask=new Uint8Array(f*a),M(S.mask,r,r,!0);else if(m){S.mask=new Uint8Array(f*a);for(let U=0;U<f*a;U++)S.mask[U]=x[U]<0||g[U]<0?0:1}return S.updateStatistics(),S}function re(t){const{pixelBlock:n,extent:e,fieldNames:l,skipFactor:o,skipSpatialReference:i=!1,pixelIdOffset:r=0}=t,u=[],{width:h,height:s,pixels:c,mask:d}=n,p=t.imageRowSize??h,f=e.width/h,a=e.height/s,m=c.length,x=Math.floor(o/2),{xmin:g,ymax:y}=e,k=i?void 0:e.spatialReference.toJSON();for(let A=x;A<s;A+=o)for(let w=x;w<h;w+=o){const M=A*h+w;if(!d||d[M]){const b={x:g+(w+.5)*f,y:y-(A+.5)*a,spatialReference:k},P={[Ut]:r+A*p+w};for(let T=0;T<m;T++)P[l[T+1]]=c[T][M];u.push({geometry:b,attributes:P})}}return u}const z=new Map;z.set("meter-per-second",1),z.set("kilometer-per-hour",.277778),z.set("knots",.514444),z.set("feet-per-second",.3048),z.set("mile-per-hour",.44704);const it=180/Math.PI,lt=5,Q=new bt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function ot(t,n){return z.get(t)/z.get(n)||1}function wt(t){return(450-t)%360}function yt(t,n="geographic"){const[e,l]=t,o=Math.sqrt(e*e+l*l);let i=Math.atan2(l,e)*it;return i=(360+i)%360,n==="geographic"&&(i=wt(i)),[o,i]}function Bt(t,n="geographic"){let e=t[1];n==="geographic"&&(e=wt(e)),e%=360;const l=t[0];return[l*Math.cos(e/it),l*Math.sin(e/it)]}function se(t,n,e,l="geographic"){if(!D(t)||e==null)return t;const o=n==="vector-magdir"?t.clone():ct(t,n),i=o.pixels[1];for(let r=0;r<i.length;r++)i[r]=l==="geographic"?(i[r]+e[r]+270)%360:(i[r]+360-e[r])%360;return n==="vector-magdir"?o:ct(o,"vector-magdir")}function ct(t,n,e="geographic",l=1){if(!D(t))return t;const{pixels:o,width:i,height:r}=t,u=i*r,h=o[0],s=o[1],c=t.pixelType.startsWith("f")?t.pixelType:"f32",d=C.createEmptyBand(c,u),p=C.createEmptyBand(c,u);let f=0;for(let m=0;m<r;m++)for(let x=0;x<i;x++)n==="vector-uv"?([d[f],p[f]]=yt([h[f],s[f]],e),d[f]*=l):([d[f],p[f]]=Bt([h[f],s[f]],e),d[f]*=l,p[f]*=l),f++;const a=new C({pixelType:c,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[d,p]});return a.updateStatistics(),a}function ae(t,n,e=1){if(e===1||!D(t))return t;const l=t.clone(),{pixels:o,width:i,height:r}=l,u=o[0];o[1];let h=0;for(let s=0;s<r;s++)for(let c=0;c<i;c++)u[h]*=e,h++;return l.updateStatistics(),l}function he(t,n,e,l,o){if(o==null||!o.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(n/l),height:Math.round(e/l),resolution:t.width/n};const i=o.xmin,r=o.ymax,u=(t.xmax-t.xmin)/n*l,h=(t.ymax-t.ymin)/e*l,s=(u+h)/2;return t.xmin=i+Math.floor((t.xmin-i)/u)*u,t.xmax=i+Math.ceil((t.xmax-i)/u)*u,t.ymin=r+Math.floor((t.ymin-r)/h)*h,t.ymax=r+Math.ceil((t.ymax-r)/h)*h,{extent:t,width:Math.round(t.width/u),height:Math.round(t.height/h),resolution:s}}const _t=kt(0,0,0);function kt(t=0,n=0,e=Math.PI,l=!0){l&&(e=(2*Math.PI-e)%(2*Math.PI));const o=l?-1:1,i=13*o,r=-7*o,u=-2*o,h=-16*o,s=21.75,[c,d]=R(0,n+i,e,s),[p,f]=R(t-5.5,n+r,e,s),[a,m]=R(t+5.5,n+r,e,s),[x,g]=R(t-1.5,n+u,e,s),[y,k]=R(t+1.5,n+u,e,s),[A,w]=R(t-1.5,n+h,e,s),[M,b]=R(t+1.5,n+h,e,s);return[c,d,p,f,x,g,y,k,a,m,A,w,M,b]}function Ct(t=0,n=Math.PI,e=!0){e&&(n=(2*Math.PI-n)%(2*Math.PI));const l=10,o=e?-1:1,i=5*o,r=20*o,u=25*o,h=45,s=0,c=0,d=2,p=0,f=d*o,a=e?1:-1,m=l/2*a;let[x,g]=[s+m,c-r],[y,k]=[x+d*a,g],[A,w]=[y-p*a,k+f],[M,b]=[s-m,c-u],[P,T]=[M+p*a,b-f],v=Math.ceil(t/lt),S=Math.floor(v/10);v-=8*S;const U=[],I=[];for(let E=0;E<v/2;E++,S--){S<=0&&v%2==1&&E===(v-1)/2&&(M=s,P=M+p*a,b=(b+g)/2,T=b-f);const[j,H]=R(M,b,n,h);if(S>0){const[L,Y]=R(y,b,n,h),[Z,tt]=R(x,g,n,h);U.push(L),U.push(Y),U.push(j),U.push(H),U.push(Z),U.push(tt)}else{const[L,Y]=R(y,k,n,h),[Z,tt]=R(A,w,n,h),[Mt,At]=R(P,T,n,h);I.push(j),I.push(H),I.push(Mt),I.push(At),I.push(Z),I.push(tt),I.push(L),I.push(Y)}b+=i,g+=i,k+=i,w+=i,T+=i}const[B,_]=R(s+m,c+r,n,h),$=(l/2+d)*a,[F,N]=R(s+$,c+r,n,h),[O,W]=R(s+m,c-u,n,h),[J,V]=R(s+$,c-u,n,h);return{pennants:U,barbs:I,shaft:[B,_,F,N,O,W,J,V]}}function R(t,n,e,l=1){const o=Math.sqrt(t*t+n*n)/l,i=(2*Math.PI+Math.atan2(n,t))%(2*Math.PI);return[o,(2*Math.PI+i-e)%(2*Math.PI)]}const G=[0,1,3,6,10,16,21,27,33,40,47,55,63],Dt=[0,.5,1,1.5,2],Rt=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function q(t,n,e,l){const o=ot(l||"knots",e);let i;for(i=1;i<n.length;i++)if(i===n.length-1){if(t<n[i]*o)break}else if(t<=n[i]*o)break;return Math.min(i-1,n.length-2)}function Ft(t,n,e,l,o){let i=0;switch(n){case"beaufort_kn":i=q(t,G,"knots",e);break;case"beaufort_km":i=q(t,G,"kilometer-per-hour",e);break;case"beaufort_ft":i=q(t,G,"feet-per-second",e);break;case"beaufort_m":i=q(t,G,"meter-per-second",e);break;case"classified_arrow":i=q(t,o??[],l,e);break;case"ocean_current_m":i=q(t,Dt,"meter-per-second",e);break;case"ocean_current_kn":i=q(t,Rt,"knots",e)}return i}function Nt(t,n){const{style:e,inputUnit:l,outputUnit:o,breakValues:i}=n,r=Q.fromJSON(l),u=Q.fromJSON(o),h=7*6,s=15;let c=0,d=0;const{width:p,height:f,mask:a}=t,m=t.pixels[0],x=t.pixels[1],g=a!=null?a.filter(w=>w>0).length:p*f,y=new Float32Array(g*h),k=new Uint32Array(s*g),A=n.invertDirection?kt(0,0,0,!1):_t;for(let w=0;w<f;w++)for(let M=0;M<p;M++){const b=w*p+M;if(!a||a[w*p+M]){const P=(x[b]+360)%360/180*Math.PI,T=Ft(m[b],e,r,u,i);for(let S=0;S<A.length;S+=2)y[c++]=(M+.5)/p,y[c++]=(w+.5)/f,y[c++]=A[S],y[c++]=A[S+1]+P,y[c++]=T,y[c++]=m[b];const v=7*(c/h-1);k[d++]=v,k[d++]=v+1,k[d++]=v+2,k[d++]=v+0,k[d++]=v+4,k[d++]=v+3,k[d++]=v+0,k[d++]=v+2,k[d++]=v+3,k[d++]=v+2,k[d++]=v+5,k[d++]=v+3,k[d++]=v+5,k[d++]=v+6,k[d++]=v+3}}return{vertexData:y,indexData:k}}const nt=[];function Et(t,n){if(nt.length===0)for(let f=0;f<30;f++)nt.push(Ct(5*f,0,!n.invertDirection));const e=ot(Q.fromJSON(n.inputUnit),"knots"),{width:l,height:o,mask:i}=t,r=t.pixels[0],u=t.pixels[1],h=6,s=[],c=[];let d=0,p=0;for(let f=0;f<o;f++)for(let a=0;a<l;a++){const m=f*l+a,x=r[m]*e;if((!i||i[f*l+a])&&x>=lt){const g=(u[m]+360)%360/180*Math.PI,{pennants:y,barbs:k,shaft:A}=nt[Math.min(Math.floor(x/5),29)];if(y.length+k.length===0)continue;let w=s.length/h;const M=(a+.5)/l,b=(f+.5)/o;for(let P=0;P<y.length;P+=2)s[d++]=M,s[d++]=b,s[d++]=y[P],s[d++]=y[P+1]+g,s[d++]=0,s[d++]=x;for(let P=0;P<k.length;P+=2)s[d++]=M,s[d++]=b,s[d++]=k[P],s[d++]=k[P+1]+g,s[d++]=0,s[d++]=x;for(let P=0;P<A.length;P+=2)s[d++]=M,s[d++]=b,s[d++]=A[P],s[d++]=A[P+1]+g,s[d++]=0,s[d++]=x;for(let P=0;P<y.length/6;P++)c[p++]=w,c[p++]=w+1,c[p++]=w+2,w+=3;for(let P=0;P<k.length/8;P++)c[p++]=w,c[p++]=w+1,c[p++]=w+2,c[p++]=w+1,c[p++]=w+2,c[p++]=w+3,w+=4;c[p++]=w+0,c[p++]=w+1,c[p++]=w+2,c[p++]=w+1,c[p++]=w+3,c[p++]=w+2,w+=4}}return{vertexData:new Float32Array(s),indexData:new Uint32Array(c)}}function Ot(t,n){let l=0,o=0;const{width:i,height:r,mask:u}=t,h=t.pixels[0],s=[],c=[],d=ot(Q.fromJSON(n.inputUnit),"knots"),p=n.style==="wind_speed"?lt:Number.MAX_VALUE;for(let f=0;f<r;f++)for(let a=0;a<i;a++){const m=h[f*i+a]*d;if((!u||u[f*i+a])&&m<p){for(let g=0;g<4;g++)s[l++]=(a+.5)/i,s[l++]=(f+.5)/r,s[l++]=g<2?-.5:.5,s[l++]=g%2==0?-.5:.5,s[l++]=0,s[l++]=m;const x=4*(l/24-1);c[o++]=x,c[o++]=x+1,c[o++]=x+2,c[o++]=x+1,c[o++]=x+2,c[o++]=x+3}}return{vertexData:new Float32Array(s),indexData:new Uint32Array(c)}}function fe(t,n){return n.style==="simple_scalar"?Ot(t,n):n.style==="wind_speed"?Et(t,n):Nt(t,n)}function ce(t,n,e,l=[0,0],o=.5){const{width:i,height:r,mask:u}=t,[h,s]=t.pixels,[c,d]=l,p=Math.round((i-c)/e),f=Math.round((r-d)/e),a=p*f,m=new Float32Array(a),x=new Float32Array(a),g=new Uint8Array(a);for(let k=0;k<f;k++)for(let A=0;A<p;A++){let w=0;const M=k*p+A,b=Math.max(0,k*e+d),P=Math.max(0,A*e+c),T=Math.min(r,b+e),v=Math.min(i,P+e);for(let S=b;S<T;S++)for(let U=P;U<v;U++){const I=S*i+U;if(!u||u[I]){w++;const B=[h[I],s[I]],[_,$]=B;m[M]+=_,x[M]+=$}}if(w>=(T-b)*(v-P)*(1-o)){g[M]=1;const[S,U]=yt([m[M]/w,x[M]/w]);m[M]=S,x[M]=U}else g[M]=0,m[M]=0,x[M]=0}const y=new C({width:p,height:f,pixels:[m,x],mask:g});return y.updateStatistics(),y}export{Yt as A,ee as C,ie as D,ne as E,Qt as M,oe as O,Tt as S,te as T,fe as U,xt as _,Ot as a,Q as b,ot as c,Xt as d,Lt as e,ct as f,Vt as g,jt as h,Zt as i,le as j,dt as k,yt as l,he as m,st as n,D as o,ae as p,pt as q,Gt as r,Jt as s,Kt as t,se as u,ce as v,Ht as x,re as z};
