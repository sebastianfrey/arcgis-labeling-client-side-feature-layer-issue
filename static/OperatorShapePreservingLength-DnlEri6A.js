import{r as F,Y as H,P as Q,a as R,f as k,m as S,c as O}from"./Point2D-CHGoJJR2.js";import{n as J,T as j,a3 as K,D as W,R as Z,m as ee,Q as te,U as se,a5 as ne,$ as N}from"./ProjectionTransformation-yTMc8p-1.js";import{Envelope2D as oe}from"./Envelope2D-K-BIX8ba.js";function M(){return{m_pGcs:new S,m_xyz:new N,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:re,setLength:ae,assign:ie}}function re(i,e,t,n){this.m_factor=i,this.m_pGcs.assign(e),this.m_xyz.assign(n),this.m_geoLength=t}function ae(i){this.m_geoLength=i}function ie(i){this.m_pGcs.assign(i.m_pGcs),this.m_xyz.assign(i.m_xyz),this.m_factor=i.m_factor,this.m_geoLength=i.m_geoLength}class ue{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,n,u,s){if(e.hasNonLinearSegments()&&(e=new J().execute(e,0,t.getTolerance(0),0,s)),t.isPannable()){let m=90,r=-90;if(n.getUnit().getUnitToBaseFactor()===1&&(m*=Math.PI/180,r*=Math.PI/180),t.getCoordinateSystemType()===2){let x=null;const o=[0,0,0,0];x=t.getPECoordSys(),o[0]=0,o[1]=m,o[2]=0,o[3]=r,j.geogToProj(x,2,o),m=o[1],r=o[3]}const g=new oe;e.queryEnvelope(g),g.ymin=r,g.ymax=m,e=new K().execute(e,g,t,s)}else{const m=t.getPCSHorizon();(e=new W().execute(e,m,t,s))===m&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,n,u,1,s)}_ExecuteIterativeApproach(e,t,n,u,s,m){const r=ne();n.querySpheroidData(r);const g=r.majorSemiAxis,x=r.e2,o=n.getUnit().getUnitToBaseFactor(),b=40,C=F(M,b),w=H(b,Number.NaN),f=M(),c=M();let p;const a=[0,0,0,0],A=t.getPECoordSys(),E=new S,L=new S,y=new S,l=new S,d=new S;let V=0;const v=e.querySegmentIterator();for(;v.nextPath();)for(;v.hasNextSegment();){const D=v.nextSegment();E.assign(D.getStartXY()),L.assign(D.getEndXY()),t.getCoordinateSystemType()===2?(a[0]=E.x,a[1]=E.y,a[2]=L.x,a[3]=L.y,j.projToGeog(A,2,a),y.x=a[0]*o,y.y=a[1]*o,l.x=a[2]*o,l.y=a[3]*o):(y.setCoordsPoint2D(E),l.setCoordsPoint2D(L),y.scale(o),l.scale(o));const z=new N,I=new N;$(g,x,y,z),$(g,x,l,I);let _=G(g,z,I);f.setValues(0,y,Number.NaN,z),c.setValues(1,l,_,I),p=s,C[0].assign(c),w[0]=s;let h=0;for(;;){h>128&&O("iterations exceeded");const Y=.5*(f.m_factor+c.m_factor),U=D.getCoord2D(Y);t.getCoordinateSystemType()===2?(a[0]=U.x,a[1]=U.y,j.projToGeog(A,1,a),d.x=a[0]*o,d.y=a[1]*o):(d.setCoordsPoint2D(U),d.scale(o)),y.setCoordsPoint2D(f.m_pGcs),l.setCoordsPoint2D(c.m_pGcs);const T=new N;$(g,x,d,T);const q=G(g,f.m_xyz,T),X=G(g,c.m_xyz,T);_=c.m_geoLength,Number.isNaN(_)&&(_=G(g,f.m_xyz,c.m_xyz));const P=q+X,B=p===s&&P>=20&&Math.abs(P-_)>1e-8*(_+P);if(h+2<b&&(B||Math.abs(P-_)>0&&p>0))c.setLength(X),C[h].assign(c),c.setValues(Y,d,q,T),C[++h].assign(c),B?(p=s,w[h]=s):(p--,w[h-1]=p,w[h]=p);else{if(V+=P,h===0)break;f.assign(c),c.assign(C[--h]),p=w[h]}}}return V}execute(e,t,n){if(t&&t.getCoordinateSystemType()!==0||Q(""),e.isEmpty()||e.getDimension()<1)return 0;let u=null;const s=t.getGCS();s!==t&&(u=Z(t,s,null));const m=e.getGeometryType();if(m===R.enumEnvelope){const r=new ee;return r.addEnvelope(e,!1),this._ExecuteShapePreservingLength(r,t,s,u,n)}if(k(m)){const r=new te;return r.addSegment(e,!0),this._ExecuteShapePreservingLength(r,t,s,u,n)}return this._ExecuteShapePreservingLength(e,t,s,u,n)}}function $(i,e,t,n){n.assign(se(i,e,t))}function G(i,e,t){const n=i,u=new N;u.setSub(e,t);const s=u.length();return 2*n*Math.asin(s/(2*n))}export{ue as w};
