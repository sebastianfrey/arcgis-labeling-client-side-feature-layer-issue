import{gk as vi,aJ as d,aK as v,aL as mi,db as Ft,fj as vs,aF as gi,l8 as Bt,ve as ms,cP as gs,fB as _s,b5 as K,b6 as hr,gN as Ct,b3 as g,gO as ys,jo as _i,gp as N,go as oe,gn as W,vf as xs,k6 as si,gu as ge,ja as Ei,pO as bs,j$ as Oe,cJ as $s,h as ws,a as bt,eF as nt,pW as te,vg as Ss,fm as Ms,h7 as me,vh as Ts,vi as Cs,bH as U,bC as de,bE as Ce,fO as Y,l0 as we,b9 as X,b8 as $t,gt as ni,vj as Ps,bF as dr,jb as Xe,jd as Pt,vk as fr,vl as pr,fN as Me,cN as vr,ke as Es,cT as Ai,qW as As,aq as Os,k5 as Ht,vc as Ut,v9 as zs,kU as rt,pP as Et,jn as Is,br as At,i$ as Fe,da as Rs,uH as at,vm as st,vn as Fs,jk as Ls,j3 as Ds,vo as Vs,vp as mr,vq as Ns,s7 as ks,je as js,vr as Bs,hL as yi,bq as qe,gP as je,t6 as Oi,gs as oi,bB as ue,d6 as zi,l$ as gr,bt as Ii,bA as Ri,bz as qt,gq as _r,vs as Hs,vt as Us,m0 as qs,aN as ze,rW as Ws,vu as Fi,kX as Li,kW as ai,id as Gs,jl as lt,bL as Di,gr as yr,uF as Xs,vv as Ys,vw as Vi,sa as Ks,i0 as xi,bN as De,vx as Zs,bI as ae,ax as xr,dl as li,jM as br,no as Lt,gv as Qs,pQ as Js,jc as $r,kN as en,vy as tn,ae as rn,hS as sn,bx as nn,p9 as on,bp as wr,mF as ct,mG as an,ap as ln,fx as cn,kF as ci,gl as Ni}from"./index-C_bK48d2.js";import{e as un,o as hn}from"./Indices-BnCWM-r-.js";import{m as dn,c as B,z as Sr,b as fn,U as wt,F as pn,I as ki,B as ji,Z as Bi,E as vn,A as mn}from"./BufferView-CruTDoyp.js";import{S as gn}from"./triangle-Bs-n1Sd1.js";import{r as Mr}from"./VertexAttributeLocations-BSIMTgtd.js";import{t as Tr}from"./VertexElementDescriptor-2_ON7b9t.js";import{T as _n,l as Cr,d as yn,e as xn,r as bn,c as $n}from"./renderState-CtcAbezy.js";import{t as m,n as re}from"./glsl-B5bJgrnA.js";import{p as Hi}from"./projectVectorToVector-IRvjF_FZ.js";import{b as Pr,k as Er}from"./ray-DFDOQn-4.js";import{v as Ar,x as wn,y as Or,k as Sn,S as Mn,d as Tn,w as Cn,R as Pn,q as En,A as An}from"./frustum-BtvbAxAw.js";import{f as On,L as zn,U as Ui,j as qi,q as In,O as Wi,Z as Rn,k as Fn}from"./plane-CYaN818s.js";import{E as Dt,m as Ln,v as Dn,h as Vn}from"./sphere-Dx28BAGo.js";import{G as Nn,K as kn}from"./orientedBoundingBox-QSEKbinM.js";import{n as Gi}from"./projectPointToVector-oWOZnQKe.js";function pc(t,e=!1){return t<=vi?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function vc(t){return(Array.isArray(t)?t.length:t.byteLength/8)<=vi?Array.from(t):new Float32Array(t)}function mc(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}let j=class extends Ft{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.FLOW_GLOBAL_SCALE_THRESHOLD=null}};d([v()],j.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([v()],j.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([v()],j.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([v()],j.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([v()],j.prototype,"LABELS_SHOW_BORDER",void 0),d([v()],j.prototype,"TEXT_SHOW_BASELINE",void 0),d([v()],j.prototype,"TEXT_SHOW_BORDER",void 0),d([v()],j.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([v()],j.prototype,"OVERLAY_SHOW_CENTER",void 0),d([v()],j.prototype,"SHOW_POI",void 0),d([v()],j.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([v()],j.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([v()],j.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([v()],j.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([v()],j.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([v()],j.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([v()],j.prototype,"I3S_TREE_SHOW_TILES",void 0),d([v()],j.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([v()],j.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([v()],j.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([v()],j.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([v()],j.prototype,"LINE_WIREFRAMES",void 0),d([v()],j.prototype,"FLOW_GLOBAL_SCALE_THRESHOLD",void 0),j=d([mi("esri.views.3d.support.debugFlags")],j);const jn=new j,ut=()=>gi.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Bn=542327876,Hn=131072,Un=4;function bi(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function qn(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Wn=bi("DXT1"),Gn=bi("DXT3"),Xn=bi("DXT5"),Yn=31,Kn=0,Zn=1,Qn=2,Jn=3,eo=4,to=7,io=20,ro=21;function _c(t,e,i){const r=so(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=r;return e.samplingMode=s.levels.length>1?9987:9729,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new vs(t,e,s)}function so(t,e){const i=new Int32Array(t.buffer,t.byteOffset,Yn);if(i[Kn]!==Bn)return ut().error("Invalid magic number in DDS header"),null;if(!(i[io]&Un))return ut().error("Unsupported format, must contain a FourCC code"),null;const r=i[ro];let s,n;switch(r){case Wn:s=8,n=Bt.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Gn:s=16,n=Bt.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Xn:s=16,n=Bt.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return ut().error("Unsupported FourCC code:",qn(r)),null}let o=1,a=i[eo],l=i[Jn];(3&a||3&l)&&(ut().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const h=a,c=l;let u,p;i[Qn]&Hn&&e!==!1&&(o=Math.max(1,i[to]));let _=t.byteOffset+i[Zn]+4;const f=[];for(let $=0;$<o;++$)p=(a+3>>2)*(l+3>>2)*s,u=new Uint8Array(t.buffer,_,p),f.push(u),_+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:f},internalFormat:n,width:h,height:c}}function no(t){if(t.length<vi)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return ms(t)?dn().from(t):gs(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let oo=class zr{get center(){return K(this._data[0],this._data[1],this._data[2])}get radius(){return this._data[3]}get bbMin(){return K(this._data[4],this._data[5],this._data[6])}get bbMax(){return K(this._data[7],this._data[8],this._data[9])}constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._data=[.1,0,0,0,0,0,0,0,0,0],this._children=void 0,B(e.length>=1),B(r.size===3||r.size===4);const{data:s,size:n,indices:o}=r;B(o.length%this._numIndexPerPrimitive===0),B(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];Ie.clear(),Ie.push(l);const h=K(s[l],s[l+1],s[l+2]),c=hr(h);for(let f=0;f<a;++f){const $=this._numIndexPerPrimitive*e[f];for(let b=0;b<this._numIndexPerPrimitive;++b){l=n*o[$+b],Ie.push(l);let E=s[l];h[0]=Math.min(E,h[0]),c[0]=Math.max(E,c[0]),E=s[l+1],h[1]=Math.min(E,h[1]),c[1]=Math.max(E,c[1]),E=s[l+2],h[2]=Math.min(E,h[2]),c[2]=Math.max(E,c[2])}}for(let f=0;f<3;++f)this._data[4+f]=h[f],this._data[7+f]=c[f];const u=Ct(g(),this.bbMin,this.bbMax,.5);let p=.5*Math.max(Math.max(c[0]-h[0],c[1]-h[1]),c[2]-h[2]),_=p*p;for(let f=0;f<Ie.length;++f){l=Ie.at(f);const $=s[l]-u[0],b=s[l+1]-u[1],E=s[l+2]-u[2],A=$*$+b*b+E*E;if(A<=_)continue;const C=Math.sqrt(A),O=.5*(C-p);p+=O,_=p*p;const R=O/C;u[0]+=$*R,u[1]+=b*R,u[2]+=E*R}this._data[3]=p;for(let f=0;f<3;++f)this._data[0+f]=u[f];Ie.clear()}getChildren(){if(this._children||ys(this.bbMin,this.bbMax)<=1)return this._children;const e=Ct(g(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o,indices:a}=this.position;for(let c=0;c<i;++c){let u=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let _=o*a[p],f=n[_],$=n[_+1],b=n[_+2];for(let E=1;E<this._numIndexPerPrimitive;++E){_=o*a[p+E];const A=n[_],C=n[_+1],O=n[_+2];A<f&&(f=A),C<$&&($=C),O<b&&(b=O)}f<e[0]&&(u|=1),$<e[1]&&(u|=2),b<e[2]&&(u|=4),r[c]=u,++s[u]}let l=0;for(let c=0;c<8;++c)s[c]>0&&++l;if(l<2)return;const h=new Array(8);for(let c=0;c<8;++c)h[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const u=r[c];h[u][s[u]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)h[c]!==void 0&&this._children.push(new zr(h[c],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Ie.prune()}};const Ie=new _s({deallocator:null});let ao=class{constructor(e){this.id=_i(),this._attributes=new Map;for(const[i,r]of e)this._attributes.set(i,{...r,indices:un(r.indices)})}get attributes(){return this._attributes}};function lo(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;N(e,0,0,0),N(ne,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*i,h=s[a+1]*i,c=s[a+2]*i;N(G,r[l],r[l+1],r[l+2]),N(be,r[h],r[h+1],r[h+2]),N(ht,r[c],r[c+1],r[c+2]);const u=gn(G,be,ht);u?(oe(G,G,be),oe(G,G,ht),W(G,G,1/3*u),oe(e,e,G),n+=u):(oe(ne,ne,G),oe(ne,ne,be),oe(ne,ne,ht),o+=3)}return(o!==0||n!==0)&&(n!==0?(W(e,e,1/n),!0):o!==0&&(W(e,ne,1/o),!0))}function co(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;N(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),n=l}return o>1&&W(e,e,1/o),o>0}function uo(t,e,i){if(!t)return!1;N(i,0,0,0),N(ne,0,0,0);let r=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,h=l+(e?2:0);for(let c=0;c<h;c+=2){const u=c<l?c+1:0,p=a[c<l?c:l]*n,_=a[u]*n;G[0]=o[p],G[1]=o[p+1],G[2]=o[p+2],be[0]=o[_],be[1]=o[_+1],be[2]=o[_+2],W(G,oe(G,G,be),.5);const f=xs(G,be);f>0?(oe(i,i,W(G,G,f)),r+=f):r===0&&(oe(ne,ne,G),s++)}return r!==0?(W(i,i,1/r),!0):s!==0&&(W(i,ne,1/s),!0)}const G=g(),be=g(),ht=g(),ne=g();let Ir=class{constructor(){this.uid=_i()}},ho=class extends Ir{constructor(e){super(),this.highlightName=e,this.channel=0}},$c=class extends Ir{constructor(){super(...arguments),this.channel=1}},Sc=class Rr extends ao{constructor(e,i,r=null,s=0,n=null,o=-1,a){super(i),this.material=e,this.mapPositions=r,this.type=s,this.olidColor=n,this.edgeIndicesLength=o,this.baseGeometry=a,this._highlights=null,this._highlightOptionsCounts=null,this.visible=!0,this._boundingInfo=null;const l=this.positionAttribute;l!=null&&this.edgeIndicesLength<0&&(this.edgeIndicesLength=l.indices.length)}instantiate(e={}){const i=new Rr(e.material||this.material,[],this.mapPositions,this.type,this.olidColor,this.edgeIndicesLength,this.baseGeometry);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:no(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r?this._attributes.set(e,{...r,exclusive:!0,data:i}):si()&&console.warn(`Setting undefined attribute ${e} data`)}get positionAttribute(){var e;return this.attributes.get("position")??((e=this.baseGeometry)==null?void 0:e.attributes.get("position"))}get indexCount(){var i;const e=(i=this._attributes.values().next().value)==null?void 0:i.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo??(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===0?this._computeAttachmentOriginTriangles(e):this.type===2?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&ge(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.positionAttribute;return lo(i,e)}_computeAttachmentOriginLines(e){const i=this.positionAttribute;return uo(i,fo(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.positionAttribute;return co(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.positionAttribute;if(!e||e.indices.length===0)return null;const i=this.type===0?3:1;B(e.indices.length%i===0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=hn(e.indices.length/i);return new oo(r,i,e)}get transformation(){return this._transformation??Ei}set transformation(e){this._transformation=e&&e!==Ei?bs(e):null}get highlights(){return this._highlights||po}get hasHighlights(){var e;return(((e=this._highlightOptionsCounts)==null?void 0:e.size)??0)>0}foreachHighlightOptions(e){var i;(i=this._highlightOptionsCounts)==null||i.forEach((r,s)=>e(s))}allocateIdAndHighlight(e){const i=new ho(e);return this.addHighlight(i)}addHighlight(e){var s;this._ensureHighlights().add(e);const{highlightName:i}=e,r=(((s=this._highlightOptionsCounts)==null?void 0:s.get(i))??0)+1;return this._ensureHighlightOptionsCounts().set(i,r),e}_ensureHighlights(){let e=this._highlights;return e||(e=new Set,this._highlights=e),e}_ensureHighlightOptionsCounts(){let e=this._highlightOptionsCounts;return e||(e=new Map,this._highlightOptionsCounts=e),e}removeHighlight(e){var i,r,s;if((i=this._highlights)!=null&&i.delete(e)){const{highlightName:n}=e,o=((r=this._highlightOptionsCounts)==null?void 0:r.get(n))??0;o<=1?(s=this._highlightOptionsCounts)==null||s.delete(n):this._ensureHighlightOptionsCounts().set(n,o-1)}}};function fo(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const po=new Set;function vo(t){return t===3||t===4||t===5||t===6||t===7}function Mc(t){return go(t)||t===2}function Fr(t){return t===8||t===9}function Tc(t){return Ve(t)||Fr(t)}function Ve(t){return t===0}function Cc(t){return Ve(t)||t===9}function mo(t){return Ve(t)||Fr(t)}function go(t){return mo(t)||Lr(t)}function Lr(t){return t===1}function _o(t){return Lr(t)||vo(t)}let yo=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){var e;return(e=this._techniques.context)==null?void 0:e.stippleTextures}get _markerTextures(){var e;return(e=this._techniques.context)==null?void 0:e.markerTextures}getTechnique(e,i){return this._techniques.get(e,this._material.getConfiguration(this._output,i))}ensureResources(e){return 2}},xo=class{};const Vt=xo;let Ac=class extends yo{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this.updateTexture(e.textureId),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){super.dispose(),this._texture=Oe(this._texture),this._textureNormal=Oe(this._textureNormal),this._textureEmissive=Oe(this._textureEmissive),this._textureOcclusion=Oe(this._textureOcclusion),this._textureMetallicRoughness=Oe(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?2:1}get textureBindParameters(){var e,i,r,s,n;return new $o(((e=this._texture)==null?void 0:e.texture)??null,((i=this._textureNormal)==null?void 0:i.texture)??null,((r=this._textureEmissive)==null?void 0:r.texture)??null,((s=this._textureOcclusion)==null?void 0:s.texture)??null,((n=this._textureMetallicRoughness)==null?void 0:n.texture)??null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Oe(this._texture),this._acquire(e,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if($s(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Oe(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},bo=class extends Vt{constructor(e=null){super(),this.textureEmissive=e}},$o=class extends bo{constructor(e,i,r,s,n,o,a){super(r),this.texture=e,this.textureNormal=i,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=o,this.normalTextureTransformMatrix=a}},wo=class{constructor(e){this._bits=[...e]}equals(e){return ws(this._bits,e.bits)}get code(){return this._code??(this._code=String.fromCharCode(...this._bits)),this._code}get bits(){return this._bits}},So=class extends Vt{constructor(){var e;super(),this._parameterBits=((e=this._parameterBits)==null?void 0:e.map(()=>0))??[],this._parameterNames??(this._parameterNames=[])}get key(){return this._key??(this._key=new wo(this._parameterBits)),this._key}decode(e=this.key){const i=this._parameterBits;this._parameterBits=[...e.bits];const r=this._parameterNames.map(s=>`    ${s}: ${this[s]}`).join(`
`);return this._parameterBits=i,r}};function tt(t={}){return(e,i)=>{var h,c;e.hasOwnProperty("_parameterNames")||Object.defineProperty(e,"_parameterNames",{value:((h=e._parameterNames)==null?void 0:h.slice())??[],configurable:!0,writable:!0}),e.hasOwnProperty("_parameterBits")||Object.defineProperty(e,"_parameterBits",{value:((c=e._parameterBits)==null?void 0:c.slice())??[0],configurable:!0,writable:!0}),e._parameterNames.push(i);const r=t.count||2,s=Math.ceil(Math.log2(r)),n=e._parameterBits;let o=0;for(;n[o]+s>16;)o++,o>=n.length&&n.push(0);const a=n[o],l=(1<<s)-1<<a;n[o]+=s,t.count?Object.defineProperty(e,i,{get(){return(this._parameterBits[o]&l)>>a},set(u){if(this[i]!==u){if(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~l|+u<<a&l,typeof u!="number")throw new bt("internal:invalid-shader-configuration",`Configuration value for ${i} must be a number, got ${typeof u}`);if(t.count==null)throw new bt("internal:invalid-shader-configuration",`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(e,i,{get(){return!!((this._parameterBits[o]&l)>>a)},set(u){if(this[i]!==u&&(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~l|+u<<a&l,typeof u!="boolean"))throw new bt("internal:invalid-shader-configuration",`Configuration value for ${i} must be boolean, got ${typeof u}`)}})}}let ui=class extends So{constructor(){super(...arguments),this.output=0,this.hasEmission=!1}};d([tt({count:10})],ui.prototype,"output",void 0),d([tt()],ui.prototype,"hasEmission",void 0);let Mo=class extends ui{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}},St=class extends Mo{constructor(){super(...arguments),this.oitPass=0,this.hasSlicePlane=!1,this.hasHighlightMixTexture=!1,this.bindType=1,this.instanced=!1,this.writeDepth=!0,this.oitPremultipliedAlpha=!1}};d([tt({count:3})],St.prototype,"oitPass",void 0),d([tt()],St.prototype,"hasSlicePlane",void 0),d([tt()],St.prototype,"hasHighlightMixTexture",void 0);let hi=class{constructor(){this._scale=0,this._angleFactor=0,this._minScale=0}update(e,i,r,s){r?(this._scale=Math.min(r.divisor/(i-r.offset),1),this._angleFactor=To(e),this._minScale=s!=null?Math.min(r.minPixelSize/s,1):0):(this._scale=1,this._minScale=1,this._angleFactor=1)}apply(e){const{_scale:i,_angleFactor:r,_minScale:s}=this;return e*nt(te(i,1,r),s,1)}applyVec2(e,i){e[0]=this.apply(i[0]),e[1]=this.apply(i[1])}},kc=class{constructor(){this.evaluator=new hi,this.alignmentEvaluator=new hi}update(e,i,r,s,n,o){this.evaluator.update(e,i,r,s),this.alignmentEvaluator.update(e,i,n??r,(n?o:null)??s)}};function To(t){return Math.abs(t)**3}function Bc(t){return!!t&&!0}function Hc(t,e,i,r,s,n){let o=i.screenLength*t.pixelRatio;s!=null&&(Yi.update(r,e,s,n),o=Yi.apply(o));const a=o*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return nt(a*e,i.minWorldLength,i.maxWorldLength)}const Co=Ss();function Xi(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?Array.isArray(t[r])&&Co(s,t[r])||(t[r]=s.slice(),i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}const Uc={multiply:1,ignore:2,replace:3,tint:4},Yi=new hi;let qc=class{constructor(e,i){this.id=_i(),this.supportsEdges=!1,this._renderPriority=0,this._parameters=new i,Xi(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){Xi(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&(this.parameters.renderOccluded&e.renderOccludedMask)!==0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}get renderOccludedFlags(){return this.visible?this.parameters.renderOccluded:0}get hasEmissions(){return!1}getConfiguration(e,i,r=new St){return r.output=e,r.hasEmission=i.hasEmission&&Ve(e),r.hasHighlightMixTexture=e===8&&i.highlightMixTexture!=null,r}},Gc=class extends Vt{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}},Po=class{constructor(e=0,i=!1,r=!0){this.tolerance=e,this.isVerticalRay=i,this.normalRequired=r}};const dt=Ms();function Kc(t,e,i,r,s,n){if(!t.visible)return;const o=me(jr,r,i),a=(c,u,p)=>n(c,p,u),{tolerance:l}=e,h=new Po(l,!1,e.options.normalRequired);if(t.boundingInfo)B(t.type===0),Dr(t.boundingInfo,i,o,l,s,h,a);else{const c=t.positionAttribute,u=c.indices;Vr(i,o,0,u.length/3,u,c.data,c.stride,s,h,a)}}const Eo=g();function Dr(t,e,i,r,s,n,o){if(t==null)return;const a=Do(i,Eo);if(Ts(dt,t.bbMin),Cs(dt,t.bbMax),s!=null&&s.applyToAabb(dt),Vo(dt,e,a,r)){const{primitiveIndices:l,position:h}=t,c=l?l.length:h.indices.length/3;if(c>ko){const u=t.getChildren();if(u!==void 0){for(const p of u)Dr(p,e,i,r,s,n,o);return}}zo(e,i,0,c,h.indices,h.data,h.stride,l,s,n,o)}}const We=g();function Zc(t,e,i,r,s,n,o,a,l){const{data:h,stride:c}=n;Vr(t,me(jr,e,t),i,r,s,h,c,o,a,l)}function Qc(t,e,i,r){if(!i.visible)return;const s=(l,h,c)=>r(l,c,h),{boundingInfo:n}=i;if(n){const{bbMin:l,bbMax:h}=n;if(t<l[0]||t>h[0]||e<l[1]||e>h[1])return}const o=i.positionAttribute,a=o.indices;Ao(t,e,0,a.length/3,a,o,s)}function Ao(t,e,i,r,s,n,o){const{data:a,stride:l}=n;for(let h=i;h<r;++h){const c=3*h,u=l*s[c],p=l*s[c+1],_=l*s[c+2],f=a[u+0]-t,$=a[u+1]-e,b=a[p+0]-t,E=a[p+1]-e,A=a[_+0]-t,C=a[_+1]-e,O=A*E-C*b,R=f*C-$*A,L=b*$-E*f;(O<0||R<0||L<0)&&(O>0||R>0||L>0)||o(0,h,null)}}function Oo(t,e,i,r,s,n,o,a){const l=t[0],h=t[1],c=t[2],u=e[0],p=e[1],_=e[2];for(let f=i;f<r;++f){const $=3*f,b=$+1,E=$+2,A=n*$,C=s[A],O=s[A+1],R=s[A+2],L=n*b,T=n*E,w=s[L]-C,x=s[L+1]-O,z=s[L+2]-R,y=s[T]-C,S=s[T+1]-O,M=s[T+2]-R,F=p*M-S*_,D=_*y-M*u,V=u*S-y*p,k=w*F+x*D+z*V;if(Math.abs(k)<=kr)continue;const Z=l-C,ie=h-O,le=c-R,J=Z*F+ie*D+le*V;if(k>0){if(J<0||J>k)continue}else if(J>0||J<k)continue;const se=ie*z-x*le,fe=le*w-z*Z,pe=Z*x-w*ie,ce=u*se+p*fe+_*pe;if(k>0){if(ce<0||J+ce>k)continue}else if(ce>0||J+ce<k)continue;const ee=(y*se+S*fe+M*pe)/k;ee>=0&&a(ee,f,o?Nr(w,x,z,y,S,M,We):null)}}function zo(t,e,i,r,s,n,o,a,l,h,c){const u=t[0],p=t[1],_=t[2],f=e[0],$=e[1],b=e[2],{normalRequired:E}=h;for(let A=i;A<r;++A){const C=a[A],O=3*C,R=o*s[O];let L=n[R],T=n[R+1],w=n[R+2];const x=o*s[O+1];let z=n[x],y=n[x+1],S=n[x+2];const M=o*s[O+2];let F=n[M],D=n[M+1],V=n[M+2];l!=null&&([L,T,w]=l.applyToVertex(L,T,w,A),[z,y,S]=l.applyToVertex(z,y,S,A),[F,D,V]=l.applyToVertex(F,D,V,A));const k=z-L,Z=y-T,ie=S-w,le=F-L,J=D-T,se=V-w,fe=$*se-J*b,pe=b*le-se*f,ce=f*J-le*$,ee=k*fe+Z*pe+ie*ce;if(Math.abs(ee)<=kr)continue;const Ne=u-L,kt=p-T,jt=_-w,ke=Ne*fe+kt*pe+jt*ce;if(ee>0){if(ke<0||ke>ee)continue}else if(ke>0||ke<ee)continue;const Mi=kt*ie-Z*jt,Ti=jt*k-ie*Ne,Ci=Ne*Z-k*kt,ot=f*Mi+$*Ti+b*Ci;if(ee>0){if(ot<0||ke+ot>ee)continue}else if(ot>0||ke+ot<ee)continue;const Pi=(le*Mi+J*Ti+se*Ci)/ee;Pi>=0&&c(Pi,C,E?Nr(k,Z,ie,le,J,se,We):null)}}function Vr(t,e,i,r,s,n,o,a,l,h){const c=e,u=jo,p=Math.abs(c[0]),_=Math.abs(c[1]),f=Math.abs(c[2]),$=p>=_?p>=f?0:2:_>=f?1:2,b=$,E=c[b]<0?2:1,A=($+E)%3,C=($+(3-E))%3,O=c[A]/c[b],R=c[C]/c[b],L=1/c[b],T=Io,w=Ro,x=Fo,{normalRequired:z}=l;for(let y=i;y<r;++y){const S=3*y,M=o*s[S];N(u[0],n[M+0],n[M+1],n[M+2]);const F=o*s[S+1];N(u[1],n[F+0],n[F+1],n[F+2]);const D=o*s[S+2];N(u[2],n[D+0],n[D+1],n[D+2]),a&&(U(u[0],a.applyToVertex(u[0][0],u[0][1],u[0][2],y)),U(u[1],a.applyToVertex(u[1][0],u[1][1],u[1][2],y)),U(u[2],a.applyToVertex(u[2][0],u[2][1],u[2][2],y))),me(T,u[0],t),me(w,u[1],t),me(x,u[2],t);const V=T[A]-O*T[b],k=T[C]-R*T[b],Z=w[A]-O*w[b],ie=w[C]-R*w[b],le=x[A]-O*x[b],J=x[C]-R*x[b],se=le*ie-J*Z,fe=V*J-k*le,pe=Z*k-ie*V;if((se<0||fe<0||pe<0)&&(se>0||fe>0||pe>0))continue;const ce=se+fe+pe;if(ce===0)continue;const ee=se*(L*T[b])+fe*(L*w[b])+pe*(L*x[b]);if(ee*Math.sign(ce)<0)continue;const Ne=ee/ce;Ne>=0&&h(Ne,y,z?Lo(u):null)}}const Io=g(),Ro=g(),Fo=g();function Nr(t,e,i,r,s,n,o){return N(Ot,t,e,i),N(zt,r,s,n),de(o,Ot,zt),Ce(o,o),o}function Lo(t){return me(Ot,t[1],t[0]),me(zt,t[2],t[0]),de(We,Ot,zt),Ce(We,We),We}const Ot=g(),zt=g();function Do(t,e){return N(e,1/t[0],1/t[1],1/t[2])}function Vo(t,e,i,r){return No(t,e,i,r,1/0)}function No(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const h=(t[1]-r-e[1])*i[1],c=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(h,c)),l<0||(a=Math.max(a,Math.min(h,c)),a>l))return!1;const u=(t[2]-r-e[2])*i[2],p=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(u,p)),!(l<0)&&(a=Math.max(a,Math.min(u,p)),!(a>l)&&a<s)}const ko=1e3,kr=1e-7,jr=g(),jo=[g(),g(),g()];let Jc=class{constructor(){this._transform=X(),this._transformInverse=new ft({value:this._transform},$t,X),this._transformInverseTranspose=new ft(this._transformInverse,ni,X),this._transformTranspose=new ft({value:this._transform},ni,X),this._transformInverseRotation=new ft({value:this._transform},Ps,dr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Xe(this._transform,e)}multiplyTransform(e){Pt(this._transform,this._transform,e)}set(e){Xe(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},ft=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Bo=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=g(),this._tmpMbs=new Dt,this._tmpObb=new Nn,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Y(e)}applyToVertex(e,i,r){const s=N(Br,e,i,r),n=N(Uo,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/Y(n);return we(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,o=e[3],a=e[4],l=e[5]+i,h=Math.abs(r),c=Math.abs(s),u=Math.abs(n),p=Math.abs(o),_=Math.abs(a),f=Math.abs(l),$=.5*(1+Math.sign(r*o))*Math.min(h,p),b=.5*(1+Math.sign(s*a))*Math.min(c,_),E=.5*(1+Math.sign(n*l))*Math.min(u,f),A=Math.max(h,p),C=Math.max(c,_),O=Math.max(u,f),R=Math.sqrt($*$+b*b+E*E),L=Math.sign(h+r),T=Math.sign(c+s),w=Math.sign(u+n),x=Math.sign(p+o),z=Math.sign(_+a),y=Math.sign(f+l),S=this._totalOffset;if(R<S)return e[0]-=(1-L)*S,e[1]-=(1-T)*S,e[2]-=(1-w)*S,e[3]+=x*S,e[4]+=z*S,e[5]+=y*S,e;const M=S/Math.sqrt(A*A+C*C+O*O),F=S/R,D=F-M,V=-D;return e[0]+=r*(L*V+F),e[1]+=s*(T*V+F),e[2]+=n*(w*V+F),e[3]+=o*(x*D+M),e[4]+=a*(z*D+M),e[5]+=l*(y*D+M),e}applyToMbs(e){const i=e.center,r=Y(i),s=this._totalOffset/r;return we(this._tmpMbs.center,i,i,s),this._tmpMbs.radius=e.radius+e.radius*this._totalOffset/r,this._tmpMbs}applyToObb(e){return kn(e,this._totalOffset,this._totalOffset,1,this._tmpObb),this._tmpObb}},Ho=class{constructor(e=0){this.offset=e,this.tmpVertex=g(),this._tmpSphere=new Dt}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=N(Br,e,i,r),o=ge(n,n,s),a=this.offset/Y(o);we(o,o,o,a);const l=this.objectTransform.inverse;return ge(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Y(e);we(e,e,e,r);const s=this.offset/Y(i);we(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=e.center,r=Y(i),s=this.offset/r;return we(this._tmpSphere.center,i,i,s),this._tmpSphere.radius=e.radius+e.radius*this.offset/r,this._tmpSphere}};const Ki=new Ho;function su(t){return t!=null?(Ki.offset=t,Ki):null}new Bo;const Br=g(),Uo=g();function nu(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let h=0;h<l;++h)o[i]=s[n[h]],i+=a;else for(let h=0;h<l;++h){const c=s[n[h]];for(let u=0;u<r;u++)o[i]=c,i+=a}}function Wt(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;i*=o;for(let l=0;l<a;++l){const h=2*s[l];n[i]=r[h],n[i+1]=r[h+1],i+=o}}function $i(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let h=0;h<l;++h){const c=3*n[h];o[i]=s[c],o[i+1]=s[c+1],o[i+2]=s[c+2],i+=a}else for(let h=0;h<l;++h){const c=3*n[h];for(let u=0;u<r;++u)o[i]=s[c],o[i+1]=s[c+1],o[i+2]=s[c+2],i+=a}}function Hr(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let h=0;h<l;++h){const c=4*n[h];o[i]=s[c],o[i+1]=s[c+1],o[i+2]=s[c+2],o[i+3]=s[c+3],i+=a}else for(let h=0;h<l;++h){const c=4*n[h];for(let u=0;u<r;++u)o[i]=s[c],o[i+1]=s[c+1],o[i+2]=s[c+2],o[i+3]=s[c+3],i+=a}}function ou(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function qo(t,e,i,r,s=1){if(!e)return void $i(t,i,r,s);const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,h=o.length,c=e[0],u=e[1],p=e[2],_=e[4],f=e[5],$=e[6],b=e[8],E=e[9],A=e[10],C=e[12],O=e[13],R=e[14];r*=l;let L=0,T=0,w=0;const x=fr(e)?z=>{L=n[z]+C,T=n[z+1]+O,w=n[z+2]+R}:z=>{const y=n[z],S=n[z+1],M=n[z+2];L=c*y+_*S+b*M+C,T=u*y+f*S+E*M+O,w=p*y+$*S+A*M+R};if(s===1)for(let z=0;z<h;++z)x(3*o[z]),a[r]=L,a[r+1]=T,a[r+2]=w,r+=l;else for(let z=0;z<h;++z){x(3*o[z]);for(let y=0;y<s;++y)a[r]=L,a[r+1]=T,a[r+2]=w,r+=l}}function Wo(t,e,i,r,s=1){if(!e)return void $i(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,h=i.typedBufferStride,c=o.length,u=a[0],p=a[1],_=a[2],f=a[4],$=a[5],b=a[6],E=a[8],A=a[9],C=a[10],O=!pr(a),R=1e-6,L=1-R;r*=h;let T=0,w=0,x=0;const z=fr(a)?y=>{T=n[y],w=n[y+1],x=n[y+2]}:y=>{const S=n[y],M=n[y+1],F=n[y+2];T=u*S+f*M+E*F,w=p*S+$*M+A*F,x=_*S+b*M+C*F};if(s===1)if(O)for(let y=0;y<c;++y){z(3*o[y]);const S=T*T+w*w+x*x;if(S<L&&S>R){const M=1/Math.sqrt(S);l[r]=T*M,l[r+1]=w*M,l[r+2]=x*M}else l[r]=T,l[r+1]=w,l[r+2]=x;r+=h}else for(let y=0;y<c;++y)z(3*o[y]),l[r]=T,l[r+1]=w,l[r+2]=x,r+=h;else for(let y=0;y<c;++y){if(z(3*o[y]),O){const S=T*T+w*w+x*x;if(S<L&&S>R){const M=1/Math.sqrt(S);T*=M,w*=M,x*=M}}for(let S=0;S<s;++S)l[r]=T,l[r+1]=w,l[r+2]=x,r+=h}}function Go(t,e,i,r,s=1){if(!e)return void Hr(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,h=i.typedBufferStride,c=o.length,u=a[0],p=a[1],_=a[2],f=a[4],$=a[5],b=a[6],E=a[8],A=a[9],C=a[10],O=!pr(a),R=1e-6,L=1-R;if(r*=h,s===1)for(let T=0;T<c;++T){const w=4*o[T],x=n[w],z=n[w+1],y=n[w+2],S=n[w+3];let M=u*x+f*z+E*y,F=p*x+$*z+A*y,D=_*x+b*z+C*y;if(O){const V=M*M+F*F+D*D;if(V<L&&V>R){const k=1/Math.sqrt(V);M*=k,F*=k,D*=k}}l[r]=M,l[r+1]=F,l[r+2]=D,l[r+3]=S,r+=h}else for(let T=0;T<c;++T){const w=4*o[T],x=n[w],z=n[w+1],y=n[w+2],S=n[w+3];let M=u*x+f*z+E*y,F=p*x+$*z+A*y,D=_*x+b*z+C*y;if(O){const V=M*M+F*F+D*D;if(V<L&&V>R){const k=1/Math.sqrt(V);M*=k,F*=k,D*=k}}for(let V=0;V<s;++V)l[r]=M,l[r+1]=F,l[r+2]=D,l[r+3]=S,r+=h}}function Xo(t,e,i,r,s=1){const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,h=o.length;if(r*=l,e===n.length&&e===4){a[r]=n[0],a[r+1]=n[1],a[r+2]=n[2],a[r+3]=n[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),u=l/4,p=c[r/=4];r+=u;const _=h*s;for(let f=1;f<_;++f)c[r]=p,r+=u;return}if(s!==1)if(e!==4)for(let c=0;c<h;++c){const u=3*o[c];for(let p=0;p<s;++p)a[r]=n[u],a[r+1]=n[u+1],a[r+2]=n[u+2],a[r+3]=255,r+=l}else for(let c=0;c<h;++c){const u=4*o[c];for(let p=0;p<s;++p)a[r]=n[u],a[r+1]=n[u+1],a[r+2]=n[u+2],a[r+3]=n[u+3],r+=l}else{if(e===4){for(let c=0;c<h;++c){const u=4*o[c];a[r]=n[u],a[r+1]=n[u+1],a[r+2]=n[u+2],a[r+3]=n[u+3],r+=l}return}for(let c=0;c<h;++c){const u=3*o[c];a[r]=n[u],a[r+1]=n[u+1],a[r+2]=n[u+2],a[r+3]=255,r+=l}}}function Yo(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=r[0];i*=o;for(let h=0;h<a;++h)n[i]=l,i+=o}function au(t,e,i,r){Me(Re,t,e);const s=Math.max(Math.sqrt(Y(Re)),1e-4);W(Re,Re,1/s),i[r++]=Re[0],i[r++]=Re[1],i[r++]=Re[2],i[r++]=s}const Re=g();function Ko(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function Zo(t,e,i,r,s,n,o){var l;let a={numItems:0,numVerticesPerItem:0};for(const h of i.fields.keys()){const c=t.get(h),u=c==null?void 0:c.indices;if(c&&u)h==="position"&&(a={numItems:1,numVerticesPerItem:u.length}),Qo(h,c,r,s,n,o);else if(h==="olidColor"&&e!=null){const p=(l=t.get("position"))==null?void 0:l.indices;if(p){const _=p.length;Ko(e,n.getField(h,Sr),_,o)}}}return a}function Qo(t,e,i,r,s,n){switch(t){case"position":{B(e.size===3);const o=s.getField(t,wt);B(!!o,`No buffer view for ${t}`),qo(e,i,o,n);break}case"normal":{B(e.size===3);const o=s.getField(t,wt);B(!!o,`No buffer view for ${t}`),Wo(e,r,o,n);break}case"normalCompressed":case"profileRight":case"profileUp":{B(e.size===2);const o=s.getField(t,Bi);B(!!o,`No buffer view for ${t}`),Wt(e,o,n);break}case"uv0":{B(e.size===2);const o=s.getField(t,vn)??s.getField(t,mn);B(!!o,`No buffer view for ${t}`),Wt(e,o,n);break}case"uvi":{B(e.size===2);const o=s.getField(t,Bi);B(!!o,`No buffer view for ${t}`),Wt(e,o,n);break}case"color":case"symbolColor":{const o=s.getField(t,Sr);B(!!o,`No buffer view for ${t}`),B(e.size===3||e.size===4),Xo(e,e.size,o,n);break}case"colorFeatureAttribute":case"opacityFeatureAttribute":case"sizeFeatureAttribute":{const o=s.getField(t,ji)??s.getField(t,ji);B(!!o,`No buffer view for ${t}`),B(e.size===1),Yo(e,o,n);break}case"tangent":{B(e.size===4);const o=s.getField(t,ki);B(!!o,`No buffer view for ${t}`),Go(e,i,o,n);break}case"profileVertexAndNormal":{B(e.size===4);const o=s.getField(t,pn)??s.getField(t,ki);B(!!o,`No buffer view for ${t}`),Hr(e,o,n);break}case"profileAuxData":{B(e.size===3);const o=s.getField(t,fn)??s.getField(t,wt);B(!!o,`No buffer view for ${t}`),$i(e,o,n);break}}}let lu=class{constructor(e){this.layout=e}elementCount(e){return e.get("position").indices.length}write(e,i,r,s,n,o){return Zo(r,s,this.layout,e,i,n,o)}intersect(e,i,r,s,n,o,a){const l=this.layout.createView(e).getField("position",wt);if(l==null)return;const h=me(Jo,o,n),c=0,u=l.count/3,p=s.options.normalRequired,_=(f,$,b)=>a(f,b,$);Oo(n,h,c,u,l.typedBuffer,l.typedBufferStride,p,_)}};const Jo=g();let H=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={0:null,1:null,2:null},s)switch(r){case void 0:break;case 0:this.bind[0]=s;break;case 1:this.bind[1]=s;break;case 2:this.bind[2]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},ea=class extends H{constructor(e,i,r){super(e,"float",0,(s,n)=>s.setUniform1f(e,i(n),r))}},Te=class extends H{constructor(e,i,r){super(e,"vec3",2,(s,n,o,a)=>s.setUniform3fv(e,i(n,o,a),r))}},xe=class extends H{constructor(e,i,r){super(e,"vec3",1,(s,n,o)=>s.setUniform3fv(e,i(n,o),r))}},ta=class extends H{constructor(e,i,r){super(e,"mat3",1,(s,n,o)=>s.setUniformMatrix3fv(e,i(n,o),r))}},Mt=class extends H{constructor(e,i,r){super(e,"mat4",0,(s,n)=>s.setUniformMatrix4fv(e,i(n),r))}},mu=class{constructor(e,i){this._module=e,this._load=i}get(){return this._module}async reload(){return this._module=await this._load(),this._module}};const _u=[],ia=[new Tr("position",3,vr.FLOAT,0,12)],ra=[new Tr("position",2,vr.FLOAT,0,8)],sa=Mr(ra);Mr(ia);let Zi=class{constructor(e,i,r){this._context=e,this.locations=r,this._textures=new Map,this.source=si()?i:null,i.attributeNames.forEach(s=>{r.has(s)||console.error(`Missing VertexAttributeLocation for ${s} used in shader`)}),this._glProgram=e.programCache.acquire(i.generate("vertex",!0),i.generate("fragment",!0),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=i.generateBind(this),this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this)}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i,r){this._glProgram.setUniform1f(e,i,r)}setUniform2fv(e,i,r){this._glProgram.setUniform2fv(e,i,r)}setUniform3fv(e,i,r){this._glProgram.setUniform3fv(e,i,r)}setUniform4fv(e,i,r){this._glProgram.setUniform4fv(e,i,r)}setUniformMatrix3fv(e,i,r){this._glProgram.setUniformMatrix3fv(e,i,!1,r)}setUniformMatrix4fv(e,i,r){this._glProgram.setUniformMatrix4fv(e,i,!1,r)}setUniformMatrices4fv(e,i,r){this._glProgram.setUniformMatrices4fv(e,i,!1,r)}setUniform1fv(e,i,r){this._glProgram.setUniform1fv(e,i,r)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform2iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e,i){let r=e.locations;if(i){const s=new Map(r);i.forEach((n,o)=>s.set(o,r.size+n)),r=s}r.size!==this.locations.size&&console.error(`VertexAttributeLocations are incompatible: ${r}, ${this.locations}`),this.locations.forEach((s,n)=>{r.get(n)!==s&&console.error(`VertexAttributeLocations are incompatible: Program has ${n} at position ${s}, VAO has it at position ${r.get(n)}.`)})}stop(){this._textures.clear()}bindTexture(e,i){if(!(i!=null&&i.glName)){const s=`Texture sampler ${e} in ${this._context.debugBoundTechnique} has no given Texture in ${new Error().stack}`;si()&&console.error(s),i=this._context.emptyTexture}const r=this._ensureTextureUnit(e,i);this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit)}_ensureTextureUnit(e,i){let r=this._textures.get(e);return r==null?(r={texture:i,unit:this._textures.size},this._textures.set(e,r)):r.texture=i,r}};const na=()=>gi.getLogger("esri.views.3d.webgl.ShaderTechnique");let Qi=class extends Ft{constructor(e,i,r=sa){super({}),this._context=e,this._configuration=i,this.locations=r,this.primitiveType=Es.TRIANGLES,this.key=i.key,this._pipeline=this.initializePipeline(i),this.reload=async s=>{s&&await this.shader.reload(),this.key.equals(i.key)||na().warn("Configuration was changed after construction, cannot reload shader.",this.shader),Ai(this._program);const n=this.shader.get().build(i);n.debugName=this.declaredClass,this._program=new Zi(e.rctx,n,r),this._pipeline=this.initializePipeline(i)}}initialize(){const e=this.shader.get().build(this._configuration);e.debugName=this.declaredClass,this._program=new Zi(this._context.rctx,e,this.locations)}destroy(){this._program=Ai(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,i){return this._pipeline}initializePipeline(e){return _n({blending:Cr,colorWrite:yn})}};function bu(t,e){return _o(t)?{buffers:[As]}:e??null}Qi=d([mi("esri.views.3d.webgl-engine.core.shaderTechnique.ShaderTechnique")],Qi);function oa(){return!!Os("enable-feature:objectAndLayerId-rendering")}const aa=xn(1,0,1,771);function $u(t,e=!1){switch(t){case 0:return e?Cr:bn;case 1:return aa;case 2:case 3:return null}}function wu(t){if(t.draped)return null;switch(t.oitPass){case 0:case 2:return t.writeDepth?$n:null;case 1:case 3:return null}}function Su(t,e=513){return{func:t===0||t===2?e:515}}const la={factor:-1,units:-2},Mu=5e5;function Tu({oitPass:t,enableOffset:e}){return e&&t===1?la:null}function Cu(t,e){return t===1?e?{buffers:[Ht,Ut,zs]}:{buffers:[Ht,Ut]}:e?{buffers:[Ht,Ut]}:null}const Pu={func:513},Eu={func:519},Au={mask:255},Ou={mask:0},zu={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},Iu={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},Ru={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},Fu={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};function Lu(t,e){ua(t,e,new Te("slicePlaneOrigin",(i,r)=>Xr(e,i,r)),new Te("slicePlaneBasis1",(i,r)=>{var s;return It(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Te("slicePlaneBasis2",(i,r)=>{var s;return It(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}function Du(t,e){Ur(t,e,new Te("slicePlaneOrigin",(i,r)=>Xr(e,i,r)),new Te("slicePlaneBasis1",(i,r)=>{var s;return It(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Te("slicePlaneBasis2",(i,r)=>{var s;return It(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}const ca=m`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool rejectBySlice(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}`;function Ur(t,e,...i){e.hasSlicePlane?(t.uniforms.add(...i),t.code.add(ca)):t.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function ua(t,e,...i){t.constants.add("groundSliceOpacity","float",.2),Ur(t,e,...i),e.hasSlicePlane?t.code.add(`
    void discardBySlice(vec3 pos) {
      if (rejectBySlice(pos)) {
        discard;
      }
    }

    vec4 applySliceOutline(vec4 color, vec3 pos) {
      SliceFactors factors = calculateSliceFactors(pos);

      factors.front /= 2.0 * fwidth(factors.front);
      factors.side0 /= 2.0 * fwidth(factors.side0);
      factors.side1 /= 2.0 * fwidth(factors.side1);
      factors.side2 /= 2.0 * fwidth(factors.side2);
      factors.side3 /= 2.0 * fwidth(factors.side3);

      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth
      if (sliceByFactors(factors)) {
        return color;
      }

      float outlineFactor = (1.0 - step(0.5, factors.front))
        * (1.0 - step(0.5, factors.side0))
        * (1.0 - step(0.5, factors.side1))
        * (1.0 - step(0.5, factors.side2))
        * (1.0 - step(0.5, factors.side3));

      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);
    }

    vec4 applySlice(vec4 color, vec3 pos) {
      return sliceEnabled() ? applySliceOutline(color, pos) : color;
    }
  `):t.code.add(m`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function qr(t,e,i){return t.instancedDoublePrecision?N(ha,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function Wr(t,e){return t!=null?Me(Rt,e.origin,t):e.origin}function Gr(t,e,i){return t.hasSliceTranslatedView?e!=null?Et(da,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function Xr(t,e,i){if(i.slicePlane==null)return rt;const r=qr(t,e,i),s=Wr(r,i.slicePlane),n=Gr(t,r,i);return n!=null?ge(Rt,s,n):s}function It(t,e,i,r){if(r==null||i.slicePlane==null)return rt;const s=qr(t,e,i),n=Wr(s,i.slicePlane),o=Gr(t,s,i);return o!=null?(oe(Ke,r,n),ge(Rt,n,o),ge(Ke,Ke,o),Me(Ke,Ke,Rt)):r}const ha=g(),Rt=g(),Ke=g(),da=X();let wi=class extends H{constructor(e,i,r){super(e,"vec2",0,(s,n)=>s.setUniform2fv(e,i(n),r))}};function Nu(t){t.vertex.uniforms.add(new wi("nearFar",e=>e.camera.nearFar))}function fa(t){t.vertex.code.add(m`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function ku(t){fa(t),t.vertex.code.add(m`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(m`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}function Nt(t){t.code.add(m`struct MaskedColor {
vec4 color;
bvec4 mask;
};`)}function ju(t){t.include(Nt),t.code.add(m`
    MaskedColor createMaskedFromUInt8NaNColor(vec4 color) {
      return MaskedColor(color * ${m.float(1/254)}, equal(color, vec4(255)));
    }
  `)}function pa(t){t.include(Nt),t.code.add(m`vec4 maskedColorSelectOrOne(MaskedColor color) {
return vec4(
color.mask.r ? 1.0 : color.color.r,
color.mask.g ? 1.0 : color.color.g,
color.mask.b ? 1.0 : color.color.b,
color.mask.a ? 1.0 : color.color.a
);
}
MaskedColor multiplyMaskedColors(MaskedColor color1, MaskedColor color2) {
vec4 masked1 = maskedColorSelectOrOne(color1);
vec4 masked2 = maskedColorSelectOrOne(color2);
return MaskedColor(masked1 * masked2, bvec4(ivec4(color1.mask) & ivec4(color2.mask)));
}`)}function va(t){t.include(Nt),t.code.add(m`MaskedColor createMaskedFromNaNColor(vec4 color) {
return MaskedColor(color, isnan(color));
}`)}let ma=class extends H{constructor(e,i,r){super(e,"vec3",0,(s,n)=>s.setUniform3fv(e,i(n),r))}},ga=class extends H{constructor(e,i,r){super(e,"mat4",2,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o),r))}};function _a(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",rt):t.uniforms.add(new Te("cameraPosition",(i,r)=>N(Yr,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Uu(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Mt("proj",r=>r.camera.projectionMatrix),new ga("view",(r,s)=>Et(Ji,s.camera.viewMatrix,r.origin)),new Te("localOrigin",r=>r.origin));const i=({camera:r})=>N(Yr,r.viewInverseTransposeMatrix[3],r.viewInverseTransposeMatrix[7],r.viewInverseTransposeMatrix[11]);t.uniforms.add(new Mt("proj",r=>r.camera.projectionMatrix),new Mt("view",r=>Et(Ji,r.camera.viewMatrix,i(r))),new ma("localOrigin",r=>i(r)))}const Ji=X(),Yr=g();function qu(t){t.uniforms.add(new Mt("viewNormal",e=>e.camera.viewInverseTransposeMatrix))}function Wu(t){t.uniforms.add(new ea("pixelRatio",e=>e.camera.pixelRatio/e.overlayStretch))}let Gu=class extends H{constructor(e,i,r){super(e,"mat4",1,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o),r))}};function Yu(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function Ku(t,e){const i=t.length;for(let r=0;r<i;++r)Ge[0]=t[r],e[r]=Ge[0];return e}function Zu(t,e){const i=t.length;for(let r=0;r<i;++r)Ge[0]=t[r],Ge[1]=t[r]-Ge[0],e[r]=Ge[1];return e}const Ge=new Float32Array(2);let Qu=class extends H{constructor(e,i){super(e,"int",1,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function ya(t,e){switch(e.textureCoordinateType){case 1:return t.attributes.add("uv0","vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(m`void forwardTextureCoordinates() { vuv0 = uv0; }`);case 2:return t.attributes.add("uv0","vec2"),t.attributes.add("uvRegion","vec4"),t.varyings.add("vuv0","vec2"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(m`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:Is(e.textureCoordinateType);case 0:return void t.vertex.code.add(m`void forwardTextureCoordinates() {}`);case 3:return}}function eh(t,e){e.hasVertexColors?(t.attributes.add("color","vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(m`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(m`
      void forwardNormalizedVertexColor() { vColor = color * ${m.float(1/255)}; }
    `)):t.vertex.code.add(m`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function xa(t){t.vertex.code.add(m`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(m`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(m`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return size * clamp(mix(factor.x, 1.0, factor.y), factor.z, 1.0);
}`),t.vertex.code.add(m`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(m`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return size * clamp(mix(factor.x, 1.0, factor.y), factor.z, 1.0);
}`),t.vertex.code.add(m`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function th(t){t.uniforms.add(new xe("screenSizePerspective",e=>Kr(e.screenSizePerspective,e.screenSizePerspectiveMinPixelReferenceSize)))}function ba(t){t.uniforms.add(new xe("screenSizePerspectiveAlignment",e=>Kr(e.screenSizePerspectiveAlignment||e.screenSizePerspective,e.screenSizePerspectiveAlignment?null:e.screenSizePerspectiveMinPixelReferenceSize)))}function Kr(t,e){const i=e!=null&&t!=null?Math.min(t.minPixelSize/e,1):0;return t?N(er,t.divisor,t.offset,i):N(er,0,0,0)}const er=g();let Zr=class extends H{constructor(e,i,r){super(e,"vec4",1,(s,n,o)=>s.setUniform4fv(e,i(n,o),r))}},rh=class{constructor(e){this.screenLength=Rs(e.screenLength),this.minWorldLength=e.minWorldLength??0,this.maxWorldLength=e.maxWorldLength??1/0}};function nh(t,e){const i=t.vertex;e.hasVerticalOffset?(wa(i),e.hasScreenSizePerspective&&(t.include(xa),ba(i),_a(t.vertex,e)),i.code.add(m`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?m`vec3 worldNormal = normalize(worldPos + localOrigin);`:m`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?m`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:m`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(m`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const $a=Fe();function wa(t){t.uniforms.add(new Zr("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return At($a,n*a,o,r,s)}))}function oh(t,e){if(e.output!==9)return t.vertex.code.add(m`void forwardObjectAndLayerIdColor() {}`),void t.fragment.code.add(m`void outputObjectAndLayerIdColor() {}`);const i=e.instanced;t.varyings.add("objectAndLayerIdColorVarying","vec4");const r=i?"instanceOlidColor":"olidColor";t.attributes.add(r,"vec4"),t.vertex.code.add(m`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${r} * 0.003921568627451;
    }`),t.fragment.code.add(m`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}function Sa(t){const{fragment:e}=t;e.code.add(m`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(uvec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return texel[lic];
}
uint readLevelBits(uvec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}let Ma=class extends H{constructor(e,i){super(e,"ivec2",0,(r,s)=>r.setUniform2iv(e,i(s)))}},Ta=class extends H{constructor(e,i){super(e,"int",0,(r,s)=>r.setUniform1i(e,i(s)))}},Qr=class extends H{constructor(e,i){super(e,"sampler2D",0,(r,s)=>r.bindTexture(e,i(s)))}},Ca=class extends H{constructor(e,i){super(e,"usampler2D",0,(r,s)=>r.bindTexture(e,i(s)))}};function Pa(t,e){const{fragment:i}=t,{output:r,draped:s,hasHighlightMixTexture:n}=e;r===8?(i.uniforms.add(new Ta("highlightLevel",o=>o.highlightLevel??0),new Ma("highlightMixOrigin",o=>o.highlightMixOrigin)),t.outputs.add("fragHighlight","uvec2",0),t.include(Sa),n?i.uniforms.add(new Ca("highlightMixTexture",o=>o.highlightMixTexture)).code.add(m`uvec2 getAccumulatedHighlight() {
return texelFetch(highlightMixTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
uvec2 combinedHighlight = getAccumulatedHighlight();
combinedHighlight[li] |= bits;
fragHighlight = combinedHighlight;
}
}`):i.code.add(m`void outputHighlight(bool occluded) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
}`),s?i.code.add(m`bool isHighlightOccluded() {
return false;
}`):i.uniforms.add(new Qr("depthTexture",o=>o.mainDepth)).code.add(m`bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}`),i.code.add(m`void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`)):i.code.add(m`void calculateOcclusionAndOutputHighlight() {}`)}let Ea=class extends H{constructor(e,i,r,s){super(e,"vec4",1,(n,o,a)=>n.setUniform4fv(e,i(o,a),s),r)}},Aa=class extends H{constructor(e,i,r,s){super(e,"float",1,(n,o,a)=>n.setUniform1fv(e,i(o,a),s),r)}},Si=class{constructor(e){this.field=e}},Oa=class extends Si{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[0,0,0],this.fallback=[0,0,0]}},tr=class extends Si{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}};class za extends Si{constructor(e,i=0){super(e),this.fallback=i,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class Ia{}function Ze(t){return t!=null}function Ra(t,e,i,r=X()){const s=t||0,n=e||0,o=i||0;return s!==0&&Vs(r,r,-s/180*Math.PI),n!==0&&mr(r,r,n/180*Math.PI),o!==0&&Ns(r,r,o/180*Math.PI),r}function Pe(t,e,i,r,s){var a;const n=t.minSize,o=t.maxSize;if(t.useSymbolValue){const l=r.symbolSize[i];return e.minSize[i]=l,e.maxSize[i]=l,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=1,!0}if(Ze(t.field))return Ze(t.stops)?t.stops.length===2&&je(t.stops[0].size)&&je(t.stops[1].size)?(ir(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=1,!0):!1:je(n)&&je(o)&&Ze(t.minDataValue)&&Ze(t.maxDataValue)?(ir(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=1,!0):t.valueUnit==="unknown"?!1:Oi[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/Oi[t.valueUnit],e.type[i]=1,!0):!1;if(!Ze(t.field)){if((a=t.stops)!=null&&a[0]&&je(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=1,!0;if(je(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=1,!0}return!1}function ir(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function Fa(t,e,i,r){if(t.normalizationField||t.valueRepresentation||!Bs(t.field))return null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return null}else e.size.field=t.field}else e.size=new Oa(t.field),U(e.size.fallback,i.fallbackSize);let s;switch(t.axis){case"width":return s=Pe(t,e.size,0,i),s?e:null;case"height":return s=Pe(t,e.size,2,i),s?e:null;case"depth":return s=Pe(t,e.size,1,i),s?e:null;case"width-and-depth":return s=Pe(t,e.size,0,i),s&&Pe(t,e.size,1,i),s?e:null;case null:case void 0:case"all":return s=Pe(t,e.size,0,i),s=s&&Pe(t,e.size,1,i),s=s&&Pe(t,e.size,2,i),s?e:null;default:return`${t.axis}`,null}}function La(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===1&&(n*=e.modelSize[s],t.type[s]=2),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==0)r=0;else if(t.type[1]!==0)r=1;else{if(t.type[2]===0)return!1;r=2}for(let s=0;s<3;++s)t.type[s]===0&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function rr(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function Da(t,e,i,r){if(t.normalizationField)return null;if(yi(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.color=new tr(t.field);const s=t.stops;for(let n=0;n<8;++n){const o=s[Math.min(n,s.length-1)];e.color.values[n]=o.value,rr(e.color.colors,n,o.color)}qe(e.color.fallback,i.fallbackColor)}}else{if(!(t.stops&&t.stops.length>=0))return null;{const s=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color=new tr(null);for(let n=0;n<8;n++)e.color.values[n]=1/0,rr(e.color.colors,n,s);qe(e.color.fallback,i.fallbackColor)}}return e}function Va(t,e,i,r){if(t.normalizationField)return null;if(yi(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.opacity=new za(t.field,i.fallbackColor[3]);const s=t.stops;for(let n=0;n<8;++n){const o=s[Math.min(n,s.length-1)];e.opacity.values[n]=o.value,e.opacity.opacityValues[n]=o.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const s=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:i.fallbackColor[3]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=s}}return e}function Gt(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function Na(t,e,i){if(!yi(t.field))return null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return Gt(t,e.rotation,0),e;case"roll":return Gt(t,e.rotation,1),e;case null:case void 0:case"heading":return Gt(t,e.rotation,2),e;default:return`${t.axis}`,null}}class mh{constructor({supports:e,modelSize:i,symbolSize:r,unitInMeters:s,anchor:n,scale:o,rotation:a,fallbackColor:l,fallbackSize:h}){this.supports=e,this.modelSize=i??at(),this.symbolSize=r??at(),this.unitInMeters=s??1,this.anchor=n??st(),this.scale=o??at(),this.rotation=a??st(),this.fallbackColor=l??Fs(),this.fallbackSize=h??at()}}function Jr(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return null;switch(n.type){case"size":return e.supports.size?Fa(n,s,e,i):s;case"color":return e.supports.color?Da(n,s,e):s;case"opacity":return e.supports.opacity?Va(n,s,e):null;case"rotation":return e.supports.rotation?Na(n,s,i):s;default:return null}},new Ia);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r!=null&&r.size&&!La(r.size,e)?null:r:null}class ka{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}}function gh(t,e){if(!t||oa()||jn.TESTS_DISABLE_FAST_UPDATES)return null;const i=Jr(t.visualVariables,e);return i?new ka(i,ts(i,e),!!i.size):null}function _h(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=Jr(e.visualVariables,i);return!!s&&!!(pt(r.size,s.size,"size")&&pt(r.color,s.color,"color")&&pt(r.rotation,s.rotation,"rotation")&&pt(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=ts(s,i),t.requiresShaderTransformation=!!s.size,!0)}function pt(t,e,i){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}class es extends Vt{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}}function ts(t,e){const i=new es(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,Ls(it),Ra(e.rotation[2],e.rotation[0],e.rotation[1],it),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||dr(),Ds(i.vvSymbolRotationMatrix,it)),i}function yh(t,e,i){if(!t.vvSize)return i;Xe(Ee,i);const r=t.vvSymbolRotationMatrix;return ks(it,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Pt(Ee,Ee,it),ja(sr,t,e),js(Ee,Ee,sr),Et(Ee,Ee,t.vvSymbolAnchor),Ee}function ja(t,e,i){if(!e.vvSize)return N(t,1,1,1),t;if(Number.isNaN(i[0]))return U(t,e.vvSize.fallback);for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=nt(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function xh(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:NaN}const Ee=X(),sr=g(),it=X();let bh=class extends es{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}};const Xt=8;function wh(t,e){const{vertex:i,attributes:r}=t;e.hasVVInstancing&&(e.hasVVSize||e.hasVVColor)&&r.add("instanceFeatureAttribute","vec4"),e.hasVVSize?(i.uniforms.add(new xe("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new xe("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new xe("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new xe("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new xe("vvSizeFallback",s=>s.vvSize.fallback)),i.uniforms.add(new ta("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new xe("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(m`vec3 vvScale(vec4 _featureAttribute) {
if (isnan(_featureAttribute.x)) {
return vvSizeFallback;
}
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(m`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 scale = max(vvScale(_featureAttribute), eps);
        return vec4(vvSymbolRotationMatrix * _normal / scale, 1.0);
      }

      ${e.hasVVInstancing?m`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(m`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vertex.include(Nt),e.hasVVColor?(i.constants.add("vvColorNumber","int",Xt),i.uniforms.add(new Aa("vvColorValues",s=>s.vvColor.values,Xt),new Ea("vvColorColors",s=>s.vvColor.colors,Xt),new Zr("vvColorFallback",s=>s.vvColor.fallback,{supportsNaN:!0})),e.hasVVInstancing&&(t.vertex.include(pa),t.vertex.include(va)),i.code.add(m`
      vec4 interpolateVVColor(float value) {
        if (isnan(value)) {
          return vvColorFallback;
        }

        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVVInstancing?m`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }

            MaskedColor applyVVColor(MaskedColor color) {
              return multiplyMaskedColors(color, createMaskedFromNaNColor(vvColor()));
            }
            `:m`
            vec4 vvColor() {
              return vec4(1.0);
            }

            MaskedColor applyVVColor(MaskedColor color) {
              return color;
            }
            `}
    `)):i.code.add(m`vec4 vvColor() {
return vec4(1.0);
}
MaskedColor applyVVColor(MaskedColor color) {
return color;
}`)}let Ba=class extends H{constructor(e,i,r){super(e,"float",2,(s,n,o)=>s.setUniform1f(e,i(n,o),r))}},Ha=class extends H{constructor(e,i,r){super(e,"float",1,(s,n,o)=>s.setUniform1f(e,i(n,o),r))}};const Ua=1/255.5;let qa=class extends H{constructor(e,i){super(e,"sampler2D",1,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function Wa(t){t.fragment.code.add(m`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function Ga(t,e){const{textureCoordinateType:i}=e;if(i===0||i===3)return;t.include(ya,e);const r=i===2;r&&t.include(Wa),t.fragment.code.add(m`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${r?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}let Ch=class extends H{constructor(e,i,r){super(e,"vec2",1,(s,n,o)=>s.setUniform2fv(e,i(n,o),r))}},Xa=class extends H{constructor(e,i){super(e,"sampler2D",2,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function Ya(t,e,i){t.worldUpAtPosition(e,nr),Me(Yt,i,e);const r=Y(Yt);return r===0?0:oi(ue(Yt,nr)/r)}const nr=g(),Yt=g();function Ka(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Za(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Qa(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function Ja(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var di;let P=di=class extends Ft{constructor(t){super(t),this._ray=Pr(),this._viewport=zi(0,0,1,1),this._padding=zi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=gr(1,1e3),this._viewDirty=!0,this._viewMatrix=X(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=X(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=X(),this._frustumDirty=!0,this._frustum=Ar(),this._fullViewport=Fe(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=g(),this._up=g(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Me(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Xe(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),N(g(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),N(g(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),N(g(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=Ii(Fe(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Ri(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=Ii(Fe(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&Ri(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[3],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[2],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(t){this.width=t-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(t){this.height=t-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){qt(this._padding,t)||(this._viewport[0]+=t[3]-this._padding[3],this._viewport[1]+=t[2]-this._padding[2],this._viewport[2]-=t[1]+t[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=t[0]+t[2]-(this._padding[0]+this._padding[2]),qe(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Pt(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return $t(X(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||X()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Qa(this._fov,this.width,this.height)}set fovX(t){this._fov=Ka(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Ja(this._fov,this.width,this.height)}set fovY(t){this._fov=Za(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return _r(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&($t(this._viewInverseTransposeMatrix,this.viewMatrix),ni(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const{near:e,far:i}=this;return 2*e*i/(i+e-t*(i-e))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,o=-r/2+this.column*n,a=o+n,l=-i/2+this.row*s,h=l+s,c=Hs(X(),o*(1+2*this._padding[3]/t),a*(1+2*this._padding[1]/t),l*(1+2*this._padding[2]/e),h*(1+2*this._padding[0]/e),this.near,this.far),u=this._get("projectionMatrix");return u&&Us(u,c)?u:c}copyFrom(t){U(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,qe(this._viewport,t.viewport),this.notifyChange("_viewport"),qe(this._padding,t.padding),this.notifyChange("_padding"),qs(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Xe(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(wn(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Xe(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),qe(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return new di().copyFrom(this)}equals(t){return ze(this.eye,t.eye)&&ze(this.center,t.center)&&ze(this.up,t.up)&&qt(this._viewport,t.viewport)&&qt(this._padding,t.padding)&&Ws(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||Fi(t.screenPadding,this.screenPadding)>=e||Fi(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;me(q,t.eye,t.center),me(ve,this.eye,this.center);const i=ue(q,ve),r=Li(q),s=Li(ve),n=5e-4;return i*i>=(1-1e-10)*r*s&&ai(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(On(this.viewForward,Me(q,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Gs()){return t[0]=(this.padding[3]+this.width/2)/this.pixelRatio,t[1]=(this.padding[0]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[3]+this.width*e,t[1]=this.padding[2]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==I&&U(I,t),I[3]=1,lt(I,I,this.projectionMatrix);const i=Math.abs(I[3]);W(I,I,1/i);const r=this.fullViewport;e[0]=te(0,r[0]+r[2],.5+.5*I[0]),e[1]=te(0,r[1]+r[3],.5+.5*I[1]),e[2]=.5*(I[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;I[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],I[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],I[2]=(2*t[2]-1)*t[3],I[3]=t[3],this.inverseProjectionMatrix!=null&&(lt(I,I,this.inverseProjectionMatrix),e[0]=I[0],e[1]=I[1],e[2]=I[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,Kt),this.renderToScreen(Kt,e),e}projectToRenderScreen(t,e){if(I[0]=t[0],I[1]=t[1],I[2]=t[2],I[3]=1,lt(I,I,this.viewProjectionMatrix),I[3]===0)return null;const i=I;W(i,i,1/Math.abs(I[3]));const r=this.fullViewport,s=te(0,r[0]+r[2],.5+.5*i[0]),n=te(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,Kt),e)}unprojectFromRenderScreen(t,e){if(Pt(vt,this.projectionMatrix,this.viewMatrix),!$t(vt,vt))return null;const i=this.fullViewport;return I[0]=2*(t[0]-i[0])/i[2]-1,I[1]=2*(t[1]-i[1])/i[3]-1,I[2]=2*t[2]-1,I[3]=1,lt(I,I,vt),I[3]===0?null:(e[0]=I[0]/I[3],e[1]=I[1]/I[3],e[2]=I[2]/I[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),h=-Math.min(this.fullHeight-n-r/2,0),c=i-l- -Math.min(this.fullWidth-s-i/2,0),u=r-h- -Math.min(n-r/2,0);return[Math.round(o),Math.round(a),Math.round(c),Math.round(u)]}computeUp(t){t===1?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}sphereFrustumCoverage(t,e){const{center:i,eye:r,distance:s,fovY:n}=this,o=Math.abs(Math.PI/2-Ya(e,i,r));return t.frustumCoverage(o,s,n)}_computeUpGlobal(){Me(q,this.center,this.eye);const t=Y(this.center);t<1?ze(this._up,Di)&&(U(this._up,Di),this._markViewDirty(),this.notifyChange("_up")):Math.abs(ue(q,this.center))>.9999*Y(q)*t||(de(ve,q,this.center),de(ve,ve,q),Ce(ve,ve),ze(this._up,ve)||(U(this._up,ve),this.notifyChange("_up"),this._markViewDirty()))}_computeUpLocal(){yr(q,this.eye,this.center),Math.abs(q[2])<=.9999&&(W(q,q,q[2]),N(q,-q[0],-q[1],1-q[2]),Ce(q,q),ze(this._up,q)||(U(this._up,q),this.notifyChange("_up"),this._markViewDirty()))}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ze(t,e)||(U(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):gi.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Or(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Xs(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([v()],P.prototype,"_viewport",void 0),d([v()],P.prototype,"_padding",void 0),d([v()],P.prototype,"_fov",void 0),d([v()],P.prototype,"_nearFar",void 0),d([v()],P.prototype,"_viewDirty",void 0),d([v()],P.prototype,"_viewMatrix",void 0),d([v()],P.prototype,"_pixelRatio",void 0),d([v()],P.prototype,"pixelRatio",null),d([v()],P.prototype,"row",void 0),d([v()],P.prototype,"column",void 0),d([v()],P.prototype,"_rows",void 0),d([v()],P.prototype,"rows",null),d([v()],P.prototype,"_columns",void 0),d([v()],P.prototype,"columns",null),d([v()],P.prototype,"eye",null),d([v()],P.prototype,"center",null),d([v()],P.prototype,"_center",void 0),d([v()],P.prototype,"up",null),d([v()],P.prototype,"_up",void 0),d([v()],P.prototype,"viewMatrix",null),d([v({readOnly:!0})],P.prototype,"viewForward",null),d([v({readOnly:!0})],P.prototype,"viewUp",null),d([v({readOnly:!0})],P.prototype,"viewRight",null),d([v({readOnly:!0})],P.prototype,"nearFar",null),d([v()],P.prototype,"near",null),d([v()],P.prototype,"far",null),d([v()],P.prototype,"viewport",null),d([v({readOnly:!0})],P.prototype,"screenViewport",null),d([v({readOnly:!0})],P.prototype,"screenPadding",null),d([v()],P.prototype,"x",null),d([v()],P.prototype,"y",null),d([v()],P.prototype,"width",null),d([v()],P.prototype,"height",null),d([v()],P.prototype,"fullWidth",null),d([v()],P.prototype,"fullHeight",null),d([v({readOnly:!0})],P.prototype,"_aspect",null),d([v()],P.prototype,"padding",null),d([v({readOnly:!0})],P.prototype,"projectionMatrix",null),d([v({readOnly:!0})],P.prototype,"inverseProjectionMatrix",null),d([v()],P.prototype,"fov",null),d([v()],P.prototype,"fovX",null),d([v()],P.prototype,"fovY",null),d([v()],P.prototype,"viewInverseTransposeMatrix",null),d([v({readOnly:!0})],P.prototype,"_projectionMatrixInternal",null),d([v()],P.prototype,"relativeElevation",void 0),P=di=d([mi("esri.views.3d.webgl.RenderCamera")],P);const Ah=P,I=Fe(),vt=X(),q=g(),ve=g(),Kt=Ys();function el(t,e){const i=[],r=[];return mt(i,t,e,0),mt(r,i,e,1),mt(i,r,e,2),mt(r,i,e,3),r}function mt(t,e,i,r){const s=tl(i,r);if(t.length=0,e.length){s(gt,e[0],e[0])===1&&Qe(t,e[0]);for(let n=0;n<e.length;n++){const o=e[n===e.length-1?0:n+1];switch(s(gt,e[n],o)){case 1:Qe(t,o);break;case 3:Qe(t,Vi(gt));break;case 2:Qe(t,Vi(gt)),Qe(t,o)}}}}function Qe(t,e){t.length!==0&&Ks(t.at(-1),e)||t.push(e)}function tl(t,e){const i=e===0||e===2?0:1,r=t[e],s=e===0||e===1?1:-1,n=i===0?1:0;return(o,a,l)=>{if(a[i]<r&&l[i]<r)return s===1?0:1;if(a[i]>r&&l[i]>r)return s===1?1:0;const h=(l[n]-a[n])/(l[i]-a[i]),c=a[n]+h*(r-a[i]);return o[i]=r,o[n]=c,(a[i]<r?1:-1)*s>0?2:3}}const gt=xi(),il=g(),_t=g();function is(){return{direction:g(),up:g()}}function rs(t,e,i,r,s){let n=Ce(il,t),o=ue(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(ue(e,r)),o<.99?(U(n,e),a&&W(n,n,-1)):n=null);let l=0;if(n){W(_t,r,ue(r,n)),Me(n,n,_t);const c=ue(n,s)/(Y(n)*Y(s));de(_t,n,s),l=(ue(_t,r)>0?1:-1)*De(oi(c))}const h=De(oi(-ue(r,t)/Y(t)));return i?(i.heading=l,i.tilt=h,i):{heading:l,tilt:h}}function ss(t,e,i,r){Me(or,i,e),zn(r,Ln(e,or),t)||t===i||U(t,i)}const or=g(),ns=K(0,1,0),os=K(0,0,1),Je=X(),_e=g(),ye=g();function as(t,e,i,r=is()){const{direction:s,up:n}=r;return Zs(Je,-ae(e)),mr(Je,Je,ae(i)),ge(s,os,Je),W(s,s,-1),ge(n,ns,Je),r}function rl(t,e,i,r){return rs(e,i,r,os,ns)}function sl(t,e,i,r){const s=as(t,i,r),n=g();return W(n,s.direction,-e),oe(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function nl(t){return De(t)}function ol(t){return ae(t)}function al(t,e,i,r,s){const n=t.renderSpatialReference,o=t.spatialReference??e.spatialReference;return Gi(e,_e,n),Gi(e,ye,n),_e[0]-=i/2,ye[0]+=i/2,_e[1]-=r/2,ye[1]+=r/2,Hi(_e,n,_e,o),Hi(ye,n,ye,o),s?(s.xmin=_e[0],s.ymin=_e[1],s.xmax=ye[0],s.ymax=ye[1],s.spatialReference=o):s=new xr(_e[0],_e[1],ye[0],ye[1],o),s}function ll(t,e){const i=t.frustum,{renderCoordsHelper:r}=t,s=r.getAltitude(e),n=t.spatialReference,o=t.state.camera.eye,a=[],l=i.planes[5];for(let h=0;h<4;h++){const c=i.lines[h];r.intersectInfiniteManifold(Er(c.origin,c.direction),s,he)||cl(he,i,r,c.endpoint,s),ss(he,o,he,l),a.push(gr(he[0],he[1]))}return ul(el(a,r.extent),r,n)}function cl(t,e,i,r,s){const n=e.lines[11].direction,o=(s-i.getAltitude(r))/n[2];we(t,r,n,o)}function ul(t,e,i){const r=t.map(s=>(N(he,s[0],s[1],0),e.fromRenderCoords(he,he,i),[he[0],he[1]]));return r.length<=2?new li({spatialReference:i}):(r.push(r[0].slice()),br(r)||r.reverse(),new li({rings:[r],spatialReference:i}))}const he=g();Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:rl,eyeForCenterWithHeadingTilt:sl,eyeTiltToLookAtTilt:ol,headingTiltToDirectionUp:as,lookAtTiltToEyeTilt:nl,toArea:ll,toExtent:al},Symbol.toStringTag,{value:"Module"}));var Le;let hl=(Le=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=Ar(),this._points=Sn(),this.lines=new Array(12),this._origin=g(),this._direction=g(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:g(),endpoint:null}}update(e){Or(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),U(this._origin,e.eye),U(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)U(this._points[i],e[i]);Mn(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Tn(this.frustum,e)}intersectsRay(e){return Cn(this.frustum,e)}intersectsLineSegment(e,i){return Pn(this.frustum,e,i)}intersectsPoint(e){return En(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;Zt(this.lines[i],e[i],e[r]),Zt(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),Zt(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}},Le.planePointIndices=An,Le.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]],Le);function Zt(t,e,i){t.origin=e,t.endpoint=i,yr(t.direction,e,i)}const Qt=K(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),Jt=3,ei=K(Jt*parseFloat(65e-8.toFixed(6)),Jt*parseFloat(1881e-9.toFixed(6)),Jt*parseFloat(85e-9.toFixed(6)));K(parseFloat(Number(Qt[0]+ei[0]).toFixed(6)),parseFloat(Number(Qt[1]+ei[1]).toFixed(6)),parseFloat(Number(Qt[2]+ei[2]).toFixed(6)));var Se;let Oh=(Se=class{constructor(e=1/0,i=-1/0){this.near=e,this.far=i}set(e,i){this.near=e,this.far=i}union(e){return e!=null&&(this.near=Math.min(this.near,e.near),this.far=Math.max(this.far,e.far)),this}within(e){return this.near<=e&&e<=this.far}equals(e){return this.near===e.near&&this.far===e.far}},Se.Zero=new Se(0,0),Se.Infinite=new Se,Se);const dl=2;new Dt;Pr();function fl(t,e,i){const r=e/i,s=ae(t),n=Math.sin(r/2),o=Math.cos(s),a=2*Lt(Math.sqrt(n*n/(o*o)));return De(a)}const ls=K(0,0,1),cs=Ce(g(),K(1,1,1)),et=X(),Ae=g(),Be=g();function us(t,e,i,r=is()){de(Ae,t,ls),ue(Ae,Ae)===0&&de(Ae,t,cs),Qs(et,-ae(e),t),Js(et,et,-ae(i),Ae);const{up:s,direction:n}=r;return de(s,Ae,t),Ce(s,s),ge(s,s,et),Ce(n,t),$r(n,n),ge(n,n,et),r}function pl(t,e,i,r){const s=Ae,n=Be;return Ce(s,t),de(Be,s,ls),ue(Be,Be)===0&&de(Be,s,cs),de(n,Be,s),rs(e,i,r,s,n)}function vl(t,e,i,r){const s={eye:g(),up:null,tilt:r,heading:i},n=Ae;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=ae(i),l=ae(r),h=Math.sin(a),c=Math.cos(a),u=Math.sin(l),p=Math.cos(l),_=Y(n);let f;if(Math.abs(l)<1e-8)f=o+_;else{const V=_/u,k=Lt(o/V),Z=Math.PI-l-k;f=V*Math.sin(Z)}const $=p*o,b=o*o*(u*u),E=c*c*b,A=f-$,C=A*A,O=E*(E+C-n[1]*n[1]);if(O<0)return W(s.eye,n,f/_),s.tilt=0,yt(s,t);const R=Math.sqrt(O),L=n[1]*A,T=E+C;let w;if(w=c>0?-R+L:R+L,Math.abs(T)<1e-8)return _<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):W(s.eye,n,f/_),s.tilt=0,ti(s.eye),yt(s,t);s.eye[1]=w/T;const x=h*h*b,z=u*o,y=c*z*s.eye[1],S=s.eye[1]*s.eye[1],M=1-S,F=Math.sqrt(M),D=E*S+x-2*y*F*A+M*C;return Math.abs(D)<1e-8?(W(s.eye,n,f/_),s.tilt=0,ti(s.eye),yt(s,t)):(s.eye[0]=(M*(f*n[0]-$*n[0])-z*F*(n[0]*s.eye[1]*c+n[2]*h))/D,s.eye[2]=(M*(f*n[2]-$*n[2])-z*F*(n[2]*s.eye[1]*c-n[0]*h))/D,W(s.eye,s.eye,f),ti(s.eye),yt(s,t))}function ti(t){const e=t[1];t[1]=-t[2],t[2]=e}function yt(t,e){const i=us(e,t.heading,t.tilt);return t.up=i.up,t}function ml(t,e,i){const r=Y(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=Lt(i/(s/Math.sin(t)));return De(t-n)}function gl(t,e,i){const r=ae(t),s=Y(e);return Lt(i/(s/Math.sin(r)))+r}function _l(t,e,i,r,s){let n,o,a,l;const h=e.latitude,c=en(t.spatialReference).radius,u=e.longitude,p=fl(h,i,c)/2;n=u-p,o=u+p;const _=ae(h),f=(1+Math.sin(_))/(1-Math.sin(_)),$=(f+1)*Math.tan(r/c/2),b=$*$;function E(C){const O=Math.PI/2;return(C=on.normalize(C,-O))>O&&(C=Math.PI-C),C}if(a=1.5*Math.PI-2*Math.atan(.5*($+Math.sqrt(4*f+b))),l=a+r/c,a=E(a),l=E(l),l<a){const C=l;l=a,a=C}if(a=Math.max(De(a),-90),l=Math.min(De(l),90),o=tn.monotonic(n,o),o-n>180){const C=(o-n-180)/2;n+=C,o-=C}const A=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:rn.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=A):s=new xr(n,a,o,l,A),t.spatialReference&&t.spatialReference.isWebMercator&&sn(s,!1,s),s}function yl(t,e){const{renderCoordsHelper:i}=t,r=t.state.camera.clone(),s=new hl(i);r.near=dl,s.update(r);const n=i.getAltitude(e),o=t.spatialReference,a=i.referenceEllipsoid.radius,l=r.eye,h=1+_r(l,e)/(a+n),c=Math.sqrt(h*h-1),{minCurvature:u,maxCurvature:p,minSamples:_,maxSamples:f}=wl,$=$l(t),b=nt((c-u)/(p-u),0,1),E=Math.round(te(_,f,b)),A=r.aboveGround,C=s.planes[5],O=[],R=Ui(rt,Sl,qi()),L=Ui(rt,Ml,qi());At(ii,0,0,0,0);const T=x=>{};for(let x=0;x<4;x++){const z=x===1&&!A||x===3&&A?1-$:0,y=x===1&&A||x===3&&!A?$:1,S=s.lines[x],M=s.lines[x===3?0:x+1];for(let F=0;F<E;F++){const D=F/E,V=F===0?0:te(z,y,x===1?1-(1-D)**2:x===3?D**2:D),k=Ct(Cl,S.origin,M.origin,V),Z=In(S.direction,M.direction,V,Tl);i.intersectManifoldClosestSilhouette(Er(k,Z),n,Q),ss(Q,l,Q,C),O.push(hr(Q)),O.length!==0&&T(ai(O.at(-1),Q));const ie=(Wi(R,Q)?1:0)|(Wi(L,Q)?2:0);ii[ie]=1}}O.length>2&&T(ai(O[0],O.at(-1)));const w=xl(nn(ii)>1?bl(hs(O,R),L):[O],i,o);return new li({rings:w,spatialReference:o})}function xl(t,e,i){const r=2*wr();return t.map(s=>{const n=[];let o=!1;for(const a of s)e.fromRenderCoords(a,Q,i),Math.abs(a[0])<r&&Math.abs(a[1])<r?(n.push([null,Q[1]]),n.push([null,Q[1]]),o=!0):n.push([Q[0],Q[1]]);if(o)for(let a=0;a<n.length;a++){const l=n[a];if(l[0]!=null)continue;const h=n[a+1],c=n.at(a===0?-1:a-1);l[0]=c[0],a++;const u=n.at(a===n.length-1?0:a+1);h[0]=u[0]}return n.push(n[0]),br(n)||n.reverse(),n})}function bl(t,e){const i=[];for(const r of t)i.push(...hs(r,e));return i}function hs(t,e){const i=[],r=[],s=wr();for(let o=0;o<t.length;o++){const a=t[o],l=o===t.length-1?t[0]:t[o+1],h=Vn(a,l,Pl),c=Rn(e,h.origin,h.vector,0,Q);switch(c){case 2:i.push(a);break;case 3:r.push(a);break;case 0:case 1:{const[u,p,_]=c===0?[1,i,r]:[-1,r,i],f=Fn(e),$=we(g(),Q,f,u*s),b=we(g(),Q,f,u*-s);p.push(a),p.push($),_.push(b)}}}const n=[];return i.length&&n.push(i),r.length&&n.push(r),n}function $l(t){const{renderCoordsHelper:e,state:i}=t,r=Math.abs(e.getAltitude(i.camera.center));return ar.radius=e.referenceEllipsoid.radius+r,i.camera.sphereFrustumCoverage(ar,e)}const wl={minCurvature:ae(5),maxCurvature:ae(50),minSamples:1,maxSamples:6},Sl=K(1,0,0),Ml=K(0,1,0),Tl=g(),Cl=g(),Q=g(),ar=new Dt,Pl=Dn(),ii=Fe();Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:pl,eyeForCenterWithHeadingTilt:vl,eyeTiltToLookAtTilt:gl,headingTiltToDirectionUp:us,lookAtTiltToEyeTilt:ml,toArea:yl,toExtent:_l},Symbol.toStringTag,{value:"Module"}));const El={OPAQUE:"opaque-color",TRANSPARENT:"transparent-color",COMPOSITE:"composite-color",FINAL:"final-color"},zh={SSAO:"ssao",LASERLINES:"laserline-color",ANTIALIASING:"aa-color",HIGHLIGHTS:"highlight-color",MAGNIFIER:"magnifier-color",OCCLUDED:"occluded-color",VIEWSHED:"viewshed-color",CUTFILL_DEPTH:"cutfill-depth",CUTFILL_COLOR:"cutfill-color",OPAQUE_TERRAIN:"opaque-terrain-color",OPAQUE_ENVIRONMENT:"opaque-environment-color",TRANSPARENT_ENVIRONMENT:"transparent-environment-color",FOCUSAREA:"focusarea",FOCUSAREA_COLOR:"focusarea-color"};let He=class extends Ft{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=El.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([ln(()=>this.view.ready,e=>{var i;e&&((i=this.view.stage)==null||i.renderer.addRenderNode(this))},cn)])}destroy(){var e,i;(i=(e=this.view.stage)==null?void 0:e.renderer)==null||i.removeRenderNode(this)}precompile(){}render(){throw new bt("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view.stage.renderView.renderingContext.gl}get techniques(){return this.view.stage.renderView.techniques}acquireOutputFramebuffer(){var r,s,n;const e=(s=(r=this._frameBuffer)==null?void 0:r.getTexture())==null?void 0:s.descriptor,i=this.view.stage.renderer.fboCache.acquire((e==null?void 0:e.width)??640,(e==null?void 0:e.height)??480,this.produces);return(n=i.fbo)==null||n.initializeAndBind(),i}bindRenderTarget(){var e,i;return(i=(e=this._frameBuffer)==null?void 0:e.fbo)==null||i.initializeAndBind(),this._frameBuffer}requestRender(e){var i;switch(e){case 2:this.view.state.fading=!0;case 1:(i=this.view.stage)==null||i.renderView.requestRender(e);case 0:case void 0:this._dirty=!0}}resetWebGLState(){var e;this.renderingContext.resetState(),this.renderingContext.bindFramebuffer((e=this._frameBuffer)==null?void 0:e.fbo)}get fboCache(){return this.view.stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view.stage.renderView.renderingContext}get renderContext(){var e;return(e=this.view.stage)==null?void 0:e.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find(({name:i})=>i===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};d([ct({constructOnly:!0})],He.prototype,"view",void 0),d([ct({constructOnly:!0})],He.prototype,"consumes",void 0),d([ct()],He.prototype,"produces",void 0),d([ct({readOnly:!0})],He.prototype,"techniques",null),He=d([an("esri.views.3d.webgl.RenderNode")],He);function Rh(t,e=!0){t.attributes.add("position","vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.main.add(m`
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?m`uv = position * 0.5 + vec2(0.5);`:""}
  `)}function Al(t){t.uniforms.add(new wi("zProjectionMap",e=>Ol(e.camera))),t.code.add(m`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(m`float delinearizeDepth(float linearDepth) {
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
float depthNdc = (-c1/linearDepth) - c2 - 1e-7;
float depthNonlinear01 = (depthNdc + 1.0 ) / 2.0;
return depthNonlinear01;
}`),t.code.add(m`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(m`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function Ol(t){const e=t.projectionMatrix;return ci(zl,e[14],e[10])}const zl=xi();let Fh=class extends H{constructor(e,i,r){super(e,"vec2",2,(s,n,o,a)=>s.setUniform2fv(e,i(n,o,a),r))}},Il=class extends H{constructor(e,i,r){super(e,"vec4",0,(s,n)=>s.setUniform4fv(e,i(n),r))}};function Vh(t){t.fragment.uniforms.add(new Il("projInfo",e=>Rl(e.camera))),t.fragment.uniforms.add(new wi("zScale",e=>Fl(e.camera))),t.fragment.code.add(m`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Rl(t){const e=t.projectionMatrix;return e[11]===0?At(lr,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):At(lr,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const lr=Fe();function Fl(t){return t.projectionMatrix[11]===0?ci(cr,0,1):ci(cr,1,0)}const cr=xi();function Nh(t){const e=3.141592653589793,i=.3183098861837907;t.constants.add("PI","float",e),t.constants.add("LIGHT_NORMALIZATION","float",i),t.constants.add("INV_PI","float",i),t.constants.add("ONE_QUATER_PI","float",.78539816339745),t.constants.add("HALF_PI","float",1.570796326794897),t.constants.add("THREE_QUATER_PI","float",2.35619449019234),t.constants.add("TWO_PI","float",6.28318530717958),t.constants.add("PI_SQUARED","float",9.86960440108936)}let kh=class extends H{constructor(e,i){super(e,"bool",0,(r,s)=>r.setUniform1b(e,i(s)))}},Ll=class{constructor(e=st()){this.intensity=e}};class Dl{constructor(e=st(),i=K(.57735,.57735,.57735)){this.intensity=e,this.direction=i}}class fi{constructor(e=st(),i=K(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}let ds=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Vl(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function ri(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function Ye(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function fs(t){return(t+1)*(t+1)}function Nl(t){return nt(Math.floor(Math.sqrt(t)-1),0,2)}function ps(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=fs(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function kl(t,e){const i=fs(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function jl(t,e){const i=Nl(e.r.length);for(const r of t)$r(pi,r.direction),ps(pi,i,$e),Vl($e,Tt),ri($e,r.intensity[0],Ue),Ye(e.r,Ue),ri($e,r.intensity[1],Ue),Ye(e.g,Ue),ri($e,r.intensity[2],Ue),Ye(e.b,Ue);return e}function Bl(t,e){ps(pi,0,$e);for(const i of t)e.r[0]+=$e[0]*Tt[0]*i.intensity[0]*4*Math.PI,e.g[0]+=$e[0]*Tt[0]*i.intensity[1]*4*Math.PI,e.b[0]+=$e[0]*Tt[0]*i.intensity[2]*4*Math.PI;return e}function Hl(t,e,i,r){kl(e,r),N(i.intensity,0,0,0);let s=!1;const n=Ul,o=ql,a=Wl;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof fi&&!s?(U(i.direction,l.direction),U(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof fi||l instanceof Dl?n.push(l):l instanceof Ll?o.push(l):l instanceof ds&&a.push(l);jl(n,r),Bl(o,r);for(const l of a)Ye(r.r,l.r),Ye(r.g,l.g),Ye(r.b,l.b)}const Ul=[],ql=[],Wl=[],$e=[0],Ue=[0],pi=g(),Tt=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class ur{constructor(){this.color=g(),this.intensity=1}}class Gl{constructor(){this.direction=g(),this.ambient=new ur,this.diffuse=new ur}}const Xl=.4;class Uh{constructor(){this._shOrder=2,this._legacy=new Gl,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new ds,this._mainLight=new fi(g(),K(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Hl(e,this._shOrder,this._mainLight,this._sphericalHarmonics),this.updateLegacy()}updateLegacy(){U(this._legacy.direction,this._mainLight.direction);const e=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*e,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*e,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*e,W(this._legacy.diffuse.color,this._mainLight.intensity,e),U(xt,this._legacy.diffuse.color),W(xt,xt,Xl*this.globalFactor),oe(this._legacy.ambient.color,this._legacy.ambient.color,xt)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),U(this._mainLight.direction,e.mainLight.direction),U(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(Ct(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=te(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=te(e.mainLight.specularStrength,i.mainLight.specularStrength,r),U(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=te(e.globalFactor,i.globalFactor,r),this.noonFactor=te(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=te(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=te(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=te(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s];this.updateLegacy()}}const xt=g();function qh(t,{occlusionPass:e,terrainDepthTest:i,cullAboveTerrain:r}){const{vertex:s,fragment:n,varyings:o}=t;if(!i)return s.code.add("void forwardViewPosDepth(vec3 pos) {}"),void n.code.add(`${e?"bool":"void"} discardByTerrainDepth() { ${re(e,"return false;")}}`);o.add("viewPosDepth","float",{invariant:!0}),s.code.add(`void forwardViewPosDepth(vec3 pos) {
    viewPosDepth = pos.z;
  }`),n.include(Al),n.uniforms.add(new Qr("terrainDepthTexture",a=>{var l;return(l=a.terrainDepth)==null?void 0:l.attachment})).code.add(m`
    ${e?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${e?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${r?">":"<="} linearDepth) discard;`}
    }`)}function Yl(t){t.code.add(m`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function Kl(t){t.code.add(m`
    const float GAMMA = ${m.float(Ni)};
    const float INV_GAMMA = ${m.float(1/Ni)};

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.a);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)}const Zl=1;function Ql(t,e){if(!Ve(e.output))return;t.fragment.include(Kl);const{emissionSource:i,hasEmissiveTextureTransform:r,bindType:s}=e,n=i===3||i===4||i===5;n&&(t.include(Ga,e),t.fragment.uniforms.add(s===1?new qa("texEmission",u=>u.textureEmissive):new Xa("texEmission",u=>u.textureEmissive)));const o=i===2||n;o&&t.fragment.uniforms.add(s===1?new xe("emissiveBaseColor",u=>u.emissiveBaseColor):new Te("emissiveBaseColor",u=>u.emissiveBaseColor));const a=i!==0;a&&!(i===7||i===6||i===4||i===5)&&t.fragment.uniforms.add(s===1?new Ha("emissiveStrength",u=>u.emissiveStrength):new Ba("emissiveStrength",u=>u.emissiveStrength));const l=i===7,h=i===5,c=i===1||i===6||l;t.fragment.code.add(m`
    vec4 getEmissions(vec3 symbolColor) {
      vec4 emissions = ${o?h?"emissiveSource == 0 ? vec4(emissiveBaseColor, 1.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(emissiveBaseColor, 1.0)":c?l?"emissiveSource == 0 ? vec4(0.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(linearizeGamma(symbolColor), 1.0)":"vec4(0.0)"};
      ${re(n,`${re(h,`if(emissiveSource == 0) {
              vec4 emissiveFromTex = textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});
              emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);
           }`,`vec4 emissiveFromTex = textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});
           emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);`)}
        emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      ${re(a,`emissions.rgb *= emissiveStrength * ${m.float(Zl)};`)}
      return emissions;
    }
  `)}function Wh(t,e){t.include(Pa,e),t.include(Ql,e),t.fragment.include(Yl);const{output:i,oitPass:r,hasEmission:s,discardInvisibleFragments:n,oitPremultipliedAlpha:o,snowCover:a}=e,l=i===9,h=Ve(i)&&r===1,c=Ve(i)&&r!==1;let u=0;(c||h)&&t.outputs.add("fragColor","vec4",u++),s&&t.outputs.add("fragEmission","vec4",u++),h&&t.outputs.add("fragAlpha","float",u++),t.fragment.code.add(m`
    void outputColorHighlightOLID(vec4 finalColor, const in vec3 vWorldPosition, vec3 emissiveSymbolColor ${re(a,", float snow")}) {
      ${re(l,"finalColor.a = 1.0;")}
      ${re(n,`if (finalColor.a < ${m.float(Ua)}) { discard; }`)}
      finalColor = applySlice(finalColor, vWorldPosition);

      ${re(h,`${re(o,"fragColor = vec4(finalColor.rgb, sqrt(finalColor.a));","fragColor = premultiplyAlpha(finalColor);")}
           fragAlpha = finalColor.a;`)}
      ${re(c,"fragColor = finalColor;")}
      ${re(s,`fragEmission = ${re(a,"mix(finalColor.a * getEmissions(emissiveSymbolColor), vec4(0.0), snow);","finalColor.a * getEmissions(emissiveSymbolColor);")}`)}
      calculateOcclusionAndOutputHighlight();
      ${re(l,"outputObjectAndLayerIdColor();")}
    }
  `)}export{Lr as $,zh as A,Kc as B,Qc as C,Uu as D,ku as E,eh as F,wh as G,oh as H,Wh as I,qh as J,Zr as K,Yl as L,Ve as M,$u as N,Su as O,Lu as P,wu as Q,bu as R,Cu as S,_c as T,Au as U,Iu as V,zu as W,Tu as X,St as Y,Cc as Z,Uh as _,oa as a,Aa as a$,Tc as a0,Ua as a1,lu as a2,yo as a3,bh as a4,ea as a5,ta as a6,Nt as a7,ju as a8,pa as a9,Hc as aA,su as aB,Ac as aC,ao as aD,vc as aE,xa as aF,wa as aG,Wu as aH,ba as aI,Du as aJ,th as aK,mo as aL,kc as aM,$o as aN,qo as aO,Wo as aP,Xo as aQ,Wt as aR,nu as aS,Hr as aT,ou as aU,Ko as aV,ja as aW,Yu as aX,$c as aY,ho as aZ,ga as a_,Gu as aa,ma as ab,Ku as ac,Zu as ad,qu as ae,Uc as af,ya as ag,Pa as ah,Nu as ai,Ga as aj,Ch as ak,Al as al,Vh as am,wi as an,Qr as ao,Il as ap,Nh as aq,Xl as ar,kh as as,Te as at,Ta as au,nh as av,_a as aw,va as ax,Mc as ay,vo as az,qa as b,Mt as b0,la as b1,Eu as b2,Fu as b3,Pu as b4,Ou as b5,Ru as b6,Fr as b7,go as b8,au as b9,Jc as ba,xh as bb,Gc as bc,Bc as bd,rh as be,gh as bf,_h as bg,mh as bh,Oh as bi,yh as bj,mc as bk,Zc as bl,Xt as bm,Ea as bn,Po as bo,Vo as bp,Zo as bq,Kl as br,Xi as bs,Qo as bt,Vt as c,xe as d,no as e,Qu as f,Fh as g,oo as h,H as i,Qi as j,_u as k,Sa as l,Sc as m,pc as n,Rh as o,mu as p,Xa as q,Ha as r,He as s,jn as t,Ah as u,Mu as v,tt as w,So as x,Ll as y,qc as z};
