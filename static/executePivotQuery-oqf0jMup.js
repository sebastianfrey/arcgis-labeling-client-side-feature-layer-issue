import{I as m,bi as u,a7 as p,aA as c,b1 as f,b0 as y}from"./index-C_bK48d2.js";import{t as v}from"./urlUtils-BlxBVR77.js";import{r as P}from"./query-BrxajYUG.js";import{v as g}from"./PivotQuery-BK1QHKE_.js";import"./pbfQueryUtils-CX8BKSeH.js";import"./pbf-CBn1Vo1A.js";import"./memoryEstimations-w0EAmzVg.js";import"./OptimizedGeometry-KE6YknPZ.js";import"./OptimizedFeatureSet-BZnZXZq6.js";function l(r){const t=P(r),o=t.outPivots;if(o!=null&&o.length){for(const i of o)i.pivotType==="Pivot"&&i.pivotParameters.outStatistic?i.pivotParameters.outStatistic=JSON.stringify(i.pivotParameters.outStatistic):i.pivotType==="Unpivot"&&(i.unPivotParameters.sourceFields=i.unPivotParameters.sourceFields.join(","));t.outPivots=JSON.stringify(o)}return t}async function S(r,t,o){return await q(r,t,o)}async function q(r,t,o={}){const i=typeof r=="string"?m(r):r,a=t.geometry?[t.geometry]:[],e=await u(a,null,{signal:o.signal}),n=e==null?void 0:e[0];n!=null&&((t=t.clone()).geometry=n);const s=v({...i.query,f:"json",...l(t)});return p(c(i.path,"queryPivot"),{...o,query:{...s,...o.query}})}async function x(r,t,o){const i=f(r),a={...o},{data:e}=await S(i,g.from(t),a);return y.fromJSON(e)}export{x as executePivotQuery};
