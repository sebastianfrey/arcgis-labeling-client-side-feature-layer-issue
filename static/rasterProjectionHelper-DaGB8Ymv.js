const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./projectOperator-GjeZoSlA.js","./index-C_bK48d2.js","./index-DxLSJ8yk.css","./operatorProject-DDNXv7o7.js","./SimpleGeometryCursor-B92kdZ15.js","./geographicTransformationUtils-DNbito7i.js"])))=>i.map(i=>d[i]);
import{be as kt,_ as ct,ax as A,f9 as z,N as Tt,dl as it,aM as T,dv as _t,a as dt,fc as C,fd as v,fe as ft,ff as Nt,aT as vt,fg as Ct,ae as Mt}from"./index-C_bK48d2.js";function O(){if(!ot)throw new dt("rasterprojectionhelper-project","projection operator is not loaded")}const ut=(t,n,i,o=0)=>{if(i[0]===1)return[0,0];let r=1,e=-1,s=1,f=-1;for(let c=0;c<t.length;c+=2)isNaN(t[c])||(r=r>t[c]?t[c]:r,e=e>t[c]?e:t[c],s=s>t[c+1]?t[c+1]:s,f=f>t[c+1]?f:t[c+1]);const{cols:a,rows:u}=n,l=(e-r)/a/i[0],d=(f-s)/u/i[1],h=2*o;let m=0,x=!1,p=[0,0];for(let c=0;c<a-3;c++){for(let R=0;R<u-3;R++){const g=c*u*2+2*R,y=(t[g]+t[g+4]+t[g+4*u]+t[g+4*u+4])/4,w=(t[g+1]+t[g+5]+t[g+4*u+1]+t[g+4*u+5])/4,M=Math.abs((y-t[g+2*u+2])/l),b=Math.abs((w-t[g+2*u+3])/d);if(M+b>m&&(m=M+b,p=[M,b]),h&&m>h){x=!0;break}}if(x)break}return p},Lt={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},Y=32,B=4,Q=B,U=new Map,H=new Map,J=500,zt=39.37,It=96;let F,k,j,ot=!1;async function Dt(){return F||(F=kt(),k=await ct(()=>import("./projectOperator-GjeZoSlA.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),j=await ct(()=>import("./geographicTransformationUtils-DNbito7i.js"),__vite__mapDeps([5,1,2]),import.meta.url),k.isLoaded()||await k.load(),j.isLoaded()||await j.load(),ot=!0,F.resolve()),F.promise}function Ot(t,n,i){if(O(),i){const o=k.execute(t,n);return j.getTransformation(n,t.spatialReference,o)}return j.getTransformation(t.spatialReference,n,t)}function Xt(t,n,i,o){const r=t.spatialReference;if(!r||!n||r.equals(n))return t;O();const e=i.center,s=new A({xmin:e.x-t.x/2,xmax:e.x+t.x/2,ymin:e.y-t.y/2,ymax:e.y+t.y/2,spatialReference:r}),f=k.execute(s,n,{geographicTransformation:o}),a=_(n);return f==null||a!=null&&f.width>=a?q(t,r,n):{x:f.width,y:f.height}}function q(t,n,i){const o=z(n)/z(i);return{x:t.x*o,y:t.y*o}}function tt(t,n,i){const{spatialReference:o}=i;if(!o||!n||o.equals(n))return t;if(o.isGeographic&&n.isGeographic)return q(t,o,n);if(O(),!ot)throw new dt("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:r,y:e}=t;const s=(r+e)/2*z(o);let f=1;s>30&&(f=30/s,r*=f,e*=f);const a=256,u=r*a/2,l=e*a/2,{x:d,y:h}=i.center,m=[];for(let P=0;P<=a;P++)m.push([d-u,h-l+P*e]);for(let P=1;P<=a;P++)m.push([d-u+P*r,h+l]);for(let P=1;P<=a;P++)m.push([d+u,h+l-P*e]);for(let P=1;P<a;P++)m.push([d+u-P*r,h-l]);m.push(m[0]);const x=new it({rings:[m],spatialReference:o}),p=k.execute(x,n);if(!p)return q(t,o,n);const c=p.extent,R=_(n);if(c==null||R!=null&&c.width>=R)return q(t,o,n);const g=Bt(p.rings),y=r*e*a*a,w=Math.sqrt(g/y)/f,M={x:c.width/f/a,y:c.height/f/a},b={x:r*w,y:e*w},G=M.x*M.y;return Math.abs(G-b.x*b.y)/G<.1?M:b}function nt(t,n){return(typeof t=="number"?t:(t.x+t.y)/2)*z(n)*It*zt}function Kt(t,n){const{pixelSize:i,extent:o}=t;return nt(tt(i,n,o),n)}function E(t,n=.01){return z(t)?n/z(t):0}function xt(t,n,i,o=!0){const r=t.spatialReference;if(r.equals(n))return t;O();const e=k.execute(t,n,{geographicTransformation:i});return o&&e&&wt([t],[e],r,n),e}function wt(t,n,i,o){const r=D(i,!0),e=D(o,!0),s=E(i,J),f=E(o,J);if(s&&r!=null&&e!=null)for(let a=0;a<t.length;a++){const u=n[a];if(!u)continue;const{x:l}=t[a],{x:d}=u;d>=e[1]-f&&Math.abs(l-r[0])<s?u.x-=e[1]-e[0]:d<=e[0]+f&&Math.abs(l-r[1])<s&&(u.x+=e[1]-e[0])}}function Wt(t){const{inSR:n,outSR:i,preferPE:o}=t;if(n.equals(i)){const{points:r}=st(t,null);return r}return n.isWebMercator&&i.isWGS84||n.isWGS84&&i.isWebMercator?jt(t):o&&(n.isGeographic||I(n)!=null)?ht(t):$t(t)}function $t(t){const{points:n}=st(t,null),{inSR:i,outSR:o,datumTransformation:r}=t,e=n.map(f=>new T(f[0],f[1],i)),s=k.executeMany(e,o,{geographicTransformation:r});return r&&wt(e,s,i,o),s.map(f=>f?[f.x,f.y]:[NaN,NaN])}function ht(t){const{inSR:n,outSR:i,datumTransformation:o}=t,r=I(n),{points:e,mask:s}=st(t,r);if(!n.isGeographic){const a=n.wkid?C.coordsys(n.wkid):C.fromString(n.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,n.wkt2||n.wkt);ft.projToGeog(a,e.length,e)}if(o!=null&&o.steps.length){let a;if(i.isGeographic&&(a=e.map(([l])=>l>179.9955?1:l<-179.9955?-1:0)),o.steps.forEach(l=>{const d=l.wkid?C.geogtran(l.wkid):C.fromString(v.PE_TYPE_GEOGTRAN,l.wkt);Nt.geogToGeog(d,e.length,e,null,l.isInverse?v.PE_TRANSFORM_2_TO_1:v.PE_TRANSFORM_1_TO_2)}),a)for(let l=0;l<e.length;l++){const d=a[l],h=e[l][0],m=h>179.9955?1:h<-179.9955?-1:0;d&&m&&d!==m&&(e[l][0]=d>0?h+360:h-360)}}if(!i.isGeographic){const a=I(i,!0),u=a!=null&&a.isEnvelope?[a.bbox[1],a.bbox[3]]:[-90,90];At(e,u);const l=i.wkid?C.coordsys(i.wkid):C.fromString(i.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,i.wkt2||i.wkt);ft.geogToProj(l,e.length,e)}let f=e;if(s&&e.length!==s.length){f=[];for(let a=0,u=0;a<s.length;a++)s[a]?f.push(e[u++]):f.push([NaN,NaN])}return f}function jt(t){const{cols:n,rows:i,xres:o,yres:r,usePixelCenter:e,inSR:s,outSR:f}=t;let{xmin:a,ymax:u}=t;e&&(a+=o/2,u-=r/2);const l=[],d=[],h=Math.max(n,i);for(let x=0;x<h;x++){const p=a+o*Math.min(n,x),c=u-r*Math.min(i,x),R=vt(new T({x:p,y:c,spatialReference:s}),s,f);x<=n&&l.push(R.x),x<=i&&d.push(R.y)}const m=[];for(let x=0;x<n;x++)for(let p=0;p<i;p++)m.push([l[x],d[p]]);return m}function I(t,n=!1){let i=t.wkid||t.wkt2||t.wkt;if(!i||t.isGeographic)return null;if(i=String(i),U.has(i)){const s=U.get(i);return n?s==null?void 0:s.gcs:s==null?void 0:s.pcs}const o=t.wkid?C.coordsys(t.wkid):C.fromString(t.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,t.wkt2||t.wkt),r=mt(o,E(t,1e-4)),e=mt(o,0,!0);return U.set(i,{pcs:r,gcs:e}),n?e:r}function mt(t,n=0,i=!1){const o=Ct.generate(t),r=i?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!o||!(r!=null&&r.length))return null;let e=!1,s=r.find(c=>c.getInclusive()===1&&c.getKind()===1);if(!s){if(s=r.find(c=>c.getInclusive()===1&&c.getKind()===0),!s)return null;e=!0}const f=i?0:(o.getNorthPoleLocation()===2?1:0)|(o.getSouthPoleLocation()===2?2:0),a=o.isPannableRectangle(),u=s.getCoord();if(e)return{isEnvelope:e,isPannable:a,vertices:u,coef:null,bbox:[u[0][0]-n,u[0][1]-n,u[1][0]+n,u[1][1]+n],poleLocation:f};let l=0;const d=[];let[h,m]=u[0],[x,p]=u[0];for(let c=0,R=u.length;c<R;c++){l++,l===R&&(l=0);const[g,y]=u[c],[w,M]=u[l];if(M===y)d.push([g,w,y,M,2]);else{const b=(w-g)/(M-y||1e-4),G=g-b*y;y<M?d.push([b,G,y,M,0]):d.push([b,G,M,y,1])}h=h<g?h:g,m=m<y?m:y,x=x>g?x:g,p=p>y?p:y}return{isEnvelope:!1,isPannable:a,vertices:u,coef:d,bbox:[h,m,x,p],poleLocation:f}}function st(t,n){const i=[],{cols:o,rows:r,xres:e,yres:s,usePixelCenter:f}=t;let{xmin:a,ymax:u}=t;if(f&&(a+=e/2,u-=s/2),n==null){for(let m=0;m<o;m++)for(let x=0;x<r;x++)i.push([a+e*m,u-s*x]);return{points:i}}const l=new Uint8Array(o*r);if(n.isEnvelope){const{bbox:[m,x,p,c]}=n;for(let R=0,g=0;R<o;R++){const y=a+e*R,w=n.isPannable||y>=m&&y<=p;for(let M=0;M<r;M++,g++){const b=u-s*M;w&&b>=x&&b<=c&&(i.push([y,b]),l[g]=1)}}return{points:i,mask:l}}const d=n.coef,h=[];for(let m=0;m<r;m++){const x=u-s*m,p=[],c=[];for(let g=0;g<d.length;g++){const[y,w,M,b,G]=d[g];if(x===M&&M===b)p.push(y),p.push(w),c.push(2),c.push(2);else if(x>=M&&x<=b){const P=y*x+w;p.push(P),c.push(G)}}let R=p;if(p.length>2){let g=c[0]===2?0:c[0],y=p[0];R=[];for(let w=1;w<c.length;w++)c[w]===2&&w!==c.length-1||(c[w]!==g&&(R.push(g===0?Math.min(y,p[w-1]):Math.max(y,p[w-1])),g=c[w],y=p[w]),w===c.length-1&&R.push(c[w]===0?Math.min(y,p[w]):Math.max(y,p[w])));R.sort((w,M)=>w-M)}else p[0]>p[1]&&(R=[p[1],p[0]]);h.push(R)}for(let m=0,x=0;m<o;m++){const p=a+e*m;for(let c=0;c<r;c++,x++){const R=u-s*c,g=h[c];if(g.length===2)p>=g[0]&&p<=g[1]&&(i.push([p,R]),l[x]=1);else if(g.length>2){let y=!1;for(let w=0;w<g.length;w+=2)if(p>=g[w]&&p<=g[w+1]){y=!0;break}y&&(i.push([p,R]),l[x]=1)}}}return{points:i,mask:l}}function At(t,n){const[i,o]=n;for(let r=0;r<t.length;r++){const e=t[r][1];(e<i||e>o)&&(t[r]=[NaN,NaN])}}function Rt(t,n){const i=_(t[0].spatialReference);if(t.length<2||i==null||(n=n??E(t[0].spatialReference),(t=t.filter(f=>f.width>n)).length===1))return t[0];let{xmin:o,xmax:r,ymin:e,ymax:s}=t[0];for(let f=1;f<t.length;f++){const a=t[f];r=a.xmax+i*f,e=Math.min(e,a.ymin),s=Math.max(s,a.ymax)}return new A({xmin:o,xmax:r,ymin:e,ymax:s,spatialReference:t[0].spatialReference})}function Pt(t,n,i=null,o=!0){const r=t.spatialReference;if(r.equals(n)||!n)return t;const e=rt(t),s=_(r,!0),f=_(n);if(e===0||s==null||f==null){const l=et(t,n,i,o);if(l&&s==null&&f!=null&&Math.abs(l.width-f)<E(n)&&k.isLoaded()){const d=I(r);if(d!=null&&d.poleLocation===0&&t.width<(d.bbox[2]-d.bbox[0])/2)return Ft(t,n)||l}return l}const a=t.clone().normalize();if(a.length===1&&t.xmax<s&&t.xmax-s/2>E(r)){const{xmin:l,xmax:d}=t;for(let h=0;h<=e;h++){const m=h===0?l:-s/2,x=h===e?d-s*h:s/2;a[h]=new A({xmin:m,xmax:x,ymin:t.ymin,ymax:t.ymax,spatialReference:r})}}const u=a.map(l=>et(l,n,i,o)).filter(Tt);return u.length===0?null:Rt(u)}function Vt(t,n,i){if(t.type==="extent"){const{xmin:o,ymin:r,xmax:e,ymax:s,spatialReference:f}=t;t=new it({rings:[[[o,s],[e,s],[e,r],[o,r],[o,s]]],spatialReference:f})}return t.spatialReference.equals(n)?t:(O(),k.execute(t,n,{geographicTransformation:i}))}function Ft(t,n){const i=_(n);if(i==null)return null;let{xmin:o,ymin:r,xmax:e,ymax:s}=t;const f=t.spatialReference,a=new it({spatialReference:f,rings:[[[o,r],[e,r],[e,s],[o,s],[o,r]]]}),u=k.execute(a,n);if(u.rings.length!==2||!u.rings[0].length||!u.rings[1].length)return null;const{rings:l}=u,d=E(f),h=new A({spatialReference:n});for(let m=0;m<2;m++){o=e=l[m][0][0],r=s=l[m][0][1];for(let x=0;x<l[m].length;x++)o=o>l[m][x][0]?l[m][x][0]:o,e=e<l[m][x][0]?l[m][x][0]:e,r=r>l[m][x][1]?l[m][x][1]:r,s=s<l[m][x][1]?l[m][x][1]:s;if(m===0)h.ymin=r,h.ymax=s,h.xmin=o,h.xmax=e;else if(h.ymin=Math.min(h.ymin,r),h.ymax=Math.max(h.ymax,s),Math.abs(e-i/2)<d)h.xmin=o,h.xmax=h.xmax+i;else{if(!(Math.abs(o+i/2)<d))return null;h.xmax=e+i}}return h}function et(t,n,i,o=!0,r=!0){const e=t.spatialReference;if(e.equals(n)||!n)return t;O();const s=k.execute(t,n,{geographicTransformation:i});if(r&&n.isWebMercator&&s&&(s.ymax=Math.min(20037508342787e-6,s.ymax),s.ymin=Math.max(-20037508342787e-6,s.ymin),s.ymin>=s.ymax))return null;if(!o||!s)return s;const f=D(e,!0),a=D(n,!0);if(f==null||a==null)return s;const u=E(e,.001),l=E(e,J),d=E(n,.001);if(Math.abs(s.xmin-a[0])<d&&Math.abs(s.xmax-a[1])<d){const h=Math.abs(t.xmin-f[0]),m=Math.abs(f[1]-t.xmax);if(h<u&&m>l){s.xmin=a[0];const x=[];x.push(new T(t.xmax,t.ymin,e)),x.push(new T(t.xmax,(t.ymin+t.ymax)/2,e)),x.push(new T(t.xmax,t.ymax,e));const p=x.map(c=>xt(c,n,i)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);s.xmax=Math.max.apply(null,p)}if(m<u&&h>l){s.xmax=a[1];const x=[];x.push(new T(t.xmin,t.ymin,e)),x.push(new T(t.xmin,(t.ymin+t.ymax)/2,e)),x.push(new T(t.xmin,t.ymax,e));const p=x.map(c=>xt(c,n,i)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);s.xmin=Math.min.apply(null,p)}}else{const h=E(n,.001);Math.abs(s.xmin-a[0])<h&&(s.xmin=a[0]),Math.abs(s.xmax-a[1])<h&&(s.xmax=a[1])}return s}function _(t,n=!1){if(!t)return null;const i=n?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*i:t.wkid&&t.isGeographic?360:2*Lt[t.wkid]||null}function D(t,n=!1){if(t.isGeographic)return[-180,180];const i=_(t,n);return i!=null?[-i/2,i/2]:null}function pt(t,n,i,o){let r=(t-n)/i;return r-Math.floor(r)!==0?r=Math.floor(r):o&&(r-=1),r}function rt(t,n=!1){const i=_(t.spatialReference);if(i==null)return 0;const o=n?0:-(i/2),r=E(t.spatialReference),e=!n&&Math.abs(t.xmax-i/2)<r?i/2:t.xmax,s=!n&&Math.abs(t.xmin+i/2)<r?-i/2:t.xmin;return pt(e,o,i,!0)-pt(s,o,i,!1)}function Qt(t){const n=t.storageInfo.origin.x,i=_(t.spatialReference,!0);if(i==null)return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const o=i/2,{nativePixelSize:r,storageInfo:e,extent:s}=t,{maximumPyramidLevel:f,blockWidth:a,pyramidScalingFactor:u}=e;let l=r.x;const d=[],h=t.transform!=null&&t.transform.type==="gcs-shift",m=n+(h?0:o),x=h?i-n:o-n;for(let p=0;p<=f;p++){const c=(s.xmax-n)/l/a,R=c-Math.floor(c)===0?c:Math.ceil(c),g=x/l/a,y=g-Math.floor(g)===0?g:Math.ceil(g),w=Math.floor(m/l/a),M=Math.round(m/l)%a,b=(a-Math.round(x/l)%a)%a;d.push({resolutionX:l,blockWidth:a,datasetColumnCount:R,worldColumnCountFromOrigin:y,leftMargin:M,rightPadding:b,originColumnOffset:w}),l*=u}return{originX:n,halfWorldWidth:o,pyramidsInfo:d,hasGCSSShiftTransform:h}}function qt(t){if(!t||t.isGeographic)return t;const n=String(t.wkid||t.wkt2||t.wkt);let i;return H.has(n)?i=H.get(n):(i=(t.wkid?C.coordsys(t.wkid):C.fromString(v.PE_TYPE_PROJCS,t.wkt2||t.wkt)).getGeogcs().getCode(),H.set(n,i)),new Mt({wkid:i})}function Ut(t){const n=t.isAdaptive&&t.spacing==null;let i=t.spacing||[Y,Y],o=Z(t),r={cols:o.size[0]+1,rows:o.size[1]+1};const e=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;let s=o.outofBoundPointCount===o.offsets.length/2||n&&e?[0,0]:ut(o.offsets,r,i,Q);const f=(s[0]+s[1])/2,a=t.projectedExtent.spatialReference,u=t.srcBufferExtent.spatialReference;if(n&&(e||f>Q)&&(a.isGeographic||I(a),i=[B,B],o=Z({...t,spacing:i}),r={cols:o.size[0]+1,rows:o.size[1]+1},s=ut(o.offsets,r,i,Q)),o.error=s,i[0]>1&&(o.coefficients=gt(o.offsets,r,e)),t.includeGCSGrid&&!a.isGeographic&&!a.isWebMercator)if(u.isGeographic)o.gcsGrid={offsets:o.offsets,coefficients:o.coefficients,spacing:i};else{const l=I(a);if(l!=null&&!l.isEnvelope){const d=qt(a),h=Pt(t.projectedExtent,d),{offsets:m}=Z({...t,srcBufferExtent:h,spacing:i}),x=gt(m,r,e);o.gcsGrid={offsets:m,coefficients:x,spacing:i}}}return o}function Z(t){const{projectedExtent:n,srcBufferExtent:i,pixelSize:o,datumTransformation:r,rasterTransform:e}=t,s=n.spatialReference,f=i.spatialReference;O();const{xmin:a,ymin:u,xmax:l,ymax:d}=n,h=_(f),m=h!=null&&(t.hasWrapAround||(e==null?void 0:e.type)==="gcs-shift"),x=t.spacing||[Y,Y],p=x[0]*o.x,c=x[1]*o.y,R=x[0]===1,g=Math.ceil((l-a)/p-.1/x[0])+(R?0:1),y=Math.ceil((d-u)/c-.1/x[1])+(R?0:1),w=Wt({cols:g,rows:y,xmin:a,ymax:d,xres:p,yres:c,inSR:s,outSR:f,datumTransformation:r,preferPE:x[0]<=B,usePixelCenter:R}),M=[];let b,G=0;const P=R?-1:NaN,{xmin:N,xmax:L,ymax:X,width:K,height:bt}=i,St=E(f,J),Gt=h!=null&&N>0&&L>h/2,at=I(s),Et=at!=null&&at.poleLocation>0;for(let W=0;W<g;W++){const V=[];for(let $=0;$<y;$++){let S=w[W*y+$];if(m&&S[0]>L&&S[0]>h/2-St?S[0]-=h:m&&W===0&&S[0]<0&&Gt&&!e&&(S[0]+=h),!S||isNaN(S[0])||isNaN(S[1]))M.push(P),M.push(P),V.push(null),G++;else{if(e){const lt=e.inverseTransform(new T({x:S[0],y:S[1],spatialReference:f}));S=[lt.x,lt.y]}V.push(S),W>0&&m&&b[$]&&S[0]<b[$][0]&&(S[0]+=h,Et&&S[0]>L&&S[0]>h&&(S[0]-=h)),M.push((S[0]-N)/K),M.push((X-S[1])/bt)}}b=V}return{offsets:M,error:null,coefficients:null,outofBoundPointCount:G,spacing:x,size:R?[g,y]:[g-1,y-1]}}function gt(t,n,i){const{cols:o,rows:r}=n,e=new Float32Array((o-1)*(r-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),f=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let a=0;a<o-1;a++){for(let u=0;u<r-1;u++){let l=a*r*2+2*u;const d=t[l],h=t[l+1],m=t[l+2],x=t[l+3];l+=2*r;const p=t[l],c=t[l+1],R=t[l+2],g=t[l+3];let y=0,w=12*(u*(o-1)+a);for(let M=0;M<3;M++)e[w++]=s[y++]*d+s[y++]*m+s[y++]*R;y=0;for(let M=0;M<3;M++)e[w++]=s[y++]*h+s[y++]*x+s[y++]*g;y=0;for(let M=0;M<3;M++)e[w++]=f[y++]*d+f[y++]*p+f[y++]*R;y=0;for(let M=0;M<3;M++)e[w++]=f[y++]*h+f[y++]*c+f[y++]*g}if(i)for(let u=0;u<e.length;u++)isNaN(e[u])&&(e[u]=-1)}return e}function Yt(t,n){const i=t.clone().normalize();return i.length===1?i[0]:Rt(i,n)}function Ht(t){const{spatialReference:n}=t,i=_t(n);if(!i)return t;const[o,r]=i.valid,e=r-o;let s=0;if(t.xmin<o){const f=o-t.xmin;s=Math.ceil(f/e)}else if(t.xmin>r){const f=t.xmin-r;s=-Math.ceil(f/e)}return new A({spatialReference:t.spatialReference,xmin:t.xmin+s*e,ymin:t.ymin,xmax:t.xmax+s*e,ymax:t.ymax})}function Zt(t,n,i){var x;const{storageInfo:o,pixelSize:r}=n;let e=0,s=!1;const{pyramidResolutions:f}=o,a=((x=o.tileInfo.format)==null?void 0:x.toLowerCase())==="mixed"?Math.max(1,Math.min(3,o.tileInfo.dpi/96)):1,u=(t.x+t.y)/2/a;if(f!=null&&f.length){const p=f[f.length-1],c=(p.x+p.y)/2,R=(r.x+r.y)/2;if(u<=R)e=0;else if(u>=c)e=f.length,s=u/c>8;else{let y,w=R;for(let M=1;M<=f.length;M++){if(y=(f[M-1].x+f[M-1].y)/2,u<=y){u===y?e=M:i==="down"?(e=M-1,s=u/w>8):e=i==="up"||u-w>y-u||u/w>2?M:M-1;break}w=y}}const g=e===0?r:f[e-1];return s&&Math.min(g.x,g.y)*z(n.spatialReference)>19567&&(s=!1),{pyramidLevel:e,pyramidResolution:new T({x:g.x,y:g.y,spatialReference:n.spatialReference}),excessiveReading:s}}const l=Math.log(t.x/r.x)/Math.LN2,d=Math.log(t.y/r.y)/Math.LN2,h=n.storageInfo.maximumPyramidLevel||0;e=i==="down"?Math.floor(Math.min(l,d)):i==="up"?Math.ceil(Math.max(l,d)):Math.round((l+d)/2),e<0?e=0:e>h&&(s=e>h+3,e=h);const m=2**e;return{pyramidLevel:e,pyramidResolution:new T({x:m*n.nativePixelSize.x,y:m*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:s}}function yt(t,n,i=!1){const{pixelSize:o,extent:r}=t,e=Ot(r,n,!1),s=Pt(Yt(r,(o.x+o.y)/16),n,e);return!s||i||rt(s)===0?s:et(r,n,e)}function tn(t,n,i){var G;const o=i==null?void 0:i.tileSize,r=i==null?void 0:i.alignGlobalDatasetWithAGOL,{extent:e,spatialReference:s,pixelSize:f}=t,a=tt(f,n,e);if(a==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(a.x+a.y)/2,l=nt(u,n),d=n.isGeographic?256/o*2958287637958547e-7:256/o*591657527591555e-6;let h=t.dataType==="vector-magdir"||t.dataType==="vector-uv";const m=yt(t,n,!0),x=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/l)/Math.LN2));if(!h&&m&&r&&(n.isGeographic||n.isWebMercator)){const P=_(n);if(h=rt(m)>0||P!=null&&m.width>P/4,!h&&P!=null){let N=-1;if(x<3)N=2**x*u*o;else if(t.storageInfo){const{maximumPyramidLevel:X=0,pyramidScalingFactor:K=2}=t.storageInfo;N=K**X*u*o}const L=Math.ceil(P/N);h=L===1||L===2&&P/2-m.xmax<N}}let p,c=l;const R=1.001,g=Math.min(2,Math.max(1.414,((G=t.storageInfo)==null?void 0:G.pyramidScalingFactor)||2));if(h){c=d;const P=n.isGeographic?1341104507446289e-21:.29858214164761665,N=nt(P,n),L=n.isGeographic?4326:3857;p=tt({x:P,y:P},s,yt(t,new Mt({wkid:L}),!0)),p.x*=c/N,p.y*=c/N}else{p={x:f.x,y:f.y};let P=0;for(;c<d*(R/2)&&P<x;)P++,c*=g,p.x*=g,p.y*=g;Math.max(c,d)/Math.min(c,d)<=R&&(c=d)}const y=[c],w=[{x:p.x,y:p.y}],M=70.5310735,b=Math.min(M,l)/R;for(;c>=b;)c/=g,p.x/=g,p.y/=g,y.push(c),w.push({x:p.x,y:p.y});return{projectedPixelSize:a,scales:y,srcResolutions:w,isCustomTilingScheme:!h}}function Bt(t){let n=0;for(const i of t){const o=i.length;let r=i[0][0]*(i[1][1]-i[o-2][1]);for(let e=1;e<o-1;e++)r+=i[e][0]*(i[e+1][1]-i[e-1][1]);n+=r/2}return Math.abs(n)}export{_ as $,Xt as C,Pt as H,Kt as I,Vt as Q,xt as W,Ht as c,Zt as f,Qt as i,Dt as j,tn as m,rt as n,Ut as r,yt as u,Ot as v};
