import{h$ as D,aJ as i,aK as s,aL as _,db as w,eV as b,pu as j,aW as v,fx as V,eZ as E,m_ as U,ao as Z,ap as f,fz as W,f_ as L,dk as J,hf as k,hc as K,ce as I,fZ as H}from"./index-C_bK48d2.js";import{e as Q}from"./getDefaultUnitForView-DghHjrRa.js";import{s as X,o as Y}from"./ExclusiveOperationManager-DAhuHQJU.js";import{G as ee}from"./quantityFormatUtils-BygWVGS0.js";import{h as C}from"./GraphicsLayer-CFgfYbpT.js";import{D as S,I as te}from"./colorUtils-CLNuAJnC.js";import{a as M,l as $}from"./quantity-wpyqwS5w.js";import{y as ie,z as T,v as ae,R as se}from"./geodesicUtils-CTZo9mb6.js";import{n as re}from"./areaOperator-CNzFZrK_.js";import{m as oe,l as ne}from"./geodeticAreaOperator-D2z_GCTf.js";import{y as le,l as P}from"./geodeticDensifyOperator-vNwHtiui.js";import{m as pe,l as he}from"./geodeticLengthOperator-BhsSOjnG.js";import{r as ue}from"./lengthOperator-J6a_F19i.js";import{load as me,execute as ye}from"./projectOperator-GjeZoSlA.js";import{u as A}from"./simplifyOperator-DCwRzIwh.js";import{d as ce,u as F}from"./SketchViewModel-BpdG2zzZ.js";import"./unitFormatUtils-Ckw47jIR.js";import"./Point2D-CHGoJJR2.js";import"./Envelope2D-K-BIX8ba.js";import"./ProjectionTransformation-yTMc8p-1.js";import"./Transformation2D-CsY48lRi.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./jsonConverter-E47-BQ_b.js";import"./apiConverter-CdLHvLkb.js";import"./geodeticCurveType-CirnHLSB.js";import"./operatorGeodeticDensify-CFr7rJxP.js";import"./operatorProject-DDNXv7o7.js";import"./operatorSimplify-CaWHRVp7.js";import"./hitTestSelectUtils-xrNddzEE.js";import"./projectVectorToVector-IRvjF_FZ.js";import"./projectPointToVector-oWOZnQKe.js";import"./plane-CYaN818s.js";import"./vectorStacks-CpRnv_41.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-Dx28BAGo.js";import"./ray-DFDOQn-4.js";import"./elevationInfoUtils-C7MilKvD.js";import"./spatialReferenceEllipsoidUtils-DtI6yob-.js";import"./earcut-Lltz9D9k.js";import"./triangle-Bs-n1Sd1.js";function de(e){const t=S(e,.2);return new D({data:{type:"CIMSymbolReference",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:t.toArray()}]}}})}function ge(e){return new D({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",capStyle:"Butt",width:2,color:e.toArray()}]}}})}function _e(e){const t=S(te(e,160),.5);return new D({data:{type:"CIMSymbolReference",primitiveOverrides:[{type:"CIMPrimitiveOverride",primitiveName:"textOverride",propertyName:"TextString",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Custom",expression:"$feature.areaText",returnType:"Default"}}],symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMVectorMarker",colorLocked:!0,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",fontFamilyName:"sans-serif",height:14,horizontalAlignment:"Center",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:e.toArray()}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:t.toArray()}]},haloSize:1.5,verticalAlignment:"Center"},primitiveName:"textOverride"}],scaleSymbolsProportionally:!0,respectFrame:!0,markerPlacement:{type:"CIMMarkerPlacementPolygonCenter"}}]}}})}let h=class extends w{get _messages(){var e;return(e=this._messagesTask)==null?void 0:e.value}constructor(e){super(e),this._graphicsLayer=new C({listMode:"hide",internal:!0}),this._updatingHandles=new b}initialize(){var e;(e=this.view.map)==null||e.add(this._graphicsLayer),this.addHandles(j(()=>this._updateMessageBundle())),this._updatingHandles.add(()=>{var t,a,r;return{accentColor:this.view.effectiveTheme.accentColor,area:(t=this.measurementViewData.result)==null?void 0:t.area,fill:(a=this.measurementViewData.result)==null?void 0:a.display.fill,messages:this._messages,outline:(r=this.measurementViewData.result)==null?void 0:r.display.outline,textColor:this.view.effectiveTheme.textColor,unit:this.measurementViewData.unit,visible:this.measurementViewData.visible}},({accentColor:t,area:a,fill:r,messages:o,outline:l,textColor:p,unit:q,visible:z},d)=>{if(this._graphicsLayer.visible=z,!z)return;if(!(a&&r&&o&&l))return void this._graphicsLayer.graphics.destroyAll();const G=o&&a?ee(o,a,q):null;if(this._graphicsLayer.graphics.length===3&&t.equals(d==null?void 0:d.accentColor)&&p.equals(d==null?void 0:d.textColor)){const[N,B,O]=this._graphicsLayer.graphics.toArray();return N.geometry=r,B.geometry=l,O.attributes.areaText=G,void(O.geometry=r)}this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.addMany([new v({geometry:r,symbol:de(t)}),new v({geometry:l,symbol:ge(t)}),new v({attributes:{areaText:G},geometry:r,symbol:_e(p)})])},V),this._updateMessageBundle()}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get updating(){var e;return!this._graphicsLayer.loaded||!((e=this._messagesTask)!=null&&e.finished)||this._updatingHandles.updating}_updateMessageBundle(){var e;return(e=this._messagesTask)==null||e.abort(),this._messagesTask=E(()=>U("esri/core/t9n/Units")),this._messagesTask.promise}};i([s()],h.prototype,"_messages",null),i([s()],h.prototype,"_messagesTask",void 0),i([s()],h.prototype,"measurementViewData",void 0),i([s()],h.prototype,"updating",null),i([s()],h.prototype,"view",void 0),h=i([_("esri.views.2d.analysis.AreaMeasurement.AreaMeasurementAreaVisualization")],h);const g=M(1e5,"meters");async function we(e,t){if(!(e!=null&&e.rings.length)||!e.rings[0].length)return null;await me();const a=ye(e,t);return a?a.spatialReference.isGeographic?ie(a.spatialReference)?ve(a):R(a):a.spatialReference.isWebMercator?R(a):fe(a):null}async function R(e){await Promise.all([oe(),le(),pe()]);const t=A(e);if(!t)return null;const a=x(t),r=P(t,g.value,{unit:g.unit});if(!r)return null;const o=P(a,g.value,{unit:g.unit});if(!o)return null;const l=he(t,{unit:"meters"}),p=ne(t,{unit:"square-meters"});return{area:$(p,"square-meters"),display:{fill:r,outline:o},mode:"geodesic",perimeter:M(l,"meters")}}function ve(e){const t=A(e);if(!t)return null;const a=x(t),r=T(t,g.value),o=T(a,g.value),l=ae([t],"meters")[0],p=se([t],"square-meters")[0];return{area:$(p,"square-meters"),display:{fill:r,outline:o},mode:"geodesic",perimeter:M(l,"meters")}}function fe(e){const t=A(e);if(!t)return null;const a=x(t),r=ue(a,{unit:"meters"}),o=re(t,{unit:"square-meters"});return{area:$(o,"square-meters"),display:{fill:t,outline:a},mode:"euclidean",perimeter:M(r,"meters")}}function x(e){return new J({spatialReference:e.spatialReference,paths:e.rings})}let u=class extends w{constructor(e){super(e),this._result=null,this._updatingHandles=new b,this._debouncedGetResult=Z(async t=>{this._result=await we(t,this.view.spatialReference)})}initialize(){this.addHandles(f(()=>this.measurementViewData.analysis.geometry,e=>{this._updatingHandles.addPromise(L(this._debouncedGetResult(e)))},W))}destroy(){this._updatingHandles.destroy()}get result(){return this._result}get updating(){return this._updatingHandles.updating}};i([s()],u.prototype,"_result",void 0),i([s()],u.prototype,"measurementViewData",void 0),i([s()],u.prototype,"result",null),i([s()],u.prototype,"updating",null),i([s()],u.prototype,"view",void 0),u=i([_("esri.views.2d.analysis.AreaMeasurement.AreaMeasurementController")],u);let m=class extends w{constructor(t){super(t),this._emptyFillSymbol=new k({color:null,outline:null}),this._graphicsLayer=new C({listMode:"hide",internal:!0}),this._updatingHandles=new b}initialize(){var t;(t=this.view.map)==null||t.add(this._graphicsLayer),this._updatingHandles.add(()=>({geometry:this.measurementViewData.analysis.geometry}),({geometry:a})=>{if(!a)return void this._graphicsLayer.graphics.destroyAll();const r=this._graphicsLayer.graphics.at(0);r?r.geometry=a:(this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.add(new v({geometry:a,symbol:this._emptyFillSymbol})))},V)}destroy(){this._emptyFillSymbol.destroy(),this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get graphic(){return this._graphicsLayer.graphics.at(0)}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded||this._updatingHandles.updating}};i([s()],m.prototype,"graphic",null),i([s()],m.prototype,"graphicsLayer",null),i([s()],m.prototype,"measurementViewData",void 0),i([s()],m.prototype,"updating",null),i([s()],m.prototype,"view",void 0),m=i([_("esri.views.2d.analysis.AreaMeasurement.AreaMeasurementManipulatorVisualization")],m);let c=class extends w{constructor(e){super(e),this._graphicsLayer=new C({listMode:"hide",internal:!0})}initialize(){var e;(e=this.view.map)==null||e.add(this._graphicsLayer)}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.destroy()}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded}};i([s()],c.prototype,"graphicsLayer",null),i([s()],c.prototype,"measurementViewData",void 0),i([s()],c.prototype,"updating",null),i([s()],c.prototype,"view",void 0),c=i([_("esri.views.2d.analysis.AreaMeasurement.AreaMeasurementSketchVisualization")],c);function Ve(e){return(e==null?void 0:e.type)==="polygon"}let y=class extends w{constructor(e){super(e),this._invisibleAreaSymbol=new k({color:null,outline:null}),this._operationManager=new X,this._updatingHandles=new b}initialize(){this._sketchViewModel=new ce({defaultCreateOptions:{mode:"click"},defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{edgeOperation:"none",shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},updateOnGraphicClick:!1,view:this.view}),this.addHandles([f(()=>({interactive:this.measurementViewData.interactive,visible:this.measurementViewData.visible}),({interactive:e,visible:t})=>{this._operationManager.stop(),t&&e&&this.reshape()}),f(()=>this.measurementViewData.snappingOptions,e=>{this._sketchViewModel&&(this._sketchViewModel.snappingOptions=e)},V),f(()=>this.view.effectiveTheme.accentColor,e=>{this._areaSymbol=new k({color:S(e,.3),outline:new K({color:e,width:2})})},V)])}destroy(){var e,t;(e=this._areaSymbol)==null||e.destroy(),this._invisibleAreaSymbol.destroy(),this._operationManager.destroy(),(t=this._sketchViewModel)==null||t.destroy(),this._updatingHandles.destroy()}get state(){if(!this.measurementViewData.visible||!this._operationManager.currentOperationType)return"idle";switch(this._operationManager.currentOperationType){case"place":return"placing";case"reshape":return"reshaping"}}get updating(){return!this._sketchViewModel||this._sketchViewModel.updating||this._updatingHandles.updating}async place(e){return this._operationManager.start("place",async t=>{if(!this._sketchViewModel||!this.measurementViewData.sketchGraphicsLayer)return;const a=this._sketchViewModel.on("create",r=>{var o;switch(r.state){case"active":{const l=(o=r.graphic)==null?void 0:o.geometry;(l==null?void 0:l.type)==="polygon"&&(this.measurementViewData.analysis.geometry=l);break}case"cancel":case"complete":t.stop()}});t.handles.push(a,I(()=>{var r,o;if(a.remove(),(r=this._sketchViewModel)==null||r.cancel(),(o=this.measurementViewData.sketchGraphicsLayer)==null||o.removeAll(),H(e))return t.reject();t.resolve({})})),this._sketchViewModel.polygonSymbol=this._invisibleAreaSymbol,this._sketchViewModel.layer=this.measurementViewData.sketchGraphicsLayer,this._updatingHandles.addPromise(L(this._sketchViewModel.create("polygon")))})}async reshape(e){return this._operationManager.start("reshape",async t=>{if(!this._sketchViewModel)return;const a=()=>this._areaSymbol&&this._sketchViewModel&&this.measurementViewData.manipulatorGraphic&&this.measurementViewData.manipulatorGraphicsLayer?(this._sketchViewModel.polygonSymbol=this._areaSymbol,this._sketchViewModel.layer=this.measurementViewData.manipulatorGraphicsLayer,this._updatingHandles.addPromise(L(this._sketchViewModel.update(this.measurementViewData.manipulatorGraphic,{tool:"reshape"})))):Promise.resolve(),r=this._sketchViewModel.on("update",o=>{var p;const l=(p=o.graphics[0])==null?void 0:p.geometry;this.measurementViewData.analysis.geometry=Ve(l)?l:null,o.state==="complete"&&(this.measurementViewData.interactive?a():t.stop())});t.handles.push(r,I(()=>{var o;if(r.remove(),(o=this._sketchViewModel)==null||o.cancel(),H(e))return t.reject();t.resolve()})),await a()})}};i([s()],y.prototype,"_sketchViewModel",void 0),i([s()],y.prototype,"measurementViewData",void 0),i([s()],y.prototype,"state",null),i([s()],y.prototype,"updating",null),i([s()],y.prototype,"view",void 0),y=i([_("esri.views.2d.analysis.AreaMeasurement.AreaMeasurementTool")],y);let n=class extends Y{constructor(e){super(e),this.analysis=null,this.snappingOptions=new F,this.type="area-measurement-view-2d"}initialize(){const{view:e}=this;this._areaVisualization=new h({view:e,measurementViewData:this}),this._controller=new u({view:e,measurementViewData:this}),this._manipulatorVisualization=new m({view:e,measurementViewData:this}),this._sketchVisualization=new c({view:e,measurementViewData:this}),this._tool=new y({view:e,measurementViewData:this})}destroy(){var e,t,a,r,o;(e=this._areaVisualization)==null||e.destroy(),(t=this._controller)==null||t.destroy(),(a=this._manipulatorVisualization)==null||a.destroy(),(r=this._sketchVisualization)==null||r.destroy(),(o=this._tool)==null||o.destroy()}get manipulatorGraphic(){var e;return(e=this._manipulatorVisualization)==null?void 0:e.graphic}get manipulatorGraphicsLayer(){var e;return(e=this._manipulatorVisualization)==null?void 0:e.graphicsLayer}get sketchGraphicsLayer(){var e;return(e=this._sketchVisualization)==null?void 0:e.graphicsLayer}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get result(){var e;return(e=this._controller)==null?void 0:e.result}get unit(){return this.analysis.unit??Q(this.view)}get updating(){var e,t,a,r;return(((e=this._areaVisualization)==null?void 0:e.updating)??!0)||(((t=this._controller)==null?void 0:t.updating)??!0)||(((a=this._sketchVisualization)==null?void 0:a.updating)??!0)||(((r=this._tool)==null?void 0:r.updating)??!0)}get visible(){return super.visible}set visible(e){super.visible=e}async place(e){return this._tool.place(e)}};i([s()],n.prototype,"_areaVisualization",void 0),i([s()],n.prototype,"_controller",void 0),i([s()],n.prototype,"_manipulatorVisualization",void 0),i([s()],n.prototype,"_sketchVisualization",void 0),i([s()],n.prototype,"_tool",void 0),i([s({constructOnly:!0})],n.prototype,"analysis",void 0),i([s()],n.prototype,"manipulatorGraphic",null),i([s()],n.prototype,"manipulatorGraphicsLayer",null),i([s()],n.prototype,"sketchGraphicsLayer",null),i([s({readOnly:!0})],n.prototype,"result",null),i([s({type:F,nonNullable:!0})],n.prototype,"snappingOptions",void 0),i([s({readOnly:!0})],n.prototype,"type",void 0),i([s({readOnly:!0})],n.prototype,"unit",null),i([s({readOnly:!0})],n.prototype,"updating",null),n=i([_("esri.views.2d.analysis.AreaMeasurementAnalysisView2D")],n);const ht=n;export{ht as default};
