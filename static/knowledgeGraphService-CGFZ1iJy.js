const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./arcgis-knowledge-client-core-simd-BPSjSsIc.js","./_commonjsHelpers-DCkdB7M8.js","./arcgis-knowledge-client-core-D59rGbtS.js","./index-C_bK48d2.js","./index-DxLSJ8yk.css","./MapImageLayer-kzEi3kkR.js","./SublayersOwner-C73x6LJp.js","./QueryTask-9_kfRTXO.js","./executeForIds-CbCn4frw.js","./query-BrxajYUG.js","./urlUtils-BlxBVR77.js","./pbfQueryUtils-CX8BKSeH.js","./pbf-CBn1Vo1A.js","./memoryEstimations-w0EAmzVg.js","./OptimizedGeometry-KE6YknPZ.js","./OptimizedFeatureSet-BZnZXZq6.js","./executeQueryJSON-B3mQDcOE.js","./featureConversionUtils-Di1UhLmY.js","./sublayerUtils-CPElnPvy.js","./ExportImageParameters-Dhssjcte.js","./floorFilterUtils-DZ5C6FQv.js"])))=>i.map(i=>d[i]);
import{aq as jt,_ as xe,g7 as rt,aJ as s,aK as l,ae as H,ax as pt,aL as g,db as Z,dj as It,bb as A,c2 as ke,am as At,c9 as Ct,e5 as Et,bi as Mt,b1 as ae,a7 as F,b0 as je,eb as Ft,fA as Nt,cG as nt,cK as _e,a as u,hN as Je,fM as ut,aM as ct,dk as Ke,dl as Qe,pN as ne,aF as Pe,uV as Ot,rs as qt,uW as Lt,rr as Ut,a8 as Vt,cc as zt}from"./index-C_bK48d2.js";import{s as Jt,t as Kt}from"./networkEnums-BSO0mlrW.js";import{a as Qt}from"./GPMessage-Dm5CYmJ1.js";import{p as Bt,t as Wt,a as Ht,s as Zt}from"./Relationship-njbOqBuZ.js";const at="esri/rest/knowledgeGraph/wasmInterface/";let De;async function f(){const e=De;if(e)return e;const t=!!jt("wasm-simd");return De=Yt(t),De}async function Yt(e){if(e){const{default:r}=await xe(()=>import("./arcgis-knowledge-client-core-simd-BPSjSsIc.js"),__vite__mapDeps([0,1]),import.meta.url).then(n=>n.a);return r({locateFile:n=>rt(at+n)})}const{default:t}=await xe(()=>import("./arcgis-knowledge-client-core-D59rGbtS.js"),__vite__mapDeps([2,1]),import.meta.url).then(r=>r.a);return t({locateFile:r=>rt(at+r)})}const yt={Regular:0,Provenance:1,Document:2},te={esriFieldTypeSmallInteger:0,esriFieldTypeInteger:1,esriFieldTypeSingle:2,esriFieldTypeDouble:3,esriFieldTypeString:4,esriFieldTypeDate:5,esriFieldTypeOID:6,esriFieldTypeGeometry:7,esriFieldTypeBlob:8,esriFieldTypeRaster:9,esriFieldTypeGUID:10,esriFieldTypeGlobalID:11,esriFieldTypeXML:12,esriFieldTypeBigInteger:13,esriFieldTypeDateOnly:14,esriFieldTypeTimeOnly:15,esriFieldTypeTimestampOffset:16},Ie={esriGeometryNull:0,esriGeometryPoint:1,esriGeometryMultipoint:2,esriGeometryPolyline:3,esriGeometryPolygon:4,esriGeometryEnvelope:5,esriGeometryAny:7,esriGeometryMultiPatch:9},Xt={esriMethodHintUNSPECIFIED:0,esriUUIDESRI:1,esriUUIDRFC4122:2},er={esriTypeUNSPECIFIED:0,esriTypeEntity:1,esriTypeRelationship:2,esriTypeBoth:4,esriTypeMetaEntityProvenance:8},ht={esriGraphPropertyUNSPECIFIED:0,esriGraphPropertyRegular:1,esriGraphPropertyDocumentName:2,esriGraphPropertyDocumentTitle:3,esriGraphPropertyDocumentUrl:4,esriGraphPropertyDocumentText:5,esriGraphPropertyDocumentKeywords:6,esriGraphPropertyDocumentContentType:7,esriGraphPropertyDocumentMetadata:8,esriGraphPropertyDocumentFileExtension:9,esriGraphPropertyProvenanceInstanceId:10,esriGraphPropertyProvenanceSourceType:11,esriGraphPropertyProvenanceSourceName:12,esriGraphPropertyProvenanceSource:13,esriGraphPropertyProvenanceComment:14,esriGraphPropertyProvenanceTypeName:15,esriGraphPropertyProvenancePropertyName:16},tr={esriIdentifierInfoTypeUNSPECIFIED:0,esriIdentifierInfoTypeDatabaseNative:1,esriIdentifierInfoTypeUniformProperty:2},ot={unspecified:0,codedValue:1,range:2},rr={esriMergePolicyType_UNSPECIFIED:0,esriMergePolicyTypeSumValues:1,esriMergePolicyTypeAreaWeighted:2,esriMergePolicyTypeDefaultValue:3},nr={esriSplitPolicyType_UNSPECIFIED:0,esriSplitPolicyTypeGeometryRatio:1,esriSplitPolicyTypeDuplicate:2,esriSplitPolicyTypeDefaultValue:3};var Ae;let O=Ae=class extends Z{constructor(e){super(e),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(e){return It(Ae,e)}};s([l({type:H})],O.prototype,"outSpatialReference",void 0),s([l({type:pt})],O.prototype,"processExtent",void 0),s([l({type:H})],O.prototype,"processSpatialReference",void 0),s([l({nonNullable:!0})],O.prototype,"returnColumnName",void 0),s([l({nonNullable:!0})],O.prototype,"returnFeatureCollection",void 0),s([l({nonNullable:!0})],O.prototype,"returnM",void 0),s([l({nonNullable:!0})],O.prototype,"returnZ",void 0),O=Ae=s([g("esri.rest.geoprocessor.GPOptions")],O);let N=class extends A{constructor(t){super(t),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};s([l({type:pt})],N.prototype,"extent",void 0),s([l()],N.prototype,"height",void 0),s([l()],N.prototype,"href",void 0),s([l()],N.prototype,"opacity",void 0),s([l()],N.prototype,"rotation",void 0),s([l()],N.prototype,"scale",void 0),s([l()],N.prototype,"visible",void 0),s([l()],N.prototype,"width",void 0),N=s([g("esri.layers.support.MapImage")],N);let ce=class extends A{constructor(t){super(t),this.area=0,this.units=null}};s([l({json:{write:!0}})],ce.prototype,"area",void 0),s([ke(Jt)],ce.prototype,"units",void 0),ce=s([g("esri.rest.support.ArealUnit")],ce);let re=class extends A{constructor(t){super(t),this.itemId=null,this.url=null}};s([l({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],re.prototype,"itemId",void 0),s([l({type:String,json:{write:!0}})],re.prototype,"url",void 0),re=s([g("esri.rest.support.DataFile")],re);let ye=class extends A{constructor(t){super(t),this.distance=0,this.units=null}};s([l({json:{write:!0}})],ye.prototype,"distance",void 0),s([ke(Kt)],ye.prototype,"units",void 0),ye=s([g("esri.rest.support.LinearUnit")],ye);const I="multi-value-",Be=new At({GPArealUnit:"areal-unit",GPBoolean:"boolean",GPComposite:"composite",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPArealUnit":`${I}areal-unit`,"GPMultiValue:GPBoolean":`${I}boolean`,"GPMultiValue:GPComposite":`${I}composite`,"GPMultiValue:GPDataFile":`${I}data-file`,"GPMultiValue:GPDate":`${I}date`,"GPMultiValue:GPDouble":`${I}double`,"GPMultiValue:GPFeatureRecordSetLayer":`${I}feature-record-set-layer`,"GPMultiValue:Field":`${I}field`,"GPMultiValue:GPLinearUnit":`${I}linear-unit`,"GPMultiValue:GPLong":`${I}long`,"GPMultiValue:GPRasterData":`${I}raster-data`,"GPMultiValue:GPRasterDataLayer":`${I}raster-data-layer`,"GPMultiValue:GPRecordSet":`${I}record-set`,"GPMultiValue:GPString":`${I}string`});let oe=class extends A{constructor(t){super(t),this.dataType=null,this.paramName=null,this.value=null}};s([ke(Be,{ignoreUnknown:!1})],oe.prototype,"dataType",void 0),s([l()],oe.prototype,"paramName",void 0),s([l()],oe.prototype,"value",void 0),oe=s([g("esri.rest.support.ParameterValue")],oe);let B=class extends A{constructor(t){super(t),this.format=null,this.itemId=null,this.type=null,this.url=null}readType(t){return t==="ImageService"?"image-service":null}};s([l()],B.prototype,"format",void 0),s([l({json:{name:"itemID",write:!0}})],B.prototype,"itemId",void 0),s([l()],B.prototype,"type",void 0),s([Ct("type")],B.prototype,"readType",null),s([l({json:{write:!0}})],B.prototype,"url",void 0),B=s([g("esri.rest.support.RasterData")],B);async function ar(e,t,r,n,a){const o={},i={},d=[];return or(n,d,o),Mt(d).then(p=>{const{outSpatialReference:c,processExtent:y,processSpatialReference:h,returnColumnName:v,returnFeatureCollection:D,returnM:_,returnZ:S}=r,{path:K}=ae(e);for(const tt in o){const[Dt,Rt]=o[tt];i[tt]=p.slice(Dt,Rt)}const m=c?c.wkid||c:null,b=h?h.wkid||h:null,Q=null,C=Se({...y?{context:{extent:y,outSR:m,processSR:b}}:{"env:outSR":m,"env:processSR":b},...n,...Q,f:"json"},null,i),ue={...a,query:C};return F(`${K}/${t}`,ue)})}function or(e,t,r){for(const n in e){const a=e[n];if(a&&typeof a=="object"&&a instanceof je){const{features:o}=a;r[n]=[t.length,t.length+o.length],o.forEach(i=>{t.push(i.geometry)})}}}async function Ce(e,t){switch(e){case"areal-unit":return ce.fromJSON(t);case"boolean":case"double":case"long":case"string":case"value-table":return t;case"date":return new Date(t);case"data-file":return re.fromJSON(t);case"linear-unit":return ye.fromJSON(t);case"feature-record-set-layer":if("url"in t)return re.fromJSON(t);if("layerDefinition"in t){const r=new(await xe(async()=>{const{default:o}=await import("./index-C_bK48d2.js").then(i=>i.xi);return{default:o}},__vite__mapDeps([3,4]),import.meta.url)).default,{layerDefinition:n,featureSet:a}=t;return r.read({layerDefinition:n,featureSet:a},{origin:"portal-item"}),r.spatialReference=H.fromJSON(a.spatialReference??n.spatialReference??n.extent.spatialReference),r}return je.fromJSON(t);case"record-set":return"url"in t?re.fromJSON(t):je.fromJSON(t);case"raster-data":case"raster-data-layer":return"mapImage"in t?N.fromJSON(t.mapImage):B.fromJSON(t);case"field":return Ft.fromJSON(t)}}function ir(e){return e.startsWith(I)}function sr(e){return e.replace(I,"")}async function dr(e,t){const r=sr(e),n=r==="composite"?t.map(a=>Ce(Be.fromJSON(a.dataType),a.value)):t.map(a=>Ce(r,a));return Promise.all(n)}async function it(e){const t=Be.fromJSON(e.dataType),{paramName:r}=e,n=ir(t)?await dr(t,e.value):await Ce(t,e.value);return new oe({dataType:t,paramName:r,value:n})}function Se(e,t,r){for(const n in e){const a=e[n];Array.isArray(a)?e[n]=JSON.stringify(a.map(o=>Se({item:o},!0).item)):a instanceof Date&&(e[n]=a.getTime())}return Et(e,t,r)}var Ge;const lr=Nt()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1}),Re=1e3;var pe;let L=(pe=class extends A{constructor(t){super(t),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._cancelJobTimer=void 0,this._jobCompletionTimer=void 0}async cancelJob(t){const{jobId:r,sourceUrl:n}=this,{path:a}=ae(n),o={...this.requestOptions,...t,query:{f:"json"}},i=`${a}/jobs/${r}/cancel`,{data:d}=await F(i,o),{messages:p,jobStatus:c,progress:y}=Ge.fromJSON(d);return this.set({messages:p,jobStatus:c,progress:y}),c==="job-cancelled"?this:new Promise((h,v)=>{nt(o.signal,()=>{this.clearCancelJobTimer(),v(_e())}),this.clearCancelJobTimer();const D=()=>{this._cancelJobTimer||v(_e()),this.checkJobStatus(t).then(({jobStatus:_})=>{switch(_){case"job-cancelling":default:this._cancelJobTimer=setTimeout(D,Re);break;case"job-deleted":case"job-deleting":case"job-executing":case"job-failed":case"job-new":case"job-submitted":case"job-succeeded":case"job-timed-out":case"job-waiting":v(this);break;case"job-cancelled":h(this)}}).catch(_=>{v(_)})};this._cancelJobTimer=setTimeout(D,Re)})}destroy(){clearInterval(this._cancelJobTimer),clearInterval(this._jobCompletionTimer)}async checkJobStatus(t){const{path:r}=ae(this.sourceUrl),n={...this.requestOptions,...t,query:{...t==null?void 0:t.query,f:"json"}},a=`${r}/jobs/${this.jobId}`,{data:o}=await F(a,n),{messages:i,jobStatus:d,progress:p}=Ge.fromJSON(o);return this.set({messages:i,jobStatus:d,progress:p}),this}async fetchResultData(t,r,n){r=O.from(r||{});const{returnColumnName:a,returnFeatureCollection:o,returnM:i,returnZ:d,outSpatialReference:p}=r,{path:c}=ae(this.sourceUrl),y={returnColumnName:a||null,returnFeatureCollection:o||null,returnM:i||null,returnZ:d||null,outSR:p,returnType:"data",f:"json",...n==null?void 0:n.query},h=Se(y,null),v={...this.requestOptions,...n,query:h},D=`${c}/jobs/${this.jobId}/results/${t}`,{data:_}=await F(D,v);return it(_)}async fetchResultImage(t,r,n){const{path:a}=ae(this.sourceUrl),o={...r.toJSON(),f:"json"},i=Se(o),d={...this.requestOptions,...n,query:i},p=`${a}/jobs/${this.jobId}/results/${t}`,{data:c}=await F(p,d);return it(c)}async fetchResultMapImageLayer(){const{path:t}=ae(this.sourceUrl),r=t.indexOf("/GPServer/"),n=`${t.slice(0,Math.max(0,r))}/MapServer/jobs/${this.jobId}`;return new(await xe(async()=>{const{default:a}=await import("./MapImageLayer-kzEi3kkR.js");return{default:a}},__vite__mapDeps([5,3,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url)).default({url:n})}async waitForJobCompletion(t={}){const{interval:r=Re,signal:n,statusCallback:a,apiKey:o}=t;return new Promise((i,d)=>{nt(n,()=>{this.clearJobCompletionTimer(),d(_e())}),this.clearJobCompletionTimer();const p=()=>{this._jobCompletionTimer||d(_e()),this.checkJobStatus({query:{token:o}}).then(({jobStatus:c})=>{switch(c){case"job-succeeded":i(this);break;case"job-executing":case"job-new":case"job-submitted":case"job-waiting":a&&a(this),this._jobCompletionTimer=setTimeout(p,r);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-failed":case"job-timed-out":d(this);break;default:this._jobCompletionTimer=setTimeout(p,r)}}).catch(c=>{d(c)})};this._jobCompletionTimer=setTimeout(p,r)})}clearCancelJobTimer(){clearTimeout(this._cancelJobTimer),this._cancelJobTimer=void 0}clearJobCompletionTimer(){clearTimeout(this._jobCompletionTimer),this._jobCompletionTimer=void 0}},Ge=pe,pe);s([l()],L.prototype,"jobId",void 0),s([ke(lr,{ignoreUnknown:!1})],L.prototype,"jobStatus",void 0),s([l({type:[Qt]})],L.prototype,"messages",void 0),s([l()],L.prototype,"progress",void 0),s([l()],L.prototype,"requestOptions",void 0),s([l({json:{write:!0}})],L.prototype,"sourceUrl",void 0),L=Ge=s([g("esri.rest.support.JobInfo")],L);async function pr(e,t,r,n){return r=O.from(r||{}),ar(e,"submitJob",r,t??{},n).then(({data:a})=>{const o=L.fromJSON(a);return o.sourceUrl=e,o})}let V=class extends Z{constructor(t){super(t),this.headerKeys=[],this.outSpatialReference=null,this.exceededTransferLimit=!1}};s([l()],V.prototype,"headerKeys",void 0),s([l()],V.prototype,"outSpatialReference",void 0),s([l()],V.prototype,"exceededTransferLimit",void 0),V=s([g("esri.rest.knowledgeGraph.GraphQueryResultHeader")],V);let se=class extends Z{constructor(t){super(t),this.resultRows=[],this.resultHeader=new V}};s([l()],se.prototype,"resultRows",void 0),s([l()],se.prototype,"resultHeader",void 0),se=s([g("esri.rest.knowledgeGraph.GraphQueryResult")],se);let de=class extends Z{constructor(t){super(t),this.resultRowsStream=new ReadableStream,this.resultHeader=new V}};s([l()],de.prototype,"resultRowsStream",void 0),s([l()],de.prototype,"resultHeader",void 0),de=s([g("esri.rest.knowledgeGraph.GraphQueryStreamingResult")],de);let U=class extends A{constructor(t){super(t),this.name=null,this.unique=null,this.ascending=!0,this.description="",this.fieldNames=[]}};s([l({type:String,json:{write:!0}})],U.prototype,"name",void 0),s([l({type:Boolean,json:{write:!0}})],U.prototype,"unique",void 0),s([l({type:Boolean,json:{write:!0}})],U.prototype,"ascending",void 0),s([l({type:String,json:{write:!0}})],U.prototype,"description",void 0),s([l({type:[String],json:{write:!0}})],U.prototype,"fieldNames",void 0),U=s([g("esri.rest.knowledgeGraph.FieldIndex")],U);let x=class extends A{constructor(t){super(t),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=!0,this.required=!1,this.defaultVisibility=!0,this.systemMaintained=null,this.role="esriGraphPropertyUNSPECIFIED",this.domain=null,this.defaultValue=null}};s([l({type:String,json:{write:!0}})],x.prototype,"name",void 0),s([l({type:String,json:{write:!0}})],x.prototype,"alias",void 0),s([l({type:String,json:{write:!0}})],x.prototype,"fieldType",void 0),s([l({type:String,json:{write:!0}})],x.prototype,"geometryType",void 0),s([l({type:Boolean,json:{write:!0}})],x.prototype,"hasM",void 0),s([l({type:Boolean,json:{write:!0}})],x.prototype,"hasZ",void 0),s([l({type:Boolean,json:{write:!0}})],x.prototype,"nullable",void 0),s([l({type:Boolean,json:{write:!0}})],x.prototype,"editable",void 0),s([l({type:Boolean,json:{write:!0}})],x.prototype,"required",void 0),s([l({type:Boolean,json:{write:!0}})],x.prototype,"defaultVisibility",void 0),s([l({type:Boolean,json:{write:!0}})],x.prototype,"systemMaintained",void 0),s([l({type:String,json:{write:!0}})],x.prototype,"role",void 0),s([l({type:String,json:{write:!0}})],x.prototype,"domain",void 0),s([l({json:{write:!0}})],x.prototype,"defaultValue",void 0),x=s([g("esri.rest.knowledgeGraph.GraphProperty")],x);let q=class extends A{constructor(t){super(t),this.name=null,this.alias=null,this.role="Regular",this.strict=null,this.properties=[],this.fieldIndexes=[],this.type=null}};s([l({type:String,json:{write:!0}})],q.prototype,"name",void 0),s([l({type:String,json:{write:!0}})],q.prototype,"alias",void 0),s([l({type:String,json:{write:!0}})],q.prototype,"role",void 0),s([l({type:Boolean,json:{write:!0}})],q.prototype,"strict",void 0),s([l({type:[x],json:{write:!0}})],q.prototype,"properties",void 0),s([l({type:[U],json:{write:!0}})],q.prototype,"fieldIndexes",void 0),q=s([g("esri.rest.knowledgeGraph.GraphObjectType")],q);let we=class extends q{constructor(t){super(t),this.type="entity"}};we=s([g("esri.rest.knowledgeGraph.EntityType")],we);let ge=class extends q{constructor(t){super(t),this.endPoints=[],this.type="relationship"}};s([l({json:{write:!0}})],ge.prototype,"endPoints",void 0),ge=s([g("esri.rest.knowledgeGraph.RelationshipType")],ge);let le=class extends A{constructor(t){super(t),this.value=null,this.behavior=null}};s([l({type:String,json:{write:!0}})],le.prototype,"value",void 0),s([l({type:String,json:{write:!0}})],le.prototype,"behavior",void 0),le=s([g("esri.rest.knowledgeGraph.SourceTypeValueBehavior")],le);let k=class extends A{constructor(t){super(t),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=[],this.entityTypes=[],this.relationshipTypes=[],this.metaEntityTypes=[],this.provenanceSourceTypeValues=[],this.domains=[]}};s([l({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e==null?void 0:e.getTime()}}}})],k.prototype,"timestamp",void 0),s([l({type:H,json:{write:!0}})],k.prototype,"spatialReference",void 0),s([l({type:Boolean,json:{write:!0}})],k.prototype,"strict",void 0),s([l({type:String,json:{write:!0}})],k.prototype,"objectIdField",void 0),s([l({type:String,json:{write:!0}})],k.prototype,"globalIdField",void 0),s([l()],k.prototype,"arcgisManaged",void 0),s([l()],k.prototype,"identifierInfo",void 0),s([l()],k.prototype,"searchIndexes",void 0),s([l({type:[we],json:{write:!0}})],k.prototype,"entityTypes",void 0),s([l({type:[ge],json:{write:!0}})],k.prototype,"relationshipTypes",void 0),s([l({type:[we],json:{write:!0}})],k.prototype,"metaEntityTypes",void 0),s([l({type:[le],json:{write:!0}})],k.prototype,"provenanceSourceTypeValues",void 0),s([l({json:{write:!0}})],k.prototype,"domains",void 0),k=s([g("esri.rest.knowledgeGraph.DataModel")],k);let G=class extends A{constructor(t){super(t),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1,this.supportsProvenance=!1}};s([l({type:[String],json:{write:!0}})],G.prototype,"capabilities",void 0),s([l({type:Boolean,json:{write:!0}})],G.prototype,"supportsSearch",void 0),s([l({type:[String],json:{write:!0}})],G.prototype,"supportedQueryFormats",void 0),s([l({type:Boolean,json:{write:!0}})],G.prototype,"allowGeometryUpdates",void 0),s([l({type:Number,json:{write:!0}})],G.prototype,"searchMaxRecordCount",void 0),s([l({type:Object,json:{write:!0}})],G.prototype,"serviceCapabilities",void 0),s([l({type:Number,json:{write:!0}})],G.prototype,"maxRecordCount",void 0),s([l({type:String,json:{write:!0}})],G.prototype,"description",void 0),s([l({type:String,json:{write:!0}})],G.prototype,"copyrightText",void 0),s([l({type:String,json:{write:!0}})],G.prototype,"units",void 0),s([l({type:H,json:{write:!0}})],G.prototype,"spatialReference",void 0),s([l({type:Number,json:{write:!0}})],G.prototype,"currentVersion",void 0),s([l({type:Object,json:{write:!0}})],G.prototype,"dateFieldsTimeReference",void 0),s([l({type:String,json:{write:!0}})],G.prototype,"serviceItemId",void 0),s([l({type:Boolean,json:{write:!0}})],G.prototype,"supportsDocuments",void 0),s([l({type:Boolean,json:{write:!0}})],G.prototype,"dataEditingNotSupported",void 0),s([l({type:Boolean,json:{write:!0}})],G.prototype,"schemaEditingNotSupported",void 0),s([l({type:Boolean,json:{write:!0}})],G.prototype,"supportsProvenance",void 0),G=s([g("esri.rest.knowledgeGraph.ServiceDefinition")],G);let ie=class extends A{constructor(t){super(t),this.url=null,this.dataModel=null,this.serviceDefinition=null}};s([l({type:String,json:{write:!0}})],ie.prototype,"url",void 0),s([l({type:k,json:{write:!0}})],ie.prototype,"dataModel",void 0),s([l({type:G,json:{write:!0}})],ie.prototype,"serviceDefinition",void 0),ie=s([g("esri.rest.knowledgeGraph.KnowledgeGraph")],ie);function P(e,t,r){if(e.error_code!==0)throw new u(t,r,{errorCode:e.error_code,errorMessage:e.error_message})}function T(e){return e!=null&&e.error_code?new u("knowledgeGraphService:server-or-decoding-error",e.error_message,{errorCode:e.error_code}):void 0}function ur(e,t,r,n=!1){const a=new r.ClientDataFetchRequestEncoder;a.deleteLater();for(const i of e){const d=cr(i,t,r,n);a.add_client_data_fetch_request_parameter(d)}a.encode();const o=a.get_encoding_result();return P(o.error,"knowledge-graph:fetchClientDataAtKeys-encoding-failed","Attempting to encode the fetchClientDataAtKeys failed"),structuredClone(o.get_byte_buffer())}function cr(e,t,r,n){const a=new r.ClientDataKey;a.deleteLater(),a.key_string=e;const o=new r.ClientDataFetchRequestParameter;o.deleteLater(),o.set_key(a);const i=t.get(e);return i&&!n&&(o.v_tag={v_tag:i.version}),o}const yr={exclude:0,include:1};function gt(e,t){const r=new t.ArrayValue;return r.deleteLater(),e.forEach(n=>{r.add_value(He(n,t))}),r}function ft(e,t){const r=new t.ObjectValue;r.deleteLater();for(const[n,a]of Object.entries(e))r.set_key_value(n,He(a,t));return r}function We(e,t){if(e instanceof ut)return mr(e,t);if(e instanceof ct)return _r(e,t);if(e instanceof Ke||e instanceof Qe)return wr(e,t);throw new u("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function hr(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function gr(e,t,r){if(!e.extent)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:r.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function fr(e,t){t.provenance_behavior={value:yr[e]}}function He(e,t){if(e==null)return"";if(typeof e!="object"||e instanceof Date)return e;if(e instanceof Je)return We(e,t);if(Array.isArray(e)){const r=new t.ArrayValue;return r.deleteLater(),e.forEach(n=>{r.add_value(He(n,t))}),r}return ft(e,t)}function wr(e,t){const r=new t.GeometryValue;r.deleteLater(),r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],a=[];let o=[];e instanceof Ke?(r.geometry_type=t.esriGeometryType.esriGeometryPolyline,o=e.paths):e instanceof Qe&&(r.geometry_type=t.esriGeometryType.esriGeometryPolygon,o=e.rings);let i=0,d=0;return o.forEach(p=>{let c=0;p.forEach(y=>{c++,y.forEach(h=>{n[d]=h,d++})}),a[i]=c,i++}),r.coords=new Float64Array(n),r.lengths=new Uint32Array(a),r}function mr(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=r.geometry_type=t.esriGeometryType.esriGeometryMultipoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],a=[];a[0]=e.points.length;let o=0;return e.points.forEach(i=>{i.forEach(d=>{n[o]=d,o++})}),r.coords=new Float64Array(n),r.lengths=new Uint32Array(a),r}function _r(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=t.esriGeometryType.esriGeometryPoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],a=[];a[0]=1,n[0]=e.x,n[1]=e.y;let o=2;return e.hasZ&&(n[o]=e.z,o++),e.hasM&&(n[o]=e.m,o++),r.coords=new Float64Array(n),r.lengths=new Uint32Array(a),r}function ve(e,t){if(!e.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(!("originId"in e)){const r=new t.EntityValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,a]of Object.entries(e.properties))r.set_key_value(n,$e(a,t));return e.id&&r.set_id(e.id),r}if("originId"in e&&"destinationId"in e){const r=new t.RelationshipValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,a]of Object.entries(e.properties))r.set_key_value(n,$e(a,t));return e.id&&r.set_id(e.id),e.originId&&e.destinationId&&r.set_related_entity_ids(e.originId,e.destinationId),r}throw new u("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function vr(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function br(e,t){const r=new t.EntityType;return r.deleteLater(),_t(e,t,r)}function Gr(e,t){const r=new t.RelationshipType;r.deleteLater();for(const n of e.endPoints){const a=new t.EndPoint;a.deleteLater(),a.origin_entity_type=n.originEntityType,a.dest_entity_type=n.destinationEntityType,r.add_end_point(a)}return _t(e,t,r)}function Tr(e,t){const r=new t.EntityType;return r.deleteLater(),vt(e,r)}function xr(e,t){const r=new t.RelationshipType;return r.deleteLater(),vt(e,r)}function wt(e,t){const r=new t.GraphProperty;return r.deleteLater(),r.name=e.name,r.alias=e.alias??"",r.field_type={value:te[e.fieldType]},r.geometry_type={value:e.geometryType?Ie[e.geometryType]:Ie.esriGeometryNull},r.has_m=e.hasM??!1,r.has_z=e.hasZ??!1,r.nullable=e.nullable??!1,r.editable=e.editable,r.required=e.required,r.default_visibility=e.defaultVisibility,r.system_maintained=e.systemMaintained??!1,r.role={value:ht[e.role]},r.default_value=$e(e.defaultValue,t),r.domain=e.domain??"",r}function Pr(e,t){const r=new t.GraphProperty;return r.deleteLater(),e.hasOwnProperty("alias")&&(r.alias=e.alias),e.hasOwnProperty("editable")&&(r.editable=e.editable),e.hasOwnProperty("required")&&(r.required=e.required),e.hasOwnProperty("defaultVisibility")&&(r.default_visibility=e.defaultVisibility),e.hasOwnProperty("defaultValue")&&(r.default_value=$e(e.defaultValue,t)),e.hasOwnProperty("domain")&&(r.domain=e.domain),r}function st(e,t){const r=new t.SearchIndexProperties;r.deleteLater();for(const n of e.propertyNames)r.add_search_property_name(n);return r}function Sr(e,t){const r=new t.FieldIndex;r.deleteLater(),r.name=e.name,r.unique=e.unique,r.ascending=e.ascending,r.description=e.description??"";for(const n of e.fieldNames)r.add_field(n);return r}function mt(e,t,r,n){const a=new t.Domain;a.deleteLater(),a.name=e.name;const o=te[r];a.field_type={value:o};let i=o;if(o!==te.esriFieldTypeTimeOnly&&o!==te.esriFieldTypeDateOnly&&o!==te.esriFieldTypeTimestampOffset||(i=te.esriFieldTypeString),n&&(a.merge_policy_type={value:rr[n.mergePolicy]},a.split_policy_type={value:nr[n.splitPolicy]}),e.type==="coded-value"){const d=e;a.type="codedValue";const p=new t.CodedValueDomain;p.deleteLater();for(const c of d.codedValues){const y=new t.CodedValue;y.deleteLater(),y.name=c.name,y.set_code(c.code,{value:i}),p.add_coded_value(y)}a.coded_value_domain=p}else if(e.type==="range"){const d=e;a.type="range";const p=new t.RangeDomain;p.deleteLater(),p.add_value(d.minValue,{value:i}),p.add_value(d.maxValue,{value:i}),a.range_domain=p}else a.type=e.type??"unspecified";return a}function _t(e,t,r){r.name=e.name,r.alias=e.alias??"",r.role={value:yt[e.role]},r.strict=e.strict;for(const n of e.properties){const a=wt(n,t);r.add_property(a)}return r}function vt(e,t){return e.hasOwnProperty("alias")&&(t.alias=e.alias),t}function $e(e,t){return e==null?null:typeof e!="object"||e instanceof Date?e:e instanceof Je?We(e,t):null}function $r(e,t,r,n=!1){const a=new Map;for(let o=0;o<e.get_results_count();o++){const i=e.get_result_at(o);if(i.get_fetch_result_case().value!==2||i.error().error_code!==0){const h=i.get_key().key_string;r.has(h)&&t.delete(h);continue}const d=i.get_value(),p=i.get_key().key_string,c=r.get(p);let y;if(d.get_data_case().value===2&&c)y=c.value;else{if(d.get_data_case().value!==1)continue;{y=d.get_data().client_data_string;const h=i.get_value().get_v_tag().v_tag;n||t.set(p,{key:p,version:h,value:y})}}a.set(p,y)}return a}function kr(e){const t=e.get_keys(),r=new Array;for(let n=0;n<t.get_keys_count();n++){const a=t.get_key_at(n);a.get_client_data_key_type().value===1&&r.push(a.key_string)}return r}let Y=class extends Z{constructor(t){super(t),this.decoderError=null,this.resultsCount=0,this.results=[],this.updatedKnowledgeGraph=null}};s([l()],Y.prototype,"decoderError",void 0),s([l()],Y.prototype,"resultsCount",void 0),s([l()],Y.prototype,"results",void 0),s([l()],Y.prototype,"updatedKnowledgeGraph",void 0),Y=s([g("esri.rest.knowledgeGraph.GraphDataModelOperationResult")],Y);const z=Y;let Ee=class extends z{constructor(e){super(e)}};Ee=s([g("esri.rest.knowledgeGraph.GraphAddFieldIndexResult")],Ee);const Dr=Ee;let X=class extends z{constructor(t){super(t),this.entityAddResultsCount=0,this.relationshipAddResultsCount=0,this.entityAddResults=[],this.relationshipAddResults=[]}};s([l()],X.prototype,"entityAddResultsCount",void 0),s([l()],X.prototype,"relationshipAddResultsCount",void 0),s([l()],X.prototype,"entityAddResults",void 0),s([l()],X.prototype,"relationshipAddResults",void 0),X=s([g("esri.rest.knowledgeGraph.GraphAddNamedTypesResult")],X);const Rr=X;let Me=class extends z{constructor(e){super(e)}};Me=s([g("esri.rest.knowledgeGraph.GraphAddPropertyResult")],Me);const jr=Me;let he=class extends Z{constructor(t){super(t),this.decoderError=null,this.updatedKnowledgeGraph=null}};s([l()],he.prototype,"decoderError",void 0),s([l()],he.prototype,"updatedKnowledgeGraph",void 0),he=s([g("esri.rest.knowledgeGraph.GraphDataModelSingletonOperationResult")],he);const Ir=he;let Fe=class extends z{constructor(t){super(t)}};Fe=s([g("esri.rest.knowledgeGraph.GraphDeleteFieldIndexResult")],Fe);const Ar=Fe;let Ne=class extends z{constructor(t){super(t)}};Ne=s([g("esri.rest.knowledgeGraph.GraphDeleteNamedTypeResult")],Ne);const Cr=Ne;let Oe=class extends z{constructor(t){super(t)}};Oe=s([g("esri.rest.knowledgeGraph.GraphDeletePropertyResult")],Oe);const Er=Oe;let qe=class extends z{constructor(t){super(t)}};qe=s([g("esri.rest.knowledgeGraph.GraphUpdateNamedTypesResult")],qe);const Mr=qe;let Le=class extends z{constructor(t){super(t)}};Le=s([g("esri.rest.knowledgeGraph.GraphUpdatePropertyResult")],Le);const Fr=Le;let Ue=class extends z{constructor(e){super(e)}};Ue=s([g("esri.rest.knowledgeGraph.GraphUpdateSearchIndexResult")],Ue);const Nr=Ue;function J(e,t){const r=[];for(let n=0;n<t;n++){const a=e.get_result_at(n);r.push({name:a.get_name(),error:T(a.get_error())})}return r}function Or(e){const t=e.get_results_count(),r=e.get_entity_type_add_results_count(),n=e.get_relationship_type_add_results_count(),a=new Rr({resultsCount:t,results:J(e,t),decoderError:T(e.error),entityAddResultsCount:r,relationshipAddResultsCount:n});for(let o=0;o<r;o++){const i=e.get_entity_type_add_results_at(o),d=i.get_name(),p=i.get_error();a.entityAddResults.push({name:d,error:T(p)})}for(let o=0;o<n;o++){const i=e.get_relationship_type_add_results_at(o),d=i.get_name(),p=i.get_error();a.relationshipAddResults.push({name:d,error:T(p)})}return a}function qr(e){const t=e.get_results_count();return new Mr({resultsCount:t,results:J(e,t),decoderError:T(e.error)})}function Lr(e){const t=e.get_results_count();return new Cr({resultsCount:t,results:J(e,t),decoderError:T(e.error)})}function Ur(e){const t=e.get_results_count();return new jr({resultsCount:t,results:J(e,t),decoderError:T(e.error)})}function Vr(e){const t=e.get_results_count();return new Er({resultsCount:t,results:J(e,t),decoderError:T(e.error)})}function zr(e){const t=e.get_results_count();return new Fr({resultsCount:t,results:J(e,t),decoderError:T(e.error)})}function Jr(e){const t=e.get_results_count();return new Nr({resultsCount:t,results:J(e,t),decoderError:T(e.error)})}function Kr(e){const t=e.get_results_count();return new Dr({resultsCount:t,results:J(e,t),decoderError:T(e.error)})}function Qr(e){const t=e.get_results_count();return new Ar({resultsCount:t,results:J(e,t),decoderError:T(e.error)})}function Ze(e){return new Ir({decoderError:T(e.error)})}let ee=class extends Z{constructor(e){super(e),this.name=null,this.supportedCategory="esriTypeUNSPECIFIED",this.analyzers=[],this.searchProperties=new Map}};s([l()],ee.prototype,"name",void 0),s([l()],ee.prototype,"supportedCategory",void 0),s([l()],ee.prototype,"analyzers",void 0),s([l()],ee.prototype,"searchProperties",void 0),ee=s([g("esri.rest.knowledgeGraph.SearchIndex")],ee);let Ve=!1;function Br(e){var r,n,a,o,i,d,p,c,y,h,v;e.deleteLater(),Ve=!1;const t=new k({timestamp:e.timestamp,spatialReference:new H(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:ne(tr,(a=(n=(r=e.identifier_info)==null?void 0:r.identifier_mapping_info)==null?void 0:n.identifier_info_type)==null?void 0:a.value),databaseNativeIdentifier:(i=(o=e.identifier_info)==null?void 0:o.identifier_mapping_info)==null?void 0:i.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:(c=(p=(d=e.identifier_info)==null?void 0:d.identifier_mapping_info)==null?void 0:p.uniform_property_identifier)==null?void 0:c.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:ne(Xt,(v=(h=(y=e.identifier_info)==null?void 0:y.identifier_generation_info)==null?void 0:h.uuid_method_hint)==null?void 0:v.value)}},searchIndexes:sn(e.search_indexes),entityTypes:dt(e.entity_types),relationshipTypes:an(e.relationship_types),metaEntityTypes:dt(e.meta_entity_types),provenanceSourceTypeValues:on(e.provenance_source_type_values.value_behavior_array),domains:dn(e)});return Ve&&Pe.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("A big integer field was detected in the retrieved data model.  The `big-integer` field type is not fully supported in web clients.  Please see https://developers.arcgis.com/javascript/latest/api-reference/esri-layers-support-Field.html#type"),t}function Wr(e){return e.deleteLater(),new we(bt(e))}function Hr(e){return e.deleteLater(),new U({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:tn(e.fields)})}function bt(e){return{name:e.name,alias:e.alias,role:ne(yt,e.role.value),strict:e.strict,properties:rn(e.properties),fieldIndexes:nn(e.field_indexes)}}function Zr(e){return e.deleteLater(),new x({alias:e.alias,name:e.name,fieldType:ne(te,e.field_type.value)??void 0,geometryType:ne(Ie,e.geometry_type.value)??null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:ne(ht,e.role.value),defaultValue:e.default_value,domain:e.domain})}function Yr(e){return e.get_domain_type().value===ot.range?new Ot({name:e.name,minValue:e.range_domain.value_at(0),maxValue:e.range_domain.value_at(1)}):e.get_domain_type().value===ot.codedValue?new qt({name:e.name,codedValues:ln(e)}):new Lt({name:e.name})}function Xr(e){e.deleteLater();const t=bt(e),r=[];for(let n=0;n<e.end_points.size();n++){const a=e.end_points.get(n);r.push({originEntityType:a.origin_entity_type,destinationEntityType:a.dest_entity_type})}return e.end_points.delete(),new ge(Object.assign({endPoints:r},t))}function en(e){return new le({behavior:e.behavior,value:e.value})}function dt(e){const t=[];for(let r=0;r<e.size();r++)t.push(Wr(e.get(r)));return e.delete(),t}function tn(e){const t=[];for(let r=0;r<e.size();r++)t.push(e.get(r));return e.delete(),t}function rn(e){const t=[];for(let r=0;r<e.size();r++){const n=Zr(e.get(r));n.fieldType==="esriFieldTypeBigInteger"&&(Ve=!0),t.push(n)}return e.delete(),t}function nn(e){const t=[];for(let r=0;r<e.size();r++)t.push(Hr(e.get(r)));return e.delete(),t}function an(e){const t=[];for(let r=0;r<e.size();r++)t.push(Xr(e.get(r)));return e.delete(),t}function on(e){const t=[];for(let r=0;r<e.size();r++){const n=e.get(r);n.deleteLater(),t.push(en(n))}return e.delete(),t}function sn(e){const t=[];for(let r=0;r<e.size();r++){const n=new ee,a=e.get(r);n.name=a.name,n.supportedCategory=ne(er,a.supported_category.value);const o=a.analyzers.size();for(let i=0;i<o;i++)n.analyzers.push({name:a.analyzers.get(i).name});a.analyzers.delete();for(let i=0;i<a.search_properties.keys().size();i++){const d=a.search_properties.keys().get(i),p=a.search_properties.get(d),c=[];for(let y=0;y<p.property_names.size();y++)c.push(p.property_names.get(y));n.searchProperties.set(d,{propertyNames:c})}t.push(n)}return e.delete(),t}function dn(e){const t=[];for(let r=0;r<e.domains_count();r++){const n=e.domain_at(r);n.deleteLater(),t.push(Yr(n))}return t}function ln(e){const t=[];for(let r=0;r<e.coded_value_domain.coded_values_count();r++){const n=e.coded_value_domain.coded_value_at(r);n.deleteLater(),t.push(new Ut({name:n.name,code:n.get_code()}))}return t}function pn(e,t){const r={spatialReference:t},n=Ye(e,r),a=e.lengths,o=e.coords,i=a[0];r.points=[];let d=0;for(let p=0;p<i;p++){const c=[];for(let y=0;y<n;y++)c[y]=o[d],d++;r.points.push(c)}return new ut(r)}function un(e,t){const r={spatialReference:t};let n=2;Ye(e,r);const a=e.coords;return r.x=a[0],r.y=a[1],e.has_z&&(r.z=a[n],n++),e.has_m&&(r.m=a[n]),new ct(r)}function cn(e,t){const{paths:r,hasM:n,hasZ:a}=Gt(e,3);return new Ke({paths:r,hasM:n,hasZ:a,spatialReference:t})}function yn(e,t){const{paths:r,hasM:n,hasZ:a}=Gt(e,4);return new Qe({rings:r,hasM:n,hasZ:a,spatialReference:t})}function Gt(e,t){const r={paths:[],hasM:!1,hasZ:!1},n=Ye(e,r),{coords:a,geometry_type:o,lengths:i}=e;if(o.value!==t)throw new u("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");let d=0;return i.forEach(p=>{const c=[];for(let y=0;y<p;y++){const h=[];for(let v=0;v<n;v++)h[v]=a[d],d++;c.push(h)}r.paths.push(c)}),r}function Ye(e,t){let r=2;return e.has_z?(t.hasZ=e.has_z,r++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,r++):t.hasM=!1,r}const be=()=>Pe.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),hn={decodedWasmObjToQueryResponseObj:(e,t,r)=>{if(e==null)return null;if(typeof e!="object"||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case 1:return un(e,r);case 2:return pn(e,r);case 3:return cn(e,r);case 4:return yn(e,r);case 5:case 7:return be().warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;default:return be().warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return be().warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case 0:return fn(e,t,r);case 1:return Tt(e,t,r);case 2:return xt(e,t,r);case 3:return wn(e,t,r);case 4:return gn(e,t,r);default:return be().warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function gn(e,t,r){const n=[],a=e.count();for(let o=0;o<a;o++){const i=e.get_value_at(o);n.push(Xe(i,t,r))}return n}function Xe(e,t,r){return hn.decodedWasmObjToQueryResponseObj(e,t,r)}function Tt(e,t,r){const n=e.type_name,a=et(e,t,r),o=e.get_id();return new Bt(Object.assign({typeName:n,id:o},a))}function et(e,t,r){const n={},a=e.key_count();for(let o=0;o<a;o++)n[e.get_key_at(o)]=Xe(e.get_value_at(o),t,r);return{properties:n}}function fn(e,t,r){return new Wt(et(e,t,r))}function wn(e,t,r){const n=e.entity_count(),a=e.relationship_count(),o=[];for(let i=0;i<n;i++)o.push(Tt(e.get_entity_at(i),t,r)),i<a&&o.push(xt(e.get_relationship_at(i),t,r));return new Ht({path:o})}function xt(e,t,r){const n=e.type_name,a=et(e,t,r);return new Zt(Object.assign({typeName:n,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},a))}function mn(e){const t=[];for(let n=0;n<e.get_header_keys().size();n++)t.push(e.get_header_keys().get(n));const r=new H(e.get_out_sr());return new V({headerKeys:t,outSpatialReference:r,exceededTransferLimit:e.exceeded_transfer_limit()})}let W=class extends Z{constructor(t){super(t),this.hasError=!1,this.error=null,this.editResults=[],this.cascadeRelationshipDeleteResults=[],this.cascadeProvenanceDeleteResults=[]}};s([l()],W.prototype,"hasError",void 0),s([l()],W.prototype,"error",void 0),s([l()],W.prototype,"editResults",void 0),s([l()],W.prototype,"cascadeRelationshipDeleteResults",void 0),s([l()],W.prototype,"cascadeProvenanceDeleteResults",void 0),W=s([g("esri.rest.knowledgeGraph.GraphApplyEditsResult")],W);const _n=W;function vn(e){const t=e.has_error(),r=new _n({hasError:t,error:t?T(e.error):null}),n=e.get_edit_results_count();for(let o=0;o<n;o++){const i=e.get_edit_results_at(o);i.deleteLater();const d=e.get_edit_results_type_name_at(o),p=[],c=[],y=[],h=i.get_add_results_count(),v=i.get_update_results_count(),D=i.get_delete_results_count();for(let _=0;_<h;_++){const S=i.get_add_result_at(_);S.deleteLater(),p.push({id:S.id,error:T(S.error)})}for(let _=0;_<v;_++){const S=i.get_update_result_at(_);S.deleteLater(),c.push({id:S.id,error:T(S.error)})}for(let _=0;_<D;_++){const S=i.get_delete_result_at(_);S.deleteLater(),y.push({id:S.id,error:T(S.error)})}r.editResults.push({typeName:d,adds:p,updates:c,deletes:y})}const a=e.get_cascaded_rel_deletes_count();for(let o=0;o<a;o++){const i=e.get_cascaded_rel_deletes_at(o);i.deleteLater();const d=e.get_cascaded_rel_deletes_type_name_at(o),p=[];for(let c=0;c<i.get_count();c++){const y=i.get_result_at(c);y.deleteLater(),p.push({id:y.id,originId:y.origin_id,destinationId:y.dest_id,error:T(y.error)})}r.cascadeRelationshipDeleteResults.push({typeName:d,cascadeRelationshipDeletes:p})}if(e.has_cascading_provenance_deletes()){const o=e.get_cascading_provenance_deletes();o.deleteLater();const i=o.get_count();for(let d=0;d<i;d++){const p=o.get_result_at(d);p.deleteLater(),r.cascadeProvenanceDeleteResults.push({id:p.id,error:T(p.error)})}}return r}const fe=new Map,bn=()=>new Map(fe.entries()),w={fetchKnowledgeGraph:async e=>{const t=new ie({url:e}),r=[];return r.push(me(t)),r.push(Pt(t)),await Promise.all(r),t},refreshDataModel:async e=>{e.dataModel=await kt(e)},refreshServiceDefinition:async e=>{var r,n;const t=(await F(e.url,{query:{f:"json"}})).data;return t.capabilities=(r=t==null?void 0:t.capabilities)==null?void 0:r.split(","),t.supportedQueryFormats=(n=t==null?void 0:t.supportedQueryFormats)==null?void 0:n.split(","),e.serviceDefinition=new G(t),e.serviceDefinition},executeFindPathsAsynchronous:async(e,t)=>{const r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new u("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /rest/services/");const n=r[0],a=(await Te(`${n}/rest/info`,{query:{f:"json"}})).data.currentVersion,o=`/rest/services/${a&&a<12?"System":"Utilities"}/KnowledgeGraphServerToolsAsync/GPServer/ServerFilteredFindPaths`;return await St(`${n}${o}`,{in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:e.config.toJSON(),result_type:"STRING"},{},t)},executeFindPaths:async(e,t)=>{const r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new u("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /rest/services/");const n=r[0],a=(await Te(`${n}/rest/info`,{query:{f:"json"}})).data.currentVersion,o=`/rest/services/${a&&a<12?"System":"Utilities"}/KnowledgeGraphServerTools/GPServer/ServerFilteredFindPaths/execute`,i=await Te(`${n}${o}`,{method:"post",query:{f:"pjson",in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:JSON.stringify(e.config),result_type:"STRING"},...t});if(i.data.results.length<1)throw new u("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results returned",i);let d;for(const p of i.data.results)if(p.paramName==="out_results_string"){d=p.value;break}if(!d)throw new u("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results were returned on the expected paramater out_results_string",i);return d},fetchAsynchronousFindPathsResultData:async(e,t)=>(await e.fetchResultData("out_results_string",null,t)).value,executeQueryStreaming:async(e,t,r)=>{var d;const n="include",a=`${e.url}/graph/query`;await j(e);const o=await R(a,r);if(!((d=e.serviceDefinition)!=null&&d.supportsProvenance)&&t.provenanceBehavior===n)throw new u("knowledge-graph:provenance-not-supported","The Knowledge Graph Service definition indicated that provenance is not supported");o.data.body=await na(t,e);const i=await $(o.data.url,o.data);if(e.dataModel){const p=await lt(i,e.dataModel);return new de({resultRowsStream:p.readableStream,resultHeader:p.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},executeApplyEdits:async(e,t,r)=>{var o;if((o=e.serviceDefinition)!=null&&o.dataEditingNotSupported)throw new u("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");const n=`${e.url}/graph/applyEdits`;await j(e);const a=await R(n,r);return a.data.body=await Kn(t,e),oa(await $(a.data.url,a.data))},executeAddNamedTypes:async(e,t,r)=>{var d,p;if(!((d=t.newEntityTypes)!=null&&d.length)&&!((p=t.newRelationshipTypes)!=null&&p.length))throw new u("knowledge-graph:no-arguments","The operation to add types to the data model contained no values");const n=`${e.url}/dataModel/edit/namedTypes/add`;await j(e);const a=await R(n,r);a.data.body=await Qn(t);const o=await $(a.data.url,a.data),i=await ia(o);return i.updatedKnowledgeGraph=await E(e.url),i},executeDeleteNamedType:async(e,t,r)=>{if(!t)throw new u("knowledge-graph:no-arguments","The operation to delete a named type from the data model contained no value");const n=`${e.url}/dataModel/edit/namedTypes/${t}/delete`;await j(e);const a=await R(n,r);a.data.body="";const o=await $(a.data.url,a.data),i=await sa(o);return i.updatedKnowledgeGraph=await E(e.url),i},executeUpdateNamedType:async(e,t,r,n)=>{if(!t&&!Object.keys(r).length)throw new u("knowledge-graph:no-arguments","The operation to update types in the data model contained missing or empty values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/update`;await j(e);const o=await R(a,n);o.data.body=await Bn(r,t,e.dataModel);const i=await $(o.data.url,o.data),d=await da(i);return d.updatedKnowledgeGraph=await E(e.url),d},executeAddGraphProperties:async(e,t,r,n)=>{if(!t&&!r.length)throw new u("knowledge-graph:no-arguments","The operation to add properties to the data model contained missing or empty values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/fields/add`;await j(e);const o=await R(a,n);o.data.body=await Wn(r);const i=await $(o.data.url,o.data),d=await la(i);return d.updatedKnowledgeGraph=await E(e.url),d},executeDeleteGraphProperty:async(e,t,r,n)=>{if(!t&&!r)throw new u("knowledge-graph:no-arguments","The operation to delete property contained missing or empty values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/fields/delete`;await j(e);const o=await R(a,n);o.data.body=await Hn(r);const i=await $(o.data.url,o.data),d=await pa(i);return d.updatedKnowledgeGraph=await E(e.url),d},executeUpdateGraphProperty:async(e,t,r,n,a)=>{if(!t&&!r&&!Object.keys(n).length)throw new u("knowledge-graph:no-arguments","The operation to update properties in the data model contained missing or empty values");const o=`${e.url}/dataModel/edit/namedTypes/${t}/fields/update`;await j(e);const i=await R(o,a);i.data.body=await Zn(r,n);const d=await $(i.data.url,i.data),p=await ua(d);return p.updatedKnowledgeGraph=await E(e.url),p},executeAddGraphFieldIndex:async(e,t,r,n)=>{if(!t)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing named type");if(!(r!=null&&r.length))throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing or empty field index values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/indexes/add`;await j(e);const o=await R(a,n);o.data.body=await Yn(r);const i=await $(o.data.url,o.data),d=await ca(i);return d.updatedKnowledgeGraph=await E(e.url),d},executeDeleteGraphFieldIndex:async(e,t,r,n)=>{if(!t)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing named type");if(!(r!=null&&r.length))throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing or empty field index values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/indexes/delete`;await j(e);const o=await R(a,n);o.data.body=await ta(r);const i=await $(o.data.url,o.data),d=await ya(i);return d.updatedKnowledgeGraph=await E(e.url),d},executeUpdateSearchIndex:async(e,t,r,n)=>{if(!t)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing named type");if(!Object.keys(r.addSearchProperties??{}).length&&!Object.keys(r.removeSearchProperties??{}).length)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing or empty properties values");const a=`${e.url}/dataModel/searchIndex/update`;await j(e);const o=await R(a,n);o.data.body=await ra(t,r);const i=await $(o.data.url,o.data),d=await ha(i);return d.updatedKnowledgeGraph=await E(e.url),d},executeAddDomain:async(e,t,r,{mergePolicy:n="esriMergePolicyTypeDefaultValue",splitPolicy:a="esriSplitPolicyTypeDefaultValue"},o)=>{const i=`${e.url}/dataModel/domains/add`;await j(e);const d=await R(i,o);d.data.body=await Xn(t,r,{mergePolicy:n,splitPolicy:a});const p=await $(d.data.url,d.data),c=await ga(p);return c.updatedKnowledgeGraph=await E(e.url),c},executeUpdateDomain:async(e,t,r,n,a)=>{const o=`${e.url}/dataModel/domains/${t.name}/update`;await j(e);const i=await R(o,a);i.data.body=await ea(t,r,n);const d=await $(i.data.url,i.data),p=await fa(d);return p.updatedKnowledgeGraph=await E(e.url),p},executeDeleteDomain:async(e,t,r)=>{const n=`${e.url}/dataModel/domains/${t}/delete`;if(!t)throw new u("knowledge-graph:no-arguments","The operation to delete a domain from the data model contained missing or empty domain name");await j(e);const a=await R(n,r);a.data.body="";const o=await $(a.data.url,a.data),i=await wa(o);return i.updatedKnowledgeGraph=await E(e.url),i},executeQuery:async(e,t,r)=>{var d;const n=`${e.url}/graph/query`,a=await F(n,{responseType:"array-buffer",query:{f:"pbf",openCypherQuery:t.openCypherQuery,...r==null?void 0:r.query},signal:r==null?void 0:r.signal,timeout:r==null?void 0:r.timeout}),o=(d=a.getHeader)==null?void 0:d.call(a,"content-type"),i=a.data;if(o!=null&&o.includes("application/x-protobuf")){const p=new(await f()).GraphQueryDecoder;if(p.deleteLater(),e.dataModel){const c=ze({wasmQueryDecoder:p,newArrayBufferToParse:i,dataModel:e.dataModel});return new se({resultRows:c.resultRows,resultHeader:c.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:a.data})},executeSearch:async(e,t,r)=>{var p;const n=t.typeCategoryFilter==="provenance"?"metaEntityProvenance":t.typeCategoryFilter,a=`${e.url}/graph/search`,o=await F(a,{responseType:"array-buffer",query:{f:"pbf",searchQuery:`"${t.searchQuery}"`,typeCategoryFilter:n,...r==null?void 0:r.query},signal:r==null?void 0:r.signal,timeout:r==null?void 0:r.timeout}),i=(p=o.getHeader)==null?void 0:p.call(o,"content-type"),d=o.data;if(i!=null&&i.includes("application/x-protobuf")){const c=new(await f()).GraphQueryDecoder;if(c.deleteLater(),e.dataModel){const y=ze({wasmQueryDecoder:c,newArrayBufferToParse:d,dataModel:e.dataModel});return new se({resultRows:y.resultRows,resultHeader:y.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:i,data:o.data})},executeSearchStreaming:async(e,t,r)=>{const n=`${e.url}/graph/search`;await j(e);const a=await R(n,r);a.data.body=await aa(t);const o=await $(a.data.url,a.data);if(e.dataModel){const i=await lt(o,e.dataModel);return new de({resultRowsStream:i.readableStream,resultHeader:i.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},fetchClientDataAtKeys:async(e,t,r={ignoreCache:!1})=>{if(!t.length)return new Map;let n=fe.get(e.url||"");n||(n=new Map,fe.set(e.url||"",n));const a=new Map(n.entries()),o=`${e.url}/clientData/fetch`;t=Array.from(new Set(t));const i=await f(),d=ur(t,n,i,r.ignoreCache),p=await R(o,r.requestOptions);p.data.body=d;const c=await $(p.data.url,p.data),y=c.headers.get("content-type");if(y!=null&&y.includes("application/x-protobuf")){const h=new i.ClientDataFetchResponseDecoder;h.deleteLater();const v=await c.arrayBuffer();return h.decode(new Uint8Array(v)),h.has_error()&&P(h.error,"knowledge-graph:fetchClientDataAtKeys-decoding-error","An error occurred while decoding the client data keys response"),$r(h,n,a,r.ignoreCache)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response when fetching client data",{responseType:y,data:c})},fetchAllClientDataKeys:async(e,t)=>{var i;const r=`${e.url}/clientData`,n=await F(r,{responseType:"array-buffer",query:{f:"pbf"},signal:t==null?void 0:t.signal,timeout:t==null?void 0:t.timeout}),a=(i=n.getHeader)==null?void 0:i.call(n,"content-type"),o=n.data;if(a!=null&&a.includes("application/x-protobuf")){const d=new(await f()).ClientDataKeysResponseDecoder;return d.deleteLater(),d.decode(new Uint8Array(o)),d.has_error()&&P(d.error,"knowledge-graph:fetchAllClientDataKeys-decoding-error","An error occurred while decoding the client data keys response"),kr(d)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:a,data:n.data})},clearClientDataCache:()=>fe.clear(),_fetchWrapper:async(e,t)=>fetch(e,t),_submitJobWrapper:async(e,t,r,n)=>pr(e,t,r,n),_esriRequestWrapper:async(e,t)=>F(e,t)};async function Gn(e,t,r){return w.executeApplyEdits(e,t,r)}async function Tn(e,t,r){return w.executeAddNamedTypes(e,t,r)}async function xn(e,t,r){return w.executeDeleteNamedType(e,t,r)}async function Pn(e,t,r,n){return w.executeUpdateNamedType(e,t,r,n)}async function Sn(e,t,r,n){return w.executeAddGraphProperties(e,t,r,n)}async function $n(e,t,r,n){return w.executeDeleteGraphProperty(e,t,r,n)}async function kn(e,t,r,n,a){return w.executeUpdateGraphProperty(e,t,r,n,a)}async function Dn(e,t,r,n){return w.executeAddGraphFieldIndex(e,t,r,n)}async function Rn(e,t,r,n){return w.executeDeleteGraphFieldIndex(e,t,r,n)}async function jn(e,t,r,n){return w.executeUpdateSearchIndex(e,t,r,n)}async function In(e,t,r){return w.executeQuery(e,t,r)}async function An(e,t,r){return w.executeQueryStreaming(e,t,r)}async function Cn(e,t,r){return w.executeSearch(e,t,r)}async function En(e,t,r){return w.executeSearchStreaming(e,t,r)}function Mn(e,t){return w.fetchAllClientDataKeys(e,t)}function Fn(e,t,r){return w.fetchClientDataAtKeys(e,t,r)}async function E(e){return w.fetchKnowledgeGraph(e)}async function me(e){return w.refreshDataModel(e)}async function Pt(e){return w.refreshServiceDefinition(e)}async function Nn(e,t){return w.executeFindPathsAsynchronous(e,t)}async function On(e,t){return w.executeFindPaths(e,t)}async function qn(e,t){return w.fetchAsynchronousFindPathsResultData(e,t)}async function Ln(e,t,r,n={mergePolicy:"esriMergePolicyTypeDefaultValue",splitPolicy:"esriSplitPolicyTypeDefaultValue"},a){return w.executeAddDomain(e,t,r,n,a)}async function Un(e,t,r,n,a){return w.executeUpdateDomain(e,t,r,n,a)}async function Vn(e,t,r){return w.executeDeleteDomain(e,t,r)}function zn(){return w.clearClientDataCache()}async function $(e,t){return w._fetchWrapper(e,t)}async function St(e,t,r,n){return w._submitJobWrapper(e,t,r,n)}async function Te(e,t){return w._esriRequestWrapper(e,t)}async function j(e){var r;((r=Vt)==null?void 0:r.findCredential(e.url))||(e.dataModel?await kt(e):await me(e))}function Jn(e,t,r,n){t==null?r.set_param_key_value(e,""):typeof t!="object"||t instanceof Date?r.set_param_key_value(e,t):t instanceof Je?r.set_param_key_value(e,We(t,n)):Array.isArray(t)?r.set_param_key_value(e,gt(t,n)):r.set_param_key_value(e,ft(t,n))}async function Kn(e,t){var d,p,c,y,h,v,D,_,S,K;if(t.dataModel||await me(t),!t.dataModel)throw new u("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");const r=await f(),n=!!((d=e.options)!=null&&d.cascadeDelete),a=!!((p=e.options)!=null&&p.cascadeProvenanceDelete),o=new r.GraphApplyEditsEncoder(r.SpatialReferenceUtil.WGS84(),(c=e.options)!=null&&c.inputQuantizationParameters?vr((y=e.options)==null?void 0:y.inputQuantizationParameters):r.InputQuantizationUtil.WGS84_lossless());o.deleteLater(),o.cascade_delete=n,o.cascade_delete_provenance=a;try{let m;(h=e.entityAdds)==null||h.forEach(b=>{m=o.add_entity(ve(b,r)),P(m,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),(v=e.relationshipAdds)==null||v.forEach(b=>{if(!b.originId||!b.destinationId)throw new u("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");m=o.add_relationship(ve(b,r)),P(m,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),(D=e.entityUpdates)==null||D.forEach(b=>{if(!b.id)throw new u("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");m=o.update_entity(ve(b,r)),P(m,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),(_=e.relationshipUpdates)==null||_.forEach(b=>{if(!b.id)throw new u("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");m=o.update_relationship(ve(b,r)),P(m,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),(S=e.entityDeletes)==null||S.forEach(b=>{var C;if(!b.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const Q=o.make_delete_helper(b.typeName,!0);Q.deleteLater(),(C=b.ids)==null||C.forEach(ue=>{Q.delete_by_id(ue)})}),(K=e.relationshipDeletes)==null||K.forEach(b=>{var C;if(!b.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const Q=o.make_delete_helper(b.typeName,!1);(C=b.ids)==null||C.forEach(ue=>{Q.delete_by_id(ue)})}),o.encode()}catch(m){throw new u("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:m})}const i=o.get_encoding_result();return P(i.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),structuredClone(i.get_byte_buffer())}async function Qn(e){var a,o;const t=await f(),r=new t.GraphNamedObjectTypeAddsRequestEncoder;r.deleteLater(),(a=e.newEntityTypes)==null||a.forEach(i=>{r.add_entity_type(br(i,t))}),(o=e.newRelationshipTypes)==null||o.forEach(i=>{r.add_relationship_type(Gr(i,t))});try{r.encode()}catch(i){throw new u("knowledge-graph:addNamedTypes-encoding-failed","Attempting to encode the addNamedTypes failed",{error:i})}const n=r.get_encoding_result();return P(n.error,"knowledge-graph:addNamedTypes-encoding-failed","Attempting to encode the addNamedTypes failed"),structuredClone(n.get_byte_buffer())}async function Bn(e,t,r){const n=await f(),a=new n.GraphNamedObjectTypeUpdateRequestEncoder;if(a.deleteLater(),r.entityTypes.some(i=>i.name===t))a.update_entity_type(Tr(e,n));else{if(!r.relationshipTypes.some(i=>i.name===t))throw new u("knowledge-graph:updateNamedType-encoding-failed","The named type you are trying to update does not exist in the data model");a.update_relationship_type(xr(e,n))}a.update_alias=e.hasOwnProperty("alias");try{a.encode()}catch(i){throw new u("knowledge-graph:updateNamedType-encoding-failed","Attempting to encode the updateNamedType failed",{error:i})}const o=a.get_encoding_result();return P(o.error,"knowledge-graph:updateNamedType-encoding-failed","Attempting to encode the updateNamedType failed"),structuredClone(o.get_byte_buffer())}async function Wn(e){const t=await f(),r=new t.GraphPropertyAddsRequestEncoder;r.deleteLater(),e.forEach(a=>{r.add_graph_property(wt(a,t))});try{r.encode()}catch(a){throw new u("knowledge-graph:addGraphProperties-encoding-failed","Attempting to encode the addGraphProperties failed",{error:a})}const n=r.get_encoding_result();return P(n.error,"knowledge-graph:addGraphProperties-encoding-failed","Attempting to encode the addGraphProperties failed"),structuredClone(n.get_byte_buffer())}async function Hn(e){const t=new(await f()).GraphPropertyDeleteRequestEncoder;t.deleteLater(),t.field_name=e;try{t.encode()}catch(n){throw new u("knowledge-graph:deleteGraphProperty-encoding-failed","Attempting to encode the deleteGraphProperty failed",{error:n})}const r=t.get_encoding_result();return P(r.error,"knowledge-graph:deleteGraphProperty-encoding-failed","Attempting to encode the deleteGraphProperty failed"),structuredClone(r.get_byte_buffer())}async function Zn(e,t){const r=await f(),n=new r.GraphPropertyUpdateRequestEncoder;n.deleteLater(),n.update_graph_property(Pr(t,r)),n.set_property_name(e),n.update_alias=t.hasOwnProperty("alias"),n.update_editable=t.hasOwnProperty("editable"),n.update_required=t.hasOwnProperty("required"),n.update_visible=t.hasOwnProperty("defaultVisibility"),n.update_default_value=t.hasOwnProperty("defaultValue"),n.update_domain=t.hasOwnProperty("domain");try{n.encode()}catch(o){throw new u("knowledge-graph:updateGraphProperty-encoding-failed","Attempting to encode the updateGraphProperty failed",{error:o})}const a=n.get_encoding_result();return P(a.error,"knowledge-graph:updateGraphProperty-encoding-failed","Attempting to encode the updateGraphProperty failed"),structuredClone(a.get_byte_buffer())}async function Yn(e){const t=await f(),r=new t.GraphIndexAddsRequestEncoder;r.deleteLater(),e.forEach(a=>{r.add_field_index(Sr(a,t))});try{r.encode()}catch(a){throw new u("knowledge-graph:addGraphFieldIndex-encoding-failed","Attempting to encode the addGraphFieldIndex failed",{error:a})}const n=r.get_encoding_result();return P(n.error,"knowledge-graph:addGraphFieldIndex-encoding-failed","Attempting to encode the addGraphFieldIndex failed"),structuredClone(n.get_byte_buffer())}async function Xn(e,t,r){const n=await f(),a=new n.GraphDomainAddRequestEncoder;a.deleteLater(),a.set_domain(mt(e,n,t,r));try{a.encode()}catch(i){throw new u("knowledge-graph:addDomain-encoding-failed","Attempting to encode the domain failed",{error:i})}const o=a.get_encoding_result();return P(o.error,"knowledge-graph:addDomain-encoding-failed","Attempting to encode the domain failed"),structuredClone(o.get_byte_buffer())}async function ea(e,t,r){const n=await f(),a=new n.GraphDomainUpdateRequestEncoder;a.deleteLater(),a.set_domain(mt(e,n,t,r)),a.update_domain=!0,r!=null&&r.mergePolicy&&(a.update_merge_policy=!0),r!=null&&r.splitPolicy&&(a.update_split_policy=!0);try{a.encode()}catch(i){throw new u("knowledge-graph:updateDomain-encoding-failed","Attempting to encode the domain failed",{error:i})}const o=a.get_encoding_result();return P(o.error,"knowledge-graph:updateDomain-encoding-failed","Attempting to encode the domain failed"),structuredClone(o.get_byte_buffer())}async function ta(e){const t=new(await f()).GraphIndexDeleteRequestEncoder;t.deleteLater(),e.forEach(n=>{t.add_index_name(n)});try{t.encode()}catch(n){throw new u("knowledge-graph:deleteGraphFieldIndex-encoding-failed","Attempting to encode the deleteGraphFieldIndex failed",{error:n})}const r=t.get_encoding_result();return P(r.error,"knowledge-graph:deleteGraphFieldIndex-encoding-failed","Attempting to encode the deleteGraphFieldIndex failed"),structuredClone(r.get_byte_buffer())}async function ra(e,t){const r=await f(),n=new r.GraphUpdateSearchIndexRequestEncoder;n.deleteLater(),t.hasOwnProperty("addSearchProperties")&&n.insert_add_search_property(e,st(t.addSearchProperties,r)),t.hasOwnProperty("removeSearchProperties")&&n.insert_delete_search_property(e,st(t.removeSearchProperties,r));try{n.encode()}catch(o){throw new u("knowledge-graph:updateSearchIndex-encoding-failed","Attempting to encode the updateSearchIndex failed",{error:o})}const a=n.get_encoding_result();return P(a.error,"knowledge-graph:updateSearchIndex-encoding-failed","Attempting to encode the updateSearchIndex failed"),structuredClone(a.get_byte_buffer())}async function na(e,t){var o,i;const r=await f(),n=new r.GraphQueryRequestEncoder;if(n.deleteLater(),e.outputSpatialReference?n.output_spatial_reference={wkid:e.outputSpatialReference.wkid,latestWkid:e.outputSpatialReference.latestWkid,vcsWkid:e.outputSpatialReference.vcsWkid,latestVcsWkid:e.outputSpatialReference.latestVcsWkid,wkt:e.outputSpatialReference.wkt??""}:n.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),n.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[d,p]of Object.entries(e.bindParameters))Jn(d,p,n,r);if(e.bindGeometryQuantizationParameters)hr(e.bindGeometryQuantizationParameters,n);else{if(t.dataModel||await me(t),((i=(o=t.dataModel)==null?void 0:o.spatialReference)==null?void 0:i.wkid)!==4326)throw new u("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");n.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&gr(e.outputQuantizationParameters,n,r),e.provenanceBehavior&&fr(e.provenanceBehavior,n);try{n.encode()}catch(d){throw new u("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:d})}const a=n.get_encoding_result();if(a.error.error_code!==0)throw new u("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:a.error.error_code,errorMessage:a.error.error_message});return structuredClone(a.get_byte_buffer())}async function aa(e){var o;const t=await f(),r=new t.GraphSearchRequestEncoder;r.deleteLater(),r.search_query=e.searchQuery;const n=e.typeCategoryFilter==="provenance"?"meta_entity_provenance":e.typeCategoryFilter;if(r.type_category_filter=t.esriNamedTypeCategory[n],e.returnSearchContext===!0&&(r.return_search_context=e.returnSearchContext),e.start!=null&&e.start>0&&(r.start_index=e.start),e.num!=null&&(r.max_num_results=e.num),e.idsFilter!=null&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{r.set_ids_filter(gt(e.idsFilter,t))}catch(i){throw new u("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:i})}(o=e.namedTypesFilter)==null||o.forEach(i=>{r.add_named_type_filter(i)});try{r.encode()}catch(i){throw new u("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:i})}const a=r.get_encoding_result();if(a.error.error_code!==0)throw new u("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:a.error.error_code,errorMessage:a.error.error_message});return structuredClone(a.get_byte_buffer())}async function R(e,t){return F(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...t==null?void 0:t.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t==null?void 0:t.signal,timeout:t==null?void 0:t.timeout})}async function M(e,t,r){const n=e.headers.get("content-type");if(n!=null&&n.includes("application/x-protobuf")){const a=await e.arrayBuffer(),o=new t;try{return o.decode(new Uint8Array(a)),r(o)}finally{o.deleteLater()}}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:await e.text()})}async function oa(e){return M(e,(await f()).GraphApplyEditsDecoder,vn)}async function ia(e){return M(e,(await f()).GraphNamedObjectTypeAddsResponseDecoder,Or)}async function sa(e){return M(e,(await f()).GraphNamedObjectTypeDeleteResponseDecoder,Lr)}async function da(e){return M(e,(await f()).GraphNamedObjectTypeUpdateResponseDecoder,qr)}async function la(e){return M(e,(await f()).GraphPropertyAddsResponseDecoder,Ur)}async function pa(e){return M(e,(await f()).GraphPropertyDeleteResponseDecoder,Vr)}async function ua(e){return M(e,(await f()).GraphPropertyUpdateResponseDecoder,zr)}async function ca(e){return M(e,(await f()).GraphIndexAddsResponseDecoder,Kr)}async function ya(e){return M(e,(await f()).GraphIndexDeleteResponseDecoder,Qr)}async function ha(e){return M(e,(await f()).GraphUpdateSearchIndexResponseDecoder,Jr)}async function ga(e){return M(e,(await f()).GraphDomainAddResponseDecoder,Ze)}async function fa(e){return M(e,(await f()).GraphDomainUpdateResponseDecoder,Ze)}async function wa(e){return M(e,(await f()).GraphDomainDeleteResponseDecoder,Ze)}let $t=50;function ma(e){$t=e}function ze({wasmQueryDecoder:e,newArrayBufferToParse:t,dataModel:r,decodedHeader:n,limitMaxProcessingTime:a=!1}){t&&e.push_buffer(new Uint8Array(t));const o=[];let i,d,p=0;const c=Date.now();let y=!0;for(;e.next_row();){i&&d||(i=n??mn(e),d=i.outSpatialReference??new H({wkid:4326})),p||(p=e.get_header_keys().size());const h=new Array(p);for(let v=0;v<p;v++){const D=e.get_value(v);h[v]=Xe(D,r,d)}if(o.push(h),a&&Date.now()-c>$t){y=!1;break}}if(e.has_error())throw new u("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - inner row decoding",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return{resultHeader:i,resultRows:o,parsedAllResultsFromBuffer:y}}async function lt(e,t){var n;const r=e.headers.get("content-type");if(e.headers.get("content-length")&&Pe.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),r==null?void 0:r.includes("application/x-protobuf")){const a=(n=e.body)==null?void 0:n.getReader(),o=new(await f()).GraphQueryDecoder;let i,d,p;o.deleteLater();const c=new Promise((D,_)=>{d=D,p=_});let y=!1,h=null;return{readableStream:new ReadableStream({pull:async function D(_){if(!a){const m=new u("knowledge-graph:stream-decoding-error","Error reading from stream - reader is undefined");throw p(m),m}const{done:S,value:K}=h?{done:!1,value:null}:await a.read().catch(m=>{throw p(m),a.releaseLock(),m});K&&(h=K);try{if(S){let C;if(o.has_error()?C=new u("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - query stream done",{errorCode:o.error.error_code,errorMessage:o.error.error_message}):y||d(new V),a.releaseLock(),C)throw _.error(C),p(C),C;return void _.close()}const{resultHeader:m,resultRows:b,parsedAllResultsFromBuffer:Q}=ze({wasmQueryDecoder:o,newArrayBufferToParse:K,dataModel:t,decodedHeader:i,limitMaxProcessingTime:!0});return Q&&(h=null),!i&&m&&(i=m,d(m),y=!0),b.length>0?void _.enqueue(b):await D(_)}catch(m){throw Pe.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").error(m),p(m),a.releaseLock(),zt(m)?m:new u("knowledge-graph:unexpected-server-response","Error inside streaming data return parsing",{error:m})}}}),resultHeader:await c}}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:e.text()})}async function kt(e){var o;const t=`${e.url}/dataModel/queryDataModel`,r=await F(t,{responseType:"array-buffer",query:{f:"pbf"}}),n=(o=r.getHeader)==null?void 0:o.call(r,"content-type"),a=r.data;if(n!=null&&n.includes("application/x-protobuf")){const i=(await f()).decode_data_model_from_protocol_buffer(new Uint8Array(a));if(!i)throw new u("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return Br(i)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:r.data})}const Ha=Object.freeze(Object.defineProperty({__proto__:null,_checkAuthentication:j,_esriRequestWrapper:Te,_fetchWrapper:$,_getClientDataCacheCopy:bn,_setMaxQueryParsingDurationForTesting:ma,_submitJobWrapper:St,clearClientDataCache:zn,clientDataCache:fe,executeAddDomain:Ln,executeAddGraphFieldIndex:Dn,executeAddGraphProperties:Sn,executeAddNamedTypes:Tn,executeApplyEdits:Gn,executeDeleteDomain:Vn,executeDeleteGraphFieldIndex:Rn,executeDeleteGraphProperty:$n,executeDeleteNamedType:xn,executeFindPaths:On,executeFindPathsAsynchronous:Nn,executeQuery:In,executeQueryStreaming:An,executeSearch:Cn,executeSearchStreaming:En,executeUpdateDomain:Un,executeUpdateGraphProperty:kn,executeUpdateNamedType:Pn,executeUpdateSearchIndex:jn,fetchAllClientDataKeys:Mn,fetchAsynchronousFindPathsResultData:qn,fetchClientDataAtKeys:Fn,fetchKnowledgeGraph:E,kgRestServices:w,refreshDataModel:me,refreshServiceDefinition:Pt},Symbol.toStringTag,{value:"Module"}));export{Gn as X,An as c,Fn as h,Ie as i,Ha as k,f as n,te as r,E as w};
