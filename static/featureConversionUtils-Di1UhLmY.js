import{bP as tt,bQ as et,bR as nt,bS as ot,a as $,bT as P,bU as T,aF as rt,bV as F,bW as st,bX as ut,bY as it,bZ as ct}from"./index-C_bK48d2.js";import{o as E,e as lt}from"./OptimizedFeatureSet-BZnZXZq6.js";import{s as Z}from"./OptimizedGeometry-KE6YknPZ.js";const L=()=>rt.getLogger("esri.layers.graphics.featureConversionUtils"),Y={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0};function at({scale:t,translate:n},e){return Math.round((e-n[0])/t[0])}function ft({scale:t,translate:n},e){return Math.round((n[1]-e)/t[1])}function U({scale:t,translate:n},e){return Math.round((e-n[0])/t[0])}function R({scale:t,translate:n},e){return Math.round((e-n[1])/t[1])}function S({scale:t,translate:n},e,o){return e*t[o]+n[o]}function _(t,n,e){return n&&(t.hasZ=!0),e&&(t.hasM=!0),t}function N(t,n,e,o){if(n&&o&&t!==e)return(s,i,c,l)=>{c[l++]=s[i++],c[l++]=s[i++],t?i++:c[l++]=0,c[l++]=s[i++]??0};const r=2+(e?1:0)+(o?1:0),u=r-((!t&&e?1:0)+(!n&&o?1:0));return(s,i,c,l)=>{for(let f=0;f<r;++f)c[l++]=f<u?s[i++]??0:0}}function q(t,n,e){if(!t)return null;const{coords:o,hasZ:r,hasM:u}=t,[s,i]=o,c=r?o[2]:0,l=u?o[2+(r?1:0)]:0;return{x:s,y:i,z:n?c:void 0,m:e?l:void 0}}function ht(t,n,e,o){for(const{geometry:r,attributes:u}of n)t.push({attributes:u,geometry:q(r,e,o)});return t}function mt(t,n,e,o,r){for(const u of n){const{geometry:s,attributes:i,centroid:c}=u,l=P(s),f=T(s);t.push(new E(s?x(s,e&&l,o&&f):null,i,c?x(c,!1,!1):null,F(u,r)))}return t}function x(t,n=P(t),e=T(t)){const{x:o,y:r,z:u,m:s}=t,i=[o,r];return n&&i.push(u??0),e&&i.push(s??0),new Z([],i,n,e)}function dt(t,n,e,o){for(const{geometry:r,attributes:u}of n)t.push({geometry:r&&W(r,e,o),attributes:u});return t}function W(t,n,e){if(t==null)return null;const{coords:o,stride:r,hasZ:u,hasM:s}=t,i=N(u,s,n,e),c=[];for(let l=0;l<o.length;l+=r){const f=[];i(o,l,f,0),c.push(f)}return _({points:c},n,e)}function gt(t,n,e,o,r){for(const u of n){const{geometry:s,attributes:i}=u,c=P(s),l=T(s);t.push(new E(s?X(s,e&&c,o&&l):null,i,null,F(u,r)))}return t}function X(t,n=P(t),e=T(t)){const{points:o,hasZ:r,hasM:u}=t,s=new Z([o.length],[],n,e),{coords:i,stride:c}=s;let l=0;const f=N(r??!1,u??!1,n,e);for(const a of o)f(a,0,i,l),l+=c;return s}function yt(t,n,e,o){for(const{geometry:r,attributes:u}of n)t.push({geometry:r&&j(r,e,o),attributes:u});return t}function j(t,n,e){if(!t)return null;const{coords:o,lengths:r,stride:u,hasZ:s,hasM:i}=t;let c=0;const l=N(s,i,n,e),f=[];for(const a of r){const h=[];for(let m=0;m<a;m++){const d=[];l(o,c,d,0),c+=u,h.push(d)}f.push(h)}return _({paths:f},n,e)}function pt(t,n,e,o,r){for(const u of n){const{geometry:s,attributes:i,centroid:c}=u,l=P(s),f=T(s);t.push(new E(s?B(s,e&&l,o&&f):null,i,c?x(c,!1,!1):null,F(u,r)))}return t}function B(t,n=P(t),e=T(t)){const{paths:o,hasZ:r,hasM:u}=t,s=N(r??!1,u??!1,n,e),i=new Z([],[],n,e),{lengths:c,coords:l,stride:f}=i;let a=0;for(const h of o){for(const m of h)s(m,0,l,a),a+=f;c.push(h.length)}return i}function bt(t,n,e,o){for(const{geometry:r,attributes:u,centroid:s}of n){const i=D(r,e,o),c=q(s,!1,!1);t.push(s?{geometry:i,attributes:u,centroid:c}:{geometry:i,attributes:u})}return t}function D(t,n,e){if(!t)return null;const{coords:o,lengths:r,stride:u,hasZ:s,hasM:i}=t;let c=0;const l=N(s,i,n,e),f=[];for(const a of r){const h=[];for(let m=0;m<a;m++){const d=[];l(o,c,d,0),c+=u,h.push(d)}f.push(h)}return _({rings:f},n,e)}function wt(t,n,e,o,r){for(const u of n){const{geometry:s,attributes:i,centroid:c}=u,l=P(s),f=T(s);t.push(new E(s?H(s,e&&l,o&&f):null,i,c?x(c,!1,!1):null,F(u,r)))}return t}function H(t,n=P(t),e=T(t)){const{rings:o,hasZ:r,hasM:u}=t,s=new Z([],[],n,e),{lengths:i,coords:c,stride:l}=s;let f=0;const a=N(r??!1,u??!1,n,e);for(const h of o){for(const m of h)a(m,0,c,f),f+=l;i.push(h.length)}return s}const v=[],k=[];function xt(t,n,e,o,r){v[0]=t;const[u]=J(k,v,n,e,o,r);return M(v),M(k),u}function J(t,n,e,o,r,u){if(M(t),!e){for(const s of n){const i=F(s,u);t.push(new E(null,s.attributes,null,i))}return t}switch(e){case"esriGeometryPoint":return mt(t,n,o,r,u);case"esriGeometryMultipoint":return gt(t,n,o,r,u);case"esriGeometryPolyline":return pt(t,n,o,r,u);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return wt(t,n,o,r,u);default:L().error("convertToFeatureSet:unknown-geometry",new $("internal:geometry",`Unable to parse unknown geometry type '${e}'`)),M(t)}return t}function Ft(t,n,e,o){k[0]=t,K(v,k,n,e,o);const r=v[0];return M(v),M(k),r}function Et(t,n=P(t),e=T(t)){return t==null?null:tt(t)?x(t,n,e):et(t)?H(t,n,e):nt(t)?B(t,n,e):ot(t)?X(t,n,e):void L().error("convertFromGeometry:unknown-geometry",new $("internal:geometry",`Unable to parse unknown geometry type '${t}'`))}function Gt(t,n,e,o){if(t==null)return null;const r="coords"in t?t:t.geometry;if(r==null)return null;switch(n){case"esriGeometryPoint":return q(r,e,o);case"esriGeometryMultipoint":return W(r,e,o);case"esriGeometryPolyline":return j(r,e,o);case"esriGeometryPolygon":return D(r,e,o);default:return L().error("convertToGeometry:unknown-geometry",new $("internal:geometry",`Unable to parse unknown geometry type '${n}'`)),null}}function Mt(t,n){for(const e of n)t.push({attributes:e.attributes});return t}function K(t,n,e,o,r){if(M(t),e==null)return Mt(t,n);switch(e){case"esriGeometryPoint":return ht(t,n,o,r);case"esriGeometryMultipoint":return dt(t,n,o,r);case"esriGeometryPolyline":return yt(t,n,o,r);case"esriGeometryPolygon":return bt(t,n,o,r);default:L().error("convertToFeatureSet:unknown-geometry",new $("internal:geometry",`Unable to parse unknown geometry type '${e}'`))}return t}function $t(t){const{spatialReference:n,transform:e,fields:o,hasM:r,hasZ:u,features:s,geometryType:i,exceededTransferLimit:c,queryGeometry:l,queryGeometryType:f}=t,a={features:K([],s,i,u,r),fields:o,geometryType:i,spatialReference:n,queryGeometry:Gt(l,f,u,r)};return e&&(a.transform=e),c&&(a.exceededTransferLimit=c),r&&(a.hasM=r),u&&(a.hasZ=u),a}function Lt(t,n){const e=new lt,{hasM:o,hasZ:r,features:u,spatialReference:s,geometryType:i,exceededTransferLimit:c,transform:l,fields:f}=t;return f&&(e.fields=f),e.geometryType=i??null,e.spatialReference=s??null,u&&J(e.features,u,i,r,o,n),c&&(e.exceededTransferLimit=c),o&&(e.hasM=o),r&&(e.hasZ=r),l&&(e.transform=l),e}function Ut(t){const{transform:n,features:e}=t;if(!n)return t;for(const o of e)o.geometry!=null&&Q(o.geometry,n),o.centroid!=null&&Q(o.centroid,n);return t.transform=null,t}function Rt(t,n){const{geometryType:e,features:o}=n;if(!t)return n;for(let r=0;r<o.length;r++){const u=o[r],s=u.weakClone();s.geometry=O(u.geometry,e,t),s.centroid=O(u.centroid,"esriGeometryPoint",t),o[r]=s}return n.transform=t,n}function O(t,n,e,o,r){if(t==null||!(t!=null&&t.coords.length))return null;const u=Y[n],{coords:s,lengths:i,stride:c,hasZ:l,hasM:f}=t;o??(o=l),r??(r=f);const a=new Z([],[],o,r),h=a.stride,m=N(l,f,o,r);let d=0;const y=[0,0,0,0].slice(h);function g(){m(s,d,y,0),d+=c,y[0]=at(e,y[0]),y[1]=ft(e,y[1])}if(t.isPoint)return g(),a.coords.push(...y),a;let p=0;for(const G of i){if(G<u)continue;let b=1;g(),a.coords.push(...y);let[w,I]=y;for(let C=1;C<G;C++){g();const[z,A]=y;w===z&&I===A||(y[0]-=w,y[1]-=I,a.coords.push(...y),w=z,I=A,b++)}b>=u?(a.lengths.push(b),p=a.coords.length):M(a.coords,p)}return M(a.coords,p),a.coords.length?a:null}function St(t,n,e,o=t.hasZ,r=t.hasM){if(!t.coords.length)return null;const u=Y[n],{coords:s,lengths:i,stride:c,hasZ:l,hasM:f}=t,a=new Z([],[],o,r),h=a.stride,m=N(l,f,o,r);if(t.isPoint)return m(s,0,a.coords,0),a;let d=0;const y=e*e;for(const g of i){if(g<u){d+=g*c;continue}const p=a.coords.length/h,G=d,b=d+(g-1)*c;m(s,G,a.coords,a.coords.length),V(a.coords,s,c,y,m,G,b),m(s,b,a.coords,a.coords.length);const w=a.coords.length/h-p;w>=u?a.lengths.push(w):M(a.coords,p*h),d+=g*c}return a.coords.length?a:null}function Pt(t,n,e,o){const r=t[n],u=t[n+1],s=t[e],i=t[e+1],c=t[o],l=t[o+1];let f=s,a=i,h=c-f,m=l-a;if(h!==0||m!==0){const d=((r-f)*h+(u-a)*m)/(h*h+m*m);d>1?(f=c,a=l):d>0&&(f+=h*d,a+=m*d)}return h=r-f,m=u-a,h*h+m*m}function V(t,n,e,o,r,u,s){let i,c=o,l=0;for(let f=u+e;f<s;f+=e)i=Pt(n,f,u,s),i>c&&(l=f,c=i);c>o&&(l-u>e&&V(t,n,e,o,r,u,l),r(n,l,t,t.length),s-l>e&&V(t,n,e,o,r,l,s))}function Vt(t,n){var s;if(!((s=n==null?void 0:n.coords)!=null&&s.length))return null;let e=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(n&&n.coords){const{coords:i,stride:c}=n;for(let l=0;l<i.length;l+=c){const f=i[l],a=i[l+1];e=Math.min(e,f),r=Math.max(r,f),o=Math.min(o,a),u=Math.max(u,a)}}return st(t)?ut(t,e,o,r,u):it(e,o,r,u,t),t}function Q(t,n){const{coords:e,lengths:o,stride:r}=t;if(!e.length)return void(o.length=0);ct(n);const{originPosition:u,scale:s,translate:i}=n,c=Zt;c.originPosition=u;const l=c.scale;l[0]=s[0]??1,l[1]=-(s[1]??1),l[2]=s[2]??1,l[3]=s[3]??1;const f=c.translate;if(f[0]=i[0]??0,f[1]=i[1]??0,f[2]=i[2]??0,f[3]=i[3]??0,!o.length){for(let h=0;h<r;++h)e[h]=S(c,e[h],h);return void(o.length=0)}let a=0;for(let h=0;h<o.length;h++){const m=o[h];o[h]=m;for(let g=0;g<r;++g)e[a+g]=S(c,e[a+g],g);let d=e[a],y=e[a+1];a+=r;for(let g=1;g<m;g++,a+=r){d+=e[a]*l[0],y+=e[a+1]*l[1],e[a]=d,e[a+1]=y;for(let p=2;p<r;++p)e[a+p]=S(c,e[a+p],p)}}}function Tt(t,n,e,o){let r=0,u=t[o*n],s=t[o*(n+1)];for(let i=1;i<e;i++){const c=u+t[o*(n+i)],l=s+t[o*(n+i)+1],f=(c-u)*(l+s);u=c,s=l,r+=f}return .5*r}function Yt(t,n){const{coords:e,lengths:o}=t;let r=0,u=0;for(let s=0;s<o.length;s++){const i=o[s];u+=Tt(e,r,i,n),r+=i}return Math.abs(u)}function It(t,n,e,o){return t*o-e*n===0&&t*e+n*o>0}function _t(t,n,e){const{stride:o}=t;if(t.isPoint){if(t.coords.length<2)return null;const[l,f]=t.coords,a=U(n,l),h=R(n,f);return new Z([],[a,h])}const r=new Z([],[0,0]),u=Y[e],s=e==="esriGeometryPolygon"||e==="esriGeometryPolyline";let i=0,c=0;for(let l=0;l<t.lengths.length;l++){const f=t.lengths[l],a=c;let h=U(n,t.coords[o*i]),m=R(n,t.coords[o*i+1]);r.coords[c++]=h,r.coords[c++]=m;let d=0,y=0,g=1;for(let p=1;p<f;p++){const G=U(n,t.coords[o*(p+i)]),b=R(n,t.coords[o*(p+i)+1]);if(G!==h||b!==m){const w=G-h,I=b-m;s&&It(d,y,w,I)?(r.coords[c-2]+=w,r.coords[c-1]+=I,h+=w,m+=I):(r.coords[c++]=G,r.coords[c++]=b,h=G,m=b,d=w,y=I,g+=1)}}g<u?c=a:r.lengths.push(g),i+=f}return r.lengths.length===0?null:r}function M(t,n=0){t.length!==n&&(t.length=n)}const Zt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};export{H as A,xt as B,J as C,Ft as D,Et as H,ft as I,Gt as J,at as M,B as S,$t as W,Lt as X,X as Y,Yt as a,Rt as e,Q as i,x as j,_t as m,St as n,O as r,Ut as t,Vt as u,q as x};
