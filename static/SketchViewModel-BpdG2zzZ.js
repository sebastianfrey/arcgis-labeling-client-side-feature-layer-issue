const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-D4moQJZ6.js","./index-C_bK48d2.js","./index-DxLSJ8yk.css","./quantity-wpyqwS5w.js","./elevationInfoUtils-C7MilKvD.js","./hitTestSelectUtils-xrNddzEE.js","./projectVectorToVector-IRvjF_FZ.js","./projectPointToVector-oWOZnQKe.js","./geodesicUtils-CTZo9mb6.js","./plane-CYaN818s.js","./vectorStacks-CpRnv_41.js","./quatf64-aQ5IuZRd.js","./sphere-Dx28BAGo.js","./ray-DFDOQn-4.js","./spatialReferenceEllipsoidUtils-DtI6yob-.js","./angularMeasurementUtils-CjfVhRr8.js","./GraphicsLayer-CFgfYbpT.js","./geodeticLengthOperator-BhsSOjnG.js","./geodeticCurveType-CirnHLSB.js","./earcut-Lltz9D9k.js","./triangle-Bs-n1Sd1.js","./geodeticAreaOperator-D2z_GCTf.js","./GridSnappingEngine-DPFSrjRU.js","./gridUtils-ZnziHA1q.js","./FeatureSnappingEngine-vVLhC7tK.js","./mapCollectionUtils-BgJ6gPaM.js","./floorFilterUtils-DZ5C6FQv.js","./layerViewUtils-B_qaHejE.js","./geometryEngine-DFKvkply.js","./geometryEngineBase-DlBBq5gp.js","./_commonjsHelpers-DCkdB7M8.js","./editingTools-b1D79JrS.js","./SnappingVisualizer2D-CWf2Lp8E.js","./SnappingContext-DX_opi8j.js","./PointSnappingHint-b5UNALvh.js","./rotate-CT4vtfG5.js","./MeshTransform-auT0YL_N.js","./quat-BPAPKRxq.js","./axisAngleDegrees-DpGZEdI4.js","./meshVertexSpaceUtils-CDdm4woH.js","./MeshLocalVertexSpace-D2aWm81U.js","./unitFormatUtils-Ckw47jIR.js","./getDefaultUnitForView-DghHjrRa.js","./quantityFormatUtils-BygWVGS0.js","./GraphicManipulator-Bi7jhnCD.js","./drapedUtils-lizrtG85.js","./editPlaneUtils-3MbDrFCi.js","./createUtils-BtrZ1zkK.js","./distanceOperator-Dulc5dHh.js","./Point2D-CHGoJJR2.js","./Distance2DCalculator-CXhBP-8I-BUsGD9ex.js","./ProjectionTransformation-yTMc8p-1.js","./Envelope2D-K-BIX8ba.js","./Transformation2D-CsY48lRi.js","./SimpleGeometryCursor-B92kdZ15.js","./OperatorDefinitions-DP7_WWTp.js","./apiConverter-CdLHvLkb.js","./jsonConverter-E47-BQ_b.js","./simplifyOperator-DCwRzIwh.js","./operatorSimplify-CaWHRVp7.js","./ReactiveSet-Dh87lN3P.js","./hydratedFeatures-dJZG-d3P.js","./boundedPlane-C07RSIqX.js","./cimSymbolUtils-kUrI6vhQ.js","./colorUtils-CLNuAJnC.js","./drawUtils-DEojaEFD.js","./ImageMaterial.glsl-DfkX5TuI.js","./SegmentLabels-Bq17BHQb.js","./frustum-BtvbAxAw.js","./RibbonLine.glsl-mNksHmZY.js","./orientedBoundingBox-QSEKbinM.js","./computeTranslationToOriginAndRotation-BdfVN0tn.js","./OutputColorHighlightOLID.glsl-sxs6Kjna.js","./Indices-BnCWM-r-.js","./BufferView-CruTDoyp.js","./VertexAttributeLocations-BSIMTgtd.js","./VertexElementDescriptor-2_ON7b9t.js","./renderState-CtcAbezy.js","./glsl-B5bJgrnA.js","./Octree-Dmg0kHEk.js","./InterleavedLayout-DFvKIHDS.js","./types-BKo2foNY.js","./HUDMaterial.glsl-p70B5G9C.js","./vec3f32-WCVSSNPR.js","./ShaderBuilder-DMt-f1fI.js","./DefaultLayouts-rMJ1pysK.js","./triangulationUtils-XRKprkBw.js","./deduplicate-Z43o2PF3.js","./VertexArrayObject-DXnl-4Rl.js","./memoryEstimations-w0EAmzVg.js","./BufferObject--KeRTd-9.js","./VertexBuffer-CJAj1yU0.js","./NestedMap-DI2--xdt.js","./ManagedTexture-B9Ayb5dV.js","./videoUtils-DSNBJ20F.js","./image-CVbVCSUp.js","./TextureBackedBufferLayout-Bu_3CpJU.js","./sdfPrimitives-DLG4KC99.js","./SelectedVertexTooltipInfo-CEuzVg6_.js","./TranslateTooltipInfo-DKuO2aLZ.js","./utils-B2fTWpox.js","./ExtentScaleTooltipInfo-Bg4VkwYW.js","./LineCallout.glsl-BHFxYFqa.js","./dehydratedFeatures-Bo4X9GGt.js","./rendererConversion-CPgb1dWp.js","./basemapUtils-FsMZ7l8w.js","./RealisticTree.glsl-Jq3TBRMx.js","./DefaultMaterial-B2uHExbq.js","./edgeUtils-DK1pdfdM.js","./OptimizedFeatureSet-BZnZXZq6.js","./OptimizedGeometry-KE6YknPZ.js","./optimizedFeatureQueryEngineAdapter-DEOBfILt.js","./featureConversionUtils-Di1UhLmY.js","./PooledRBush-Dq_6mwF9.js","./popupUtils-xKNFEs4a.js","./LayerView-BIRCz2lH.js","./highlightOptionsUtils-DXd9_sA-.js","./GraphicMover-D5a_xS6Q.js","./Box-4PJs-DDB.js","./settings-oq6IwySZ.js","./Reshape-BrrC2N_-.js","./symbolUtils-C-02jwAZ.js"])))=>i.map(i=>d[i]);
import{sG as rt,oe as nt,sH as pt,of as lt,aJ as l,aK as c,aL as L,db as Ze,bj as I,aF as We,d as ht,b6 as ct,fN as dt,go as ut,aN as W,gN as yt,b3 as M,p7 as gt,bH as mt,iS as vt,id as ft,dC as Ke,aa as ze,dk as _t,f2 as fe,ap as x,fz as Z,eZ as bt,hg as wt,_ as C,aO as ne,g0 as me,fR as St,fZ as Et,sI as Tt,gp as Te,l0 as Gt,gw as Ot,f3 as _e,iM as Ct,iT as V,eV as At,he as Ge,hf as Mt,hc as Pt,sJ as Rt,sK as kt,ld as Dt,N as $t,eW as K,f8 as Ht,kz as pe,cK as Oe,aS as xt,hQ as It,hR as Lt,sL as Ut,kN as Vt,hX as T,lm as Ce,ot as w,sM as P,i1 as Ae,a as Ft,a9 as Me,ig as jt,f4 as qt,f_ as Pe}from"./index-C_bK48d2.js";import{h as Zt}from"./GraphicsLayer-CFgfYbpT.js";import{p as ie,P as Wt,z as R,Q as Kt,h as zt,v as Nt,S as Ne,j as Be,A as Bt,B as Je,G as Jt,s as Re,T as be,D as z,b as le,E as ke,y as Qt,n as Xt,U as Yt,V as ea,W as ta,X as aa,K as ia,Y as oa,Z as sa,g as Qe,N as ra,u as na}from"./hitTestSelectUtils-xrNddzEE.js";import{b as pa,k as ve}from"./elevationInfoUtils-C7MilKvD.js";import{t as la,p as ha}from"./projectVectorToVector-IRvjF_FZ.js";import{a as se,l as re}from"./quantity-wpyqwS5w.js";import{q as ca,v as da,b as ua,R as ya}from"./geodesicUtils-CTZo9mb6.js";import{m as ga,l as Xe}from"./geodeticLengthOperator-BhsSOjnG.js";import{e as ma}from"./earcut-Lltz9D9k.js";import{w as va,d as fa,k as _a,T as ba}from"./plane-CYaN818s.js";import{v as wa}from"./triangle-Bs-n1Sd1.js";import{m as Sa,l as Ea}from"./geodeticAreaOperator-D2z_GCTf.js";function De(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the symbol type is not supported"}return""}function Ta(e){var a,i;if(e.graphic&&((a=e.graphic.layer)==null?void 0:a.type)!=="graphics")return 1;const t=(i=e.operations)==null?void 0:i.data.type;if(!t)return 3;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}return 0}function Ga(e){return Oa(e).result}function Oa(e){var i;if(e.graphic&&((i=e.graphic.layer)==null?void 0:i.type)!=="graphics")return{result:1};if(!e.operations)return{result:2};const t=e.operations.data.type,a=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:0,geometry:a}:{result:3}}function Ca(e){var a;if(((a=e.layer)==null?void 0:a.type)!=="graphics")return 1;if(e.geometry==null)return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return t&&t.some(i=>i.type==="object")?0:4}function $e(e,t,a){if(!t||!(e!=null&&e.map))return;const{map:i}=e,o=i.layers.find(s=>s===t);o||i.add(t,a),o&&a!=null&&i.layers.reorder(o,a)}function Gi(e,t){const a=(t==null?void 0:t.type)==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(i=>{const o=i.layer;return o===a||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(a)})}function Oi(e){return rt(e)||nt(e)||pt(e)||lt(e)}let k=class extends Ze{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new I}};l([c({constructOnly:!0})],k.prototype,"layer",void 0),l([c()],k.prototype,"enabled",void 0),l([c()],k.prototype,"updating",void 0),l([c()],k.prototype,"availability",void 0),l([c()],k.prototype,"sublayerSources",void 0),k=l([L("esri.views.interactive.snapping.FeatureSnappingLayerSource")],k);let E=class extends Ze{constructor(t){super(t),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new I,this.distance=ie.distance,this.touchSensitivityMultiplier=ie.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var n;const t=this.featureSources;t.some(He)&&We.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const a=t.filter(Ma),i=((n=this._get("_effectiveFeatureSources"))==null?void 0:n.filter(He))??new I;for(const r of a){const m=i.find(d=>d.layer===r.layer.parent);if(m)m.sublayerSources.includes(r)||m.sublayerSources.add(r);else if(r.layer.parent){const d=new k({layer:r.layer.parent});d.sublayerSources.add(r),i.add(d)}}for(const r of i){const m=r.sublayerSources.filter(d=>!a.includes(d));r.sublayerSources.removeMany(m)}i.removeMany(i.filter(r=>r.sublayerSources.length===0));const o=t.filter(Aa),s=this._get("_effectiveFeatureSources")??new I,{added:p,removed:h}=ht(s.toArray(),[...o,...i]);return s.removeMany(h),s.addMany(p),s}};function He(e){return e.layer.type==="subtype-group"}function Aa(e){return e.layer.type!=="subtype-group"}function Ma(e){return e.layer.type==="subtype-sublayer"}l([c()],E.prototype,"enabled",void 0),l([c()],E.prototype,"enabledToggled",void 0),l([c()],E.prototype,"forceDisabled",void 0),l([c()],E.prototype,"selfEnabled",void 0),l([c()],E.prototype,"featureEnabled",void 0),l([c()],E.prototype,"gridEnabled",void 0),l([c()],E.prototype,"attributeRulesEnabled",void 0),l([c({type:I.ofType(k)})],E.prototype,"featureSources",void 0),l([c()],E.prototype,"distance",void 0),l([c()],E.prototype,"touchSensitivityMultiplier",void 0),l([c({readOnly:!0})],E.prototype,"effectiveEnabled",null),l([c({readOnly:!0})],E.prototype,"effectiveGridEnabled",null),l([c({readOnly:!0})],E.prototype,"effectiveSelfEnabled",null),l([c({readOnly:!0})],E.prototype,"effectiveFeatureEnabled",null),l([c({readOnly:!0})],E.prototype,"_effectiveFeatureSources",null),E=l([L("esri.views.interactive.snapping.SnappingOptions")],E);class U{constructor(t,a,i,o){this.targetPoint=t,this.constraint=a,this.isDraped=i,this.domain=o}}let Ye=class extends U{constructor({targetPoint:t,objectId:a,constraint:i,isDraped:o}){super(t,i,o,1),this.objectId=a}},Pa=class extends Ye{constructor(t){super({...t,isDraped:!0,constraint:new Wt(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new R(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Ra=class extends Ye{constructor(t){super({...t,constraint:new Kt(t.edgeStart,t.edgeEnd)})}get hints(){return[new R(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},te=class extends U{constructor(t,a,i,o){super(t,new zt(t),o,3),this.first=a,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Nt(this.targetPoint,this.isDraped,this.domain)]}},ka=class extends U{constructor({lineStart:t,lineEnd:a,targetPoint:i,isDraped:o}){super(i,new Ne(t,a),o,2),this._referenceLineHint=new R(2,t,a,o,this.domain)}get hints(){return[this._referenceLineHint,new R(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Da=class extends U{constructor({referenceLine:t,lineStart:a,targetPoint:i,isDraped:o}){const s=ct(a),{left:p,right:h}=t;dt(s,ut(s,s,h),p),super(i,new Ne(a,Be(s)),o,2),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new R(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Bt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(t=>new R(1,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const a={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{W(t.right,i.edge.left)&&(i.fadeLeft=!1,a.fadeRight=!1),W(t.right,i.edge.right)&&(i.fadeRight=!1,a.fadeRight=!1),W(t.left,i.edge.right)&&(i.fadeRight=!1,a.fadeLeft=!1),W(t.left,i.edge.left)&&(i.fadeLeft=!1,a.fadeLeft=!1)}),this._referenceLines.push(a)}},$a=class extends U{constructor({targetPoint:t,constraint:a,previousVertex:i,otherVertex:o,otherVertexType:s,isDraped:p,selfSnappingType:h,objectId:n,domain:r}){super(t,a,p,r??2),this.previousVertex=i,this.otherVertex=o,this.otherVertexType=s,this.selfSnappingType=h??0,this.objectId=n??null}get hints(){const t=this.previousVertex,a=this.otherVertexType===1?this.otherVertex:this.targetPoint,i=this.otherVertexType===1?this.targetPoint:this.otherVertex;return[new R(0,a,i,this.isDraped,this.domain),new R(1,t,a,this.isDraped,this.domain),new Je(this.previousVertex,a,i,this.isDraped,this.domain)]}},Ha=class extends U{constructor({targetPoint:t,point1:a,point2:i,isDraped:o}){super(t,new Jt(Be(yt(M(),a,i,.5)),.5*gt(Re(a),Re(i))),o,2),this._p1=a,this._p2=i}get hints(){return[new R(1,this.targetPoint,this._p1,this.isDraped,this.domain),new R(1,this.targetPoint,this._p2,this.isDraped,this.domain),new Je(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function xa(e,t,a,i,o=M()){const s=mt(Ia,e);return s[2]=pa(i,s,t,a)||0,i.renderCoordsHelper.toRenderCoords(s,t,o),o}const Ia=M();function La(e,t,a,i){return i.type==="2d"?(N.x=e[0],N.y=e[1],N.spatialReference=t,i.toScreen(N)):(xa(e,t,a,i,xe),i.state.camera.projectToScreen(xe,he),vt(he[0],he[1]))}const N=la(0,0,0,null),xe=M(),he=ft();function Ua(e){const{spatialReference:t}=e,a=Ke(e);return be(t,a?Ie:Za,Ie,e)}function Va(e,t){if(!ze(e.spatialReference,t.spatialReference))return null;const{spatialReference:a}=e;return B[0]=e.x,B[1]=e.y,B[2]=e.hasZ?e.z:0,J[0]=t.x,J[1]=t.y,J[2]=t.hasZ?t.z:0,et(B,J,a)}function et(e,t,a){return be(a,ja,qa,e,t,a)}const Fa={geodesicLength:Ua,geodesicDistanceBetweenPoints:Va,geodesicDistance:et};async function tt(){return await ga(),Fa}function ja(e,t,a){return se(ca(Ka,e,t,a).distance,"meters")}function qa(e,t,a){return se(Xe(Wa(e,t,a),{unit:"meters"}),"meters")}function Za(e){return se(da([e],"meters")[0],"meters")}function Ie(e){return se(Xe(e,{unit:"meters"}),"meters")}function Wa(e,t,a){return new _t({spatialReference:a,paths:[[[...e],[...t]]]})}const Ka=new ua,B=M(),J=M();let A=class extends fe{constructor(e){super(e),this.options=new E,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([x(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:a,effectiveFeatureEnabled:i,effectiveGridEnabled:o}=this.options;return{selfEnabled:a,featureEnabled:i,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{var a;t&&(this.doneSnapping(),this.emit("changed")),(a=this._loadTask)==null||a.abort(),this._loadTask=bt(i=>this._updateEngines(e,t,i))},Z),x(()=>this.options,e=>{for(const t of this._engines)t.options=e},wt)])}destroy(){var e;(e=this._loadTask)==null||e.abort(),this._destroyEngines()}get updating(){var e;return this._engines.some(t=>t.updating)||!((e=this._loadTask)!=null&&e.finished)}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,a){var s;if(!e.viewReady)return void this._destroyEngines();(t==null?void 0:t.viewSpatialReference)!==e.viewSpatialReference&&this._destroyEngines();const i=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!i.has("feature")?this._createFeatureSnappingEngine(a):void 0,e.selfEnabled&&!i.has("self")?this._createSelfSnappingEngine(a):void 0,e.gridEnabled&&!i.has("grid")?this._createGridSnappingEngine(a):void 0]);if(a.aborted)for(const p of o)p.status==="fulfilled"&&((s=p.value)==null||s.engine.destroy());else{for(const p of o)p.status==="fulfilled"&&p.value&&i.set(p.value.type,p.value.engine);this._engines=Array.from(i.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},a]=await Promise.all([C(()=>import("./SelfSnappingEngine-D4moQJZ6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url),tt()]);return ne(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:a})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:a}=await C(()=>import("./GridSnappingEngine-DPFSrjRU.js"),__vite__mapDeps([22,1,2,23,8,5,6,7,9,10,11,12,13,4,3,14,16,17,18,19,20,21]),import.meta.url);return ne(e),{type:"grid",engine:new a({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await C(()=>import("./FeatureSnappingEngine-vVLhC7tK.js"),__vite__mapDeps([24,1,2,25,4,5,6,7,8,9,10,11,12,13,3,14,26,27,16,17,18,19,20,21]),import.meta.url);ne(e);const{view:a,options:i}=this,{spatialReference:o}=a;return{type:"feature",engine:new t({view:a,options:i,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,a=e*t;return a*a}snap(e){return Ba(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:a}=e;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:s}=a,p=me(o,s);if(p==null)return t;const{view:h}=this,{elevationInfo:n,visualizer:r}=a,m=[],d=z(p,h,n),u=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,u,a)||!de(i,a.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=le(u),m.push(...i.hints);for(const v of this._currentOtherActiveCandidates)de(v,a.drawConstraints)&&(v.targetPoint=le(u),m.push(...v.hints));return r!=null&&this.addHandles(r.draw(m,{spatialReference:s,elevationInfo:Ja(a),view:h,selfSnappingZ:a.selfSnappingZ}),ce),ke(u,h,t,a)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case 0:return e;case 1:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(ce)}async _snapSinglePoint({point:e,context:t,signal:a}){const{view:i}=this,{elevationInfo:o}=t,s=z(e,i,o),p=await this._fetchCandidates(s,3,t,a);return this._createSnapResult(s,0,p,i,e,t,a)}async _snapMultiPoint({point:e,scenePoint:t,context:a,signal:i}){const{view:o}=this,{coordinateHelper:s,elevationInfo:p,spatialReference:h}=a;await St(t.spatialReference,h);const n=me(t,h),r=z(n,o,p),m=await this._fetchCandidates(r,1,a,i);if(m.length>0){const v=await this._fetchCandidates(r,2,a,i);return this._createSnapResult(r,1,[...m,...v],o,n,a,i)}const d=z(e,o,p),u=await this._fetchCandidates(d,2,a,i);return this._createSnapResult(d,0,u,o,{z:s.hasZ()&&e.hasZ?e.z??0:void 0,m:s.hasM()&&e.hasM?e.m??0:void 0},a,i)}async _fetchCandidates(e,t,a,i){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,a,i)))).flat()}_createSnapResult(e,t,a,i,o,s,p){return{get valid(){return!Et(p)},apply:()=>{const{spatialReference:h}=s,{snappedPoint:n,hints:r}=this._processCandidates(e,t,a,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(r,{spatialReference:h,elevationInfo:ve,view:i,selfSnappingZ:s.selfSnappingZ}),ce),ke(n,i,o,s)}}}_processCandidates(e,t,a,i){if(a.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Qt(e,a);const o=this._currentMainCandidate;if(o!=null){const s=Na(o,a);if(s>=0){if(!(a[s]instanceof te))return this._intersectWithOtherCandidates(s,a,e,t,i);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,i))return this._updateSnappingCandidate(o,t,a,i)}}return this._intersectWithOtherCandidates(0,a,e,t,i)}_intersectWithOtherCandidates(e,t,a,i,o){const{coordinateHelper:s}=o,p=t[e],h=[];for(let n=0;n<t.length;++n){if(n===e)continue;const r=t[n],m=p.constraint.intersect(r.constraint);if(m)for(const d of m.closestPoints(p.targetPoint))h.push([new te(le(d),p,r,r.isDraped),this._squaredScreenDistance(a,d,s)])}return h.length>0&&(h.sort((n,r)=>n[1]-r[1]),h[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(h[0][0],i,t,o):de(p,o.drawConstraints)?this._updateSnappingCandidate(p,i,t,o):{snappedPoint:a,hints:[]}}_updateSnappingCandidate(e,t,a,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const p of a){if(e instanceof te){if(p.constraint.equals(e.first.constraint)||p.constraint.equals(e.second.constraint))continue}else if(p.constraint.equals(e.constraint))continue;const h=p.constraint.closestTo(o);this._squaredScreenDistance(h,o,i.coordinateHelper)<za()&&(p.targetPoint=o,this._currentOtherActiveCandidates.push(p),s.push(...p.hints))}return{snappedPoint:o,hints:s}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,a){return this._squaredScreenDistance(e,t,a.coordinateHelper)<this._squaredPointProximityThreshold(a.pointer)}_squaredScreenDistance(e,t,a){return Xt(this._toScreen(e,a),this._toScreen(t,a))}_toScreen(e,t){return La(e,t.spatialReference,ve,this.view)}get test(){}};l([c({constructOnly:!0})],A.prototype,"view",void 0),l([c()],A.prototype,"options",void 0),l([c({readOnly:!0})],A.prototype,"updating",null),l([c()],A.prototype,"_loadTask",void 0),l([c()],A.prototype,"_engines",void 0),l([c()],A.prototype,"_squaredMouseProximityThreshold",null),l([c()],A.prototype,"_squaredTouchProximityThreshold",null),A=l([L("esri.views.interactive.snapping.SnappingManager")],A);const ce="visualization-handle";function za(){return ie.satisfiesConstraintScreenThreshold*ie.satisfiesConstraintScreenThreshold}function de(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof Pa||e instanceof Ra||e instanceof ka||e instanceof Da||e instanceof Ha)&&(!(e instanceof $a)||t.direction==null&&e.selfSnappingType===1)}function Na(e,t){return e instanceof te?ue(t,e.first)>=0&&ue(t,e.second)>=0?0:-1:ue(t,e)}function ue(e,t){let a=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){a=i;break}return a}function Ba(e){return e.scenePoint!=null}function Ja({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?ve:t}function Qa(e,t=oe()){return at(e,t)}function Xa(e,t=oe()){return at(e,t,!1)}function at(e,t,a=e.hasZ){const i=Yt(e.spatialReference),o=Tt(i);if(o==null)return null;const s=(h,n)=>!(n.length<2)&&(Te(h,n[0],n[1],a&&n[2]||0),!0);let p=0;for(const h of e.rings){const n=h.length;if(n<3)continue;const{positionsWorldCoords:r}=t;for(;r.length<n;)r.push(M());const m=Ya,d=Te(ei,0,0,0),u=1/n;for(let y=0;y<n;y++){if(!s(m,h[y])||!ha(m,e.spatialReference,r[y],i))return null;Gt(d,d,r[y],u)}const v=va(r[0],r[1],d,fa());if(Ot(_a(v))===0)continue;for(let y=0;y<n;y++)ba(v,d,r[y],r[y]);const g=ti(r);for(let y=0;y<g.length;y+=3)p+=wa(r[g[y]],r[g[y+1]],r[g[y+2]])}return re(p,o)}const Ya=M(),ei=M();function oe(){return{positionsWorldCoords:[]}}function ti(e){return ma(ai(e),[],2)}function ai(e){const t=new Float64Array(2*e.length);for(let a=0;a<e.length;++a){const i=e[a],o=2*a;t[o]=i[0],t[o+1]=i[1]}return t}const ii=e=>({geodesicArea(t){const{spatialReference:a}=t,i=Ke(t);return be(a,i?Le:si,i?Le:o=>ri(e,o),t)}});async function oi(){const e=await C(()=>import("./geometryEngine-DFKvkply.js"),__vite__mapDeps([28,1,2,29,30]),import.meta.url);return await Sa(),ii(e)}function si(e){return re(Math.abs(ya([e],"square-meters")[0]),"square-meters")}function ri(e,t){try{return re(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch{return null}}function Le(e){return re(Ea(e,{unit:"square-meters",curveType:"geodesic"}),"square-meters")}const ni=e=>({autoAreaByElevationMode(t,a,i=oe()){if(a==="on-the-ground"){const o=e.geodesicArea(t);return o??Xa(t,i)}return Qa(t,i)},autoArea2D(t,a=oe()){return this.autoAreaByElevationMode(t,"on-the-ground",a)}});let ye=null;async function Q(){return ye||(ye=ni(await oi())),ye}function pi(e){return{autoLength2D:t=>e.geodesicLength(t)??ea(t),autoDistanceBetweenPoints2D:(t,a)=>e.geodesicDistanceBetweenPoints(t,a)??ta(t,a),autoDistance2D:(t,a,i)=>(F[0]=t[0],F[1]=t[1],F[2]=t.length===3?t[2]:0,j[0]=a[0],j[1]=a[1],j[2]=a.length===3?a[2]:0,e.geodesicDistance(F,j,i)??aa(F,j,i))}}async function H(){return pi(await tt())}const F=M(),j=M();class it{constructor(t){this.layer=t}get elevationInfo(){return this.layer.elevationInfo}add(t){this.layer.add(t)}addMany(t){this.layer.addMany(t)}onGraphicsChange(t){const{layer:a}=this;return _e(()=>a.graphics,"change",i=>t(i))}has(t){return t.layer===this.layer}remove(t){this.layer.remove(t)}removeMany(t){this.layer.removeMany(t)}removeAll(){this.layer.removeAll()}}l([c()],it.prototype,"elevationInfo",null);class ot{constructor(t){this.layer=t}get elevationInfo(){}add(t,a){const i=this._getSublayerForCreateTool(a)??this._getSublayerForGraphic(t);i==null||i.add(t)}addMany(t,a){if(a){const i=this._getSublayerForCreateTool(a);if(i)return void i.addMany(t)}t.forEach(i=>{var o;return(o=this._getSublayerForGraphic(i))==null?void 0:o.add(i)})}onGraphicsChange(t){var i,o;const{layer:a}=this;if((i=a.sublayers)!=null&&i.length)return Ct((o=a.sublayers)==null?void 0:o.toArray().map(s=>_e(()=>s.graphics,"change",p=>t(p))))}has(t){var i;const{layer:a}=this;return t.layer===a||t.sourceLayer===a||!!((i=a.sublayers)!=null&&i.some(o=>t.layer===o||t.sourceLayer===o))}remove(t){var a;(a=this._getSublayerForGraphic(t))==null||a.remove(t)}removeMany(t){t.forEach(a=>{var i;return(i=this._getSublayerForGraphic(a))==null?void 0:i.remove(a)})}removeAll(){var t;(t=this.layer.sublayers)==null||t.forEach(a=>a.removeAll())}_getSublayerForCreateTool(t){const{layer:a}=this;switch(t){case"point":return a.pointLayer;case"polyline":return a.polylineLayer;case"polygon":return a.polygonLayer;case"multipoint":return a.multipointLayer;case"text":return a.textLayer}}_getSublayerForGraphic(t){var i;const{layer:a}=this;if(t!=null&&t.geometry)switch(t.geometry.type){case"point":return((i=t.symbol)==null?void 0:i.type)==="text"?a.textLayer:a.pointLayer;case"polyline":return a.polylineLayer;case"polygon":return a.polygonLayer;case"multipoint":return a.multipointLayer}}}l([c()],ot.prototype,"elevationInfo",null);let G=class extends fe{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){var t;const{activeComponent:e}=this;if(!e)return null;switch(e.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":return((t=e.graphicSymbol)==null?void 0:t.type)==="text"?"text":e.geometryType;case"draw-3d":return e.geometryType}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var e;(e=this.activeComponent)==null||e.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};l([c()],G.prototype,"activeComponent",void 0),l([c()],G.prototype,"cancelled",void 0),l([c()],G.prototype,"history",void 0),l([c()],G.prototype,"tool",null),l([c()],G.prototype,"type",void 0),l([c()],G.prototype,"canUndo",null),l([c()],G.prototype,"canRedo",null),l([c()],G.prototype,"onEnd",void 0),l([c()],G.prototype,"undo",null),l([c()],G.prototype,"redo",null),l([c()],G.prototype,"toggleTool",void 0),l([c()],G.prototype,"addToSelection",void 0),l([c()],G.prototype,"removeFromSelection",void 0),G=l([L("esri.widgets.Sketch.support.OperationHandle")],G);let ae=class extends G{};l([c()],ae.prototype,"activeComponent",void 0),ae=l([L("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],ae);let D=class extends G{};l([c()],D.prototype,"activeComponent",void 0),D=l([L("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],D);function li(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function hi(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";case"text":return"point";default:return e}}function Ue(e){var a;if(e.length>1)return!1;const t=(a=e.at(0))==null?void 0:a.geometry;return(t==null?void 0:t.type)==="point"||(t==null?void 0:t.type)==="multipoint"&&t.points.length<2}const Ve={defaultZ:0},q={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move",enableCreateCurveFromStraightEdge:!0},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:qt},tool:"transform"},ge=Symbol(),Fe=Symbol();let f=class extends fe{constructor(e){var t;super(e),this._defaultSnappingManager=null,this._internalGraphicsLayer=new Zt({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._updatingHandles=new At,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new Ge({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Mt({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Pt({color:[130,130,130,1],width:2}),this.meshSymbol=new Rt({symbolLayers:new I([new kt])}),this.textSymbol=new Dt({text:"text"}),this.updateGraphics=new I,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new Ge({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Qe,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{const{_layerAdapter:a}=this;if(this.removeHandles(Fe),!a)return;const i=[a.onGraphicsChange(o=>this._onLayerGraphicsChangeCallback(o)),x(()=>a.elevationInfo,o=>{o!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer&&(this._internalGraphicsLayer.elevationInfo=o))},Z)].filter($t);this.addHandles(i,Fe)},this._originalPopupEnabled=null,this.defaultCreateOptions=Ve,this.defaultUpdateOptions=q,this.snappingOptions=((t=e==null?void 0:e.snappingManager)==null?void 0:t.options)??(e==null?void 0:e.snappingOptions)??new E}initialize(){this.addHandles([_e(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.layers},"change",e=>{this.layer&&e.removed.includes(this.layer)&&this.cancel()}),x(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),Z),x(()=>this.view,e=>{this._defaultSnappingManager=K(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new A({view:e,options:this.snappingOptions})),e.type==="2d"?C(()=>import("./editingTools-b1D79JrS.js"),__vite__mapDeps([31,1,2,32,5,6,7,8,9,10,11,12,13,4,3,14,33,34,35,36,37,38,39,40,41,42,43,15,44,45,46,16,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65]),import.meta.url):e.type==="3d"&&(C(()=>import("./ImageMaterial.glsl-DfkX5TuI.js").then(t=>t.e),__vite__mapDeps([66,1,2,64,4,10,11,67,43,3,41,12,13,9,42,6,7,68,69,70,37,14,71,72,73,74,20,75,76,77,78,79,80,81,82,39,40,61,83,84,85,86,19,87,88,89,90,91,92,38,93,94,95,96,97,5,8,33,34,35,36,15,44,45,98,46,16,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,99,100,63,101]),import.meta.url),C(()=>import("./LineCallout.glsl-BHFxYFqa.js").then(t=>t.G),__vite__mapDeps([102,1,2,7,6,4,69,70,37,11,14,71,9,10,72,73,74,20,13,12,75,76,77,78,68,79,80,81,82,39,40,61,83,84,103,89,104,105,106,107,91,90,108,109,110,111,112,113,114,27,115,116]),import.meta.url)))},Z),x(()=>{var e;return(e=this.view)==null?void 0:e.spatialReference},(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),ra(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=K(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get _layerAdapter(){const{layer:e}=this;switch(e==null?void 0:e.type){case"graphics":return new it(e);case"map-notes":return new ot(e);default:return null}}get activeTool(){var e;return((e=this._operationHandle)==null?void 0:e.tool)??null}get activeCreateToolDrawMode(){var e;return((e=this._operationHandle)==null?void 0:e.type)==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,a=!t&&e&&"tooltip"in e?e.tooltip:null;return a!=null&&a.visible?a:null}get activeComponent(){var e;return((e=this._operationHandle)==null?void 0:e.activeComponent)??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Ve,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...q,...e,reshapeOptions:{...q.reshapeOptions,...e==null?void 0:e.reshapeOptions},highlightOptions:{...q.highlightOptions,...e==null?void 0:e.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){var e;return((e=this.snappingManager)==null?void 0:e.options)??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=K(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new A({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){var a;const e=!(!((a=this.view)!=null&&a.ready)||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get updating(){var e;return!(!this._updatingHandles.updating&&!((e=this.snappingManager)!=null&&e.updating))}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:i,map:o}=t;i&&this._clearCursor(),o==null||o.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const a="view-ready";this.removeHandles(a),e&&this.addHandles(Ht(()=>e.ready,i=>{this.removeHandles(this._viewHandlesKey),i&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},Z),a),this._set("view",e)}addGraphic(e){var t;(t=this._layerAdapter)==null||t.add(e)}addGraphics(e){var t;(t=this._layerAdapter)==null||t.addMany(e)}hasGraphic(e){var t;return!!((t=this._layerAdapter)!=null&&t.has(e))}removeGraphic(e){var t;(t=this._layerAdapter)==null||t.remove(e)}removeGraphics(e){var t;(t=this._layerAdapter)==null||t.removeMany(e)}removeAllGraphics(){var e;(e=this._layerAdapter)==null||e.removeAll()}cancel(){this._moduleLoaderAbortController=pe(this._moduleLoaderAbortController),this._viewReadyAbortController=pe(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){var e;(e=this._operationHandle)==null||e.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:a}=this,i=t.toArray();this.removeGraphics(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:a})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.addGraphics(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){var p;this.cancel(),await this._waitViewReady();const{view:a,layer:i}=this;if(!a||this.state==="disabled")throw i||this._logMissingLayer(),Oe();if(a.activeTool!=null&&(a.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");$e(a,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void((p=a.map)==null?void 0:p.remove(this._internalGraphicsLayer));const s=()=>{var h,n;if(o===this._operationHandle){const r=this.createGraphic,m=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),(n=(h=this.view)==null?void 0:h.map)==null||n.remove(this._internalGraphicsLayer),o.cancelled||r==null||this.addGraphic(r),this._sketchContinuationFlag=!1,this.emit("create",{graphic:r,state:m?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),m||this._sketchContinuationFlag)return;const{creationMode:d}=this;if(d==="continuous"){if(t!=null&&t.geometryToPlace)return;this._updatingHandles.addPromise(Pe(this.create(e,t)))}else d==="update"&&r&&this._updatingHandles.addPromise(Pe(this.update([r])))}};o.on("complete",s),this._operationHandle=o,a.ready&&a.focus()}async place(e,t){return await e.load(),this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:a,view:i,state:o}=this;if(!i||o==="disabled")throw a||this._logMissingLayer(),Oe();i.activeTool!=null&&(i.activeTool=null);const s=Array.isArray(e)?e:[e];if(e==null||!(s!=null&&s.length))return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(h=>this.hasGraphic(h)?h.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0)))return;const p=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,t));this.destroyed||p==null||S(p)||($e(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(p,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:p.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const a of e)a.geometry==null||a.geometry.type==="mesh"||ze(a.geometry.spatialReference,t.spatialReference)||(xt(a.geometry.spatialReference,t.spatialReference)||It()||await Lt(),a.geometry=me(a.geometry,t.spatialReference))}else this._logMissingView()}undo(){var e;this.canUndo()&&((e=this._operationHandle)==null||e.undo())}redo(){var e;this.canRedo()&&((e=this._operationHandle)==null||e.redo())}canUndo(){var e;return!!((e=this._operationHandle)!=null&&e.canUndo())}canRedo(){var e;return!!((e=this._operationHandle)!=null&&e.canRedo())}toggleUpdateTool(){var e;(e=this._operationHandle)==null||e.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach(p=>{p.type!=="vector-tile"&&p.type!=="imagery"||o.push(p)});const s=await t.hitTest(e,{exclude:o});return na(s.results)}const a=[t.map.ground];t.map.allLayers.forEach(o=>{Ut(o)&&a.push(o)});const i=await t.hitTest(e,{exclude:a});if(i.results.length>0){const o=i.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(o.distance??0)>-Math.min(3*i.ground.distance,t.viewingMode==="global"?Vt(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{var i;const a=this.state==="active"&&((i=this._operationHandle)==null?void 0:i.type)==="create";this.state!=="disabled"&&!a&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},T.WIDGET)]}async _handleImmediateClick(e){var i;const t=await e.defer(()=>this._getFirstHit(Ce(e)));let a=null;if(t!=null){const o=t.graphic;this.updateGraphics.includes(o)||this.hasGraphic(o)?(e.stopPropagation(),a=o):((i=this.view)==null?void 0:i.type)!=="2d"||this._isComponentGraphic(o)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();a==null||this.updateGraphics.includes(a)||await this.update([a],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const a=this.view;if(!a)return this._logMissingView(),null;const i={hasZ:a.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,a,i);return o==null?null:(a.tools.add(o),a.activeTool=o,this._setupCreateOperationHandle(o,e))}async _setupDrawGraphicTool(e,t,a){var y;if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:o,hasZ:s,geometryToPlace:p,graphicProperties:h,mode:n,preserveAspectRatio:r}=a,m=li(n,e),d=hi(e),u=(y=a==null?void 0:a.optionsPerTool)!=null&&y.has(e)?a.optionsPerTool.get(e):{},v=(u==null?void 0:u.preserveAspectRatio)??r??e!=="rectangle",g={centered:e!=="rectangle"&&!(e==="circle"&&!v),cursor:i,defaultZ:o,forceUniformSize:v,graphicProperties:{...h,attributes:{...h==null?void 0:h.attributes}},geometryToPlace:p,geometryType:d,mode:m,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:t,...u};return t.type==="2d"?this._makeDrawGraphicTool2D(g):this._makeDrawGraphicTool3D(g)}async _makeDrawGraphicTool2D(e){const[t,a,i]=await Promise.all([this._requireModule(C(()=>import("./editingTools-b1D79JrS.js"),__vite__mapDeps([31,1,2,32,5,6,7,8,9,10,11,12,13,4,3,14,33,34,35,36,37,38,39,40,41,42,43,15,44,45,46,16,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65]),import.meta.url)),Q(),H()]);return S(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:di(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:i})}async _makeDrawGraphicTool3D(e){var o;const[t,a,i]=await Promise.all([this._requireModule(C(()=>import("./ImageMaterial.glsl-DfkX5TuI.js").then(s=>s.e),__vite__mapDeps([66,1,2,64,4,10,11,67,43,3,41,12,13,9,42,6,7,68,69,70,37,14,71,72,73,74,20,75,76,77,78,79,80,81,82,39,40,61,83,84,85,86,19,87,88,89,90,91,92,38,93,94,95,96,97,5,8,33,34,35,36,15,44,45,98,46,16,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,99,100,63,101]),import.meta.url)),Q(),H()]);return S(t)||this.destroyed?null:new t.module.DrawGraphicTool3D({...e,elevationInfo:(o=this._layerAdapter)==null?void 0:o.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:i})}_setupCreateOperationHandle(e,t){const a=this.view;if(!a)return this._logMissingView(),null;let i=null;const o=e.forceUniformSize,s=e.centered,p=[a.on("key-down",n=>{if(n.key===w.pan)n.stopPropagation(),n.repeat||(e.enabled=!1);else if(n.key===w.complete)n.stopPropagation(),e.completeCreateOperation();else if(n.key!==w.vertexAdd||n.repeat)n.key===w.undo?(n.stopPropagation(),h.undo()):n.key===w.redo?(n.stopPropagation(),h.redo()):n.key!==w.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||n.repeat?n.key===w.center&&(n.repeat||(e.centered=!s,n.stopPropagation())):(e.forceUniformSize=!o,n.stopPropagation());else{const r=e.drawOperation.geometryType;r!=="polyline"&&r!=="polygon"&&r!=="multipoint"||(n.stopPropagation(),e.drawOperation.commitStagedVertex())}},T.WIDGET),a.on("key-up",n=>{n.key===w.pan?e.enabled=!0:n.key!==w.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?n.key===w.center&&(e.centered=s,n.stopPropagation()):(e.forceUniformSize=o,n.stopPropagation())},T.WIDGET),e.on("vertex-add",n=>{switch(i=i==null?"start":"active",n.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:n,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",n=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:n.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",n=>{switch(n.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:n,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",n=>{this._set("createGraphic",n.graphic),i="complete",n.aborted?h&&h.cancel():h&&h.complete()}),x(()=>this._getGraphicSymbolFromTool(t),n=>{e.graphicSymbol=n})],h=new ae({activeComponent:e,type:"create",onEnd:()=>{var n;P(p),(n=a.tools)==null||n.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return h}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol;case"text":return this.textSymbol}}async _setupUpdateOperation(e,t){const{view:a}=this;if(!a)return this._logMissingView(),null;const i={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t==null?void 0:t.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t==null?void 0:t.highlightOptions}};let o=i.tool??q.tool;if(this.removeGraphics(e),this.addGraphics(e),a.type==="3d"){if(e.length===0)return null;switch(o){case"move":return this._setupMove3DOperation(e,i,a,o);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],i,a);case"transform":return this._setupGraphicTransform3DOperation(e,i,a)}}switch(o){case"move":return this._setupMove2DOperation(e,i,a);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,o,i,a);case"transform":return Ue(e)&&(o="reshape"),this._setupTransformOrReshape2DOperation(e,o,i,a)}}async _setupMove3DOperation(e,t,a,i,o=!1){const[s,p]=await Promise.all([this._requireModule(C(()=>import("./ImageMaterial.glsl-DfkX5TuI.js").then(g=>g.e),__vite__mapDeps([66,1,2,64,4,10,11,67,43,3,41,12,13,9,42,6,7,68,69,70,37,14,71,72,73,74,20,75,76,77,78,79,80,81,82,39,40,61,83,84,85,86,19,87,88,89,90,91,92,38,93,94,95,96,97,5,8,33,34,35,36,15,44,45,98,46,16,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,99,100,63,101]),import.meta.url)),H()]);if(S(s))return s;const{ManipulatedObject3DGraphic:h,MoveTool3D:n}=s.module,r=new Map,m=()=>{r.forEach(g=>g.destroy()),r.clear()};for(const g of e){const y=new h({view:a,graphic:g}),_=Ta(y);if(_!==0)return m(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${De(_)}).`),null;r.set(g,y)}const d=new n({view:a,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:p});a.tools.add(d),d.objects.addMany(Array.from(r.values())),o||this.updateGraphics.addMany(e);const u=[],v=new D({activeComponent:d,tool:i,type:"update",onEnd:()=>{P(u),ee(a,d),m()},undo:()=>{qe(this.view,d),X(v,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{Y(v,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:g=>{this.updateGraphics.push(g);const y=new h({view:a,graphic:g});r.set(g,y),d.objects.push(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:g=>{const y=this.updateGraphics.indexOf(g);if(v.history.undo.forEach(O=>O.updates.splice(y,1)),v.history.redo.forEach(O=>O.updates.splice(y,1)),this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void v.complete();const _=r.get(g);_&&(d.objects.remove(_),_.destroy(),r.delete(g))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||i!=="transform")return;const g=this.updateGraphics.at(0),y=await this._setupReshape3DOperation(g,t,a,!0);y&&!S(y)&&(v.onEnd(),v.destroy(),this._setUpdateOperationHandle(y,t))}});return u.push(...this._getHandlesForComponent(v,t),a.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(v,g,t),T.WIDGET),a.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(v,g)},T.WIDGET)),v}_setupGraphicTransform3DOperation(e,t,a,i=!1){if(e.length===1&&Ca(e[0])===0){const o=e[0],s=o.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(o,t,a);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,a,i)}return this._setupMove3DOperation(e,t,a,"transform",i)}async _setupPointTransform3DOperation(e,t,a){const i="transform",{enableRotation:o,enableScaling:s,enableZ:p}=t,h=await this._requireModule(C(()=>import("./ImageMaterial.glsl-DfkX5TuI.js").then(g=>g.e),__vite__mapDeps([66,1,2,64,4,10,11,67,43,3,41,12,13,9,42,6,7,68,69,70,37,14,71,72,73,74,20,75,76,77,78,79,80,81,82,39,40,61,83,84,85,86,19,87,88,89,90,91,92,38,93,94,95,96,97,5,8,33,34,35,36,15,44,45,98,46,16,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,99,100,63,101]),import.meta.url));if(S(h))return h;const{TransformTool3D:n,ManipulatedObject3DGraphic:r}=h.module,m=new r({graphic:e,view:a}),d=new n({object:m,view:a,enableRotation:o,enableScaling:s,enableZ:p,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(d),this.updateGraphics.add(e);const u=[],v=new D({activeComponent:d,tool:i,type:"update",onEnd:()=>{P(u),ee(a,d),m.destroy()},undo:()=>{qe(this.view,d),X(v,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{Y(v,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),v.onEnd(),v.destroy();const y=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);S(y)||this._setUpdateOperationHandle(y,t)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),v.complete()},toggleTool:()=>{}});return u.push(...this._getHandlesForComponent(v,t),a.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(v,g,t),T.WIDGET),a.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(v,g)},T.WIDGET)),v}async _setupPolyTransform3DOperation(e,t,a,i=!1){var we,Se;const o="transform",{enableRotation:s,enableScaling:p,enableZ:h,preserveAspectRatio:n}=t,[r,m]=await Promise.all([this._requireModule(C(()=>import("./ImageMaterial.glsl-DfkX5TuI.js").then(b=>b.e),__vite__mapDeps([66,1,2,64,4,10,11,67,43,3,41,12,13,9,42,6,7,68,69,70,37,14,71,72,73,74,20,75,76,77,78,79,80,81,82,39,40,61,83,84,85,86,19,87,88,89,90,91,92,38,93,94,95,96,97,5,8,33,34,35,36,15,44,45,98,46,16,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,99,100,63,101]),import.meta.url)),H()]);if(S(r))return r;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:u}=r.module,v=(Se=(we=this.view)==null?void 0:we.inputManager)==null?void 0:Se.isModifierKeyDown(w.constraint),g=new d({view:a,graphic:e}),y=new u({object:g,view:a,enableRotation:s,enableScaling:p,enableZ:h,preserveAspectRatio:!!n!=!!v,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:m});a.tools.add(y),i||this.updateGraphics.add(e);const _=[],O=new D({activeComponent:y,tool:o,type:"update",onEnd:()=>{P(_),ee(a,y),g.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async b=>{this.updateGraphics.add(b),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[b],removed:[],type:"selection-change"},type:"update"}),O.onEnd(),O.destroy();const Ee=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);S(Ee)||this._setUpdateOperationHandle(Ee,t)},removeFromSelection:b=>{this.updateGraphics.remove(b),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[b],type:"selection-change"},type:"update"}),O.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const b=await this._setupReshape3DOperation(e,t,a,!0);b&&!S(b)&&(O.onEnd(),O.destroy(),this._setUpdateOperationHandle(b,t))}});return _.push(...this._getHandlesForComponent(O,t),a.on("immediate-click",b=>this._getCommonUpdateOperationClickHandlers(O,b,t),T.WIDGET),a.on("key-down",b=>this._getCommonUpdateOperationKeyDownHandlers(O,b),T.WIDGET),a.on("key-down",b=>{b.key!==w.constraint||b.repeat||(y.preserveAspectRatio=!y.preserveAspectRatio,b.stopPropagation())},T.WIDGET),a.on("key-up",b=>{b.key===w.constraint&&(y.preserveAspectRatio=!y.preserveAspectRatio,b.stopPropagation())},T.WIDGET)),O}async _setupMove2DOperation(e,t,a){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,a);if(S(o))return o;const s=new D({activeComponent:o,tool:i,type:"update",onEnd:()=>{var r;this._clearCursor(),P(n),P(h),o.destroy(),(r=this._internalGraphicsLayer)==null||r.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const r=this.updateGraphics.toArray();X(s,r),s.refreshComponent(),this._emitUndoEvent({graphics:r,tool:i})},redo:()=>{const r=this.updateGraphics.toArray();Y(s,r),s.refreshComponent(),this._emitRedoEvent({graphics:r,tool:i})},addToSelection:async r=>{await this._updatingHandles.addPromise(this._updateSpatialReference(r)),this.updateGraphics.push(r),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[r],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:r=>{const m=this.updateGraphics.indexOf(r);s.history.undo.forEach(u=>u.updates.splice(m,1)),s.history.redo.forEach(u=>u.updates.splice(m,1)),this.updateGraphics.remove(r);const d=this.updateGraphics.toArray();this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[r],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=d:s.complete()}});let p=!1;const h=[a.on("immediate-click",r=>this._getCommonUpdateOperationClickHandlers(s,r,t),T.WIDGET),a.on("key-down",r=>{this._getCommonUpdateOperationKeyDownHandlers(s,r),r.key!==w.constraint||r.repeat||(p=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},T.WIDGET),a.on("key-up",r=>{r.key===w.constraint&&p&&(p=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},T.WIDGET)],n=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,a,i=!1){const o="reshape",[s,p,h]=await Promise.all([this._requireModule(C(()=>import("./ImageMaterial.glsl-DfkX5TuI.js").then(_=>_.e),__vite__mapDeps([66,1,2,64,4,10,11,67,43,3,41,12,13,9,42,6,7,68,69,70,37,14,71,72,73,74,20,75,76,77,78,79,80,81,82,39,40,61,83,84,85,86,19,87,88,89,90,91,92,38,93,94,95,96,97,5,8,33,34,35,36,15,44,45,98,46,16,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,99,100,63,101]),import.meta.url)),Q(),H()]);if(S(s))return s;const{ManipulatedObject3DGraphic:n,ReshapeTool3D:r}=s.module,m=new n({view:a,graphic:e}),d=Ga(m);if(d!==0)return m.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${De(d)}).`),null;const u=t.reshapeOptions,v=new r({view:a,object:m,enableZVertex:t.enableZ&&(u==null?void 0:u.vertexOperation)==="move",enableZShape:t.enableZ&&(u==null?void 0:u.shapeOperation)==="move",enableMoveObject:(u==null?void 0:u.shapeOperation)==="move"||(u==null?void 0:u.shapeOperation)==="move-xy",enableMidpoints:(u==null?void 0:u.edgeOperation)==="split",enableEdgeOffset:(u==null?void 0:u.edgeOperation)==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:p,automaticLengthMeasurementUtils:h});a.tools.add(v),i||this.updateGraphics.add(m.graphic);const g=[],y=new D({activeComponent:v,tool:o,type:"update",onEnd:()=>{P(g),ee(a,v),m.destroy()},canUndo:()=>!v.destroyed&&v.canUndo,undo:()=>{v.destroyed||(v.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!v.destroyed&&v.canRedo,redo:()=>{v.destroyed||(v.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);S(O)||this._setUpdateOperationHandle(O,t)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),y.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;y.onEnd(),y.destroy();const _=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,a,!0);S(_)||this._setUpdateOperationHandle(_,t)}});return g.push(...this._getHandlesForComponent(y,t),a.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(y,_,t),T.WIDGET),a.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(y,_)},T.WIDGET)),y}async _setupTransformOrReshape2DOperation(e,t,a,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,a,i):await this._getReshape(e,a,i);if(S(o))return o;const s=new D({activeComponent:o,type:"update",onEnd:()=>{P(h),P(p),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{X(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{Y(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async n=>{let r=s.activeComponent;if((r==null?void 0:r.type)==="reshape"){const m=[...this.updateGraphics,n];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const d=await this._setupTransformOrReshape2DOperation(m,"transform",a,i);if(S(d))return;this._setUpdateOperationHandle(d,a)}else this.updateGraphics.add(n),r.graphics=this.updateGraphics.toArray(),r.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{const r=this.updateGraphics.indexOf(n);s.history.undo.forEach(d=>d.updates.splice(r,1)),s.history.redo.forEach(d=>d.updates.splice(r,1)),this.updateGraphics.remove(n);const m=this.updateGraphics.toArray();m.length===0?s.complete():Ue(m)?s.toggleTool():s.activeComponent.graphics=m,this.emit("update",{graphics:m,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"})},toggleTool:async()=>{var d;if(this.updateGraphics.length>1)return;const n=this.updateGraphics.at(0),r=n.geometry;if(r!=null&&(s.tool==="reshape"&&r.type==="point"||s.tool==="transform"&&r.type==="extent"))return;let m=null;s.tool==="transform"?m=await this._getReshape([n],a,i):s.tool==="reshape"&&(m=await this._getBox([n],a,i)),S(m)||((d=s.activeComponent)==null||d.destroy(),s.activeComponent=m,s.activeComponent&&(P(h),h=this._getHandlesForComponent(s,a)))}}),p=[i.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(s,n,a),T.WIDGET),i.on("key-down",n=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,n),n.key===w.constraint&&!n.repeat&&s){const r=s.activeComponent;(r==null?void 0:r.type)==="box"&&(r.preserveAspectRatio=!r.preserveAspectRatio)}},T.WIDGET),i.on("key-up",n=>{if(n.key===w.constraint&&s){const r=s.activeComponent;(r==null?void 0:r.type)==="box"&&(r.preserveAspectRatio=!r.preserveAspectRatio)}},T.WIDGET)];let h=this._getHandlesForComponent(s,a);return s}async _getGraphicMover(e,t,a){const{enableMoveAllGraphics:i,highlightOptions:o}=t,s=await this._requireModule(C(()=>import("./GraphicMover-D5a_xS6Q.js").then(p=>p.G),__vite__mapDeps([117,1,2,16,65,44,7,4,45,27]),import.meta.url));return S(s)?s:new s.module.default({enableMoveAllGraphics:i,highlightName:o==null?void 0:o.name,highlightsEnabled:!!(o!=null&&o.enabled),indicatorsEnabled:!1,graphics:e,view:a,callbacks:{onGraphicMoveStart:({dx:p,dy:h,graphic:n})=>{this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:h,mover:n,type:"move-start"},type:"update"})},onGraphicMove:({dx:p,dy:h,graphic:n})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:h,mover:n,type:"move"},type:"update"}),onGraphicMoveStop:({dx:p,dy:h,graphic:n})=>{this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:h,mover:n,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(e,t,a){var m,d;const{enableRotation:i,enableScaling:o,highlightOptions:s,preserveAspectRatio:p}=t,[h,n]=await Promise.all([this._requireModule(C(()=>import("./Box-4PJs-DDB.js"),__vite__mapDeps([118,1,2,3,35,36,37,11,38,39,40,4,41,42,43,15,8,6,7,65,44,45,117,16,27,119,5,9,10,12,13,14,101,99,17,18,19,20,21]),import.meta.url)),H()]);if(S(h))return h;const r=(d=(m=this.view)==null?void 0:m.inputManager)==null?void 0:d.isModifierKeyDown(w.constraint);return new h.module.default({graphics:e,enableRotation:i,enableScaling:o,highlightName:s==null?void 0:s.name,highlightsEnabled:!!(s!=null&&s.enabled),preserveAspectRatio:!!p!=!!r,layer:this._internalGraphicsLayer,view:a,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:n,callbacks:{onMoveStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMove:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMoveStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScale:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotate:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"})}})}async _getReshape(e,t,a){const{highlightOptions:i,reshapeOptions:o}=t,s=(o==null?void 0:o.edgeOperation)==="split",p=(o==null?void 0:o.shapeOperation)==="move",h=!!(o!=null&&o.enableCreateCurveFromStraightEdge),[n,r,m]=await Promise.all([this._requireModule(C(()=>import("./Reshape-BrrC2N_-.js"),__vite__mapDeps([120,1,2,56,49,52,51,53,54,55,57,16,32,5,6,7,8,9,10,11,12,13,4,3,14,33,34,35,36,37,38,39,40,41,42,43,15,44,45,121,100,63,64,98,65,117,27,99,119,17,18,19,20,21]),import.meta.url)),Q(),H()]);return S(n)?n:new n.module.default({enableMidpoints:s,enableMovement:p,enableCurveOnMidpoint:h,graphic:e[0],highlightName:i==null?void 0:i.name,highlightsEnabled:!!(i!=null&&i.enabled),layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:m,view:a,callbacks:{onReshapeStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshape:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshapeStop:({mover:d,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d,type:u},type:"update"}),onMoveStart:({dx:d,dy:u,mover:v,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:v,type:g},type:"update"}),onMove:({dx:d,dy:u,mover:v,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:v,type:g},type:"update"}),onMoveStop:({dx:d,dy:u,mover:v,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:v,type:g},type:"update"}),onVertexAdd:({added:d,type:u,vertices:v})=>{const g=d.map(y=>Ae(y.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:g,vertices:v,type:u},type:"update"})},onVertexRemove:({removed:d,type:u,vertices:v})=>{const g=d.map(y=>Ae(y.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:g,vertices:v,type:u},type:"update"})}}})}_getHandlesForComponent(e,t){const a=e.activeComponent;if(!a)return[];switch(a.type){case"graphic-mover":return[a.on("graphic-click",({graphic:i,viewEvent:o})=>{var s;(s=o.native)!=null&&s.shiftKey&&t.multipleSelectionEnabled&&(o.stopPropagation(),e.removeFromSelection(i))}),a.on("graphic-move-start",i=>e.addToHistory($(i.allGraphics)))];case"box":return[a.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),a.on("move-start",i=>e.addToHistory($(i.graphics))),a.on("rotate-start",i=>e.addToHistory($(i.graphics))),a.on("scale-start",i=>e.addToHistory($(i.graphics)))];case"reshape":return[a.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),a.on("move-start",i=>e.addToHistory($([i.mover]))),a.on("reshape-start",i=>e.addToHistory($([i.graphic]))),a.on("vertex-add",i=>e.addToHistory($([i.oldGraphic]))),a.on("vertex-remove",i=>e.addToHistory($([i.oldGraphic])))];case"move-3d":return[a.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),a.events.on("move-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-start"},type:"update"})}),a.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:i.dx,dy:i.dy,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move"},type:"update"})}),a.events.on("move-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-stop"},type:"update"})}),a.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[a.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),a.events.on("translate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-start"},type:"update"})}),a.events.on("translate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-stop"},type:"update"})}),a.events.on("rotate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-start"},type:"update"})}),a.events.on("rotate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-stop"},type:"update"})}),a.events.on("scale-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-start"},type:"update"})}),a.events.on("scale-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-stop"},type:"update"})}),a.events.on("translate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move"},type:"update"})}),a.events.on("rotate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate"},type:"update"})}),a.events.on("scale",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale"},type:"update"})}),a.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[a.events.on("reshape",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),a.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),a.events.on("vertex-add",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),a.events.on("vertex-remove",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),a.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,a){var s;const{graphic:i,viewEvent:o}=a;return(s=o.native)!=null&&s.shiftKey&&this.hasGraphic(i)?(o.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){var o;this._operationHandle=e;const a=(o=this.view)==null?void 0:o.map;this._disablePopup(t);const i=()=>{if(e===this._operationHandle){const s=this.updateGraphics.toArray(),p=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),a&&a.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:s,state:"complete",aborted:e.cancelled,tool:p,toolEventInfo:null,type:"update"})}};e.on("complete",i)}async _getCommonUpdateOperationClickHandlers(e,t,a){const i=Ce(t),o=await t.defer(()=>this._getFirstHit(i));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,a))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,a){const i=!!a.multipleSelectionEnabled;return e.some(o=>o!=null&&!(!i||!this.hasGraphic(o))&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const a=t.key;a===w.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):a===w.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):a===w.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&w.delete.includes(a)&&this._onDeleteKey(t)}_onDeleteKey(e){this._operationHandle&&this._operationHandle.type==="update"&&this.activeComponent!=null&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){var e,t;this._internalGraphicsLayer&&((t=(e=this.view)==null?void 0:e.map)==null||t.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=K(this._internalGraphicsLayer))}_isComponentGraphic(e){var a;const{activeComponent:t}=this;return!(!e||t==null)&&(((a=e.attributes)==null?void 0:a.esriSketchTool)||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_clearCursor(){this.removeHandles(ge)}_displayCursor(e){var t;this.removeHandles(ge),(t=this.view)!=null&&t.container&&e!=null&&this.addHandles(this.view.acquireCursor(e,"high"),ge)}_logError(e,t,a){We.getLogger(this).error(new Ft(e,t,a))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const a=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:a}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}_onLayerGraphicsChangeCallback(e){if(this._operationHandle!=null){const{updateGraphics:t}=this;for(const a of e.removed)if(t.includes(a)){if(!(t.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(a)}}}get test(){}wait(){return Me(()=>!this.updating)}_disablePopupEnabled(e){var t;return((t=this.view)==null?void 0:t.type)!=="3d"||this.updateOnGraphicClick||((e==null?void 0:e.toggleToolOnClick)??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(pe(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await jt(Me(()=>e==null?void 0:e.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",je("view"))}_logMissingLayer(){this._logError(ci,je("layer"))}};l([c()],f.prototype,"_defaultSnappingManager",void 0),l([c()],f.prototype,"_layerAdapter",null),l([c()],f.prototype,"_operationHandle",void 0),l([c({readOnly:!0})],f.prototype,"_updatingHandles",void 0),l([c({readOnly:!0})],f.prototype,"activeTool",null),l([c({readOnly:!0})],f.prototype,"activeCreateToolDrawMode",null),l([c()],f.prototype,"activeTooltip",null),l([c({types:V})],f.prototype,"activeFillSymbol",void 0),l([c()],f.prototype,"activeLineSymbol",void 0),l([c()],f.prototype,"activeVertexSymbol",void 0),l([c()],f.prototype,"allowDeleteKey",void 0),l([c({readOnly:!0})],f.prototype,"createGraphic",null),l([c()],f.prototype,"defaultCreateOptions",null),l([c()],f.prototype,"defaultUpdateOptions",null),l([c({type:ia,nonNullable:!0})],f.prototype,"labelOptions",null),l([c()],f.prototype,"layer",void 0),l([c({types:V})],f.prototype,"pointSymbol",void 0),l([c({types:V})],f.prototype,"polygonSymbol",void 0),l([c({types:V})],f.prototype,"polylineSymbol",void 0),l([c()],f.prototype,"meshSymbol",void 0),l([c()],f.prototype,"textSymbol",void 0),l([c({type:E,nonNullable:!0})],f.prototype,"snappingOptions",null),l([c()],f.prototype,"snappingManager",null),l([c({readOnly:!0})],f.prototype,"state",null),l([c({type:oa,nonNullable:!0})],f.prototype,"tooltipOptions",null),l([c({readOnly:!0})],f.prototype,"updateGraphics",void 0),l([c()],f.prototype,"updateOnGraphicClick",void 0),l([c()],f.prototype,"updating",null),l([c()],f.prototype,"creationMode",void 0),l([c({type:sa,nonNullable:!0})],f.prototype,"valueOptions",null),l([c({types:V})],f.prototype,"vertexSymbol",void 0),l([c({value:null})],f.prototype,"view",null),l([c({constructOnly:!0,type:Qe})],f.prototype,"sketchOptions",void 0),f=l([L("esri.widgets.Sketch.SketchViewModel")],f);const ci="sketch:missing-property",je=e=>`Property '${e}' is missing on SketchViewModel.`;function di(e){return e==="polygon"||e==="rectangle"||e==="circle"}function X(e,t){st("undo",e.history.undo,e.history.redo,t)}function Y(e,t){st("redo",e.history.redo,e.history.undo,t)}function st(e,t,a,i){const o=t.pop();if(!o)return;const s=o.updates,p=[];i.forEach((h,n)=>{const r=s[n];r!=null&&("geometry"in r&&r.geometry!=null&&(p.push({geometry:h.geometry}),h.geometry=r.geometry),"symbol"in r&&r.symbol!=null&&(p.push({symbol:h.symbol}),h.symbol=r.symbol),"undo"in r&&(p.push(r),r[e](h)))}),a.push({updates:p})}function qe(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function $(e){return{updates:e.map(({geometry:t})=>(t==null?void 0:t.type)==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function ee(e,t){var a;(a=e.tools)==null||a.remove(t),t.destroyed||t.destroy()}function S(e){return"requireError"in e&&e.requireError==="aborted"}export{Ra as a,Ye as b,Oi as c,f as d,Pa as e,Ha as f,k as g,Da as h,ka as i,xa as j,Ta as k,Gi as l,te as n,$a as r,La as s,$e as t,E as u};
