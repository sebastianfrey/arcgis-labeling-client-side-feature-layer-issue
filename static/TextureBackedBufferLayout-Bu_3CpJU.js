import{S as b,z as g,d,f as w,a as _,x,B as c}from"./BufferView-CruTDoyp.js";import{e as p}from"./types-BKo2foNY.js";class f{constructor(r,e,t){this.elementCount=r,this.elementType=e,this.bufferViewConstructor=t,this.byteSize=T(t)}}function T(s){return p(s.ElementType)*s.ElementCount}const S={u8:new f(1,"uint",b),vec4u8:new f(4,"uint",g),unorm8:new f(1,"float",d),vec4unorm8:new f(4,"float",w),f16:new f(1,"float",_?x:c),f32:new f(1,"float",c)};let C=class{constructor(r,e,t,o){this._declaration=r,this._byteOffset=e,this._creationInfo=o,this._startTexel=Math.floor(e/t);const l=o.byteSize;this._numTexels=Math.ceil((e+l)/t)-this._startTexel;let i=this._startTexel,n=e%t;const u=[],h=["x","y","z","w"];for(let a=0;a<l;++a){const m=`texel${i}.${h[n]}`;u.push(m),++n,n>=t&&(n=0,++i)}this._glslDecodeArgumentString=u.join(", ")}get name(){return this._declaration.name}get fieldType(){return this._declaration.type}get byteOffset(){return this._byteOffset}get startTexel(){return this._startTexel}get numTexels(){return this._numTexels}get elementType(){return this._creationInfo.elementType}get elementCount(){return this._creationInfo.elementCount}get glslDecodeArgumentString(){return this._glslDecodeArgumentString}get bufferViewConstructor(){return this._creationInfo.bufferViewConstructor}};class y{constructor(r,e,t){this.layout=r,this._bufferViews=new Map,this.buffer=typeof e=="number"?new ArrayBuffer(e*r.byteStride):e,this.texelElementBuffer=new t(this.buffer,0);const o=this._bufferViews;for(const[l,i]of this.layout.fields)o.set(l,new i.bufferViewConstructor(this.buffer,i.byteOffset,this.layout.byteStride))}get stride(){return this.layout.byteStride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(r,e){const t=this._bufferViews.get(r);return t!=null&&t.elementCount===e.ElementCount&&t.elementType===e.ElementType?t:null}get usedMemory(){return this.byteLength}}class I{constructor(r){this._fields=new Map,this.texelByteStride=4,this.texelElementArrayConstructor=Uint8Array;let e=0;const t=[];for(let n=0;n<r.length;++n){const u=r[n],{type:h}=u,a=S[h];t.push({declaration:u,byteOffset:e,creationInfo:a}),e+=a.byteSize}e=A(e);const o=e,l=this._fields,{texelByteStride:i}=this;for(const{declaration:n,byteOffset:u,creationInfo:h}of t)l.set(n.name,new C(n,u,i,h));this.byteStride=o,this.texelStride=Math.ceil(o/i)}get fields(){return this._fields}createBuffer(r){return new y(this,r,this.texelElementArrayConstructor)}createView(r){return new y(this,r,this.texelElementArrayConstructor)}}function A(s){return s+3&-4}export{I as i};
