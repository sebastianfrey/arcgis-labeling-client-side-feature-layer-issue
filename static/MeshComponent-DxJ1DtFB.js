import{b2 as y,hl as M,dj as x,o9 as L,aJ as s,aK as o,mc as U,e1 as H,c9 as N,aL as d,bb as T,d3 as C,aF as D,hz as j}from"./index-C_bK48d2.js";import{u as E,a as I,b as R,n as O,r as S}from"./meshProperties-BrNWSC8G.js";var g;const f=new WeakMap;let A=0;var p;let n=(p=class extends y(T){constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,a,i){if(e instanceof HTMLImageElement){const l={type:"image-element",src:M(e.src,i),crossOrigin:e.crossOrigin};t[a]=l}else if(e instanceof HTMLCanvasElement){const l={type:"canvas-element",imageData:b(e.getContext("2d").getImageData(0,0,e.width,e.height))};t[a]=l}else if(e instanceof HTMLVideoElement){const l={type:"video-element",src:M(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[a]=l}else if(e instanceof ImageData){const l={type:"image-data",imageData:b(e)};t[a]=l}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=$(e.imageData),a=document.createElement("canvas");return a.width=t.width,a.height=t.height,a.getContext("2d").putImageData(t,0,0),a}case"image-data":return $(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const{data:e,url:t}=this,a=i=>(i==null?void 0:i.toLowerCase().endsWith(".png"))||(i==null?void 0:i.toLocaleLowerCase().startsWith("data:image/png;"));return e instanceof HTMLCanvasElement?_(e.getContext("2d").getImageData(0,0,e.width,e.height)):e instanceof ImageData?_(e):!(!t||!a(t))||!!(e instanceof HTMLImageElement&&a(e.src))}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(a="")=>`d:${a},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(f.has(this.data)||f.set(this.data,++A),t(f.get(this.data))):t()}get memoryUsage(){let e=0;if(e+=this.url!=null?this.url.length:0,this.data!=null){const t=this.data;"data"in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}clone(e){var l,w;const t=E(e),a=(l=t==null?void 0:t.textureMap)==null?void 0:l.get(this);if(a)return a;const i=super.clone(e);return(w=t==null?void 0:t.textureMap)==null||w.set(this,i),i}static from(e){return typeof e=="string"?new g({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new g({data:e}):x(g,e)}},g=p,p);function b(r){let e="";for(let t=0;t<r.data.length;t++)e+=String.fromCharCode(r.data[t]);return{data:btoa(e),width:r.width,height:r.height}}function $(r){const e=atob(r.data),t=new Uint8ClampedArray(e.length);for(let a=0;a<e.length;a++)t[a]=e.charCodeAt(a);return L(t,r.width,r.height)}function _(r){for(let e=3;e<r.data.length;e+=4)if(r.data[e]!==255)return!0;return!1}s([o({type:String,json:{write:U}})],n.prototype,"url",null),s([o({clonable:"reference",json:{write:{overridePolicy(){return{enabled:!this.url}}}}})],n.prototype,"data",null),s([H("data")],n.prototype,"writeData",null),s([N("data")],n.prototype,"readData",null),s([o({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],n.prototype,"transparent",null),s([o({json:{write:!0}})],n.prototype,"wrap",void 0),s([o({readOnly:!0})],n.prototype,"contentHash",null),n=g=s([d("esri.geometry.support.MeshTexture")],n);let c=class extends y(T){constructor(r){super(r),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};s([o({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"offset",void 0),s([o({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"rotation",void 0),s([o({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"scale",void 0),c=s([d("esri.geometry.support.MeshTextureTransform")],c);let m=class extends y(T){constructor(r){super(r),this.color=null,this.colorTextureTransform=null,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}get colorTexture(){return this._get("colorTexture")}set colorTexture(r){this._set("colorTexture",r==null?null:n.from(r))}get normalTexture(){return this._get("normalTexture")}set normalTexture(r){this._set("normalTexture",r==null?null:n.from(r))}clone(r){var i,l;const e=I(r),t=(i=e==null?void 0:e.materialMap)==null?void 0:i.get(this);if(t)return t;const a=super.clone(R(r));return(l=e==null?void 0:e.materialMap)==null||l.set(this,a),a}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let r=0;return r+=this.color!=null?16:0,this.colorTexture!=null&&(r+=this.colorTexture.memoryUsage),r+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(r+=this.normalTexture.memoryUsage),r+=this.normalTextureTransform!=null?20:0,r}};s([o({type:C,json:{write:!0}})],m.prototype,"color",void 0),s([o({type:n,json:{write:!0},value:null})],m.prototype,"colorTexture",null),s([o({type:c,json:{write:!0}})],m.prototype,"colorTextureTransform",void 0),s([o({type:n,json:{write:!0},value:null})],m.prototype,"normalTexture",null),s([o({type:c,json:{write:!0}})],m.prototype,"normalTextureTransform",void 0),s([o({nonNullable:!0,json:{write:!0}})],m.prototype,"alphaMode",void 0),s([o({nonNullable:!0,json:{write:!0}})],m.prototype,"alphaCutoff",void 0),s([o({nonNullable:!0,json:{write:!0}})],m.prototype,"doubleSided",void 0),m=s([d("esri.geometry.support.MeshMaterial")],m);let u=class extends m{constructor(e){super(e),this.emissiveColor=null,this.emissiveStrength=null,this.emissiveTextureTransform=void 0,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTextureTransform=void 0}get emissiveTexture(){return this._get("emissiveTexture")}set emissiveTexture(e){this._set("emissiveTexture",e==null?null:n.from(e))}get occlusionTexture(){return this._get("occlusionTexture")}set occlusionTexture(e){this._set("occlusionTexture",e==null?null:n.from(e))}get metallicRoughnessTexture(){return this._get("metallicRoughnessTexture")}set metallicRoughnessTexture(e){this._set("metallicRoughnessTexture",e==null?null:n.from(e))}getMemoryUsage(){let e=super.getMemoryUsage();return e+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(e+=this.emissiveTexture.memoryUsage),e+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(e+=this.occlusionTexture.memoryUsage),e+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=this.metallicRoughnessTextureTransform!=null?20:0,e}};s([o({type:C,json:{write:!0}})],u.prototype,"emissiveColor",void 0),s([o({json:{write:!0}})],u.prototype,"emissiveStrength",void 0),s([o({type:n,json:{write:!0},value:null})],u.prototype,"emissiveTexture",null),s([o({type:c,json:{write:!0}})],u.prototype,"emissiveTextureTransform",void 0),s([o({type:n,json:{write:!0},value:null})],u.prototype,"occlusionTexture",null),s([o({type:c,json:{write:!0}})],u.prototype,"occlusionTextureTransform",void 0),s([o({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],u.prototype,"metallic",void 0),s([o({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],u.prototype,"roughness",void 0),s([o({type:n,json:{write:!0},value:null})],u.prototype,"metallicRoughnessTexture",null),s([o({type:c,json:{write:!0}})],u.prototype,"metallicRoughnessTextureTransform",void 0),u=s([d("esri.geometry.support.MeshMaterialMetallicRoughness")],u);var v;let h=v=class extends y(T){static from(r){return x(v,r)}constructor(r){super(r),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(r){return O(r,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},D.getLogger(this))}castMaterial(r){return x(r&&typeof r=="object"&&("metallic"in r||"roughness"in r||"metallicRoughnessTexture"in r)?u:m,r)}get memoryUsage(){let r=0;return this.faces!=null&&(r+=this.faces.byteLength),this.material!=null&&(r+=this.material.memoryUsage),r}};s([o({json:{write:S}})],h.prototype,"faces",void 0),s([j("faces")],h.prototype,"castFaces",null),s([o({type:m,json:{write:!0}})],h.prototype,"material",void 0),s([j("material")],h.prototype,"castMaterial",null),s([o({json:{write:!0}})],h.prototype,"name",void 0),s([o({type:String,json:{write:!0}})],h.prototype,"shading",void 0),s([o({type:Boolean})],h.prototype,"trustSourceNormals",void 0),h=v=s([d("esri.geometry.support.MeshComponent")],h);export{n as g,h,c as p,u};
