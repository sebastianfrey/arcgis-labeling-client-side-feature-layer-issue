import{db as u,eV as b,ap as m,fx as w,f$ as k,aJ as l,aK as c,aL as _}from"./index-C_bK48d2.js";import{h as f}from"./GraphicsLayer-CFgfYbpT.js";import{h as v,a as M,T as B,w as V}from"./Stop-DjYDsPQB.js";import{d as L}from"./SketchViewModel-BpdG2zzZ.js";import"./networkEnums-BSO0mlrW.js";import"./hitTestSelectUtils-xrNddzEE.js";import"./projectVectorToVector-IRvjF_FZ.js";import"./projectPointToVector-oWOZnQKe.js";import"./geodesicUtils-CTZo9mb6.js";import"./plane-CYaN818s.js";import"./vectorStacks-CpRnv_41.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-Dx28BAGo.js";import"./ray-DFDOQn-4.js";import"./elevationInfoUtils-C7MilKvD.js";import"./quantity-wpyqwS5w.js";import"./spatialReferenceEllipsoidUtils-DtI6yob-.js";import"./geodeticLengthOperator-BhsSOjnG.js";import"./geodeticCurveType-CirnHLSB.js";import"./earcut-Lltz9D9k.js";import"./triangle-Bs-n1Sd1.js";import"./geodeticAreaOperator-D2z_GCTf.js";function y(e,r){e.networkFeature=r}function S(e){const r=n(e.graphic);return{...e,networkFeature:r}}function F(e){const r=e.graphics.map(i=>n(i));return{...e,networkFeatures:r}}function n(e){return e.networkFeature}function $(e){return(e==null?void 0:e.type)==="point"||(e==null?void 0:e.type)==="polyline"||(e==null?void 0:e.type)==="polygon"}let s=class extends u{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new f({internal:!0,listMode:"hide"}),this._sketchViewModel=new L({layer:this._graphicsLayer}),this._updatingHandles=new b,this.enabled=!0,this._handleSketchViewModelEvents=async r=>{var i,o;switch(r.type){case"update":switch(r.state){case"active":case"complete":for(const t of r.graphics)n(t).geometry=$(t.geometry)?t.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const t of r.graphics){const p=n(t);this._removeNetworkFeature(p)}break;case"create":if(r.graphic&&r.state==="complete"&&this._createMode){const t=(i=r.graphic.geometry)==null?void 0:i.clone(),p=(o=r.graphic.symbol)==null?void 0:o.clone();if(!t)break;switch(this._createMode){case"stop":{if(t.type!=="point")break;const{stops:a}=this.layer;if(a.length>0&&a.every(({geometry:h})=>!h)){a.at(0).geometry=t;break}if(a.length>1&&a.filter((h,g)=>g!==0).every(({geometry:h})=>!h)){a.at(1).geometry=t;break}const d=new V({geometry:t});a.add(d),y(r.graphic,d);break}case"point-barrier":{if(t.type!=="point")break;const a=new B({geometry:t,symbol:p});this.layer.pointBarriers.add(a),y(r.graphic,a);break}case"polyline-barrier":{if(t.type!=="polyline")break;const a=new M({geometry:t,symbol:p});this.layer.polylineBarriers.add(a),y(r.graphic,a);break}case"polygon-barrier":{if(t.type!=="polygon")break;const a=new v({geometry:t,symbol:p});this.layer.polygonBarriers.add(a),y(r.graphic,a);break}}}}(await this.view.whenLayerView(this.layer)).emit(r.type,r.type==="create"?S(r):F(r))}}initialize(){this._sketchViewModel.view=this.view,this.addHandles([m(()=>this.enabled,e=>{e?this._activate():this._deactivate()},w),m(()=>{const{stops:e,pointBarriers:r,polylineBarriers:i,polygonBarriers:o}=this.layer;return{stops:e,pointBarriers:r,polylineBarriers:i,polygonBarriers:o}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),k(this._updatingHandles)])}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._sketchViewModel.destroy(),this._updatingHandles.destroy()}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>n(e))}get updating(){return this._updatingHandles.updating}create(e){var r;switch(this._createMode=e,e){case"stop":(r=this.layer.defaultSymbols.stops)!=null&&r.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const r=this._graphicsLayer.graphics.find(i=>n(i)===e);r&&this._graphicsLayer.remove(r),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){var e;this._sketchViewModel.cancel(),(e=this.view.map)==null||e.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(r=>r.toArray().map(i=>{const o=i.toGraphic();return o.networkFeature=i,o}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};l([c()],s.prototype,"enabled",void 0),l([c({constructOnly:!0})],s.prototype,"layer",void 0),l([c({readOnly:!0})],s.prototype,"selectedNetworkFeatures",null),l([c()],s.prototype,"updating",null),l([c({constructOnly:!0})],s.prototype,"view",void 0),s=l([_("esri.views.2d.layers.support.RouteLayerInteraction")],s);export{s as RouteLayerInteraction};
