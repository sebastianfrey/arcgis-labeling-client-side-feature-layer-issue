import{l as w}from"./ClassBreaksDefinition-C5eqXtrO.js";import{aF as E}from"./index-C_bK48d2.js";const B=()=>E.getLogger("esri.rest.support.generateRendererUtils");function x(n,e){return Number(n.toFixed(e))}function gn(n){const e=q(n),t=[],a=e.uniqueValues.length;for(let l=0;l<a;l++){const s=e.uniqueValues[l],m=e.valueFrequency[l],i=s.toString();t.push({value:s,count:m,label:i})}return{uniqueValues:t}}function O(n,e){const{normalizationTotal:t}=n;return{classBreaks:U(n,e),normalizationTotal:t}}function U(n,e){const t=n.definition,{classificationMethod:a,normalizationType:l,definedInterval:s}=t,m=t.breakCount??1,i=[];let u=n.values;if(u.length===0)return[];u=u.sort((c,r)=>c-r);const[p,d]=e??[u.at(0),u.at(-1)];if(a==="equal-interval")if(u.length>=m){const c=(d-p)/m;let r=p;for(let o=1;o<m;o++){const f=x(p+o*c,6);i.push({minValue:r,maxValue:f,label:b(r,f,l)}),r=f}i.push({minValue:r,maxValue:d,label:b(r,d,l)})}else u.forEach(c=>{i.push({minValue:c,maxValue:c,label:b(c,c,l)})});else if(a==="natural-breaks"){const c=q(u),r=n.valueFrequency||c.valueFrequency,o=P(c.uniqueValues,r,m);let f=p;for(let h=1;h<m;h++)if(c.uniqueValues.length>h){const v=x(c.uniqueValues[o[h]],6);i.push({minValue:f,maxValue:v,label:b(f,v,l)}),f=v}i.push({minValue:f,maxValue:d,label:b(f,d,l)})}else if(a==="quantile")if(u.length>=m&&p!==d){let c=p,r=Math.ceil(u.length/m),o=0;for(let f=1;f<m;f++){let h=r+o-1;h>u.length&&(h=u.length-1),h<0&&(h=0),i.push({minValue:c,maxValue:u[h],label:b(c,u[h],l)}),c=u[h],o+=r,r=Math.ceil((u.length-o)/(m-f))}i.push({minValue:c,maxValue:d,label:b(c,d,l)})}else{let c=-1;for(let r=0;r<u.length;r++){const o=u[r];o!==c&&(c=o,i.push({minValue:c,maxValue:o,label:b(c,o,l)}),c=o)}}else if(a==="standard-deviation"){const c=A(u),r=_(u,c);if(r===0)i.push({minValue:u[0],maxValue:u[0],label:b(u[0],u[0],l)});else{const o=G(p,d,m,c,r)*r;let f=0,h=p;for(let V=m;V>=1;V--){const g=x(c-(V-.5)*o,6);i.push({minValue:h,maxValue:g,label:b(h,g,l)}),h=g,f++}let v=x(c+.5*o,6);i.push({minValue:h,maxValue:v,label:b(h,v,l)}),h=v,f++;for(let V=1;V<=m;V++)v=f===2*m?d:x(c+(V+.5)*o,6),i.push({minValue:h,maxValue:v,label:b(h,v,l)}),h=v,f++}}else if(a==="defined-interval"){if(!s)return i;const[c,r]=e??[u.at(0),u.at(-1)],o=Math.ceil((r-c)/s);let f=c;for(let h=1;h<o;h++){const v=x(c+h*s,6);i.push({minValue:f,maxValue:v,label:b(f,v,l)}),f=v}i.push({minValue:f,maxValue:r,label:b(f,r,l)})}return i}function b(n,e,t){let a=null;return a=n===e?t&&t==="percent-of-total"?n+"%":n.toString():t&&t==="percent-of-total"?n+"% - "+e+"%":n+" - "+e,a}function q(n){const e=[],t=[];let a=Number.MIN_VALUE,l=1,s=-1;for(let m=0;m<n.length;m++){const i=n[m];i===a?(l++,t[s]=l):i!==null&&(e.push(i),a=i,l=1,t.push(l),s++)}return{uniqueValues:e,valueFrequency:t}}function P(n,e,t){const a=n.length,l=[];t>a&&(t=a);for(let m=0;m<t;m++)l.push(Math.round(m*a/t-1));l.push(a-1);let s=D(l,n,e,t);return L(s.mean,s.sdcm,l,n,e,t)&&(s=D(l,n,e,t)),l}function D(n,e,t,a){let l=[],s=[],m=[],i=0;const u=[],p=[];for(let o=0;o<a;o++){const f=T(o,n,e,t);u.push(f.sbMean),p.push(f.sbSdcm),i+=p[o]}let d,c=i,r=!0;for(;r||i<c;){r=!1,l=[];for(let o=0;o<a;o++)l.push(n[o]);for(let o=0;o<a;o++)for(let f=n[o]+1;f<=n[o+1];f++)if(d=e[f],o>0&&f!==n[o+1]&&Math.abs(d-u[o])>Math.abs(d-u[o-1]))n[o]=f;else if(o<a-1&&n[o]!==f-1&&Math.abs(d-u[o])>Math.abs(d-u[o+1])){n[o+1]=f-1;break}c=i,i=0,s=[],m=[];for(let o=0;o<a;o++){s.push(u[o]),m.push(p[o]);const f=T(o,n,e,t);u[o]=f.sbMean,p[o]=f.sbSdcm,i+=p[o]}}if(i>c){for(let o=0;o<a;o++)n[o]=l[o],u[o]=s[o],p[o]=m[o];i=c}return{mean:u,sdcm:p}}function L(n,e,t,a,l,s){let m=0,i=0,u=0,p=0,d=!0;for(let c=0;c<2&&d;c++){c===0&&(d=!1);for(let r=0;r<s-1;r++)for(;t[r+1]+1!==t[r+2];){t[r+1]=t[r+1]+1;const o=T(r,t,a,l);u=o.sbMean,m=o.sbSdcm;const f=T(r+1,t,a,l);if(p=f.sbMean,i=f.sbSdcm,!(m+i<e[r]+e[r+1])){t[r+1]=t[r+1]-1;break}e[r]=m,e[r+1]=i,n[r]=u,n[r+1]=p,d=!0}for(let r=s-1;r>0;r--)for(;t[r]!==t[r-1]+1;){t[r]=t[r]-1;const o=T(r-1,t,a,l);u=o.sbMean,m=o.sbSdcm;const f=T(r,t,a,l);if(p=f.sbMean,i=f.sbSdcm,!(m+i<e[r-1]+e[r])){t[r]=t[r]+1;break}e[r-1]=m,e[r]=i,n[r-1]=u,n[r]=p,d=!0}}return d}function G(n,e,t,a,l){let s=Math.max(a-n,e-a)/l/t;return s=s>=1?1:s>=.5?.5:.25,s}function A(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e/=n.length,e}function _(n,e){let t=0;for(let a=0;a<n.length;a++){const l=n[a];t+=(l-e)*(l-e)}return t/=n.length,Math.sqrt(t)}function T(n,e,t,a){let l=0,s=0;for(let u=e[n]+1;u<=e[n+1];u++){const p=a[u];l+=t[u]*p,s+=p}s<=0&&B().warn("Exception in Natural Breaks calculation");const m=l/s;let i=0;for(let u=e[n]+1;u<=e[n+1];u++)i+=a[u]*(t[u]-m)**2;return{sbMean:m,sbSdcm:i}}const Y="<Null>",j="equal-interval",Q=1,R=5,H=10,J=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,K=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),W=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),X=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function y(n){return n==null||typeof n=="string"&&!n?Y:n}function Z(n){const e=n.normalizationField!=null||n.normalizationType!=null,t=n.minValue!=null||n.maxValue!=null,a=!!n.sqlExpression&&n.supportsSQLExpression;return!e&&!t&&!a}function bn(n){var m,i;const{outStatisticTypes:e}=n,t=n.returnDistinct?[...new Set(n.values)]:n.values,a=t.filter(u=>u!=null).sort(),l=a.length,s={count:l,min:a[0],max:a[l-1]};return n.supportsNullCount&&(s.nullcount=t.length-l),!n.percentileParams||(m=e==null?void 0:e.include)!=null&&m.length&&!e.include.includes("median")||(i=e==null?void 0:e.exclude)!=null&&i.length&&e.exclude.includes("median")||(s.median=k(t,n.percentileParams)),s}function nn(n){var h,v;const{values:e,useSampleStdDev:t,supportsNullCount:a,outStatisticTypes:l}=n;let s=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,i=null,u=null,p=null,d=null,c=0;const r=n.minValue==null?-1/0:n.minValue,o=n.maxValue==null?1/0:n.maxValue;for(const V of e)Number.isFinite(V)?V>=r&&V<=o&&(i=i===null?V:i+V,s=Math.min(s,V),m=Math.max(m,V),c++):typeof V=="string"&&c++;if(c&&i!=null){u=i/c;let V=0;for(const g of e)Number.isFinite(g)&&g>=r&&g<=o&&(V+=(g-u)**2);d=t?c>1?V/(c-1):0:c>0?V/c:0,p=Math.sqrt(d)}else s=null,m=null;const f={avg:u,count:c,max:m,min:s,stddev:p,sum:i,variance:d};return a&&(f.nullcount=e.length-c),!n.percentileParams||(h=l==null?void 0:l.include)!=null&&h.length&&!l.include.includes("median")||(v=l==null?void 0:l.exclude)!=null&&v.length&&l.exclude.includes("median")||(f.median=k(e,n.percentileParams)),f}function k(n,e){const{fieldType:t,value:a,orderBy:l,isDiscrete:s}=e,m=en(t,l==="desc","case-insensitive");if((n=[...n].filter(o=>o!=null).sort((o,f)=>m(o,f))).length===0)return null;if(a<=0)return n[0];if(a>=1)return n[n.length-1];const i=(n.length-1)*a,u=Math.floor(i),p=u+1,d=i%1,c=n[u],r=n[p];return p>=n.length||s||typeof c=="string"||typeof r=="string"?c:c*(1-d)+r*d}function en(n,e,t="case-sensitive"){if(n){if(K.has(n))return $(e);if(W.has(n))return I(e,!0);if(n==="esriFieldTypeTimestampOffset")return an(e);const i=I(e,t==="case-sensitive");if(n==="esriFieldTypeString")return i;if(n==="esriFieldTypeGUID"||n==="esriFieldTypeGlobalID")return(u,p)=>i(N(u),N(p))}const a=e?1:-1,l=$(e),s=I(e,t==="case-sensitive"),m=C(e);return(i,u)=>typeof i=="number"&&typeof u=="number"?l(i,u):typeof i=="string"&&typeof u=="string"?s(i,u):m(i,u)??a}const F=(n,e)=>n==null?e==null?0:1:e==null?-1:null,M=(n,e)=>n==null?e==null?0:-1:e==null?1:null;function C(n){return n?F:M}const tn=(n,e)=>M(n,e)??(n===e?0:new Date(n).getTime()-new Date(e).getTime()),ln=(n,e)=>F(n,e)??(n===e?0:new Date(e).getTime()-new Date(n).getTime());function an(n){return n?ln:tn}const un=(n,e)=>M(n,e)??(n===e?0:n<e?-1:1),on=(n,e)=>F(n,e)??(n===e?0:n<e?1:-1);function I(n,e){if(e)return n?on:un;const t=C(n);return n?(a,l)=>{const s=t(a,l);return s??((a=a.toUpperCase())>(l=l.toUpperCase())?-1:a<l?1:0)}:(a,l)=>{const s=t(a,l);return s??((a=a.toUpperCase())<(l=l.toUpperCase())?-1:a>l?1:0)}}const rn=(n,e)=>F(n,e)??e-n,sn=(n,e)=>M(n,e)??n-e;function $(n){return n?rn:sn}function N(n){return n.slice(24,36)+n.slice(19,23)+n.slice(16,18)+n.slice(14,16)+n.slice(11,13)+n.slice(9,11)+n.slice(6,8)+n.slice(4,6)+n.slice(2,4)+n.slice(0,2)}function xn(n,e,t){var l,s;let a;for(a in n)(l=e==null?void 0:e.include)!=null&&l.length&&!e.include.includes(a)||(s=e==null?void 0:e.exclude)!=null&&s.length&&e.exclude.includes(a)?delete n[a]:X.includes(a)&&(Number.isFinite(n[a])||(n[a]=null));return t&&["avg","stddev","variance"].forEach(m=>{n[m]!=null&&(n[m]=Math.ceil(n[m]??0))}),n}function Tn(n){const e={};for(let t of n)(t==null||typeof t=="string"&&t.trim()==="")&&(t=null),e[t]==null?e[t]={count:1,data:t}:e[t].count++;return{count:e}}function z(n){return(n==null?void 0:n.type)!=="coded-value"?[]:n.codedValues.map(e=>e.code)}function yn(n,e,t,a){const l=n.count,s=[];if(t&&e){const m=[],i=z(e[0]);for(const u of i)if(e[1]){const p=z(e[1]);for(const d of p)if(e[2]){const c=z(e[2]);for(const r of c)m.push(`${y(u)}${a}${y(d)}${a}${y(r)}`)}else m.push(`${y(u)}${a}${y(d)}`)}else m.push(u);for(const u of m)l.hasOwnProperty(u)||(l[u]={data:u,count:0})}for(const m in l){const i=l[m];s.push({value:i.data,count:i.count,label:i.label})}return{uniqueValueInfos:s}}function Fn(n,e,t,a){let l=null;switch(e){case"log":n!==0&&(l=Math.log(n)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(a)&&a!==0&&(l=n/a*100);break;case"field":Number.isFinite(t)&&t!==0&&(l=n/t);break;case"natural-log":n>0&&(l=Math.log(n));break;case"square-root":n>0&&(l=n**.5)}return l}function cn(n,e,t){const a=fn({field:e.field,normalizationType:e.normalizationType,normalizationField:e.normalizationField,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,definedInterval:e.definedInterval,breakCount:e.numClasses||R});return n=mn(n,e.minValue,e.maxValue),O({definition:a,values:n,normalizationTotal:e.normalizationTotal},t)}function mn(n,e,t){const a=e??-1/0,l=t??1/0;return n.filter(s=>Number.isFinite(s)&&s>=a&&s<=l)}function fn(n){const{breakCount:e,field:t,normalizationField:a,normalizationType:l}=n,s=n.classificationMethod||j,m=s==="standard-deviation"?n.standardDeviationInterval||Q:void 0,i=s==="defined-interval"?n.definedInterval:void 0;return new w({breakCount:e,classificationField:t,classificationMethod:s,normalizationField:l==="field"?a:void 0,normalizationType:l,standardDeviationInterval:m,definedInterval:i})}function Mn(n,e){var u,p;let t=n.classBreaks;const a=t.length,l=(u=t[0])==null?void 0:u.minValue,s=(p=t[a-1])==null?void 0:p.maxValue,m=e==="standard-deviation",i=J;return t=t.map(d=>{const c=d.label,r={minValue:d.minValue,maxValue:d.maxValue,label:c};if(m&&c){const o=c.match(i),f=(o==null?void 0:o.map(h=>+h.trim()))??[];f.length===2?(r.minStdDev=f[0],r.maxStdDev=f[1],f[0]<0&&f[1]>0&&(r.hasAvg=!0)):f.length===1&&(c.includes("<")?(r.minStdDev=null,r.maxStdDev=f[0]):c.includes(">")&&(r.minStdDev=f[0],r.maxStdDev=null))}return r}),{minValue:l,maxValue:s,classBreakInfos:t,normalizationTotal:n.normalizationTotal}}function In(n,e){const t=dn(n,e);if(t.min==null&&t.max==null)return{bins:[],minValue:t.min,maxValue:t.max,normalizationTotal:e.normalizationTotal};const a=t.intervals,l=t.min??0,s=t.max??0,m=a.map((i,u)=>({minValue:a[u][0],maxValue:a[u][1],count:0}));for(const i of n)if(i!=null&&i>=l&&i<=s){const u=pn(a,i);u>-1&&m[u].count++}return{bins:m,minValue:l,maxValue:s,normalizationTotal:e.normalizationTotal}}function dn(n,e,t=!1){var v,V;const{field:a,classificationMethod:l,standardDeviationInterval:s,definedInterval:m,normalizationType:i,normalizationField:u,normalizationTotal:p,minValue:d,maxValue:c}=e,r=e.numBins||H;let o=null,f=null,h=null;if((!l||l==="equal-interval")&&!i){if(d!=null&&c!=null)o=d,f=c;else{const g=nn({values:n,minValue:d,maxValue:c,useSampleStdDev:!i,supportsNullCount:Z({normalizationType:i,normalizationField:u,minValue:d,maxValue:c})});o=g.min??null,f=g.max??null}h=hn(o??0,f??0,r)}else{const{classBreaks:g}=cn(n,{field:a,normalizationType:i,normalizationField:u,normalizationTotal:p,classificationMethod:l,standardDeviationInterval:s,definedInterval:m,minValue:d,maxValue:c,numClasses:r},d!=null&&c!=null?[d,c]:void 0);o=(v=g[0])==null?void 0:v.minValue,f=(V=g[g.length-1])==null?void 0:V.maxValue,h=g.map(S=>[S.minValue,S.maxValue])}if(t&&h.length){const g=h.at(-1)[1];h.push([g,g])}return{min:o,max:f,intervals:h}}function pn(n,e){let t=-1;for(let a=n.length-1;a>=0;a--)if(e>=n[a][0]){t=a;break}return t}function hn(n,e,t){const a=(e-n)/t,l=[];let s,m=n;for(let i=1;i<=t;i++)s=m+a,s=Number(s.toFixed(16)),l.push([m,i===t?e:s]),m=s;return l}export{yn as $,Fn as B,xn as C,cn as E,dn as G,pn as L,Mn as P,In as U,O as a,X as c,Z as d,bn as f,en as g,hn as j,Tn as k,y as m,gn as n,nn as p,fn as q,k as v};
