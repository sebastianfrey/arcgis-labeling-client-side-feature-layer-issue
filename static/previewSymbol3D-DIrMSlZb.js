import{g7 as K,da as M,a as W,aF as V,g8 as X,g9 as Y}from"./index-C_bK48d2.js";import{B as _,U as $}from"./colorUtils-CLNuAJnC.js";import{b as aa,f as ea,h as la,w as Q,d as na}from"./utils-B2fTWpox.js";import{u as P,t as D,s as sa,l as ta,L as ra,p as oa,o as ia,n as ca,e as pa,c as ua,m as ha}from"./previewUtils-B8Y4tA-6.js";import{d as ma,l as H}from"./symbolUtils-C-02jwAZ.js";import{resolveWebStyleSymbol as fa}from"./webStyleSymbolUtils-DZP4PQg-.js";import"./cimSymbolUtils-kUrI6vhQ.js";import"./devEnvironmentUtils-CnNDiFMM.js";import"./webStyleAcceptedFormats-CG7ZQ6BV.js";const L=22,U=120,E=80,A=50,Z=20;function j(e){const a=e.outline,s=e.material!=null?e.material.color:null,l=s!=null?s.toHex():null;if(a==null||"pattern"in a&&a.pattern!=null&&a.pattern.type==="style"&&a.pattern.style==="none")return e.type==="fill"&&l==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const c=M(a.size)||0;return{color:"rgba("+(a.color!=null?a.color.toRgba():"255,255,255,1")+")",width:Math.min(c,E),style:"pattern"in a&&a.pattern!=null&&a.pattern.type==="style"?Q(a.pattern.style):null,join:"butt",cap:"patternCap"in a?a.patternCap:"butt"}}async function ya(e,a){var l,c,f;if((l=e.thumbnail)!=null&&l.url)return e.thumbnail.url;if(a.type==="icon"&&((c=a==null?void 0:a.resource)==null?void 0:c.href))return na(a);const s=K("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const t=await fa(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(t&&"thumbnail"in t&&((f=t.thumbnail)!=null&&f.url))return t.thumbnail.url}return s}function R(e,a=1){const s=e.a,l=_(e),c=l.h,f=l.s/a,t=100-(100-l.v)/a,{r:d,g:o,b:r}=$({h:c,s:f,v:t});return[d,o,r,s]}function q(e){var a;return e.type==="water"?e.color==null?null:e.color:((a=e.material)==null?void 0:a.color)==null?null:e.material.color}function i(e,a=0){const s=q(e);if(!s){if(e.type==="fill")return null;const c=aa.r,f=P(c,a);return[f,f,f,100]}const l=s.toRgba();for(let c=0;c<3;c++)l[c]=P(l[c],a);return l}async function da(e,a){const s=e.style;return s==="none"?null:{type:"pattern",x:0,y:0,src:await ea(K(`esri/symbols/patterns/${s}.png`),a.toCss(!0)),width:5,height:5}}function G(e){return e.outline?j(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function I(e,a){const s=q(e);if(!s)return null;let l="rgba(";return l+=P(s.r,a)+",",l+=P(s.g,a)+",",l+=P(s.b,a)+",",l+s.a+");"}function J(e,a){const s=e.edges;return!s||!s.color||!s.size?null:{color:s.color.toCss(!0),width:Math.min(M(s.size),a,E),join:"round"}}function B(e,a){var c;const s=I(e,a);if(!s||"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none")return null;const l={color:s,width:Math.min(e.size?M(e.size):.75,E)};return"pattern"in e&&((c=e.pattern)==null?void 0:c.type)==="style"&&(l.style=Q(e.pattern.style)),"cap"in e&&e.cap&&(l.cap=e.cap),"join"in e&&e.join&&(l.join=e.join==="miter"?M(2):e.join),l}function F(e,a,s){const l=s!=null?.75*s:0;return{type:"linear",x1:l?.25*l:0,y1:l?.5*l:0,x2:l||4,y2:l?.5*l:4,colors:[{color:e,offset:0},{color:a,offset:1}]}}function ba(e){const a=e.depth,s=e.height,l=e.width;return l!==0&&a!==0&&s!==0&&l===a&&l!=null&&s!=null&&l<s}function ga(e,a,s){var c,f;const l=[];if(!e)return l;switch(e.type){case"icon":{const o=a,r=a;switch(((c=e.resource)==null?void 0:c.primitive)??Y){case"circle":l.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:i(e,0),stroke:j(e)});break;case"square":l.push({shape:{type:"path",path:[{command:"M",values:[0,r]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,r]},{command:"Z",values:[]}]},fill:i(e,0),stroke:j(e)});break;case"triangle":l.push({shape:{type:"path",path:[{command:"M",values:[0,r]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,r]},{command:"Z",values:[]}]},fill:i(e,0),stroke:j(e)});break;case"cross":l.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,r]},{command:"M",values:[0,.5*r]},{command:"L",values:[o,.5*r]}]},stroke:G(e)});break;case"x":l.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,r]},{command:"M",values:[o,0]},{command:"L",values:[0,r]}]},stroke:G(e)});break;case"kite":l.push({shape:{type:"path",path:[{command:"M",values:[0,.5*r]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*r]},{command:"L",values:[.5*o,r]},{command:"Z",values:[]}]},fill:i(e,0),stroke:j(e)})}break}case"object":switch(((f=e.resource)==null?void 0:f.primitive)??X){case"cone":{const t=F(i(e,0),i(e,-.6),s?Z:a),d=ca(a,s);l.push({shape:d[0],fill:t},{shape:d[1],fill:t});break}case"inverted-cone":{const t=i(e,0),d=F(t,i(e,-.6),a),o=ia(a);l.push({shape:o[0],fill:d},{shape:o[1],fill:t});break}case"cube":{const t=oa(a,s);l.push({shape:t[0],fill:i(e,0)},{shape:t[1],fill:i(e,-.3)},{shape:t[2],fill:i(e,-.5)});break}case"cylinder":{const t=F(i(e,0),i(e,-.6),s?Z:a),d=ra(a,s);l.push({shape:d[0],fill:t},{shape:d[1],fill:t},{shape:d[2],fill:i(e,0)});break}case"diamond":{const t=ta(a);l.push({shape:t[0],fill:i(e,-.3)},{shape:t[1],fill:i(e,0)},{shape:t[2],fill:i(e,-.3)},{shape:t[3],fill:i(e,-.7)});break}case"sphere":{const t=F(i(e,0),i(e,-.6));t.x1=0,t.y1=0,t.x2=.25*a,t.y2=.25*a,l.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:t});break}case"tetrahedron":{const t=sa(a);l.push({shape:t[0],fill:i(e,-.3)},{shape:t[1],fill:i(e,0)},{shape:t[2],fill:i(e,-.6)});break}}break}return l}function N(e){const a=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null;return a?M(a):null}function ka(e){return e.type==="icon"?"multiply":"tint"}async function va(e,a){const s=N(a),l=a!=null&&a.maxSize?M(a.maxSize):null,c=(a==null?void 0:a.disableUpsampling)??!1,f=e.symbolLayers,t=[],d=[];let o=!1,r=0,y=0,v=0;f.forEach(n=>{var g,k,w,z;if(n.type!=="icon"&&n.type!=="object")return;n&&n.type==="icon"&&(v=Math.max(n.size&&M(n.size),v));const u=n.type==="icon"?n.size&&M(n.size):0,h=s||u?Math.ceil(Math.min(s||u,l||U)):L;let m=n.type==="icon"?n.angle:null;if((a==null?void 0:a.rotation)!=null&&(m=(m??0)+a.rotation),d.push(m),(g=n==null?void 0:n.resource)==null?void 0:g.href){const S=ya(e,n).then(x=>{var T;const C=(T=n==null?void 0:n.material)==null?void 0:T.color,O=ka(n);return ma(x,h,C,O,c)}).then(x=>{const C=x.width,O=x.height;return r=Math.max(r,C),y=Math.max(y,O),m&&(o=!0),[{shape:{type:"image",x:0,y:0,width:C,height:O,src:x.url},fill:null,stroke:null}]});t.push(S)}else{let S=h;n.type==="icon"&&s&&(S=h*(u/v));const x=(a==null?void 0:a.symbolConfig)==="tall"||((k=a==null?void 0:a.symbolConfig)==null?void 0:k.isTall)||n.type==="object"&&ba(n);r=Math.max(r,x?Z:S),y=Math.max(y,S),m&&((w=n.resource)!=null&&w.primitive)&&["square","triangle","x"].includes((z=n.resource)==null?void 0:z.primitive)&&(o=!0),t.push(Promise.resolve(ga(n,S,x)))}});const p=await Promise.allSettled(t),b=[];return p.forEach(n=>{n.status==="fulfilled"?b.push(n.value):n.reason&&V.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",n.reason)}),H(b,[r,y],{node:a==null?void 0:a.node,scale:!1,opacity:a==null?void 0:a.opacity,ariaLabel:a==null?void 0:a.ariaLabel,rotations:d,useRotationSize:o})}function wa(e,a){const s=e.symbolLayers,l=[],c=la(e),f=N(a),t=(a!=null&&a.maxSize?M(a.maxSize):null)||E;let d,o=0,r=0;return s.forEach((y,v)=>{if(!y||y.type!=="line"&&y.type!=="path")return;const p=[];switch(y.type){case"line":{const b=B(y,0);if(b==null)break;const n=(b==null?void 0:b.width)||0;v===0&&(d=n);const u=Math.min(f||n,t),h=v===0?u:f?u*(n/d):u,m=h>A/2?2*h:A;r=Math.max(r,h),o=Math.max(o,m),b.width=h,p.push({shape:{type:"path",path:[{command:"M",values:[0,.5*r]},{command:"L",values:[o,.5*r]}]},stroke:b});break}case"path":{const b=Math.min(f||L,t),n=i(y,0),u=i(y,-.2),h=I(y,-.4),m=h?{color:h,width:1}:{};if(y.profile==="quad"){const g=y.width,k=y.height,w=pa(g&&k?g/k:1,k===0,g===0),z={...m,join:"bevel"};p.push({shape:w[0],fill:u,stroke:z},{shape:w[1],fill:u,stroke:z},{shape:w[2],fill:n,stroke:z})}else p.push({shape:D.pathSymbol3DLayer[0],fill:u,stroke:m},{shape:D.pathSymbol3DLayer[1],fill:n,stroke:m});r=Math.max(r,b),o=r}}l.push(p)}),Promise.resolve(H(l,[o,r],{node:a==null?void 0:a.node,scale:c,opacity:a==null?void 0:a.opacity,ariaLabel:a==null?void 0:a.ariaLabel}))}async function Ma(e,a){const s=e.type==="mesh-3d",l=e.symbolLayers,c=N(a),f=a!=null&&a.maxSize?M(a.maxSize):null,t=c||L,d=[];let o=0,r=0,y=!1;for(let v=0;v<l.length;v++){const p=l.at(v),b=[];if(!s||p.type==="fill"){switch(p.type){case"fill":{const n=Math.min(t,f||U);if(o=Math.max(o,n),r=Math.max(r,n),y=!0,s){const u=D.meshSymbol3DFill,h=I(p,-.4),m=J(p,.05*n)??(h?{join:"round",color:h,width:1}:null);b.push({shape:u[0],fill:i(p,0),stroke:m},{shape:u[1],fill:i(p,-.2),stroke:m},{shape:u[2],fill:i(p,-.6),stroke:m})}else{let u=i(p,0);const h="pattern"in p?p.pattern:null,m=j(p),g=q(p);h!=null&&h.type==="style"&&h.style!=="solid"&&g&&(u=await da(h,g)),b.push({shape:D.fill[0],fill:u,stroke:m})}break}case"line":{const n=B(p,0);if(n==null)break;const u={stroke:n,shape:D.fill[0]};o=Math.max(o,L),r=Math.max(r,L),b.push(u);break}case"extrude":{const n=i(p,0),u=i(p,-.2),h=Math.min(t,f||U),m=ha(h),g=L,k=.7*L+.5*h,w=J(p,.1*Math.min(g,k))??{join:"round",...B(p,-.4),width:1};b.push({shape:m[0],fill:u,stroke:w},{shape:m[1],fill:u,stroke:w},{shape:m[2],fill:n,stroke:w}),o=Math.max(o,g),r=Math.max(r,k);break}case"water":{const n=q(p),u=R(n),h=R(n,2),m=R(n,3),g=ua();y=!0,b.push({shape:g[0],fill:u},{shape:g[1],fill:h},{shape:g[2],fill:m});const k=Math.min(t,f||U);o=Math.max(o,k),r=Math.max(r,k);break}}d.push(b)}}return H(d,[o,r],{node:a==null?void 0:a.node,scale:y,opacity:a==null?void 0:a.opacity,ariaLabel:a==null?void 0:a.ariaLabel})}function Fa(e,a){if(e.symbolLayers.length===0)return Promise.reject(new W("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return va(e,a);case"line-3d":return wa(e,a);case"polygon-3d":case"mesh-3d":return Ma(e,a)}return Promise.reject(new W("symbolPreview: swatchInfo3D","symbol not supported."))}export{da as getPatternDescriptor,N as getSizeFromOptions,i as getSymbolLayerFill,Fa as previewSymbol3D};
