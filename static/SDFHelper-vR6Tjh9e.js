import{o as V}from"./rasterizingUtils-JV4ZHDNN.js";import{d7 as X,d8 as D,d9 as k,da as Y}from"./index-C_bK48d2.js";import{t as j}from"./CIMSymbolHelper-BdzJMZqf.js";const q=.45;function G(o){var t;switch(o.type){case"CIMPointSymbol":{const e=o.symbolLayers;if(!e||e.length!==1)return null;const n=e[0];return n.type!=="CIMVectorMarker"?null:G(n)}case"CIMVectorMarker":{const e=o.markerGraphics;if(!e||e.length!==1)return null;const n=e[0];if(!n)return null;const l=n.geometry,i=U(l);if(!i)return null;const a=n.symbol;if(!a||a.type!=="CIMPolygonSymbol"&&a.type!=="CIMLineSymbol"||(t=a.symbolLayers)!=null&&t.some(s=>!!s.effects))return null;let r=0;for(const s of a.symbolLayers??[])r=Math.max(s.type==="CIMSolidStroke"?s.width:0,r);const{sdfTextureSize:f,sdfPaddingRatio:c}=H(i,o.frame,o.size,o.anchorPoint,o.anchorPointUnits!=="Relative",r,o.scaleSymbolsProportionally);return{type:"sdf",geometry:l,sdfTextureSize:f,sdfPaddingRatio:c,asFill:a.type==="CIMPolygonSymbol"}}}}function $(o){return o?o.rings?o.rings:o.paths?o.paths:o.xmin!==void 0&&o.ymin!==void 0&&o.xmax!==void 0&&o.ymax!==void 0?[[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]]]:null:null}function B(o){let t=1/0,e=-1/0,n=1/0,l=-1/0;for(const i of o)for(const a of i)a[0]<t&&(t=a[0]),a[0]>e&&(e=a[0]),a[1]<n&&(n=a[1]),a[1]>l&&(l=a[1]);return new j(t,n,e-t,l-n)}function A(o){let t=1/0,e=-1/0,n=1/0,l=-1/0;for(const i of o)for(const a of i)a[0]<t&&(t=a[0]),a[0]>e&&(e=a[0]),a[1]<n&&(n=a[1]),a[1]>l&&(l=a[1]);return[t,n,e,l]}function U(o){return o?o.rings?A(o.rings):o.paths?A(o.paths):X(o)?[o.xmin,o.ymin,o.xmax,o.ymax]:null:null}function Z(o,t,e){const[n,l,i,a]=U(o),r=i-n,f=a-l,c=t,s=k,m=Math.floor(.5*(c*e-s)),d=(c-2*(m+s))/Math.max(r,f),h=Math.round(r*d),u=Math.round(f*d);return{pixelDimensions:[r,f],texelDimensions:[Math.round((h+2*m)/d),Math.round((u+2*m)/d)]}}const E=1.61803;function H(o,t,e,n,l,i,a){const[r,f,c,s]=o;if(c<r||s<f)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5,sdfTextureSize:D};const m=c-r,d=s-f,h=Math.max(m,d);let u,y=.5;{!a&&t!=null&&(i*=(t.ymax-t.ymin)/e);const w=i/(i+h);w>q&&w<1&&(y=Math.min(w+.1,.99))}{const w=(h+i)/d,I=Y(e)*w;u=Math.floor(I*E+2*k),u=1<<32-Math.clz32(u-1),u=Math.max(u,D)}const M=u,b=k,g=Math.floor(.5*(M*y-b)),P=(M-2*(g+b))/h,R=Math.round(m*P)+2*g,x=Math.round(d*P)+2*g;let T=1;t&&(T=x*(1-y)/((t.ymax-t.ymin)*P));let p=0,S=0,z=1;n&&(l?t&&e&&t.ymax-t.ymin>0&&(z=(t.xmax-t.xmin)/(t.ymax-t.ymin),p=n.x/(e*z),S=n.y/e):(p=n.x,S=n.y)),t&&(p=.5*(t.xmax+t.xmin)+p*(t.xmax-t.xmin),S=.5*(t.ymax+t.ymin)+S*(t.ymax-t.ymin)),p-=r,S-=f,p*=P,S*=P,p+=g,S+=g;let v=p/R-.5,C=S/x-.5;return l&&e&&(v*=e*z,C*=e),{frameSizeRatio:T,anchorX:v,anchorY:C,widthRatio:z,sdfTextureSize:u,sdfPaddingRatio:y}}function _(o){const t=$(o.geometry),e=B(t),n=o.sdfTextureSize,l=k,i=Math.floor(.5*(n*o.sdfPaddingRatio-l)),a=n-2*(i+l),r=a/Math.max(e.width,e.height),f=Math.round(e.width*r)+2*i,c=Math.round(e.height*r)+2*i,s=[];for(const d of t)if(d&&d.length>1){const h=[];for(const u of d){let[y,M]=u;y-=e.x,M-=e.y,y*=r,M*=r,y+=i-.5,M+=i-.5,o.asFill?h.push([y,M]):h.push([Math.round(y),Math.round(M)])}if(o.asFill){const u=h.length-1;h[0][0]===h[u][0]&&h[0][1]===h[u][1]||h.push(h[0])}s.push(h)}const m=J(s,f,c,i);return o.asFill&&K(s,f,c,i,m),{data:N(m,i),width:f,height:c,sdfPaddingRatio:o.sdfPaddingRatio,sdfDecodeCoeff:2*i/a}}function J(o,t,e,n){const l=t*e,i=new Array(l),a=n*n+1;for(let r=0;r<l;++r)i[r]=a;for(const r of o){const f=r.length;for(let c=1;c<f;++c){const s=r[c-1],m=r[c];let d,h,u,y;s[0]<m[0]?(d=s[0],h=m[0]):(d=m[0],h=s[0]),s[1]<m[1]?(u=s[1],y=m[1]):(u=m[1],y=s[1]);let M=Math.floor(d)-n,b=Math.floor(h)+n,g=Math.floor(u)-n,P=Math.floor(y)+n;M<0&&(M=0),b>t&&(b=t),g<0&&(g=0),P>e&&(P=e);const R=m[0]-s[0],x=m[1]-s[1],T=R*R+x*x;for(let p=M;p<b;p++)for(let S=g;S<P;S++){const z=p+.5,v=S+.5;let C,w,I=(z-s[0])*R+(v-s[1])*x;I<0?(C=s[0],w=s[1]):I>T?(C=m[0],w=m[1]):(I/=T,C=s[0]+I*R,w=s[1]+I*x);const F=(z-C)*(z-C)+(v-w)*(v-w),L=(e-S-1)*t+p;F<i[L]&&(i[L]=F)}}}for(let r=0;r<l;++r)i[r]=Math.sqrt(i[r]);return i}function K(o,t,e,n,l){for(const i of o){const a=i.length;for(let r=1;r<a;++r){const f=i[r-1],c=i[r];let s,m,d,h;f[0]<c[0]?(s=f[0],m=c[0]):(s=c[0],m=f[0]),f[1]<c[1]?(d=f[1],h=c[1]):(d=c[1],h=f[1]);let u=Math.floor(s),y=Math.floor(m)+1,M=Math.floor(d),b=Math.floor(h)+1;u<n&&(u=n),y>t-n&&(y=t-n),M<n&&(M=n),b>e-n&&(b=e-n);for(let g=M;g<b;++g){if(f[1]>g==c[1]>g)continue;const P=g+.5,R=(e-g-1)*t;for(let x=u;x<y;++x)x+.5<(c[0]-f[0])*(P-f[1])/(c[1]-f[1])+f[0]&&(l[R+x]=-l[R+x]);for(let x=n;x<u;++x)l[R+x]=-l[R+x]}}}}function N(o,t){const e=2*t,n=o.length,l=new Uint8Array(4*n);for(let i=0;i<n;++i){const a=.5-o[i]/e;V(a,l,4*i)}return l}export{U as c,H as d,Z as h,G as s,_ as y};
