import{t as O}from"./date-DLgTylpo.js";import{a as m,bn as I,f7 as S,gD as Z}from"./index-C_bK48d2.js";import{Y as $,S as b}from"./featureConversionUtils-Di1UhLmY.js";import{o as D}from"./OptimizedFeatureSet-BZnZXZq6.js";import{s as F}from"./OptimizedGeometry-KE6YknPZ.js";const N={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function h(e){return N[e]}function*j(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*x(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const n of t)yield*n}}function*C(e,t={}){const{geometryType:n,objectIdField:o}=t;for(const r of e){const{geometry:c,properties:u,id:i}=r;if(c&&h(c.type)!==n)continue;const s=u||{};let f;o&&(f=s[o],i==null||f||(s[o]=f=i)),yield new D(c&&A(c,t),s,null,f)}}function E(e){for(const t of e)if(t.length>2)return!0;return!1}function J(e){return!k(e)}function R(e){return k(e)}function k(e){let t=0;for(let n=0;n<e.length;n++){const o=e[n],r=e[(n+1)%e.length];t+=o[0]*r[1]-r[0]*o[1]}return t<=0}function G(e){const t=e[0],n=e[e.length-1];t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t)}function A(e,t){const{coordinates:n,type:o}=e,r=t.hasZ??!1,c=!0;switch(o){case"Point":return new F([],[...n],r,!1);case"LineString":return b({paths:[n],hasZ:c},r,!1);case"MultiLineString":return b({paths:n,hasZ:c},r,!1);case"MultiPoint":return $({points:n,hasZ:c},r,!1);case"Polygon":case"MultiPolygon":{const u=new F([],[],r,!1);for(const i of o==="Polygon"?[n]:n){v(u,i[0],r);for(let s=1;s<i.length;s++)H(u,i[s],r)}return u}}}function v(e,t,n){G(t),J(t)?T(e,t,n):M(e,t,n)}function H(e,t,n){G(t),R(t)?T(e,t,n):M(e,t,n)}function M(e,t,n){for(const o of t)L(e,o,n);e.lengths.push(t.length)}function T(e,t,n){for(let o=t.length-1;o>=0;o--)L(e,t[o],n);e.lengths.push(t.length)}function L(e,[t,n,o],r){e.coords.push(t,n),r&&e.coords.push(o||0)}function Y(e){switch(typeof e){case"string":return O(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function U(e,t=4326){if(!e)throw new m("geojson-layer:empty","GeoJSON data is empty");if(e.type!=="Feature"&&e.type!=="FeatureCollection")throw new m("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:n}=e;if(!n)return;const o=typeof n=="string"?n:n.type==="name"?n.properties.name:n.type==="EPSG"?n.properties.code:null,r=I({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!o||!r.test(o))throw new m("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function V(e,t={}){const n=[],o=new Set,r=new Set;let c,u=!1,i=null,s=!1,{geometryType:f=null}=t;for(const y of j(e)){const{geometry:g,properties:a,id:p}=y;if((!g||(f||(f=h(g.type)),h(g.type)===f))&&(u||(u=E(x(g))),s||(s=p!=null,s&&(c=typeof p,a&&(i=Object.keys(a).filter(l=>a[l]===p)))),a&&i&&s&&p!=null&&(i.length>1?i=i.filter(l=>a[l]===p):i.length===1&&(i=a[i[0]]===p?i:[])),a))for(const l in a){if(o.has(l))continue;const w=Y(a[l]);if(w==="unknown"){r.add(l);continue}r.delete(l),o.add(l);const P=S(l);P&&n.push({name:P,alias:l,type:w})}}const d=S((i==null?void 0:i.length)===1&&i[0]||null)??void 0;if(d){for(const y of n)if(y.name===d&&Z(y)){y.type="esriFieldTypeOID";break}}return{fields:n,geometryType:f,hasZ:u,objectIdFieldName:d,objectIdFieldType:c,unknownFields:Array.from(r)}}function W(e,t){return Array.from(C(j(e),t))}export{U as M,W as O,V as T,h as f};
