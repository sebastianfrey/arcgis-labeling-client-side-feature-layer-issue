import{aJ as i,aK as a,aL as y,db as g,eV as f,ao as P,ap as w,fz as A,f_ as b,h$ as R,pu as F,aW as T,fx as v,eZ as E,m_ as N,hf as j,hc as $,ce as x,fZ as z}from"./index-C_bK48d2.js";import{e as B}from"./getDefaultUnitForView-DghHjrRa.js";import{s as U,o as Z}from"./ExclusiveOperationManager-DAhuHQJU.js";import{a as V}from"./quantity-wpyqwS5w.js";import{y as q,z as W,v as J}from"./geodesicUtils-CTZo9mb6.js";import{y as K,l as X}from"./geodeticDensifyOperator-vNwHtiui.js";import{m as Y,l as Q}from"./geodeticLengthOperator-BhsSOjnG.js";import{r as ee}from"./lengthOperator-J6a_F19i.js";import{load as te,execute as ie}from"./projectOperator-GjeZoSlA.js";import{u as k}from"./simplifyOperator-DCwRzIwh.js";import{k as se}from"./quantityFormatUtils-BygWVGS0.js";import{h as D}from"./GraphicsLayer-CFgfYbpT.js";import{D as H,I as O}from"./colorUtils-CLNuAJnC.js";import{d as ae,u as I}from"./SketchViewModel-BpdG2zzZ.js";import"./operatorGeodeticDensify-CFr7rJxP.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./geodeticCurveType-CirnHLSB.js";import"./Point2D-CHGoJJR2.js";import"./Envelope2D-K-BIX8ba.js";import"./ProjectionTransformation-yTMc8p-1.js";import"./Transformation2D-CsY48lRi.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./jsonConverter-E47-BQ_b.js";import"./apiConverter-CdLHvLkb.js";import"./operatorProject-DDNXv7o7.js";import"./operatorSimplify-CaWHRVp7.js";import"./unitFormatUtils-Ckw47jIR.js";import"./hitTestSelectUtils-xrNddzEE.js";import"./projectVectorToVector-IRvjF_FZ.js";import"./projectPointToVector-oWOZnQKe.js";import"./plane-CYaN818s.js";import"./vectorStacks-CpRnv_41.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-Dx28BAGo.js";import"./ray-DFDOQn-4.js";import"./elevationInfoUtils-C7MilKvD.js";import"./spatialReferenceEllipsoidUtils-DtI6yob-.js";import"./earcut-Lltz9D9k.js";import"./triangle-Bs-n1Sd1.js";import"./geodeticAreaOperator-D2z_GCTf.js";const L=V(1e5,"meters");async function re(e,t){if(!(e!=null&&e.paths.length)||!e.paths[0].length)return null;await te();const s=ie(e,t);return s?s.spatialReference.isGeographic?q(s.spatialReference)?ne(s):G(s):s.spatialReference.isWebMercator?G(s):oe(s):null}async function G(e){await Promise.all([K(),Y()]);const t=k(e);if(!t)return null;const s=X(t,L.value,{unit:L.unit});if(!s)return null;const r=Q(t,{unit:"meters"});return{display:{outline:s},mode:"geodesic",length:V(r,"meters")}}function ne(e){const t=k(e);if(!t)return null;const s=W(t,L.value),r=J([t],"meters")[0];return{display:{outline:s},mode:"geodesic",length:V(r,"meters")}}function oe(e){const t=k(e);if(!t)return null;const s=ee(t,{unit:"meters"});return{display:{outline:t},mode:"euclidean",length:V(s,"meters")}}let p=class extends g{constructor(e){super(e),this._result=null,this._updatingHandles=new f,this._debouncedGetResult=P(async t=>{this._result=await re(t,this.view.spatialReference)})}initialize(){this.addHandles(w(()=>this.measurementViewData.analysis.geometry,e=>{this._updatingHandles.addPromise(b(this._debouncedGetResult(e)))},A))}destroy(){this._updatingHandles.destroy()}get result(){return this._result}get updating(){return this._updatingHandles.updating}};i([a()],p.prototype,"_result",void 0),i([a()],p.prototype,"measurementViewData",void 0),i([a()],p.prototype,"result",null),i([a()],p.prototype,"updating",null),i([a()],p.prototype,"view",void 0),p=i([y("esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementController")],p);function le(e,t){const s=H(O(t,160),.5),r=O(e);return new R({data:{type:"CIMSymbolReference",primitiveOverrides:[{type:"CIMPrimitiveOverride",primitiveName:"textOverride",propertyName:"TextString",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Custom",expression:"$feature.lengthText",returnType:"Default"}}],symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,colorLocked:!0,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",fontFamilyName:"sans-serif",height:14,horizontalAlignment:"Center",offsetX:0,offsetY:0,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t.toArray()}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:s.toArray()}]},haloSize:2,verticalAlignment:"Center",flipAngle:90},primitiveName:"textOverride"}],scaleSymbolsProportionally:!0,respectFrame:!0,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,offset:8,relativeTo:"LineMiddle",startPointOffset:0}},{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:3.5,color:r.toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:5,color:e.toArray()}]}}})}let h=class extends g{get _messages(){var e;return(e=this._messagesTask)==null?void 0:e.value}constructor(e){super(e),this._graphicsLayer=new D({listMode:"hide",internal:!0}),this._updatingHandles=new f}initialize(){var e;(e=this.view.map)==null||e.add(this._graphicsLayer),this.addHandles(F(()=>this._updateMessageBundle())),this._updatingHandles.add(()=>{var t,s;return{accentColor:this.view.effectiveTheme.accentColor,length:(t=this.measurementViewData.result)==null?void 0:t.length,messages:this._messages,outline:(s=this.measurementViewData.result)==null?void 0:s.display.outline,textColor:this.view.effectiveTheme.textColor,unit:this.measurementViewData.unit,visible:this.measurementViewData.visible}},({accentColor:t,length:s,messages:r,outline:n,textColor:l,unit:_,visible:S},d)=>{if(this._graphicsLayer.visible=S,!S)return;if(!r||!s||!n)return void this._graphicsLayer.graphics.destroyAll();const M=this._graphicsLayer.graphics.at(0),C=r&&s?se(r,s,_):"";if(M&&t.equals(d==null?void 0:d.accentColor)&&l.equals(d==null?void 0:d.textColor))return M.attributes.lengthText=C,void(M.geometry=n);this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.add(new T({attributes:{lengthText:C},geometry:n,symbol:le(t,l)}))},v),this._updateMessageBundle()}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get updating(){var e;return!this._graphicsLayer.loaded||!((e=this._messagesTask)!=null&&e.finished)||this._updatingHandles.updating}_updateMessageBundle(){var e;return(e=this._messagesTask)==null||e.abort(),this._messagesTask=E(()=>N("esri/core/t9n/Units")),this._messagesTask.promise}};i([a()],h.prototype,"_messages",null),i([a()],h.prototype,"_messagesTask",void 0),i([a()],h.prototype,"measurementViewData",void 0),i([a()],h.prototype,"updating",null),i([a()],h.prototype,"view",void 0),h=i([y("esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementLineVisualization")],h);let u=class extends g{constructor(e){super(e),this._emptyFillSymbol=new j({color:null,outline:null}),this._graphicsLayer=new D({listMode:"hide",internal:!0}),this._updatingHandles=new f}initialize(){var e;(e=this.view.map)==null||e.add(this._graphicsLayer),this._updatingHandles.add(()=>({geometry:this.measurementViewData.analysis.geometry}),({geometry:t})=>{if(!t)return void this._graphicsLayer.graphics.destroyAll();const s=this._graphicsLayer.graphics.at(0);s?s.geometry=t:(this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.add(new T({geometry:t,symbol:this._emptyFillSymbol})))},v)}destroy(){this._emptyFillSymbol.destroy(),this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get graphic(){return this._graphicsLayer.graphics.at(0)}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded||this._updatingHandles.updating}};i([a()],u.prototype,"graphic",null),i([a()],u.prototype,"graphicsLayer",null),i([a()],u.prototype,"measurementViewData",void 0),i([a()],u.prototype,"updating",null),i([a()],u.prototype,"view",void 0),u=i([y("esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementManipulatorVisualization")],u);let m=class extends g{constructor(e){super(e),this._graphicsLayer=new D({listMode:"hide",internal:!0})}initialize(){var e;(e=this.view.map)==null||e.add(this._graphicsLayer)}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.destroy()}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded}};i([a()],m.prototype,"graphicsLayer",null),i([a()],m.prototype,"measurementViewData",void 0),i([a()],m.prototype,"updating",null),i([a()],m.prototype,"view",void 0),m=i([y("esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementSketchVisualization")],m);function pe(e){return(e==null?void 0:e.type)==="polyline"}let c=class extends g{constructor(e){super(e),this._invisibleLineSymbol=new $({color:null,width:0}),this._operationManager=new U,this._updatingHandles=new f}initialize(){this._sketchViewModel=new ae({defaultCreateOptions:{mode:"click"},defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{edgeOperation:"none",shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},updateOnGraphicClick:!1,view:this.view}),this.addHandles([w(()=>({interactive:this.measurementViewData.interactive,visible:this.measurementViewData.visible}),({interactive:e,visible:t})=>{this._operationManager.stop(),t&&e&&this.reshape()}),w(()=>this.measurementViewData.snappingOptions,e=>{this._sketchViewModel&&(this._sketchViewModel.snappingOptions=e)},v),w(()=>this.view.effectiveTheme.accentColor,e=>{this._lineSymbol=new $({color:H(e,.3),width:2})},v)])}destroy(){var e,t;this._invisibleLineSymbol.destroy(),(e=this._lineSymbol)==null||e.destroy(),this._operationManager.destroy(),(t=this._sketchViewModel)==null||t.destroy(),this._updatingHandles.destroy()}get state(){if(!this.measurementViewData.visible||!this._operationManager.currentOperationType)return"idle";switch(this._operationManager.currentOperationType){case"place":return"placing";case"reshape":return"reshaping"}}get updating(){return!this._sketchViewModel||this._sketchViewModel.updating||this._updatingHandles.updating}async place(e){return this._operationManager.start("place",async t=>{if(!this._sketchViewModel||!this.measurementViewData.sketchGraphicsLayer)return;const s=this._sketchViewModel.on("create",r=>{var n;switch(r.state){case"active":{const l=(n=r.graphic)==null?void 0:n.geometry;(l==null?void 0:l.type)==="polyline"&&(this.measurementViewData.analysis.geometry=l);break}case"cancel":case"complete":t.stop()}});t.handles.push(s,x(()=>{var r,n;if(s.remove(),(r=this._sketchViewModel)==null||r.cancel(),(n=this.measurementViewData.sketchGraphicsLayer)==null||n.removeAll(),z(e))return t.reject();t.resolve({})})),this._sketchViewModel.polylineSymbol=this._invisibleLineSymbol,this._sketchViewModel.layer=this.measurementViewData.sketchGraphicsLayer,this._updatingHandles.addPromise(b(this._sketchViewModel.create("polyline")))})}async reshape(e){return this._operationManager.start("reshape",async t=>{if(!this._sketchViewModel)return;const s=()=>this._lineSymbol&&this._sketchViewModel&&this.measurementViewData.manipulatorGraphic&&this.measurementViewData.manipulatorGraphicsLayer?(this._sketchViewModel.polylineSymbol=this._lineSymbol,this._sketchViewModel.layer=this.measurementViewData.manipulatorGraphicsLayer,this._updatingHandles.addPromise(b(this._sketchViewModel.update(this.measurementViewData.manipulatorGraphic,{tool:"reshape"})))):Promise.resolve(),r=this._sketchViewModel.on("update",n=>{var _;const l=(_=n.graphics[0])==null?void 0:_.geometry;this.measurementViewData.analysis.geometry=pe(l)?l:null,n.state==="complete"&&(this.measurementViewData.interactive?s():t.stop())});t.handles.push(r,x(()=>{var n;if(r.remove(),(n=this._sketchViewModel)==null||n.cancel(),z(e))return t.reject();t.resolve()})),await s()})}};i([a()],c.prototype,"_sketchViewModel",void 0),i([a()],c.prototype,"measurementViewData",void 0),i([a()],c.prototype,"state",null),i([a()],c.prototype,"updating",null),i([a()],c.prototype,"view",void 0),c=i([y("esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementTool")],c);let o=class extends Z{constructor(e){super(e),this.analysis=null,this.snappingOptions=new I,this.type="distance-measurement-view-2d"}initialize(){const{view:e}=this;this._lineVisualization=new h({view:e,measurementViewData:this}),this._controller=new p({view:e,measurementViewData:this}),this._manipulatorVisualization=new u({view:e,measurementViewData:this}),this._sketchVisualization=new m({view:e,measurementViewData:this}),this._tool=new c({view:e,measurementViewData:this})}destroy(){var e,t,s,r,n;(e=this._lineVisualization)==null||e.destroy(),(t=this._controller)==null||t.destroy(),(s=this._manipulatorVisualization)==null||s.destroy(),(r=this._sketchVisualization)==null||r.destroy(),(n=this._tool)==null||n.destroy()}get manipulatorGraphic(){var e;return(e=this._manipulatorVisualization)==null?void 0:e.graphic}get manipulatorGraphicsLayer(){var e;return(e=this._manipulatorVisualization)==null?void 0:e.graphicsLayer}get sketchGraphicsLayer(){var e;return(e=this._sketchVisualization)==null?void 0:e.graphicsLayer}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get result(){var e;return(e=this._controller)==null?void 0:e.result}get unit(){return this.analysis.unit??B(this.view)}get updating(){var e,t,s,r;return(((e=this._controller)==null?void 0:e.updating)??!0)||(((t=this._lineVisualization)==null?void 0:t.updating)??!0)||(((s=this._sketchVisualization)==null?void 0:s.updating)??!0)||(((r=this._tool)==null?void 0:r.updating)??!0)}get visible(){return super.visible}set visible(e){super.visible=e}async place(e){return this._tool.place(e)}};i([a()],o.prototype,"_lineVisualization",void 0),i([a()],o.prototype,"_controller",void 0),i([a()],o.prototype,"_manipulatorVisualization",void 0),i([a()],o.prototype,"_sketchVisualization",void 0),i([a()],o.prototype,"_tool",void 0),i([a({constructOnly:!0})],o.prototype,"analysis",void 0),i([a()],o.prototype,"manipulatorGraphic",null),i([a()],o.prototype,"manipulatorGraphicsLayer",null),i([a()],o.prototype,"sketchGraphicsLayer",null),i([a({readOnly:!0})],o.prototype,"result",null),i([a({type:I,nonNullable:!0})],o.prototype,"snappingOptions",void 0),i([a({readOnly:!0})],o.prototype,"type",void 0),i([a({readOnly:!0})],o.prototype,"unit",null),i([a({readOnly:!0})],o.prototype,"updating",null),o=i([y("esri.views.2d.analysis.DistanceMeasurementAnalysisView2D")],o);const Ke=o;export{Ke as default};
