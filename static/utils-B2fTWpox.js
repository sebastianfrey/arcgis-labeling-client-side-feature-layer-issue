const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-CFt565Oe.js","./index-C_bK48d2.js","./index-DxLSJ8yk.css"])))=>i.map(i=>d[i]);
import{cg as z,d3 as d,da as u,g7 as S,a7 as _,eq as y,iE as m,iF as E,gb as R,iG as A,iH as O,iI as C,_ as D}from"./index-C_bK48d2.js";import{u as g,S as I}from"./cimSymbolUtils-kUrI6vhQ.js";const k="picture-fill",$="simple-fill",M="simple-line",x="simple-marker",N="text",P="cim",b=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),w=new z(1e3);function tn(n){const t=n.style;let r=null;if(n)switch(n.type){case x:t!=="cross"&&t!=="x"&&(r=n.color);break;case $:t&&t!=="solid"?t!=="none"&&(r={type:"pattern",x:0,y:0,src:S(`esri/symbols/patterns/${t}.png`),width:5,height:5}):r=n.color;break;case k:r={type:"pattern",src:n.url,width:u(n.width)*n.xscale,height:u(n.height)*n.yscale,x:u(n.xoffset),y:u(n.yoffset)};break;case N:r=n.color;break;case P:r=g(n)}return r}function rn(n,t){const r=n+"-"+t,e=w.get(r);return e!=null?Promise.resolve(e):_(n,{responseType:"image"}).then(l=>{const o=l.data,i=o.naturalWidth,s=o.naturalHeight,a=document.createElement("canvas");a.width=i,a.height=s;const c=a.getContext("2d");c.fillStyle=t,c.fillRect(0,0,i,s),c.globalCompositeOperation="destination-in",c.drawImage(o,0,0);const p=a.toDataURL();return w.put(r,p),p})}function L(n){if(!n)return null;let t=null;switch(n.type){case $:case k:case x:t=L(n.outline);break;case M:{const r=u(n.width);n.style!=null&&n.style!=="none"&&r!==0&&(t={color:n.color,style:H(n.style),width:r,cap:n.cap,join:n.join==="miter"?u(n.miterLimit):n.join},t.dashArray=q(t).join(",")||"none");break}default:t=null}return t}function q(n){if(!(n!=null&&n.style))return[];const{dashArray:t,style:r,width:e}=n;if(typeof t=="string"&&t!=="none")return t.split(",").map(i=>Number(i));const l=e??0,o=b.has(r)?b.get(r).map(i=>i*l):[];if(n.cap!=="butt")for(const[i,s]of o.entries())o[i]=i%2==1?s+l:Math.max(s-l,1);return o}const H=(()=>{const n={};return t=>{if(n[t])return n[t];const r=t.replaceAll("-","");return n[t]=r,r}})(),en=new d([128,128,128]);function J(n){var r,e;const t=(r=n.symbolLayers)==null?void 0:r.at(-1);if(t&&"outline"in t)return(e=t==null?void 0:t.outline)==null?void 0:e.size}function on(n){var t;if(!n)return 0;if(y(n)){const r=J(n);return r??0}return R((t=L(n))==null?void 0:t.width)}function ln(n){if(n==null||!("symbolLayers"in n)||n.symbolLayers==null)return!1;switch(n.type){case"point-3d":return n.symbolLayers.some(t=>t.type==="object");case"line-3d":return n.symbolLayers.some(t=>t.type==="path");case"polygon-3d":return n.symbolLayers.some(t=>t.type==="object"||t.type==="extrude");default:return!1}}function an(n){var t;return((t=n.resource)==null?void 0:t.href)??""}function sn(n,t){if(!n)return null;let r=null;return y(n)?r=T(n):m(n)&&(r=n.type==="cim"?g(n):n.color?new d(n.color):null),r?f(r,t):null}function T(n){const t=n.symbolLayers;if(!t)return null;let r=null;return t.forEach(e=>{var l;e.type==="object"&&((l=e.resource)!=null&&l.href)||(r=e.type==="water"?e.color:e.material?e.material.color:null)}),r?new d(r):null}function f(n,t){if(t==null||n==null)return n;const r=n.toRgba();return r[3]=r[3]*t,new d(r)}function U(n,t,r){const e=n.symbolLayers;if(!e)return;const l=(o,i=!1)=>{let s=t??o??null;return(r==null?void 0:r.override)!=null&&(!s&&i&&(s=new d([255,255,255])),s&&(s.a=r.override)),f(s,r==null?void 0:r.add)};e.forEach(o=>{var a,c;if(o.type==="water")return void(o.color=f(o.color,r==null?void 0:r.add));const i=o.material!=null?o.material.color:null,s=l(i,o.type==="icon"&&((a=o.resource)==null?void 0:a.href)!=null);o.material==null?o.material=new A({color:s}):o.material.color=s,"outline"in o&&((c=o.outline)!=null&&c.color)&&(r==null?void 0:r.add)!=null&&(o.outline.color=f(o.outline.color,r.add)),"marker"in o&&o.marker!=null&&(o.marker.color=l(o.marker.color))})}function F(n,t,r){var e;t=t??n.color,(r==null?void 0:r.override)!=null&&t&&(t.a=r.override),t&&(n.color=f(t,r==null?void 0:r.add)),"outline"in n&&((e=n.outline)!=null&&e.color)&&(n.outline.color=f(n.outline.color,r==null?void 0:r.add))}function cn(n,t,r){n&&(t||r!=null)&&(t&&(t=new d(t)),y(n)?U(n,t,r):m(n)&&F(n,t,r))}async function G(n,t){const r=n.symbolLayers;r&&await O(r,async e=>V(e,t))}async function V(n,t){switch(n.type){case"extrude":B(n,t);break;case"icon":case"line":case"text":W(n,t);break;case"path":Q(n,t);break;case"object":await K(n,t)}}function W(n,t){const r=v(t);r!=null&&(n.size=r)}function v(n){for(const t of n)if(typeof t=="number")return t;return null}function B(n,t){const r=t[2];typeof r=="number"&&(n.size=r)}async function K(n,t){const{resourceSize:r,symbolSize:e}=await X(n),l=j(t,r,e);l!=null&&(n.width=h(t[0],e[0],r[0],l),n.depth=h(t[1],e[1],r[1],l),n.height=h(t[2],e[2],r[2],l))}function Q(n,t){const r=j(t,C,[n.width,void 0,n.height]);r!=null&&(n.width=h(t[0],n.width,1,r),n.height=h(t[2],n.height,1,r))}function j(n,t,r){for(let e=0;e<3;e++){const l=n[e];switch(l){case"symbol-value":{const o=r[e];return o!=null?o/t[e]:1}case"proportional":break;default:if(l&&t[e])return l/t[e]}}return null}async function X(n){const{computeObjectLayerResourceSize:t}=await D(()=>import("./symbolLayerUtils-CFt565Oe.js"),__vite__mapDeps([0,1,2]),import.meta.url),r=await t(n,10),{width:e,height:l,depth:o}=n,i=[e,o,l];let s=1;for(let a=0;a<3;a++){const c=i[a];if(c!=null){s=c/r[a];break}}for(let a=0;a<3;a++)i[a]==null&&(i[a]=r[a]*s);return{resourceSize:r,symbolSize:i}}function h(n,t,r,e){switch(n){case"proportional":return r*e;case"symbol-value":return t??r;default:return n}}function Y(n,t){const r=v(t);if(r!=null)switch(n.type){case"simple-marker":n.size=r;break;case"picture-marker":{const e=n.width/n.height;e>1?(n.width=r,n.height=r*e):(n.width=r*e,n.height=r);break}case"simple-line":n.width=r;break;case"text":n.font.size=r}}async function un(n,t){if(n&&t)return y(n)?G(n,t):void(m(n)&&Y(n,t))}function fn(n,t,r){if(n&&t!=null){if(y(n)){const e=n.symbolLayers;e&&e.forEach(l=>{if(l.type==="object")switch(r){case"tilt":l.tilt=(l.tilt??0)+t;break;case"roll":l.roll=(l.roll??0)+t;break;default:l.heading=(l.heading??0)+t}l.type==="icon"&&(l.angle+=t)})}else if(m(n))switch(n.type){case"simple-marker":case"picture-marker":case"text":n.angle+=t;break;case"cim":I(n,t,!0)}}}function dn(n,t){if(!n)return null;const r=n.effects.map(e=>e.toJSON());return E(r)}function hn(n){return n!=null&&n.type==="polygon-3d"&&n.symbolLayers.some(t=>t.type==="extrude")}export{hn as A,cn as L,un as M,fn as N,sn as a,en as b,an as d,rn as f,q as g,ln as h,on as m,dn as q,tn as u,H as w,L as y};
